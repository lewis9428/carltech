function _0x5902(_0x1abed4,_0x2229dd){const _0x3508bf=_0x1b28();return _0x5902=function(_0x21c05b,_0x30da5e){_0x21c05b=_0x21c05b-0x13b;let _0x54a532=_0x3508bf[_0x21c05b];if(_0x5902['fYcgVD']===undefined){var _0x41624e=function(_0x21c566){const _0x4af2e1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x151ad4='',_0x4ff169='';for(let _0x1b4af0=0x0,_0x1a7519,_0x3c60fc,_0x4cf4a1=0x0;_0x3c60fc=_0x21c566['charAt'](_0x4cf4a1++);~_0x3c60fc&&(_0x1a7519=_0x1b4af0%0x4?_0x1a7519*0x40+_0x3c60fc:_0x3c60fc,_0x1b4af0++%0x4)?_0x151ad4+=String['fromCharCode'](0xff&_0x1a7519>>(-0x2*_0x1b4af0&0x6)):0x0){_0x3c60fc=_0x4af2e1['indexOf'](_0x3c60fc);}for(let _0x1259cc=0x0,_0x9074c4=_0x151ad4['length'];_0x1259cc<_0x9074c4;_0x1259cc++){_0x4ff169+='%'+('00'+_0x151ad4['charCodeAt'](_0x1259cc)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4ff169);};_0x5902['qDZhxQ']=_0x41624e,_0x1abed4=arguments,_0x5902['fYcgVD']=!![];}const _0x1b28b4=_0x3508bf[0x0],_0x5902cf=_0x21c05b+_0x1b28b4,_0x375df6=_0x1abed4[_0x5902cf];return!_0x375df6?(_0x54a532=_0x5902['qDZhxQ'](_0x54a532),_0x1abed4[_0x5902cf]=_0x54a532):_0x54a532=_0x375df6,_0x54a532;},_0x5902(_0x1abed4,_0x2229dd);}(function(_0x32e62f,_0x23eb0b){const _0x58e5d6=_0x5902,_0x19ed80=_0x32e62f();while(!![]){try{const _0x1cac16=-parseInt(_0x58e5d6(0x151))/0x1+-parseInt(_0x58e5d6(0x15d))/0x2*(parseInt(_0x58e5d6(0x168))/0x3)+parseInt(_0x58e5d6(0x14e))/0x4*(-parseInt(_0x58e5d6(0x13b))/0x5)+parseInt(_0x58e5d6(0x14f))/0x6*(parseInt(_0x58e5d6(0x164))/0x7)+-parseInt(_0x58e5d6(0x15f))/0x8+-parseInt(_0x58e5d6(0x144))/0x9*(-parseInt(_0x58e5d6(0x16f))/0xa)+parseInt(_0x58e5d6(0x140))/0xb*(parseInt(_0x58e5d6(0x157))/0xc);if(_0x1cac16===_0x23eb0b)break;else _0x19ed80['push'](_0x19ed80['shift']());}catch(_0x4918f0){_0x19ed80['push'](_0x19ed80['shift']());}}}(_0x1b28,0xb8dcf));const _0x30da5e=(function(){let _0x200407=!![];return function(_0x466dcf,_0x497457){const _0x186c5c=_0x200407?function(){const _0x36198f=_0x5902;if(_0x497457){const _0x58eb11=_0x497457[_0x36198f(0x15b)](_0x466dcf,arguments);return _0x497457=null,_0x58eb11;}}:function(){};return _0x200407=![],_0x186c5c;};}());(function(){const _0x3e5a9a={'Zikrr':function(_0x363fc5,_0x17bc57){return _0x363fc5(_0x17bc57);}};_0x30da5e(this,function(){const _0xa9d5b6=_0x5902,_0x2828a6=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x271ec6=new RegExp(_0xa9d5b6(0x14d),'i'),_0x48f934=_0x3e5a9a[_0xa9d5b6(0x13d)](_0x21c05b,'init');!_0x2828a6['test'](_0x48f934+'chain')||!_0x271ec6[_0xa9d5b6(0x15e)](_0x48f934+'input')?_0x3e5a9a['Zikrr'](_0x48f934,'0'):_0x21c05b();})();}());import _0x38e736 from'sqlite3';import{open}from'sqlite';import _0x5e0370 from'fs-extra';import _0x52d468 from'path';import _0x101833 from'quick-lru';import{getConfig}from'./config.js';import{info,error,warn}from'./logger.js';let db,dbReady=![],writeQueue=[],isFlushing=![],flushTimer;const cache=new _0x101833({'maxSize':0x2710});export async function initializeDatabase(){const _0x4379ec=_0x5902,_0x2d2525={'HwLfS':function(_0x19dc8d,_0x4f8530,_0x4dca8a){return _0x19dc8d(_0x4f8530,_0x4dca8a);}};try{const _0x71e4f=getConfig(),_0x416fb6=_0x71e4f['PROJECT_ROOT']||process['cwd'](),_0x7d6a88=_0x71e4f['DB_PATH']?_0x52d468['isAbsolute'](_0x71e4f['DB_PATH'])?_0x71e4f[_0x4379ec(0x163)]:_0x52d468['resolve'](_0x416fb6,_0x71e4f['DB_PATH']):_0x52d468['resolve'](_0x416fb6,'data/db');_0x5e0370['ensureDirSync'](_0x7d6a88);const _0x1f3687=_0x71e4f['DB_NAME']||'database.db',_0x454ed0=_0x52d468['join'](_0x7d6a88,_0x1f3687),_0x41aa8a=_0x52d468['basename'](_0x1f3687,_0x52d468['extname'](_0x1f3687)),_0x979edf=new Date()['toISOString']()[_0x4379ec(0x16c)](0x0,0xa),_0x1108c8=_0x52d468[_0x4379ec(0x154)](_0x7d6a88,_0x41aa8a+'-'+_0x979edf+'.bak');db=await open({'filename':_0x454ed0,'driver':_0x38e736['Database']}),await db[_0x4379ec(0x142)]('PRAGMA\x20journal_mode\x20=\x20WAL;'),await db[_0x4379ec(0x142)](_0x4379ec(0x14b)+(typeof _0x71e4f['DB_CACHE_SIZE']===_0x4379ec(0x15a)?-Math['abs'](_0x71e4f[_0x4379ec(0x14a)]):-0x2710)+';'),await db['exec'](_0x4379ec(0x143)+(_0x71e4f['DB_DURABILITY']==='high'?'FULL':'NORMAL')+';'),await db['exec']('PRAGMA\x20foreign_keys\x20=\x20ON;'),await db['exec']('PRAGMA\x20busy_timeout\x20=\x2010000;'),info('Database\x20initialized\x20with\x20'+(_0x71e4f['DB_DURABILITY']||'normal')+'\x20durability\x20at\x20'+_0x454ed0),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20meta\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20key\x20\x20\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');const _0x4d4f79=await db['get']('PRAGMA\x20user_version'),_0x4dab9b=_0x4d4f79?.['user_version']||0x0;_0x4dab9b<0x1&&await applyMigrations(),await integrityCheck(),await _0x2d2525['HwLfS'](backupDB,_0x454ed0,_0x1108c8),dbReady=!![],startFlushInterval(_0x71e4f['DB_BATCH_SIZE']||0x64),info(_0x4379ec(0x166)+_0x454ed0);}catch(_0x40dc18){error('DB\x20init\x20error:\x20'+(_0x40dc18?.['message']||_0x40dc18),_0x40dc18);throw _0x40dc18;}}async function applyMigrations(){const _0x9a7401=_0x5902,_0x1927ee={'epEtA':'7|3|4|8|5|2|1|6|0'};try{const _0x2da9a7=_0x1927ee['epEtA'][_0x9a7401(0x147)]('|');let _0x57753f=0x0;while(!![]){switch(_0x2da9a7[_0x57753f++]){case'0':info('Schema\x20upgraded\x20to\x20version\x201');continue;case'1':await db['exec']('PRAGMA\x20user_version\x20=\x201;');continue;case'2':await db[_0x9a7401(0x142)]('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20key_value_store\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20key\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');continue;case'3':await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20logs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20ts\x20\x20\x20\x20\x20\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20module\x20\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20level\x20\x20\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');continue;case'4':await db[_0x9a7401(0x142)]('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20blocklists\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20phrase\x20\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20PRIMARY\x20KEY\x20(chat_id,\x20phrase)\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');continue;case'5':await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20infractions\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20user_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ts\x20\x20\x20\x20\x20\x20INTEGER\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');continue;case'6':await db['exec']('COMMIT;');continue;case'7':await db['exec']('BEGIN\x20TRANSACTION;');continue;case'8':await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20connections\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20name\x20\x20\x20\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_id\x20INTEGER\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');continue;}break;}}catch(_0x21331f){await db[_0x9a7401(0x142)]('ROLLBACK;'),error('Migration\x20failed:\x20'+(_0x21331f?.['message']||_0x21331f),_0x21331f);throw _0x21331f;}}async function integrityCheck(){const _0x333b3b=_0x5902,_0x5a0b1e={'FRUKN':function(_0x580ca7,_0x321a0a,_0x3a19b7){return _0x580ca7(_0x321a0a,_0x3a19b7);}};try{const _0x2dd5e7=await db['get']('PRAGMA\x20quick_check;');if(_0x2dd5e7?.['quick_check']!=='ok'){const _0xf2f301=await db[_0x333b3b(0x16a)]('PRAGMA\x20integrity_check;');throw new Error('DB\x20integrity\x20issues:\x20'+_0xf2f301?.['integrity_check']);}}catch(_0x50d202){_0x5a0b1e['FRUKN'](error,'Integrity\x20check\x20failed:\x20'+(_0x50d202?.['message']||_0x50d202),_0x50d202);throw _0x50d202;}}async function backupDB(_0x226ab0,_0x261a09){const _0x2d2b55=_0x5902,_0x532336={'gyvgn':function(_0x471f4d,_0xe20171){return _0x471f4d(_0xe20171);}};try{if(!await _0x5e0370['pathExists'](_0x226ab0))return;const _0x588954=_0x52d468['dirname'](_0x226ab0),_0x40265e=_0x52d468['basename'](_0x226ab0,_0x52d468['extname'](_0x226ab0)),_0x1b21fa=_0x52d468['join'](_0x588954,_0x40265e+'.bak'),_0x273d5b=_0x3d991c=>_0x3d991c['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');let _0x2f351f=[];try{const _0x8f6e25=await _0x5e0370['readdir'](_0x588954),_0x40ce51=new RegExp('^'+_0x273d5b(_0x40265e)+'(?:-\x5cd{4}-\x5cd{2}-\x5cd{2})?\x5c.bak$');_0x2f351f=_0x8f6e25['filter'](_0xe70b83=>_0x40ce51[_0x2d2b55(0x15e)](_0xe70b83))['map'](_0x2a50c7=>_0x52d468['join'](_0x588954,_0x2a50c7));}catch(_0x324ce5){warn('Could\x20not\x20list\x20directory\x20for\x20backups:\x20'+(_0x324ce5?.['message']||_0x324ce5));}const _0x15581f=0x30*0x3c*0x3c*0x3e8;let _0x483c25=!![];if(await _0x5e0370['pathExists'](_0x1b21fa))try{const _0x21c357=await _0x5e0370['stat'](_0x1b21fa),_0x1f7a46=Date['now']()-_0x21c357['mtimeMs'];if(_0x1f7a46<_0x15581f)info('Recent\x20backup\x20exists\x20at\x20'+_0x1b21fa+'\x20(age\x20'+Math['round'](_0x1f7a46/0x3e8)+'s)\x20â€”\x20skipping\x20new\x20backup.'),_0x483c25=![];else for(const _0x243b9e of _0x2f351f){try{await _0x5e0370['remove'](_0x243b9e);}catch(_0x571a05){warn('Failed\x20to\x20remove\x20old\x20backup\x20'+_0x243b9e+':\x20'+(_0x571a05?.['message']||_0x571a05));}}}catch(_0x3f65a7){warn('Could\x20not\x20stat\x20existing\x20backup:\x20'+(_0x3f65a7?.['message']||_0x3f65a7)+'.\x20Will\x20attempt\x20rotation.');for(const _0x188065 of _0x2f351f){if('dNsbK'!=='tzrel')try{await _0x5e0370['remove'](_0x188065);}catch(_0x130d36){warn('Failed\x20to\x20remove\x20old\x20backup\x20'+_0x188065+':\x20'+(_0x130d36?.['message']||_0x130d36));}else{_0x532336['gyvgn'](_0x27d643,_0x222ca8);return;}}}else for(const _0x462e0a of _0x2f351f){try{await _0x5e0370[_0x2d2b55(0x156)](_0x462e0a);}catch(_0x2dd5fd){warn(_0x2d2b55(0x161)+_0x462e0a+':\x20'+(_0x2dd5fd?.['message']||_0x2dd5fd));}}_0x483c25&&(await _0x5e0370['copy'](_0x226ab0,_0x1b21fa,{'overwrite':!![]}),info('Database\x20backup\x20created\x20at\x20'+_0x1b21fa));}catch(_0x23310a){error('Backup\x20failed:\x20'+(_0x23310a?.['message']||_0x23310a),_0x23310a);}}function startFlushInterval(_0x56a60f){const _0x350409={'JrMez':function(_0x2de60a,_0x2bb0c9){return _0x2de60a>_0x2bb0c9;},'gYAbg':function(_0x5acddf,_0x54b198){return _0x5acddf>=_0x54b198;}};_0x350409['gYAbg'](writeQueue['length'],_0x56a60f||0x64)&&flushQueue(_0x56a60f)['catch'](()=>error('Initial\x20flush\x20failed')),flushTimer=setInterval(()=>{const _0x10998b=_0x5902;_0x350409['JrMez'](writeQueue['length'],0x0)&&flushQueue(_0x56a60f)['catch'](()=>error(_0x10998b(0x153)));},0x1388);}export async function get(_0x2023d9){const _0x164a10=_0x5902,_0x2cbc92={'LBrtG':function(_0x56ab03,_0x570d14,_0x5154ed){return _0x56ab03(_0x570d14,_0x5154ed);},'HvUNu':function(_0x106a07,_0x1b1813){return _0x106a07!==_0x1b1813;},'lIRoU':function(_0x1d9840,_0x3cfd54){return _0x1d9840(_0x3cfd54);}};if(cache['has'](_0x2023d9))return cache['get'](_0x2023d9);if(!dbReady){if(_0x2cbc92[_0x164a10(0x141)]('xyOXV','xyOXV')){_0x2cbc92['LBrtG'](_0x44af8d,'DB\x20init\x20error:\x20'+(_0x30083f?.['message']||_0xde0fe0),_0x8ad0a8);throw _0x49b96e;}else return _0x2cbc92['lIRoU'](warn,'DB\x20not\x20ready\x20for\x20get\x20operation.'),undefined;}try{const _0x5e93eb=await db['get']('SELECT\x20value\x20FROM\x20key_value_store\x20WHERE\x20key\x20=\x20?',_0x2023d9);if(_0x5e93eb){const _0x21a31e=JSON['parse'](_0x5e93eb['value']);return cache[_0x164a10(0x155)](_0x2023d9,_0x21a31e),_0x21a31e;}}catch(_0x2a0345){error(_0x164a10(0x13e)+_0x2023d9+'\x22\x20from\x20DB:\x20'+_0x2a0345['message'],_0x2a0345);}return undefined;}function _0x1b28(){const _0x18782a=['su5trvjuie9sifjfueXbq0uGsu5utYbRzxLFDMfSDwvFC3rVCMuGkgTLEsWGDMfSDwuPifzbtfvfuYaOpYWGpYK','C2XPy2u','zNLXBKC','y2f0y2G','odG5mfn2wNbVBq','C3bSAwnL','mZeWntviq0HQt28','D2HPBguGkhrYDwuPihT9','wMLRCNi','rMfPBgvKihrVigDLDcbRzxKGiG','CNvU','ndq2nJG5mxr6ww14DW','shzvtNu','zxHLyW','ufjbr01bihn5BMnOCM9UB3vZid0G','mti2ndvVtKL2txi','zgf0yq','q09ntuLuoW','C3bSAxq','vMvgthK','BgvUz3rO','rejFq0fdsevFu0LArq','ufjbr01bignHy2HLx3nPEMuGpsa','u0LhvevstsbYzwnLAxzLzcaTignSB3nPBMCGzgf0ywjHC2u','xcTCkYaQkd86w2eTEKeTwL8KxvSWltLHlxPblvPFjf0Qkq','odH5D0PAtM8','ndaYnJzyzM5NrMC','BwvZC2fNzq','mtqYmdq0ngHkue96EG','rejFqKfuq0HFu0LArq','ugvYAw9KAwmGzMX1C2GGzMfPBgvK','AM9PBG','C2v0','CMvTB3zL','odrwug9mruq','ChjLCgfYzq','rMfPBgvKihrVihbYB2nLC3mGAxrLBsbVzIb0ExbLia','BNvTyMvY','yxbWBhK','Bg9N','ntm1mtiWuKnQEw5Q','DgvZDa','nJaZotu1mNjItM9Oua','zMLUywXPEMu','rMfPBgvKihrVihjLBw92zsbVBgqGyMfJA3vWia','zgvSzxrL','rejFuefusa','mZi5vxHQsMz2','u2H1DgrVD24GzxjYB3i6ia','rgf0ywjHC2uGCMvHzhKGyxqG','su5trvjuieLove8GBg9NCYaODhmSig1VzhvSzsWGBgv2zwWSig1LC3nHz2uPifzbtfvfuYaOpYWGpYWGpYWGpYK','mtvmENnHBNO','Bgv2zwW','z2v0'];_0x1b28=function(){return _0x18782a;};return _0x1b28();}export function set(_0x5bb835,_0x551357){if(_0x551357===undefined){del(_0x5bb835);return;}cache['set'](_0x5bb835,_0x551357),writeQueue['push']({'type':'set','key':_0x5bb835,'value':JSON['stringify'](_0x551357)});const _0x5ceb25=getConfig(),_0x17d960=_0x5ceb25['DB_BATCH_SIZE']||0x64;writeQueue['length']>=_0x17d960&&flushQueue(_0x17d960)['catch'](()=>error('Batch\x20flush\x20error\x20on\x20set'));}export function del(_0x547672){const _0x287c68=_0x5902;cache[_0x287c68(0x162)](_0x547672),writeQueue['push']({'type':'delete','key':_0x547672});const _0xd5b2b9=getConfig(),_0x1d2dc3=_0xd5b2b9['DB_BATCH_SIZE']||0x64;writeQueue['length']>=_0x1d2dc3&&flushQueue(_0x1d2dc3)['catch'](()=>error('Batch\x20flush\x20error\x20on\x20delete'));}export function logToDB(module,_0xfc6727,_0x252d2f){const _0x533ac6=_0x5902;if(!dbReady||!module||!_0xfc6727||!_0x252d2f)return;const _0x27a54d=Date['now'](),_0x60c5a0={'ts':_0x27a54d,'module':module,'level':_0xfc6727,'message':String(_0x252d2f)['slice'](0x0,0x3e8)};writeQueue['push']({'type':_0x533ac6(0x15c),'data':_0x60c5a0});const _0x2578a1=getConfig(),_0x350030=_0x2578a1['DB_BATCH_SIZE']||0x64;writeQueue['length']>=_0x350030&&flushQueue(_0x350030)[_0x533ac6(0x16e)](()=>error('Batch\x20flush\x20error'));}async function flushQueue(_0x27ca9f){const _0x121725=_0x5902,_0x1f2d44={'gIYgG':function(_0x320cbb,_0x52c695){return _0x320cbb===_0x52c695;},'RvBXh':'delete','YAWSl':'PRAGMA\x20wal_checkpoint(TRUNCATE);','fyqnG':function(_0x4339b2,_0x116d3f){return _0x4339b2>_0x116d3f;}};if(!dbReady||isFlushing)return;isFlushing=!![];const _0x8ab7d1=writeQueue[_0x121725(0x170)](0x0,_0x27ca9f||0x64);if(_0x1f2d44['gIYgG'](_0x8ab7d1['length'],0x0)){isFlushing=![];return;}const _0x4afe1f=[];let _0xecfcd9,_0x23cc78,_0x1a161b;try{await db['exec']('BEGIN\x20TRANSACTION;'),_0xecfcd9=await db[_0x121725(0x158)](_0x121725(0x167)),_0x23cc78=await db['prepare'](_0x121725(0x16b)),_0x1a161b=await db[_0x121725(0x158)]('DELETE\x20FROM\x20key_value_store\x20WHERE\x20key\x20=\x20?');for(const _0x3679b6 of _0x8ab7d1){try{switch(_0x3679b6['type']){case'log':await _0xecfcd9['run'](_0x3679b6[_0x121725(0x145)]['ts'],_0x3679b6['data']['module'],_0x3679b6['data'][_0x121725(0x169)],_0x3679b6[_0x121725(0x145)][_0x121725(0x150)]);break;case _0x121725(0x155):await _0x23cc78[_0x121725(0x13f)](_0x3679b6['key'],_0x3679b6['value']);break;case _0x1f2d44['RvBXh']:await _0x1a161b['run'](_0x3679b6['key']);break;}}catch(_0x450882){warn(_0x121725(0x159)+_0x3679b6['type']+'\x20for\x20key\x20'+_0x3679b6['key']+'.\x20Re-queuing.\x20Error:\x20'+_0x450882[_0x121725(0x150)]),_0x4afe1f['push'](_0x3679b6);}}await db[_0x121725(0x142)](_0x121725(0x146));if(Math['random']()<0.1)try{await db['exec'](_0x1f2d44['YAWSl']);}catch(_0x5ec4cb){}}catch(_0x393583){error('Transaction\x20error:\x20'+(_0x393583?.['message']||_0x393583),_0x393583);try{await db['exec']('ROLLBACK;');}catch(_0x23b973){}_0x4afe1f['push'](..._0x8ab7d1);}finally{if(_0xecfcd9)try{await _0xecfcd9['finalize']();}catch(_0x558879){}if(_0x23cc78)try{await _0x23cc78[_0x121725(0x160)]();}catch(_0x571d89){}if(_0x1a161b)try{await _0x1a161b['finalize']();}catch(_0x446e9b){}_0x1f2d44[_0x121725(0x16d)](_0x4afe1f['length'],0x0)&&(writeQueue['unshift'](..._0x4afe1f),warn('Requeued\x20'+_0x4afe1f['length']+'\x20failed\x20DB\x20entries')),isFlushing=![];}}async function gracefulClose(){const _0x2e4dad=_0x5902;try{clearInterval(flushTimer);const _0x45082e=getConfig();writeQueue['length']>0x0&&(info('Flushing\x20'+writeQueue[_0x2e4dad(0x149)]+'\x20remaining\x20entries...'),await flushQueue(_0x45082e[_0x2e4dad(0x152)]||0x64)),db&&(await db['close'](),info('Database\x20connection\x20closed'));}catch(_0x410733){error(_0x2e4dad(0x165)+(_0x410733?.['message']||_0x410733),_0x410733);}}process['once']('SIGINT',()=>{info('SIGINT\x20received\x20-\x20closing\x20database'),gracefulClose()['finally'](()=>process['exit'](0x0));}),(function(){const _0x528076={'zDcBD':function(_0x2e8f49,_0x33174f){return _0x2e8f49(_0x33174f);}},_0x16b924=function(){let _0x2c3ca2;try{_0x2c3ca2=_0x528076['zDcBD'](Function,'return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4d7a19){_0x2c3ca2=window;}return _0x2c3ca2;},_0x145ce8=_0x16b924();_0x145ce8['setInterval'](_0x21c05b,0x61a80);}()),process['once']('SIGTERM',()=>{const _0x26a8e9=_0x5902;info(_0x26a8e9(0x14c)),gracefulClose()['finally'](()=>process['exit'](0x0));});export{db};function _0x21c05b(_0x1f3494){const _0x42a8f6=_0x5902,_0x50cabf={'ItKUI':'string','VeFLy':function(_0x215751,_0x15f633){return _0x215751(_0x15f633);}};function _0x2f6135(_0x1130a0){const _0x10ee7f=_0x5902;if(typeof _0x1130a0===_0x50cabf['ItKUI'])return function(_0x48ed43){}['constructor'](_0x10ee7f(0x13c))[_0x10ee7f(0x15b)]('counter');else(''+_0x1130a0/_0x1130a0)['length']!==0x1||_0x1130a0%0x14===0x0?'EYTWN'!=='EYTWN'?_0x564af9('Shutdown\x20error:\x20'+(_0x2c252e?.['message']||_0xc558b9),_0x1603e9):function(){return!![];}['constructor']('debu'+'gger')['call']('action'):function(){return![];}['constructor']('debu'+'gger')[_0x10ee7f(0x15b)]('stateObject');_0x2f6135(++_0x1130a0);}try{if(_0x1f3494)return _0x2f6135;else _0x50cabf[_0x42a8f6(0x148)](_0x2f6135,0x0);}catch(_0x25d545){}}