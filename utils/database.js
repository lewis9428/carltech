(function(_0x15b4ff,_0x3e4efe){const _0x17e114=_0x162b,_0x396fa2=_0x15b4ff();while(!![]){try{const _0x40ab5e=parseInt(_0x17e114(0x165))/0x1*(-parseInt(_0x17e114(0x175))/0x2)+parseInt(_0x17e114(0x15b))/0x3*(-parseInt(_0x17e114(0x17e))/0x4)+-parseInt(_0x17e114(0x163))/0x5*(parseInt(_0x17e114(0x17c))/0x6)+-parseInt(_0x17e114(0x16b))/0x7*(parseInt(_0x17e114(0x169))/0x8)+-parseInt(_0x17e114(0x16d))/0x9+-parseInt(_0x17e114(0x159))/0xa+parseInt(_0x17e114(0x185))/0xb;if(_0x40ab5e===_0x3e4efe)break;else _0x396fa2['push'](_0x396fa2['shift']());}catch(_0x585b5e){_0x396fa2['push'](_0x396fa2['shift']());}}}(_0x3eef,0x207fc));const _0x1bd3dc=(function(){let _0x2a5db5=!![];return function(_0x1a55b8,_0x22cbba){const _0x148caa=_0x2a5db5?function(){if(_0x22cbba){const _0x1db2a7=_0x22cbba['apply'](_0x1a55b8,arguments);return _0x22cbba=null,_0x1db2a7;}}:function(){};return _0x2a5db5=![],_0x148caa;};}());(function(){const _0x2de1af=_0x162b,_0x280397=function(){const _0x15c0de=_0x162b;let _0x3971fe;try{_0x3971fe=Function('return\x20(function()\x20'+_0x15c0de(0x184)+');')();}catch(_0x134690){_0x3971fe=window;}return _0x3971fe;},_0x41e6ca=_0x280397();_0x41e6ca[_0x2de1af(0x16e)](_0xf46ab5,0x61a80);}()),(function(){const _0x1c0f51={'CvGZB':function(_0x2962d9,_0x87d837,_0x104a52){return _0x2962d9(_0x87d837,_0x104a52);}};_0x1c0f51['CvGZB'](_0x1bd3dc,this,function(){const _0x40c4dd=_0x162b,_0x3689fb=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x2838cf=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x56a648=_0xf46ab5('init');!_0x3689fb['test'](_0x56a648+'chain')||!_0x2838cf[_0x40c4dd(0x15a)](_0x56a648+'input')?_0x56a648('0'):_0xf46ab5();})();}());import _0x2897a0 from'sqlite3';import{open}from'sqlite';import _0x5e74db from'fs-extra';import _0x1bb514 from'path';import _0x14341a from'quick-lru';import{getConfig}from'./config.js';import{info,error,warn}from'./logger.js';let db,dbReady=![],writeQueue=[],isFlushing=![],flushTimer;const cache=new _0x14341a({'maxSize':0x2710});export async function initializeDatabase(){const _0x17e697=_0x162b,_0x355911={'QwIqJ':'database.db','UlhTM':function(_0x25fde4,_0x596c27){return _0x25fde4<_0x596c27;},'RBzzG':function(_0x3d5feb){return _0x3d5feb();}};try{const _0x31998e=getConfig(),_0x510e44=_0x31998e['PROJECT_ROOT']||process['cwd'](),_0x5b4416=_0x31998e[_0x17e697(0x167)]?_0x1bb514['isAbsolute'](_0x31998e[_0x17e697(0x167)])?_0x31998e['DB_PATH']:_0x1bb514['resolve'](_0x510e44,_0x31998e['DB_PATH']):_0x1bb514['resolve'](_0x510e44,'data/db');_0x5e74db['ensureDirSync'](_0x5b4416);const _0x240e97=_0x31998e['DB_NAME']||_0x355911['QwIqJ'],_0x214b6f=_0x1bb514['join'](_0x5b4416,_0x240e97),_0x1dcf7a=_0x1bb514['basename'](_0x240e97,_0x1bb514['extname'](_0x240e97)),_0x1e9cc8=new Date()['toISOString']()[_0x17e697(0x17d)](0x0,0xa),_0x32649c=_0x1bb514['join'](_0x5b4416,_0x1dcf7a+'-'+_0x1e9cc8+'.bak');db=await open({'filename':_0x214b6f,'driver':_0x2897a0['Database']}),await db['exec']('PRAGMA\x20journal_mode\x20=\x20WAL;'),await db['exec']('PRAGMA\x20cache_size\x20=\x20'+(typeof _0x31998e['DB_CACHE_SIZE']==='number'?-Math['abs'](_0x31998e['DB_CACHE_SIZE']):-0x2710)+';'),await db['exec'](_0x17e697(0x181)+(_0x31998e['DB_DURABILITY']==='high'?'FULL':'NORMAL')+';'),await db['exec']('PRAGMA\x20foreign_keys\x20=\x20ON;'),await db[_0x17e697(0x16a)](_0x17e697(0x183)),info('Database\x20initialized\x20with\x20'+(_0x31998e['DB_DURABILITY']||'normal')+'\x20durability\x20at\x20'+_0x214b6f),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20meta\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20key\x20\x20\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');const _0x53ccda=await db['get']('PRAGMA\x20user_version'),_0x1a2c85=_0x53ccda?.['user_version']||0x0;_0x355911['UlhTM'](_0x1a2c85,0x1)&&await _0x355911['RBzzG'](applyMigrations),await integrityCheck(),await backupDB(_0x214b6f,_0x32649c),dbReady=!![],startFlushInterval(_0x31998e['DB_BATCH_SIZE']||0x64),info(_0x17e697(0x168)+_0x214b6f);}catch(_0x5dd040){error('DB\x20init\x20error:\x20'+(_0x5dd040?.['message']||_0x5dd040),_0x5dd040);throw _0x5dd040;}}async function applyMigrations(){const _0x561674=_0x162b;try{await db['exec']('BEGIN\x20TRANSACTION;'),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20logs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20ts\x20\x20\x20\x20\x20\x20INTEGER\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20module\x20\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20level\x20\x20\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20'),await db[_0x561674(0x16a)](_0x561674(0x16f)),await db['exec'](_0x561674(0x178)),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20infractions\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20user_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ts\x20\x20\x20\x20\x20\x20INTEGER\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20'),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20key_value_store\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20key\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20'),await db[_0x561674(0x16a)]('PRAGMA\x20user_version\x20=\x201;'),await db['exec']('COMMIT;'),info('Schema\x20upgraded\x20to\x20version\x201');}catch(_0x3b89c3){await db[_0x561674(0x16a)]('ROLLBACK;'),error('Migration\x20failed:\x20'+(_0x3b89c3?.[_0x561674(0x180)]||_0x3b89c3),_0x3b89c3);throw _0x3b89c3;}}async function integrityCheck(){const _0x38cb08={'VvBiC':function(_0x2d4757,_0x403517){return _0x2d4757!==_0x403517;}};try{if('NFSEB'!=='JYSBk'){const _0x224fcb=await db['get']('PRAGMA\x20quick_check;');if(_0x38cb08['VvBiC'](_0x224fcb?.['quick_check'],'ok')){const _0x5f4b3f=await db['get']('PRAGMA\x20integrity_check;');throw new Error('DB\x20integrity\x20issues:\x20'+_0x5f4b3f?.['integrity_check']);}}else return!![];}catch(_0x1c64af){error('Integrity\x20check\x20failed:\x20'+(_0x1c64af?.['message']||_0x1c64af),_0x1c64af);throw _0x1c64af;}}async function backupDB(_0x2db93b,_0x26ebf0){const _0x1a37c1=_0x162b,_0x39dc08={'HCyfU':'yggwc','UVGAS':function(_0x4b959c,_0x589bb8){return _0x4b959c-_0x589bb8;}};try{if(!await _0x5e74db[_0x1a37c1(0x164)](_0x2db93b))return;const _0x405d0c=_0x1bb514['dirname'](_0x2db93b),_0x34e09b=_0x1bb514['basename'](_0x2db93b,_0x1bb514['extname'](_0x2db93b)),_0x15c6f6=_0x1bb514['join'](_0x405d0c,_0x34e09b+'.bak'),_0x3647f1=_0x628083=>_0x628083[_0x1a37c1(0x17f)](/[.*+?^${}()|[\]\\]/g,'\x5c$&');let _0x124a8f=[];try{const _0x1c7446=await _0x5e74db['readdir'](_0x405d0c),_0x4dc0c3=new RegExp('^'+_0x3647f1(_0x34e09b)+_0x1a37c1(0x15c));_0x124a8f=_0x1c7446[_0x1a37c1(0x155)](_0x17d14f=>_0x4dc0c3[_0x1a37c1(0x15a)](_0x17d14f))['map'](_0x2f8e00=>_0x1bb514['join'](_0x405d0c,_0x2f8e00));}catch(_0x597a18){if('yggwc'===_0x39dc08['HCyfU'])warn('Could\x20not\x20list\x20directory\x20for\x20backups:\x20'+(_0x597a18?.['message']||_0x597a18));else{let _0x2edba5;try{_0x2edba5=_0x537b0('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x37ad59){_0x2edba5=_0x441c0b;}return _0x2edba5;}}const _0xee82fc=0x30*0x3c*0x3c*0x3e8;let _0x27974f=!![];if(await _0x5e74db['pathExists'](_0x15c6f6))try{if('RKuGW'!=='RKuGW')_0x3821fe(_0xa7bf7)['catch'](()=>_0x3418b4('Batch\x20flush\x20error'));else{const _0x27e101=await _0x5e74db['stat'](_0x15c6f6),_0x4f9c12=_0x39dc08['UVGAS'](Date['now'](),_0x27e101['mtimeMs']);if(_0x4f9c12<_0xee82fc)info('Recent\x20backup\x20exists\x20at\x20'+_0x15c6f6+_0x1a37c1(0x173)+Math['round'](_0x4f9c12/0x3e8)+'s)\x20â€”\x20skipping\x20new\x20backup.'),_0x27974f=![];else for(const _0x3fd23b of _0x124a8f){try{await _0x5e74db['remove'](_0x3fd23b);}catch(_0x4d513c){warn('Failed\x20to\x20remove\x20old\x20backup\x20'+_0x3fd23b+':\x20'+(_0x4d513c?.['message']||_0x4d513c));}}}}catch(_0x2831c9){warn('Could\x20not\x20stat\x20existing\x20backup:\x20'+(_0x2831c9?.['message']||_0x2831c9)+'.\x20Will\x20attempt\x20rotation.');for(const _0x5b85a3 of _0x124a8f){try{await _0x5e74db['remove'](_0x5b85a3);}catch(_0x36dcd3){warn('Failed\x20to\x20remove\x20old\x20backup\x20'+_0x5b85a3+':\x20'+(_0x36dcd3?.['message']||_0x36dcd3));}}}else{if('QUyRE'!=='QUyRE'){_0x3ea6d2(_0x585a72);return;}else for(const _0x1da1af of _0x124a8f){try{await _0x5e74db['remove'](_0x1da1af);}catch(_0x37eaa2){warn(_0x1a37c1(0x17b)+_0x1da1af+':\x20'+(_0x37eaa2?.['message']||_0x37eaa2));}}}_0x27974f&&(await _0x5e74db['copy'](_0x2db93b,_0x15c6f6,{'overwrite':!![]}),info('Database\x20backup\x20created\x20at\x20'+_0x15c6f6));}catch(_0x4e0282){error('Backup\x20failed:\x20'+(_0x4e0282?.[_0x1a37c1(0x180)]||_0x4e0282),_0x4e0282);}}function startFlushInterval(_0x80b9b6){const _0x1b6923=_0x162b,_0x3230d7={'EGYNq':function(_0x1171a0,_0x4e9ce0){return _0x1171a0>=_0x4e9ce0;}};_0x3230d7[_0x1b6923(0x182)](writeQueue[_0x1b6923(0x154)],_0x80b9b6||0x64)&&flushQueue(_0x80b9b6)['catch'](()=>error('Initial\x20flush\x20failed')),flushTimer=setInterval(()=>{writeQueue['length']>0x0&&flushQueue(_0x80b9b6)['catch'](()=>error('Periodic\x20flush\x20failed'));},0x1388);}export async function get(_0x385d32){const _0x2c66c1=_0x162b,_0x3d77a3={'Olswb':'SELECT\x20value\x20FROM\x20key_value_store\x20WHERE\x20key\x20=\x20?'};if(cache[_0x2c66c1(0x166)](_0x385d32))return cache['get'](_0x385d32);if(!dbReady)return warn('DB\x20not\x20ready\x20for\x20get\x20operation.'),undefined;try{const _0x3238e8=await db['get'](_0x3d77a3['Olswb'],_0x385d32);if(_0x3238e8){const _0x334f2e=JSON[_0x2c66c1(0x171)](_0x3238e8['value']);return cache[_0x2c66c1(0x176)](_0x385d32,_0x334f2e),_0x334f2e;}}catch(_0x450158){error('Failed\x20to\x20get\x20key\x20\x22'+_0x385d32+'\x22\x20from\x20DB:\x20'+_0x450158['message'],_0x450158);}return undefined;}export function set(_0x2ab92f,_0x354221){if(_0x354221===undefined){del(_0x2ab92f);return;}cache['set'](_0x2ab92f,_0x354221),writeQueue['push']({'type':'set','key':_0x2ab92f,'value':JSON['stringify'](_0x354221)});const _0x4d1369=getConfig(),_0x16c57a=_0x4d1369['DB_BATCH_SIZE']||0x64;writeQueue['length']>=_0x16c57a&&flushQueue(_0x16c57a)['catch'](()=>error('Batch\x20flush\x20error\x20on\x20set'));}export function del(_0x53b57a){const _0x34d2d0=_0x162b,_0x365f18={'RflLR':function(_0x4f6a97){return _0x4f6a97();},'tEXCf':function(_0x1cfb13,_0x391d0b){return _0x1cfb13>=_0x391d0b;}};cache[_0x34d2d0(0x172)](_0x53b57a),writeQueue['push']({'type':'delete','key':_0x53b57a});const _0x5e47f8=_0x365f18['RflLR'](getConfig),_0x3349e1=_0x5e47f8['DB_BATCH_SIZE']||0x64;_0x365f18[_0x34d2d0(0x161)](writeQueue['length'],_0x3349e1)&&flushQueue(_0x3349e1)[_0x34d2d0(0x170)](()=>error('Batch\x20flush\x20error\x20on\x20delete'));}export function logToDB(module,_0x3b7510,_0xbe138a){const _0x1f974a=_0x162b;if(!dbReady||!module||!_0x3b7510||!_0xbe138a)return;const _0x4621d3=Date[_0x1f974a(0x179)](),_0x286442={'ts':_0x4621d3,'module':module,'level':_0x3b7510,'message':String(_0xbe138a)['slice'](0x0,0x3e8)};writeQueue['push']({'type':_0x1f974a(0x186),'data':_0x286442});const _0x4081b1=getConfig(),_0x3c6742=_0x4081b1['DB_BATCH_SIZE']||0x64;writeQueue['length']>=_0x3c6742&&flushQueue(_0x3c6742)['catch'](()=>error('Batch\x20flush\x20error'));}function _0x162b(_0x5aafa6,_0x3df192){const _0x48af02=_0x3eef();return _0x162b=function(_0xf46ab5,_0x1bd3dc){_0xf46ab5=_0xf46ab5-0x152;let _0x40c908=_0x48af02[_0xf46ab5];if(_0x162b['JrcuJE']===undefined){var _0x5f2592=function(_0x3d0f7b){const _0x1ebdf5='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1dc564='',_0x3a672b='';for(let _0x16d72c=0x0,_0x3ef482,_0x26c482,_0x7aebbc=0x0;_0x26c482=_0x3d0f7b['charAt'](_0x7aebbc++);~_0x26c482&&(_0x3ef482=_0x16d72c%0x4?_0x3ef482*0x40+_0x26c482:_0x26c482,_0x16d72c++%0x4)?_0x1dc564+=String['fromCharCode'](0xff&_0x3ef482>>(-0x2*_0x16d72c&0x6)):0x0){_0x26c482=_0x1ebdf5['indexOf'](_0x26c482);}for(let _0x57cd34=0x0,_0x3ae2e7=_0x1dc564['length'];_0x57cd34<_0x3ae2e7;_0x57cd34++){_0x3a672b+='%'+('00'+_0x1dc564['charCodeAt'](_0x57cd34)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3a672b);};_0x162b['nxSjKN']=_0x5f2592,_0x5aafa6=arguments,_0x162b['JrcuJE']=!![];}const _0x3eef42=_0x48af02[0x0],_0x162baf=_0xf46ab5+_0x3eef42,_0x1544d0=_0x5aafa6[_0x162baf];return!_0x1544d0?(_0x40c908=_0x162b['nxSjKN'](_0x40c908),_0x5aafa6[_0x162baf]=_0x40c908):_0x40c908=_0x1544d0,_0x40c908;},_0x162b(_0x5aafa6,_0x3df192);}function _0x3eef(){const _0x20b3bf=['zxHPDa','uMvXDwv1zwqG','zwzWvvy','yxbWBhK','Devyq2y','y2fSBa','nJvnru9YAey','Cgf0Aev4Axn0CW','mZu0n3PSq09mAG','AgfZ','rejFuefusa','rgf0ywjHC2uGCMvHzhKGyxqG','mZjYsuTJy0i','zxHLyW','mZa1nZC0s0PKu2DM','zMLUywXSEq','mteXode2ovnsyxfSuq','C2v0sw50zxj2ywW','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtigjSB2nRBgLZDhmGkaOGicaGicaGignOyxrFAwqGsu5uruDfuIWkicaGicaGicbWAhjHC2uGifrfwfqScIaGicaGicaGufjjtufswsblrvKGkgnOyxrFAwqSihbOCMfZzsKkicaGicaGktSkicaGia','y2f0y2G','CgfYC2u','zgvSzxrL','icHHz2uG','ChjLCgfYzq','ofzWrePQzq','C2v0','revmrvrfiezst00GA2v5x3zHBhvLx3n0B3jLifDirvjfigTLEsa9id8','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtignVBM5Ly3rPB25ZicGkicaGicaGicbUyw1LicaGifrfwfqGufjjtufswsblrvKScIaGicaGicaGy2HHDf9PzcbjtLrfr0vscIaGicaGicK7cIaGica','BM93','zgf0yq','rMfPBgvKihrVihjLBw92zsbVBgqGyMfJA3vWia','ntKZotr6ALrPExq','C2XPy2u','mtaZnJi4AfHQqvHR','CMvWBgfJzq','BwvZC2fNzq','ufjbr01bihn5BMnOCM9UB3vZid0G','ruDztNe','ufjbr01bigj1C3LFDgLTzw91Dca9ideWmdaWoW','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','ote4nJa1nLDhzvHRsa','Bg9N','u0Lhsu5uihjLy2vPDMvKic0Gy2XVC2LUzYbKyxrHyMfZzq','vhjHBNnHy3rPB24GzxjYB3i6ia','BgvUz3rO','zMLSDgvY','CNvU','lIbszs1XDwv1Aw5NlIbfCNjVCJOG','D2HPBguGkhrYDwuPihT9','mtGYnde1mfDtsfvVtG','DgvZDa','oxflt2DdCW','kd86lvXKEZr9lvXKEZj9lvXKEZj9kt9ClMjHAYq'];_0x3eef=function(){return _0x20b3bf;};return _0x3eef();}async function flushQueue(_0x5e185a){const _0x216162=_0x162b,_0x47f130={'nVKCp':function(_0x1c7e5d,_0x2d0e7f){return _0x1c7e5d(_0x2d0e7f);}};if(!dbReady||isFlushing)return;isFlushing=!![];const _0x531bdd=writeQueue['splice'](0x0,_0x5e185a||0x64);if(_0x531bdd['length']===0x0){isFlushing=![];return;}const _0xf2f384=[];let _0x9f91c5,_0x1126c1,_0x2f859b;try{await db['exec']('BEGIN\x20TRANSACTION;'),_0x9f91c5=await db[_0x216162(0x174)]('INSERT\x20INTO\x20logs\x20(ts,\x20module,\x20level,\x20message)\x20VALUES\x20(?,\x20?,\x20?,\x20?)'),_0x1126c1=await db['prepare']('INSERT\x20OR\x20REPLACE\x20INTO\x20key_value_store\x20(key,\x20value)\x20VALUES\x20(?,\x20?)'),_0x2f859b=await db['prepare'](_0x216162(0x177));for(const _0x9ca362 of _0x531bdd){try{switch(_0x9ca362['type']){case'log':await _0x9f91c5['run'](_0x9ca362['data']['ts'],_0x9ca362['data']['module'],_0x9ca362['data']['level'],_0x9ca362[_0x216162(0x17a)]['message']);break;case'set':await _0x1126c1['run'](_0x9ca362['key'],_0x9ca362['value']);break;case'delete':await _0x2f859b[_0x216162(0x156)](_0x9ca362['key']);break;}}catch(_0x2434c3){warn('Failed\x20to\x20process\x20item\x20of\x20type\x20'+_0x9ca362['type']+'\x20for\x20key\x20'+_0x9ca362['key']+_0x216162(0x157)+_0x2434c3['message']),_0xf2f384['push'](_0x9ca362);}}await db[_0x216162(0x16a)]('COMMIT;');if(Math['random']()<0.1)try{await db['exec']('PRAGMA\x20wal_checkpoint(TRUNCATE);');}catch(_0x519815){}}catch(_0x478b80){error(_0x216162(0x153)+(_0x478b80?.[_0x216162(0x180)]||_0x478b80),_0x478b80);try{await db['exec']('ROLLBACK;');}catch(_0x3789d6){}_0xf2f384['push'](..._0x531bdd);}finally{if(_0x9f91c5)try{await _0x9f91c5['finalize']();}catch(_0x6af092){}if(_0x1126c1)try{await _0x1126c1['finalize']();}catch(_0x165a79){}if(_0x2f859b)try{await _0x2f859b['finalize']();}catch(_0x38da4c){}_0xf2f384[_0x216162(0x154)]>0x0&&(writeQueue['unshift'](..._0xf2f384),_0x47f130['nVKCp'](warn,_0x216162(0x15e)+_0xf2f384[_0x216162(0x154)]+'\x20failed\x20DB\x20entries')),isFlushing=![];}}async function gracefulClose(){const _0x4b521e=_0x162b;try{clearInterval(flushTimer);const _0x4ffc74=getConfig();writeQueue[_0x4b521e(0x154)]>0x0&&(info('Flushing\x20'+writeQueue[_0x4b521e(0x154)]+'\x20remaining\x20entries...'),await flushQueue(_0x4ffc74['DB_BATCH_SIZE']||0x64)),db&&(await db['close'](),info('Database\x20connection\x20closed'));}catch(_0xdf5b84){error('Shutdown\x20error:\x20'+(_0xdf5b84?.['message']||_0xdf5b84),_0xdf5b84);}}process['once']('SIGINT',()=>{const _0x4fda79=_0x162b;info(_0x4fda79(0x152)),gracefulClose()['finally'](()=>process['exit'](0x0));}),process['once']('SIGTERM',()=>{const _0x3697f7=_0x162b;info('SIGTERM\x20received\x20-\x20closing\x20database'),gracefulClose()[_0x3697f7(0x16c)](()=>process[_0x3697f7(0x15d)](0x0));});export{db};function _0xf46ab5(_0xe922f6){const _0x478a23={'lqxCo':function(_0x18018a,_0x5c6756){return _0x18018a!==_0x5c6756;},'MfALE':'debu'};function _0x111b5f(_0x2966bb){const _0x469f7f=_0x162b;if(typeof _0x2966bb==='string')return function(_0x4174ed){}['constructor'](_0x469f7f(0x158))['apply']('counter');else _0x478a23['lqxCo']((''+_0x2966bb/_0x2966bb)[_0x469f7f(0x154)],0x1)||_0x2966bb%0x14===0x0?function(){return!![];}['constructor'](_0x478a23['MfALE']+'gger')[_0x469f7f(0x162)]('action'):function(){const _0x5c8da6=_0x469f7f;if('efpUV'!==_0x5c8da6(0x15f))_0x3bb4c0('SIGTERM\x20received\x20-\x20closing\x20database'),_0x46ee0a()['finally'](()=>process[_0x5c8da6(0x15d)](0x0));else return![];}['constructor']('debu'+'gger')[_0x469f7f(0x160)]('stateObject');_0x111b5f(++_0x2966bb);}try{if(_0xe922f6)return _0x111b5f;else _0x111b5f(0x0);}catch(_0x5e074e){}}