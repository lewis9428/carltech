const _0x5c8f2a=_0x14bb;(function(_0x5f3d74,_0x22c22a){const _0x449a93=_0x14bb,_0x28ee86=_0x5f3d74();while(!![]){try{const _0x4e587b=-parseInt(_0x449a93(0x115))/0x1+-parseInt(_0x449a93(0x110))/0x2*(parseInt(_0x449a93(0x136))/0x3)+-parseInt(_0x449a93(0x128))/0x4+parseInt(_0x449a93(0x112))/0x5+parseInt(_0x449a93(0xf9))/0x6*(-parseInt(_0x449a93(0x10f))/0x7)+parseInt(_0x449a93(0x121))/0x8+parseInt(_0x449a93(0xf6))/0x9*(parseInt(_0x449a93(0x109))/0xa);if(_0x4e587b===_0x22c22a)break;else _0x28ee86['push'](_0x28ee86['shift']());}catch(_0x40d623){_0x28ee86['push'](_0x28ee86['shift']());}}}(_0x195b,0x4164b));const _0x4dfb97=(function(){let _0x4cac4c=!![];return function(_0x29c453,_0x3350e7){const _0x547135={'fLBZg':function(_0x1c89a5,_0x113025){return _0x1c89a5===_0x113025;},'ZGLad':'XsYjO'},_0x48a102=_0x4cac4c?function(){const _0x853b82=_0x14bb,_0x557d3d={'vjrjq':function(_0x4fce99,_0x5ed239){return _0x4fce99(_0x5ed239);}};if(_0x547135[_0x853b82(0x107)]('nMhjL',_0x547135[_0x853b82(0x102)]))return _0x13bdbf;else{if(_0x3350e7){if('Brgqv'!=='DotUQ'){const _0x30e3d5=_0x3350e7['apply'](_0x29c453,arguments);return _0x3350e7=null,_0x30e3d5;}else _0x557d3d['vjrjq'](_0x383907,'Failed\x20to\x20remove\x20old\x20backup\x20'+_0x302f38+':\x20'+(_0x5c3faa?.['message']||_0x513d59));}}}:function(){};return _0x4cac4c=![],_0x48a102;};}());(function(){const _0x48a95b={'BtvVN':function(_0x2c1bc0,_0x55cb61){return _0x2c1bc0===_0x55cb61;},'YDsIE':'chain'};_0x4dfb97(this,function(){const _0x288973=_0x14bb;if(_0x48a95b['BtvVN'](_0x288973(0xfc),_0x288973(0xfc))){const _0x32c6b6=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x307de7=new RegExp(_0x288973(0x120),'i'),_0x55b4ea=_0x5d0c12('init');!_0x32c6b6[_0x288973(0x100)](_0x55b4ea+_0x48a95b['YDsIE'])||!_0x307de7['test'](_0x55b4ea+_0x288973(0x104))?_0x55b4ea('0'):_0x5d0c12();}else _0x23d89c(_0x67f545)['catch'](()=>_0x2cf6ce('Batch\x20flush\x20error\x20on\x20delete'));})();}());import _0x38a3cf from'sqlite3';import{open}from'sqlite';import _0x45052e from'fs-extra';import _0x3d6b72 from'path';import _0x30dab8 from'quick-lru';import{getConfig}from'./config.js';import{info,error,warn}from'./logger.js';let db,dbReady=![],writeQueue=[],isFlushing=![],flushTimer;const cache=new _0x30dab8({'maxSize':0x2710});export async function initializeDatabase(){const _0x2b808e=_0x14bb,_0x404265={'XjciQ':'normal'};try{const _0x12591f=getConfig(),_0x124c26=_0x12591f[_0x2b808e(0x118)]||process['cwd'](),_0x4ea9fe=_0x12591f['DB_PATH']?_0x3d6b72['isAbsolute'](_0x12591f['DB_PATH'])?_0x12591f['DB_PATH']:_0x3d6b72['resolve'](_0x124c26,_0x12591f[_0x2b808e(0x127)]):_0x3d6b72['resolve'](_0x124c26,'data/db');_0x45052e['ensureDirSync'](_0x4ea9fe);const _0x587bb2=_0x12591f[_0x2b808e(0x129)]||'database.db',_0x35586e=_0x3d6b72[_0x2b808e(0x12d)](_0x4ea9fe,_0x587bb2),_0x20cd27=_0x3d6b72['basename'](_0x587bb2,_0x3d6b72['extname'](_0x587bb2)),_0x4f0394=new Date()['toISOString']()[_0x2b808e(0x122)](0x0,0xa),_0x1563e2=_0x3d6b72[_0x2b808e(0x12d)](_0x4ea9fe,_0x20cd27+'-'+_0x4f0394+'.bak');db=await open({'filename':_0x35586e,'driver':_0x38a3cf['Database']}),await db[_0x2b808e(0x11b)]('PRAGMA\x20journal_mode\x20=\x20WAL;'),await db['exec'](_0x2b808e(0xfb)+(typeof _0x12591f[_0x2b808e(0x138)]==='number'?-Math['abs'](_0x12591f['DB_CACHE_SIZE']):-0x2710)+';'),await db['exec']('PRAGMA\x20synchronous\x20=\x20'+(_0x12591f['DB_DURABILITY']==='high'?'FULL':'NORMAL')+';'),await db['exec']('PRAGMA\x20foreign_keys\x20=\x20ON;'),await db['exec']('PRAGMA\x20busy_timeout\x20=\x2010000;'),info('Database\x20initialized\x20with\x20'+(_0x12591f['DB_DURABILITY']||_0x404265['XjciQ'])+'\x20durability\x20at\x20'+_0x35586e),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20meta\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20key\x20\x20\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');const _0x45c43f=await db[_0x2b808e(0xf7)]('PRAGMA\x20user_version'),_0x56c3f5=_0x45c43f?.['user_version']||0x0;_0x56c3f5<0x1&&await applyMigrations(),await integrityCheck(),await backupDB(_0x35586e,_0x1563e2),dbReady=!![],startFlushInterval(_0x12591f['DB_BATCH_SIZE']||0x64),info('Database\x20ready\x20at\x20'+_0x35586e);}catch(_0x97c602){error('DB\x20init\x20error:\x20'+(_0x97c602?.['message']||_0x97c602),_0x97c602);throw _0x97c602;}}async function applyMigrations(){const _0x23b0b8=_0x14bb;try{'rYnTK'!=='VjdqU'?(await db['exec'](_0x23b0b8(0x11f)),await db['exec'](_0x23b0b8(0x11c)),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20blocklists\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20phrase\x20\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20PRIMARY\x20KEY\x20(chat_id,\x20phrase)\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20'),await db[_0x23b0b8(0x11b)](_0x23b0b8(0x106)),await db['exec'](_0x23b0b8(0x10b)),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20key_value_store\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20key\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20'),await db['exec']('PRAGMA\x20user_version\x20=\x201;'),await db[_0x23b0b8(0x11b)]('COMMIT;'),info('Schema\x20upgraded\x20to\x20version\x201')):_0x206e44=_0x3721a0;}catch(_0x5a039e){await db['exec'](_0x23b0b8(0x11e)),error('Migration\x20failed:\x20'+(_0x5a039e?.[_0x23b0b8(0x12e)]||_0x5a039e),_0x5a039e);throw _0x5a039e;}}async function integrityCheck(){const _0x4b89e3=_0x14bb;try{const _0x249a55=await db[_0x4b89e3(0xf7)]('PRAGMA\x20quick_check;');if(_0x249a55?.[_0x4b89e3(0xf8)]!=='ok'){const _0xcc8847=await db['get']('PRAGMA\x20integrity_check;');throw new Error('DB\x20integrity\x20issues:\x20'+_0xcc8847?.['integrity_check']);}}catch(_0x1414a0){error('Integrity\x20check\x20failed:\x20'+(_0x1414a0?.[_0x4b89e3(0x12e)]||_0x1414a0),_0x1414a0);throw _0x1414a0;}}async function backupDB(_0x23cac9,_0x4eda81){const _0x1f2df6=_0x14bb,_0x3727e7={'WEZga':function(_0x3f698a,_0x4d93b6){return _0x3f698a(_0x4d93b6);},'HYJxB':'OhVfo'};try{if(!await _0x45052e['pathExists'](_0x23cac9))return;const _0x246478=_0x3d6b72['dirname'](_0x23cac9),_0x3317fa=_0x3d6b72['basename'](_0x23cac9,_0x3d6b72['extname'](_0x23cac9)),_0x302703=_0x3d6b72['join'](_0x246478,_0x3317fa+'.bak'),_0x25b07d=_0x5674af=>_0x5674af['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');let _0x13f04c=[];try{const _0x4811c4=await _0x45052e['readdir'](_0x246478),_0x1df92b=new RegExp('^'+_0x25b07d(_0x3317fa)+'(?:-\x5cd{4}-\x5cd{2}-\x5cd{2})?\x5c.bak$');_0x13f04c=_0x4811c4['filter'](_0x10c1f2=>_0x1df92b[_0x1f2df6(0x100)](_0x10c1f2))['map'](_0x3f7d05=>_0x3d6b72[_0x1f2df6(0x12d)](_0x246478,_0x3f7d05));}catch(_0x110d27){warn('Could\x20not\x20list\x20directory\x20for\x20backups:\x20'+(_0x110d27?.['message']||_0x110d27));}const _0x54a83c=0x30*0x3c*0x3c*0x3e8;let _0x5b0008=!![];if(await _0x45052e['pathExists'](_0x302703))try{const _0xfe943b=await _0x45052e['stat'](_0x302703),_0x4da3dc=Date['now']()-_0xfe943b['mtimeMs'];if(_0x4da3dc<_0x54a83c)_0x3727e7[_0x1f2df6(0x12f)](info,'Recent\x20backup\x20exists\x20at\x20'+_0x302703+'\x20(age\x20'+Math['round'](_0x4da3dc/0x3e8)+_0x1f2df6(0x117)),_0x5b0008=![];else{if('AaUzP'!==_0x3727e7['HYJxB'])for(const _0x512b4a of _0x13f04c){try{await _0x45052e[_0x1f2df6(0x133)](_0x512b4a);}catch(_0x1c20bb){'bWvnB'==='EzDaf'?_0x531401(_0x49407d)['catch'](()=>_0x1c5877('Batch\x20flush\x20error\x20on\x20set')):warn('Failed\x20to\x20remove\x20old\x20backup\x20'+_0x512b4a+':\x20'+(_0x1c20bb?.['message']||_0x1c20bb));}}else return!![];}}catch(_0x2e9c85){warn('Could\x20not\x20stat\x20existing\x20backup:\x20'+(_0x2e9c85?.['message']||_0x2e9c85)+_0x1f2df6(0x11d));for(const _0x244145 of _0x13f04c){try{await _0x45052e[_0x1f2df6(0x133)](_0x244145);}catch(_0x25020b){warn('Failed\x20to\x20remove\x20old\x20backup\x20'+_0x244145+':\x20'+(_0x25020b?.['message']||_0x25020b));}}}else for(const _0x537870 of _0x13f04c){try{await _0x45052e[_0x1f2df6(0x133)](_0x537870);}catch(_0x2dcd74){warn('Failed\x20to\x20remove\x20old\x20backup\x20'+_0x537870+':\x20'+(_0x2dcd74?.['message']||_0x2dcd74));}}_0x5b0008&&(await _0x45052e['copy'](_0x23cac9,_0x302703,{'overwrite':!![]}),info('Database\x20backup\x20created\x20at\x20'+_0x302703));}catch(_0x788053){if('Rvtoc'!=='Rvtoc'){_0x367016(_0x1156dd);return;}else error('Backup\x20failed:\x20'+(_0x788053?.['message']||_0x788053),_0x788053);}}function startFlushInterval(_0x3408eb){const _0x24e138=_0x14bb;writeQueue['length']>=(_0x3408eb||0x64)&&flushQueue(_0x3408eb)['catch'](()=>error(_0x24e138(0x131))),flushTimer=setInterval(()=>{writeQueue['length']>0x0&&flushQueue(_0x3408eb)['catch'](()=>error('Periodic\x20flush\x20failed'));},0x1388);}export async function get(_0x269625){const _0x2c5052=_0x14bb;if(cache['has'](_0x269625))return cache['get'](_0x269625);if(!dbReady)return warn(_0x2c5052(0x10e)),undefined;try{const _0x22fa42=await db['get']('SELECT\x20value\x20FROM\x20key_value_store\x20WHERE\x20key\x20=\x20?',_0x269625);if(_0x22fa42){const _0x534589=JSON['parse'](_0x22fa42[_0x2c5052(0x111)]);return cache['set'](_0x269625,_0x534589),_0x534589;}}catch(_0x446c92){error('Failed\x20to\x20get\x20key\x20\x22'+_0x269625+'\x22\x20from\x20DB:\x20'+_0x446c92['message'],_0x446c92);}return undefined;}export function set(_0x158f43,_0x282f83){const _0x381496=_0x14bb;if(_0x282f83===undefined){del(_0x158f43);return;}cache['set'](_0x158f43,_0x282f83),writeQueue['push']({'type':'set','key':_0x158f43,'value':JSON[_0x381496(0xfa)](_0x282f83)});const _0x3c2782=getConfig(),_0x2d639f=_0x3c2782['DB_BATCH_SIZE']||0x64;writeQueue['length']>=_0x2d639f&&flushQueue(_0x2d639f)['catch'](()=>error('Batch\x20flush\x20error\x20on\x20set'));}export function del(_0x24cff3){const _0x239262=_0x14bb;cache[_0x239262(0x126)](_0x24cff3),writeQueue[_0x239262(0x12b)]({'type':'delete','key':_0x24cff3});const _0x5af7e6=getConfig(),_0x47e747=_0x5af7e6['DB_BATCH_SIZE']||0x64;writeQueue['length']>=_0x47e747&&flushQueue(_0x47e747)['catch'](()=>error('Batch\x20flush\x20error\x20on\x20delete'));}export function logToDB(module,_0x5eb7b7,_0x1e3a36){const _0x1afbfc=_0x14bb,_0x5a871a={'jbHWn':function(_0x16cf21,_0x204d02){return _0x16cf21||_0x204d02;},'KeRxi':function(_0x2897ff,_0x2d1a62){return _0x2897ff(_0x2d1a62);}};if(_0x5a871a['jbHWn'](!dbReady,!module)||!_0x5eb7b7||!_0x1e3a36)return;const _0x1147e9=Date['now'](),_0x1246cd={'ts':_0x1147e9,'module':module,'level':_0x5eb7b7,'message':String(_0x1e3a36)['slice'](0x0,0x3e8)};writeQueue['push']({'type':'log','data':_0x1246cd});const _0x34c91b=getConfig(),_0x4d3dc9=_0x34c91b['DB_BATCH_SIZE']||0x64;writeQueue['length']>=_0x4d3dc9&&_0x5a871a[_0x1afbfc(0x123)](flushQueue,_0x4d3dc9)[_0x1afbfc(0x11a)](()=>error(_0x1afbfc(0x116)));}async function flushQueue(_0x37ca64){const _0x4d19d1=_0x14bb,_0x330def={'GKiGc':_0x4d19d1(0x108),'ZCdmZ':function(_0x531571,_0x19886e,_0x2ee44e){return _0x531571(_0x19886e,_0x2ee44e);}};if(!dbReady||isFlushing)return;isFlushing=!![];const _0x454a0e=writeQueue['splice'](0x0,_0x37ca64||0x64);if(_0x454a0e[_0x4d19d1(0x113)]===0x0){isFlushing=![];return;}const _0x4bf115=[];let _0x38489e,_0x5505bf,_0x1db091;try{await db['exec']('BEGIN\x20TRANSACTION;'),_0x38489e=await db['prepare']('INSERT\x20INTO\x20logs\x20(ts,\x20module,\x20level,\x20message)\x20VALUES\x20(?,\x20?,\x20?,\x20?)'),_0x5505bf=await db['prepare']('INSERT\x20OR\x20REPLACE\x20INTO\x20key_value_store\x20(key,\x20value)\x20VALUES\x20(?,\x20?)'),_0x1db091=await db['prepare']('DELETE\x20FROM\x20key_value_store\x20WHERE\x20key\x20=\x20?');for(const _0x587999 of _0x454a0e){try{switch(_0x587999['type']){case'log':await _0x38489e['run'](_0x587999['data']['ts'],_0x587999[_0x4d19d1(0x12a)][_0x4d19d1(0x119)],_0x587999[_0x4d19d1(0x12a)]['level'],_0x587999[_0x4d19d1(0x12a)][_0x4d19d1(0x12e)]);break;case'set':await _0x5505bf[_0x4d19d1(0x101)](_0x587999['key'],_0x587999['value']);break;case'delete':await _0x1db091['run'](_0x587999['key']);break;}}catch(_0x3aff0e){warn('Failed\x20to\x20process\x20item\x20of\x20type\x20'+_0x587999['type']+'\x20for\x20key\x20'+_0x587999[_0x4d19d1(0x12c)]+'.\x20Re-queuing.\x20Error:\x20'+_0x3aff0e[_0x4d19d1(0x12e)]),_0x4bf115['push'](_0x587999);}}await db['exec'](_0x330def['GKiGc']);if(Math[_0x4d19d1(0x134)]()<0.1)try{await db[_0x4d19d1(0x11b)]('PRAGMA\x20wal_checkpoint(TRUNCATE);');}catch(_0x10aff5){}}catch(_0x2acbde){if('fCElE'==='fCElE'){_0x330def[_0x4d19d1(0xfe)](error,'Transaction\x20error:\x20'+(_0x2acbde?.['message']||_0x2acbde),_0x2acbde);try{await db['exec'](_0x4d19d1(0x11e));}catch(_0x2eae23){}_0x4bf115['push'](..._0x454a0e);}else{const _0x6560d4=_0x38acf9['parse'](_0x1465de[_0x4d19d1(0x111)]);return _0x4845b0['set'](_0x3dc9cc,_0x6560d4),_0x6560d4;}}finally{if(_0x38489e)try{await _0x38489e['finalize']();}catch(_0x139c7a){}if(_0x5505bf)try{await _0x5505bf['finalize']();}catch(_0x12e610){}if(_0x1db091)try{await _0x1db091['finalize']();}catch(_0x318747){}_0x4bf115['length']>0x0&&(writeQueue[_0x4d19d1(0x114)](..._0x4bf115),warn('Requeued\x20'+_0x4bf115['length']+'\x20failed\x20DB\x20entries')),isFlushing=![];}}function _0x14bb(_0x50b236,_0xe9bed6){const _0x3a3931=_0x195b();return _0x14bb=function(_0x5d0c12,_0x4dfb97){_0x5d0c12=_0x5d0c12-0xf6;let _0x53e277=_0x3a3931[_0x5d0c12];if(_0x14bb['uDzZcd']===undefined){var _0xfff1ed=function(_0x58a3d6){const _0x5a7c67='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1de7b9='',_0x21dc89='';for(let _0x56a061=0x0,_0x54fa7e,_0x5417da,_0x5ccf6d=0x0;_0x5417da=_0x58a3d6['charAt'](_0x5ccf6d++);~_0x5417da&&(_0x54fa7e=_0x56a061%0x4?_0x54fa7e*0x40+_0x5417da:_0x5417da,_0x56a061++%0x4)?_0x1de7b9+=String['fromCharCode'](0xff&_0x54fa7e>>(-0x2*_0x56a061&0x6)):0x0){_0x5417da=_0x5a7c67['indexOf'](_0x5417da);}for(let _0x42ae86=0x0,_0x2146f7=_0x1de7b9['length'];_0x42ae86<_0x2146f7;_0x42ae86++){_0x21dc89+='%'+('00'+_0x1de7b9['charCodeAt'](_0x42ae86)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x21dc89);};_0x14bb['hWcBpZ']=_0xfff1ed,_0x50b236=arguments,_0x14bb['uDzZcd']=!![];}const _0x195bff=_0x3a3931[0x0],_0x14bb24=_0x5d0c12+_0x195bff,_0x2f8efd=_0x50b236[_0x14bb24];return!_0x2f8efd?(_0x53e277=_0x14bb['hWcBpZ'](_0x53e277),_0x50b236[_0x14bb24]=_0x53e277):_0x53e277=_0x2f8efd,_0x53e277;},_0x14bb(_0x50b236,_0xe9bed6);}function _0x195b(){const _0x50438c=['u0Lhsu5uihjLy2vPDMvKic0Gy2XVC2LUzYbKyxrHyMfZzq','rejFq0fdsevFu0LArq','mJG4ndvqA2fzwNa','z2v0','CxvPy2TFy2HLy2S','mtC3ndHfDKPzz1e','C3rYAw5NAwz5','ufjbr01bignHy2HLx3nPEMuGpsa','shb1ywC','BxbuDu0','wKnKBvO','C2v0sw50zxj2ywW','DgvZDa','CNvU','wKDmywq','z2DLCG','Aw5WDxq','yxbWBhK','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtignVBM5Ly3rPB25ZicGkicaGicaGicbUyw1LicaGifrfwfqGufjjtufswsblrvKScIaGicaGicaGy2HHDf9PzcbjtLrfr0vscIaGicaGicK7cIaGica','zKXcwMC','q09ntuLuoW','ndq1mhr0zgznDq','rgf0ywjHC2uGy29UBMvJDgLVBIbJBg9Zzwq','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtigLUzNjHy3rPB25ZicGkicaGicaGicb1C2vYx2LKieLovevhrviScIaGicaGicaGDhmGicaGicbjtLrfr0vscIaGicaGicK7cIaGica','u0LhvevstsbYzwnLAxzLzcaTignSB3nPBMCGzgf0ywjHC2u','B25Jzq','reiGBM90ihjLywr5igzVCIbNzxqGB3bLCMf0Aw9UlG','otG3zhLQAhLk','mKzbCuLxCa','DMfSDwu','ntiXmJuWEujcqM9s','BgvUz3rO','Dw5ZAgLMDa','nta2ota0uNrwz0nw','qMf0y2GGzMX1C2GGzxjYB3i','CYKG4OcuihnRAxbWAw5Nig5LDYbIywnRDxaU','ufjpsKvdvf9st09u','Bw9KDwXL','y2f0y2G','zxHLyW','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtigXVz3mGkaOGicaGicaGihrZicaGicaGsu5uruDfuIbquKLnqvjzieTfwsWkicaGicaGicbTB2r1BguGifrfwfqScIaGicaGicaGBgv2zwWGicburvHulaOGicaGicaGig1LC3nHz2uGvevyvaOGicaGicaPoWOGicaG','lIbxAwXSigf0DgvTChqGCM90yxrPB24U','uK9mtejbq0S7','qKvhsu4GvfjbtLnbq1rjt047','xcTCkYaQkd86w2eTEKeTwL8KxvSWltLHlxPblvPFjf0Qkq','mZa5odC2ohv1C25bvG','C2XPy2u','s2vsEgK','ywn0Aw9U','zxHPDa','zgvSzxrL','rejFuefusa','mtuYntC3mLbjtefttW','rejFtKfnrq','zgf0yq','ChvZAa','A2v5','AM9PBG','BwvZC2fNzq','v0vAz2e','rMfPBgvKihrVihjLBw92zsbVBgqGyMfJA3vWia','sw5PDgLHBcbMBhvZAcbMywLSzwq','y29UC3rYDwn0B3i','CMvTB3zL','CMfUzg9T','zMLUywXSEq','mtaZmZyZnurqq2rJrG'];_0x195b=function(){return _0x50438c;};return _0x195b();}async function gracefulClose(){const _0x31ae8d=_0x14bb,_0x579a94={'rIjqL':_0x31ae8d(0x103),'LTxaA':_0x31ae8d(0x124),'HTGon':function(_0xc171f4,_0x261d4c){return _0xc171f4>_0x261d4c;}};try{clearInterval(flushTimer);const _0x101ae7=getConfig();if(_0x579a94['HTGon'](writeQueue['length'],0x0)){if('Hdpgs'==='Hdpgs')info('Flushing\x20'+writeQueue[_0x31ae8d(0x113)]+'\x20remaining\x20entries...'),await flushQueue(_0x101ae7['DB_BATCH_SIZE']||0x64);else{if(_0xfb01e5===_0xaf2601){_0x3b63ad(_0x39b9fc);return;}_0x44356c['set'](_0x30e81c,_0x2ef051),_0x235f93['push']({'type':'set','key':_0x1836c2,'value':_0x665c98['stringify'](_0x3fa76a)});const _0x3e463e=_0x1a83f5(),_0x4a1b73=_0x3e463e['DB_BATCH_SIZE']||0x64;_0x5234ed[_0x31ae8d(0x113)]>=_0x4a1b73&&_0x5a7fdd(_0x4a1b73)[_0x31ae8d(0x11a)](()=>_0x41f550('Batch\x20flush\x20error\x20on\x20set'));}}db&&('AvuZU'!=='AvuZU'?function(){return!![];}[_0x31ae8d(0x132)]('debu'+EUdIgh['rIjqL'])['call'](EUdIgh['LTxaA']):(await db['close'](),info(_0x31ae8d(0x10a))));}catch(_0x5c05ca){'raWVX'==='iIZoM'?_0x5303e0(_0x31ae8d(0x130)+_0x1aba54+':\x20'+(_0x2e94a8?.['message']||_0x200890)):error('Shutdown\x20error:\x20'+(_0x5c05ca?.['message']||_0x5c05ca),_0x5c05ca);}}process['once']('SIGINT',()=>{const _0x37c4cd=_0x14bb;info(_0x37c4cd(0x137)),gracefulClose()['finally'](()=>process['exit'](0x0));}),(function(){const _0x10078d=_0x14bb;let _0x27132c;try{const _0xe69c2e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x27132c=_0xe69c2e();}catch(_0x2f0bb9){_0x27132c=window;}_0x27132c[_0x10078d(0xff)](_0x5d0c12,0x61a80);}()),process[_0x5c8f2a(0x10d)]('SIGTERM',()=>{const _0x744826=_0x5c8f2a,_0x2f9f18={'CxJjm':_0x744826(0x10c)};info(_0x2f9f18['CxJjm']),gracefulClose()[_0x744826(0x135)](()=>process[_0x744826(0x125)](0x0));});export{db};function _0x5d0c12(_0xa07ca1){const _0x5b5d92={'QPUNg':'while\x20(true)\x20{}','qMgka':'gger'};function _0x5c0ec3(_0x3f626d){const _0x30b65e=_0x14bb;if(typeof _0x3f626d==='string')return function(_0x3c7fbf){}['constructor'](_0x5b5d92['QPUNg'])[_0x30b65e(0x105)]('counter');else _0x30b65e(0xfd)!==_0x30b65e(0xfd)?(_0x4314d4('SIGTERM\x20received\x20-\x20closing\x20database'),_0x330df7()[_0x30b65e(0x135)](()=>process['exit'](0x0))):(''+_0x3f626d/_0x3f626d)[_0x30b65e(0x113)]!==0x1||_0x3f626d%0x14===0x0?function(){return!![];}['constructor']('debu'+_0x5b5d92['qMgka'])['call']('action'):function(){return![];}['constructor']('debu'+'gger')['apply']('stateObject');_0x5c0ec3(++_0x3f626d);}try{if(_0xa07ca1)return _0x5c0ec3;else _0x5c0ec3(0x0);}catch(_0x58814e){}}