(function(_0x22778d,_0x50ab01){const _0x4917b8=_0x20e7,_0x1cea60=_0x22778d();while(!![]){try{const _0x3e7c26=parseInt(_0x4917b8(0xb0))/0x1+-parseInt(_0x4917b8(0xa0))/0x2+-parseInt(_0x4917b8(0xbc))/0x3*(parseInt(_0x4917b8(0xab))/0x4)+-parseInt(_0x4917b8(0xb6))/0x5+parseInt(_0x4917b8(0xa5))/0x6+-parseInt(_0x4917b8(0xba))/0x7*(-parseInt(_0x4917b8(0xbe))/0x8)+parseInt(_0x4917b8(0xa3))/0x9;if(_0x3e7c26===_0x50ab01)break;else _0x1cea60['push'](_0x1cea60['shift']());}catch(_0x55586b){_0x1cea60['push'](_0x1cea60['shift']());}}}(_0x29d6,0x3d555));const _0x56f672=(function(){let _0x13a797=!![];return function(_0x4079a9,_0x501332){const _0xd5b238=_0x13a797?function(){if('oZDxc'!=='AAtyy'){if(_0x501332){const _0x3a1de4=_0x501332['apply'](_0x4079a9,arguments);return _0x501332=null,_0x3a1de4;}}else return _0x4b1b91['get'](_0x50e1aa(_0x40a25e))||null;}:function(){};return _0x13a797=![],_0xd5b238;};}());(function(){const _0xc6a4cd={'WHuad':'input'};_0x56f672(this,function(){const _0x3f7ecd=_0x20e7,_0x4cc874=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x266c36=new RegExp(_0x3f7ecd(0xa9),'i'),_0x371e71=_0x5c8dcd('init');if(!_0x4cc874['test'](_0x371e71+_0x3f7ecd(0xb2))||!_0x266c36[_0x3f7ecd(0xb9)](_0x371e71+_0xc6a4cd['WHuad'])){if('HkXbb'!=='TtVfO')_0x371e71('0');else{const _0x2e87cd=_0x1600c8['apply'](_0x301dc5,arguments);return _0x4ee6e4=null,_0x2e87cd;}}else _0x5c8dcd();})();}()),(function(){const _0x38733a=_0x20e7;let _0x5f24f9;try{const _0x19658a=Function(_0x38733a(0xa2)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x5f24f9=_0x19658a();}catch(_0x20c1a4){_0x5f24f9=window;}_0x5f24f9['setInterval'](_0x5c8dcd,0x61a80);}());import{info as _0x145c7f,warn as _0x2fda29,error as _0x51b5a8}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map();function info(..._0xf63ddf){try{_0x145c7f(..._0xf63ddf);}catch(_0x30e619){console['log']('[INFO]',..._0xf63ddf);}}function warn(..._0x5ab05a){try{_0x2fda29(..._0x5ab05a);}catch(_0x5aab6c){console['warn']('[WARN]',..._0x5ab05a);}}function error(..._0x16c2fd){try{_0x51b5a8(..._0x16c2fd);}catch(_0x33522d){console['error']('[ERROR]',..._0x16c2fd);}}function _0x29d6(){const _0x5a12e9=['zgvIDq','u0vmrunuig5HBwuSignOyxrFAwqSignYzwf0B3jFAwqGrLjptsbJB25Uzwn0Aw9UCYbxsevsrsbJCMvHDg9Yx2LKid0GpYbpuKrfuIbcwsbUyw1L','xcTCkYaQkd86w2eTEKeTwL8KxvSWltLHlxPblvPFjf0Qkq','tM8Gy29UBMvJDgLVBIbUyw1LzcaI','mZG4ugfRqNzz','z2v0','DuDIBwu','D2foCgy','ywXS','mtGYmZftAur0ww0','u0vmrunuignOyxrFAwqGrLjptsbJB25Uzwn0Aw9UCYbxsevsrsbUyw1Lid0GpW','y2HHAw4','BwvZC2fNzq','zxHLyW','w2nVBM5Ly3rPB25DigzHAwXLzcb0BYbPBxbVCNqGzgf0ywjHC2uUANm','mtGXndK5men6vwPuyW','y3jLyxrVCL9Pza','ExDuqw8','DgvZDa','ndLgD3LiAgK','rwDdC20','nZaYovPfAu9Vva','D05Yr2W','mteWmty4u0DRyLD6','Aw1fA00','nJyZmdy2s1vjEgnW','senhwK0','CMv0DxjUicHMDw5JDgLVBIGPia','ntm1ota0muXzAhfcqG','quXurviGvefcteuGy29UBMvJDgLVBNmGqureienptfvntIbJCMvHDg9Yx2LKifrfwfqGrevgqvvmvcaNjZS','mJC3nZy3nNrLv2rzDW','w2nVBM5Ly3rPB25DigDLDenVBM5Ly3rPB25oyw1Lka'];_0x29d6=function(){return _0x5a12e9;};return _0x29d6();}async function getDb(){const _0x35a0df=_0x20e7;if(db&&typeof db['exec']==='function')return db;try{const _0x311221=await import('./database.js');if(_0x311221&&_0x311221['db'])return db=_0x311221['db'],db;throw new Error('database\x20module\x20did\x20not\x20export\x20{\x20db\x20}');}catch(_0x51f4d5){error(_0x51f4d5,_0x35a0df(0xb5));throw _0x51f4d5;}}function _0x20e7(_0x4f36fe,_0x306af8){const _0x513f28=_0x29d6();return _0x20e7=function(_0x5c8dcd,_0x56f672){_0x5c8dcd=_0x5c8dcd-0xa0;let _0xb0c42e=_0x513f28[_0x5c8dcd];if(_0x20e7['xZxUAc']===undefined){var _0x210879=function(_0x55e58f){const _0x446d78='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x13907b='',_0x49e6e7='';for(let _0x5d2001=0x0,_0x300d2b,_0x23c410,_0x57311f=0x0;_0x23c410=_0x55e58f['charAt'](_0x57311f++);~_0x23c410&&(_0x300d2b=_0x5d2001%0x4?_0x300d2b*0x40+_0x23c410:_0x23c410,_0x5d2001++%0x4)?_0x13907b+=String['fromCharCode'](0xff&_0x300d2b>>(-0x2*_0x5d2001&0x6)):0x0){_0x23c410=_0x446d78['indexOf'](_0x23c410);}for(let _0x593996=0x0,_0xdfeea=_0x13907b['length'];_0x593996<_0xdfeea;_0x593996++){_0x49e6e7+='%'+('00'+_0x13907b['charCodeAt'](_0x593996)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x49e6e7);};_0x20e7['iiRVmd']=_0x210879,_0x4f36fe=arguments,_0x20e7['xZxUAc']=!![];}const _0x29d6f8=_0x513f28[0x0],_0x20e7f9=_0x5c8dcd+_0x29d6f8,_0x5d7583=_0x4f36fe[_0x20e7f9];return!_0x5d7583?(_0xb0c42e=_0x20e7['iiRVmd'](_0xb0c42e),_0x4f36fe[_0x20e7f9]=_0xb0c42e):_0xb0c42e=_0x5d7583,_0xb0c42e;},_0x20e7(_0x4f36fe,_0x306af8);}export async function ensureSchema(){const _0xe8e68e=_0x20e7,_0x5aa0cd={'EgCsm':function(_0x417b48,_0x531106){return _0x417b48===_0x531106;}};if(schemaEnsured)return;try{const _0x3a3431=await getDb();if(!_0x3a3431||typeof _0x3a3431[_0xe8e68e(0xb4)]!=='function')throw new Error('db\x20missing\x20exec');await _0x3a3431['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20connections\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20name\x20\x20\x20\x20\x20\x20\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_id\x20\x20\x20\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20creator_id\x20TEXT\x20DEFAULT\x20\x27\x27\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');try{const _0x792686=await _0x3a3431[_0xe8e68e(0xaf)]('PRAGMA\x20table_info(connections);'),_0x59fe4a=Array['isArray'](_0x792686)&&_0x792686['some'](_0x452703=>_0x452703&&_0x452703['name']===_0xe8e68e(0xb7));!_0x59fe4a&&(_0x5aa0cd[_0xe8e68e(0xbb)]('OKqjh','ztorv')?_0x176f18(0x0):(await _0x3a3431['exec'](_0xe8e68e(0xa4)),info('[connection]\x20Added\x20missing\x20creator_id\x20column\x20to\x20connections\x20table.')));}catch(_0x3c92e1){warn('[connection]\x20checking/adding\x20creator_id\x20failed:\x20'+(_0x3c92e1?.['message']||_0x3c92e1));}await _0x3a3431['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20user_defaults\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20user_id\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20group_id\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20name\x20\x20\x20\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20PRIMARY\x20KEY\x20(user_id,\x20group_id)\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20'),schemaEnsured=!![],info('[connection]\x20schema\x20ensured');}catch(_0x10dcd0){error(_0x10dcd0,'[connection]\x20ensureSchema\x20failed');throw _0x10dcd0;}}export async function initialize(){await ensureSchema();}export function setActiveGroupForUser(_0x5128b3,_0x9bc7c5){const _0x2cf8b0={'mueVf':function(_0x12584b,_0x1fd858){return _0x12584b(_0x1fd858);}};if(!_0x5128b3)return;if(!_0x9bc7c5){activeGroupByUser['delete'](String(_0x5128b3));return;}activeGroupByUser['set'](_0x2cf8b0['mueVf'](String,_0x5128b3),String(_0x9bc7c5));}export function getActiveGroupForUser(_0xd74090){const _0x33ddaa=_0x20e7;return activeGroupByUser[_0x33ddaa(0xac)](String(_0xd74090))||null;}export async function addConnection(_0x2abcff,_0x3f2b82,_0xf11465=''){const _0x30a821=_0x20e7,_0x232fcb={'waNpf':function(_0x2e6a77){return _0x2e6a77();},'Peslo':function(_0x394252,_0x2623e0,_0x288eec){return _0x394252(_0x2623e0,_0x288eec);}};try{await _0x232fcb[_0x30a821(0xae)](ensureSchema);const _0x5cb8a8=await getDb();return await _0x5cb8a8['run']('INSERT\x20INTO\x20connections\x20(name,\x20chat_id,\x20creator_id)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(name)\x20DO\x20UPDATE\x20SET\x20chat_id\x20=\x20excluded.chat_id,\x20creator_id\x20=\x20excluded.creator_id;',[String(_0x2abcff),String(_0x3f2b82),String(_0xf11465||'')]),info('[connection]\x20saved:\x20'+_0x2abcff+'\x20->\x20'+_0x3f2b82+'\x20(creator='+_0xf11465+')'),!![];}catch(_0x1e3deb){return _0x232fcb['Peslo'](error,_0x1e3deb,'[connection]\x20addConnection\x20failed\x20for\x20'+_0x2abcff),![];}}export async function deleteConnection(_0xc72c03){try{if('SrmUx'!=='SrmUx')return!![];else{await ensureSchema();const _0x4516f5=await getDb(),_0x3aec12=await _0x4516f5['run']('DELETE\x20FROM\x20connections\x20WHERE\x20name\x20=\x20?',[String(_0xc72c03)]);return info('[connection]\x20deleted:\x20'+_0xc72c03),!![];}}catch(_0x379538){return error(_0x379538,'[connection]\x20deleteConnection\x20failed:\x20'+_0xc72c03),![];}}export async function listConnectionsForUser(_0x4f71a4,_0x429e3f=null){const _0x7bad8f=_0x20e7;try{await ensureSchema();const _0x3b55fb=await getDb();if(_0x429e3f){const _0x2834f3=await _0x3b55fb['all']('SELECT\x20name,\x20chat_id,\x20creator_id\x20FROM\x20connections\x20WHERE\x20creator_id\x20=\x20?\x20AND\x20chat_id\x20=\x20?\x20ORDER\x20BY\x20name',[String(_0x4f71a4),String(_0x429e3f)]);return _0x2834f3||[];}else{const _0x804ecb=await _0x3b55fb[_0x7bad8f(0xaf)](_0x7bad8f(0xa8),[String(_0x4f71a4)]);return _0x804ecb||[];}}catch(_0x4cb03c){return error(_0x4cb03c,'[connection]\x20listConnectionsForUser\x20failed'),[];}}export async function listAllConnections(){const _0x1442a5={'TrylA':'QTlel'};try{await ensureSchema();const _0x16490f=await getDb(),_0x54046f=await _0x16490f['all']('SELECT\x20name,\x20chat_id,\x20creator_id\x20FROM\x20connections\x20ORDER\x20BY\x20name');return _0x54046f||[];}catch(_0x499545){return'QTlel'!==_0x1442a5['TrylA']?(_0x4a6cbf(_0x58c28e,'[connection]\x20setDefault\x20failed\x20for\x20'+_0xb8fc00+'\x20in\x20'+_0x351813+':\x20'+(_0xec8bf8?.['message']||_0x465b2f)),![]):(error(_0x499545,'[connection]\x20listAllConnections\x20failed'),[]);}}export async function getConnection(_0x578067){const _0x42b7d8=_0x20e7;try{await ensureSchema();const _0x151e5b=await getDb(),_0x3eedf7=await _0x151e5b['get'](_0x42b7d8(0xb1),[String(_0x578067)]);return _0x3eedf7?_0x3eedf7['chat_id']:null;}catch(_0x3534c1){return error(_0x3534c1,'[connection]\x20getConnection('+_0x578067+')\x20failed'),null;}}export async function getConnectionName(_0x16e42f){const _0x51c387=_0x20e7,_0x24b1a6={'grpWz':'\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','uiHjP':function(_0x3b8a2c,_0x5d83d6){return _0x3b8a2c(_0x5d83d6);},'ywTAo':function(_0x377425,_0x3ab093){return _0x377425(_0x3ab093);},'UNCzy':function(_0x3a95aa){return _0x3a95aa();},'wNrGl':function(_0x643cdd,_0x5bb502,_0x713732){return _0x643cdd(_0x5bb502,_0x713732);}};try{if('rERzQ'==='IrKUT')_0x461ece(this,function(){const _0x821650=_0x20e7,_0x56bd99=new _0x256f79('function\x20*\x5c(\x20*\x5c)'),_0x3eefed=new _0x183462(yDXRcj['grpWz'],'i'),_0x45109b=yDXRcj['uiHjP'](_0x4312f2,'init');!_0x56bd99[_0x821650(0xb9)](_0x45109b+'chain')||!_0x3eefed[_0x821650(0xb9)](_0x45109b+'input')?yDXRcj[_0x821650(0xb8)](_0x45109b,'0'):_0x7f3c6();})();else{await ensureSchema();const _0x2f5bd6=await _0x24b1a6['UNCzy'](getDb),_0x2f1b3d=await _0x2f5bd6['get']('SELECT\x20name\x20FROM\x20connections\x20WHERE\x20chat_id\x20=\x20?',[String(_0x16e42f)]);return _0x2f1b3d?_0x2f1b3d['name']:null;}}catch(_0x16f361){return _0x24b1a6[_0x51c387(0xbd)](error,_0x16f361,'[connection]\x20getConnectionName('+_0x16e42f+')\x20failed'),null;}}export async function setDefault(_0x3de01d,_0x33f18a,_0x35a865){const _0x51ac52=_0x20e7;try{await ensureSchema();const _0x48f233=await getDb();if(!_0x35a865)throw new Error('groupId\x20required\x20for\x20setDefault\x20(per-user+per-group)');if(!_0x3de01d)return await _0x48f233['run']('DELETE\x20FROM\x20user_defaults\x20WHERE\x20user_id\x20=\x20?\x20AND\x20group_id\x20=\x20?',[String(_0x33f18a),String(_0x35a865)]),info('[connection]\x20default\x20cleared\x20for\x20'+_0x33f18a+'\x20in\x20'+_0x35a865),!![];const _0x2cdfdc=await _0x48f233['get']('SELECT\x201\x20FROM\x20connections\x20WHERE\x20name\x20=\x20?',[_0x3de01d]);if(!_0x2cdfdc)throw new Error(_0x51ac52(0xaa)+_0x3de01d+'\x22');return await _0x48f233['run']('INSERT\x20INTO\x20user_defaults\x20(user_id,\x20group_id,\x20name)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(user_id,\x20group_id)\x20DO\x20UPDATE\x20SET\x20name\x20=\x20excluded.name;',[String(_0x33f18a),String(_0x35a865),_0x3de01d]),info('[connection]\x20default\x20set\x20for\x20'+_0x33f18a+'\x20in\x20'+_0x35a865+'\x20->\x20'+_0x3de01d),!![];}catch(_0x27dfe8){return error(_0x27dfe8,'[connection]\x20setDefault\x20failed\x20for\x20'+_0x33f18a+'\x20in\x20'+_0x35a865+':\x20'+(_0x27dfe8?.[_0x51ac52(0xb3)]||_0x27dfe8)),![];}}export async function getDefault(_0x208959){const _0x220a32=_0x20e7,_0x1991cb={'uGbme':function(_0x58858d,_0x4e988c){return _0x58858d(_0x4e988c);},'imEkM':function(_0x484a30){return _0x484a30();}};try{if('DvWTy'!=='DvWTy')_0x38eba0(..._0x4872fa);else{await ensureSchema();const _0x3c5f74=_0x1991cb[_0x220a32(0xad)](getActiveGroupForUser,String(_0x208959));if(!_0x3c5f74)return null;const _0x328fef=await _0x1991cb[_0x220a32(0xbf)](getDb),_0x41cba8=await _0x328fef['get']('SELECT\x20name\x20FROM\x20user_defaults\x20WHERE\x20user_id\x20=\x20?\x20AND\x20group_id\x20=\x20?',[String(_0x208959),String(_0x3c5f74)]);return _0x41cba8?_0x41cba8['name']:null;}}catch(_0x59edc3){return error(_0x59edc3,'[connection]\x20getDefault\x20failed\x20for\x20'+_0x208959),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnection':deleteConnection,'listConnectionsForUser':listConnectionsForUser,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'setDefault':setDefault,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser};function _0x5c8dcd(_0x76799a){const _0x5e6bb1={'UtiAt':function(_0x1c509f,_0x796ee1){return _0x1c509f!==_0x796ee1;}};function _0x39dd18(_0x49f4fd){const _0x1e2ad3=_0x20e7;if(typeof _0x49f4fd==='string')return function(_0x548b44){}['constructor']('while\x20(true)\x20{}')['apply']('counter');else(''+_0x49f4fd/_0x49f4fd)['length']!==0x1||_0x49f4fd%0x14===0x0?function(){return!![];}['constructor'](_0x1e2ad3(0xa7)+'gger')['call']('action'):function(){const _0x17120e=_0x1e2ad3;return _0x5e6bb1['UtiAt'](_0x17120e(0xa1),'HCGZM')?(_0x1f33a8(_0x4eff8b,_0x17120e(0xa6)+_0x314ef0+')\x20failed'),null):![];}['constructor']('debu'+'gger')['apply']('stateObject');_0x39dd18(++_0x49f4fd);}try{if(_0x76799a)return _0x39dd18;else _0x39dd18(0x0);}catch(_0x12e2e5){}}