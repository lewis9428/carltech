(function(_0x166e23,_0x4627f4){const _0x1334f3=_0x2c7d,_0x46da3b=_0x166e23();while(!![]){try{const _0x172e27=-parseInt(_0x1334f3(0x19c))/0x1+parseInt(_0x1334f3(0x1a9))/0x2+parseInt(_0x1334f3(0x1b9))/0x3+-parseInt(_0x1334f3(0x1bb))/0x4+parseInt(_0x1334f3(0x1a4))/0x5+-parseInt(_0x1334f3(0x1be))/0x6*(parseInt(_0x1334f3(0x1b5))/0x7)+-parseInt(_0x1334f3(0x19f))/0x8*(-parseInt(_0x1334f3(0x1af))/0x9);if(_0x172e27===_0x4627f4)break;else _0x46da3b['push'](_0x46da3b['shift']());}catch(_0x159126){_0x46da3b['push'](_0x46da3b['shift']());}}}(_0x1735,0xe3426));const _0x54d656=(function(){let _0x501c0a=!![];return function(_0x8691ec,_0x401ce1){const _0x23a707=_0x501c0a?function(){const _0xf98115=_0x2c7d;if(_0x401ce1){const _0x205677=_0x401ce1[_0xf98115(0x1a8)](_0x8691ec,arguments);return _0x401ce1=null,_0x205677;}}:function(){};return _0x501c0a=![],_0x23a707;};}());(function(){const _0x35d002=_0x2c7d,_0x33752d={'wDDGv':_0x35d002(0x19d),'FiLnc':function(_0x2eee17,_0x515df7){return _0x2eee17(_0x515df7);},'gyDon':function(_0x2348be,_0x35895a){return _0x2348be+_0x35895a;}};_0x54d656(this,function(){const _0x5df317=_0x35d002,_0x2ecbce=new RegExp(_0x33752d[_0x5df317(0x1b0)]),_0x5c5127=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x159ef8=_0x33752d['FiLnc'](_0x1d8531,'init');!_0x2ecbce['test'](_0x33752d['gyDon'](_0x159ef8,'chain'))||!_0x5c5127[_0x5df317(0x1a6)](_0x159ef8+'input')?_0x159ef8('0'):_0x1d8531();})();}());import{info as _0x4e7439,warn as _0x12ff97,error as _0x33ae97}from'./logger.js';function _0x1735(){const _0x548365=['AeLkzLe','odmYnZa1nw92tvvpqG','z2v0','DgvZDa','w2nVBM5Ly3rPB25DigfKzenVBM5Ly3rPB24GzMfPBgvKigzVCIa','yxbWBhK','mZyXotmYnKfqs0vZEq','y2HHDf9Pza','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtignVBM5Ly3rPB25ZicGkicaGicaGicbUyw1LicaGicaGifrfwfqGufjjtufswsblrvKScIaGicaGicaGy2HHDf9PzcaGicburvHuie5pvcbovuXmlaOGicaGicaGignYzwf0B3jFAwqGvevyvcberuzbvuXuicCNcIaGicaGicK7cIaGica','zgvIDq','C2v0sw50zxj2ywW','ywXS','owjWCLb5yG','D0rer3y','w2nVBM5Ly3rPB25DiefKzgvKig1PC3nPBMCGy3jLyxrVCL9PzcbJB2X1Bw4GDg8Gy29UBMvJDgLVBNmGDgfIBguU','BK5qzMW','w2nVBM5Ly3rPB25DigDLDenVBM5Ly3rPB25oyw1Lka','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtihvZzxjFzgvMyxvSDhmGkaOGicaGicaGihvZzxjFAwqGvevyvcbot1qGtLvmtcWkicaGicaGicbNCM91Cf9PzcburvHuie5pvcbovuXmlaOGicaGicaGig5HBwuGicaGvevyvcbot1qGtLvmtcWkicaGicaGicbquKLnqvjzieTfwsaODxnLCL9PzcWGz3jVDxbFAwqPcIaGicaGicK7cIaGica','mJe3Aur5wMr6','zgiGBwLZC2LUzYbLEgvJ','BwvZC2fNzq','CNvU','ndm3oduZrwHoshzw','r3fxCuW','ntq4mdC2mejjC3zuDa','w2nVBM5Ly3rPB25DignOzwnRAw5Nl2fKzgLUzYbJCMvHDg9Yx2LKigzHAwXLzdOG','zxHLyW','mtK3otGYzersD3bW','vwzrufm','nJe3mZu4EKDYCKHR','zNvUy3rPB24GkLWOicPCkq','AxnbCNjHEq','mJu2mJi3mLbsEwvxsG','CuPqBgu','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','revmrvrfiezst00Gy29UBMvJDgLVBNmGv0HfuKuGBMfTzsa9id8'];_0x1735=function(){return _0x548365;};return _0x1735();}let db=null,schemaEnsured=![];(function(){const _0x56e32d=_0x2c7d;let _0x44c3c6;try{const _0x59e215=Function('return\x20(function()\x20'+_0x56e32d(0x1a1)+');');_0x44c3c6=_0x59e215();}catch(_0x2c77bc){_0x44c3c6=window;}_0x44c3c6[_0x56e32d(0x1ad)](_0x1d8531,0x61a80);}());const activeGroupByUser=new Map();function info(..._0x42048d){try{_0x4e7439(..._0x42048d);}catch(_0x545c81){console['log']('[INFO]',..._0x42048d);}}function warn(..._0x18730a){const _0x3011ec=_0x2c7d,_0x4aae9={'yxQoj':function(_0x306ca5,_0x894545,_0x277fbc){return _0x306ca5(_0x894545,_0x277fbc);},'Dledb':'hvzoD'};try{if(_0x4aae9['Dledb']!==_0x4aae9['Dledb'])return _0x4aae9['yxQoj'](_0x57d1ad,_0x412bf5,'[connection]\x20setDefault\x20failed\x20for\x20'+_0x3bbfb9+'\x20in\x20'+_0x52c991+':\x20'+(_0x42765c?.[_0x3011ec(0x1b7)]||_0x598d9e)),![];else _0x12ff97(..._0x18730a);}catch(_0x3fd8cc){console['warn']('[WARN]',..._0x18730a);}}function error(..._0x1e9fbc){try{_0x33ae97(..._0x1e9fbc);}catch(_0x275f74){'uzxRB'==='sCuii'?_0xedfef3=_0x2beae6:console['error']('[ERROR]',..._0x1e9fbc);}}async function getDb(){const _0x4e3c9a=_0x2c7d,_0xd642b8={'UfQPS':function(_0x529cd2,_0x5c3195){return _0x529cd2===_0x5c3195;},'dZBpU':'database\x20module\x20did\x20not\x20export\x20{\x20db\x20}'};if(db&&_0xd642b8[_0x4e3c9a(0x19b)](typeof db[_0x4e3c9a(0x1bd)],'function'))return db;try{const _0x1cefb4=await import('./database.js');if(_0x1cefb4&&_0x1cefb4['db'])return db=_0x1cefb4['db'],db;throw new Error(_0xd642b8['dZBpU']);}catch(_0x4d6f16){error(_0x4d6f16,'[connection]\x20failed\x20to\x20import\x20database.js');throw _0x4d6f16;}}export async function ensureSchema(){const _0x30b4fe=_0x2c7d,_0xb73f53={'HLSpr':_0x30b4fe(0x1b6)};if(schemaEnsured)return;try{const _0x483b9b=await getDb();if(!_0x483b9b||typeof _0x483b9b['exec']!=='function')throw new Error(_0xb73f53['HLSpr']);await _0x483b9b['exec'](_0x30b4fe(0x1ab));try{const _0x53b903=await _0x483b9b['all']('PRAGMA\x20table_info(connections);'),_0x42509c=Array[_0x30b4fe(0x19e)](_0x53b903)&&_0x53b903['some'](_0x2153a5=>_0x2153a5&&_0x2153a5['name']==='creator_id');!_0x42509c&&(await _0x483b9b['exec']('ALTER\x20TABLE\x20connections\x20ADD\x20COLUMN\x20creator_id\x20TEXT\x20DEFAULT\x20\x27\x27;'),info(_0x30b4fe(0x1b1)));}catch(_0x4c9973){if(_0x30b4fe(0x1a0)!=='qJPle')return _0x418ce9['get'](_0x49c2f6(_0x3219dc))||null;else warn(_0x30b4fe(0x1bc)+(_0x4c9973?.['message']||_0x4c9973));}await _0x483b9b[_0x30b4fe(0x1bd)](_0x30b4fe(0x1b4)),schemaEnsured=!![],info('[connection]\x20schema\x20ensured');}catch(_0x1e6821){error(_0x1e6821,'[connection]\x20ensureSchema\x20failed');throw _0x1e6821;}}function _0x2c7d(_0x3ee854,_0x52a16d){const _0x5b4d7f=_0x1735();return _0x2c7d=function(_0x1d8531,_0x54d656){_0x1d8531=_0x1d8531-0x19b;let _0x16274f=_0x5b4d7f[_0x1d8531];if(_0x2c7d['stfLOI']===undefined){var _0x86ff19=function(_0x45f59f){const _0x4be34c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4b15ca='',_0x466cdb='';for(let _0x5942f6=0x0,_0x42f973,_0x1d2e7e,_0x113b21=0x0;_0x1d2e7e=_0x45f59f['charAt'](_0x113b21++);~_0x1d2e7e&&(_0x42f973=_0x5942f6%0x4?_0x42f973*0x40+_0x1d2e7e:_0x1d2e7e,_0x5942f6++%0x4)?_0x4b15ca+=String['fromCharCode'](0xff&_0x42f973>>(-0x2*_0x5942f6&0x6)):0x0){_0x1d2e7e=_0x4be34c['indexOf'](_0x1d2e7e);}for(let _0x4f4118=0x0,_0x12471d=_0x4b15ca['length'];_0x4f4118<_0x12471d;_0x4f4118++){_0x466cdb+='%'+('00'+_0x4b15ca['charCodeAt'](_0x4f4118)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x466cdb);};_0x2c7d['bMCcnz']=_0x86ff19,_0x3ee854=arguments,_0x2c7d['stfLOI']=!![];}const _0x1735bc=_0x5b4d7f[0x0],_0x2c7d27=_0x1d8531+_0x1735bc,_0x155220=_0x3ee854[_0x2c7d27];return!_0x155220?(_0x16274f=_0x2c7d['bMCcnz'](_0x16274f),_0x3ee854[_0x2c7d27]=_0x16274f):_0x16274f=_0x155220,_0x16274f;},_0x2c7d(_0x3ee854,_0x52a16d);}export async function initialize(){await ensureSchema();}export function setActiveGroupForUser(_0x27a763,_0x152650){if(!_0x27a763)return;if(!_0x152650){activeGroupByUser['delete'](String(_0x27a763));return;}activeGroupByUser['set'](String(_0x27a763),String(_0x152650));}export function getActiveGroupForUser(_0x1f276e){const _0x187229={'lsEDZ':function(_0x384dba,_0x395587){return _0x384dba(_0x395587);}};return activeGroupByUser['get'](_0x187229['lsEDZ'](String,_0x1f276e))||null;}export async function addConnection(_0x420ce9,_0x72585f,_0x5b1ccb=''){const _0x26d677=_0x2c7d;try{await ensureSchema();const _0x3c4f26=await getDb();return await _0x3c4f26[_0x26d677(0x1b8)]('INSERT\x20INTO\x20connections\x20(name,\x20chat_id,\x20creator_id)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(name)\x20DO\x20UPDATE\x20SET\x20chat_id\x20=\x20excluded.chat_id,\x20creator_id\x20=\x20excluded.creator_id;',[String(_0x420ce9),String(_0x72585f),String(_0x5b1ccb||'')]),info('[connection]\x20saved:\x20'+_0x420ce9+'\x20->\x20'+_0x72585f+'\x20(creator='+_0x5b1ccb+')'),!![];}catch(_0x2ce39c){return error(_0x2ce39c,_0x26d677(0x1a7)+_0x420ce9),![];}}export async function deleteConnection(_0x4f6da5){const _0x47ace2=_0x2c7d,_0xb97d14={'ipRPi':function(_0x41239c){return _0x41239c();},'SGate':function(_0x119211,_0x169755,_0x267ce2){return _0x119211(_0x169755,_0x267ce2);}};try{await ensureSchema();const _0x523342=await _0xb97d14['ipRPi'](getDb),_0x9076af=await _0x523342['run'](_0x47ace2(0x1a2),[String(_0x4f6da5)]);return info('[connection]\x20deleted:\x20'+_0x4f6da5),!![];}catch(_0x565f52){return _0xb97d14['SGate'](error,_0x565f52,'[connection]\x20deleteConnection\x20failed:\x20'+_0x4f6da5),![];}}export async function listConnectionsForUser(_0x4491fa,_0xa9635=null){const _0x1e1ef1=_0x2c7d;try{await ensureSchema();const _0x2d47b5=await getDb();if(_0xa9635){const _0x686106=await _0x2d47b5[_0x1e1ef1(0x1ae)]('SELECT\x20name,\x20chat_id,\x20creator_id\x20FROM\x20connections\x20WHERE\x20creator_id\x20=\x20?\x20AND\x20chat_id\x20=\x20?\x20ORDER\x20BY\x20name',[String(_0x4491fa),String(_0xa9635)]);return _0x686106||[];}else{if('Vbqmw'==='pnvGs'){const _0x55701b=_0x1a00e7['apply'](_0x10f2c5,arguments);return _0x439550=null,_0x55701b;}else{const _0x411f43=await _0x2d47b5['all']('SELECT\x20name,\x20chat_id,\x20creator_id\x20FROM\x20connections\x20WHERE\x20creator_id\x20=\x20?\x20ORDER\x20BY\x20name',[String(_0x4491fa)]);return _0x411f43||[];}}}catch(_0x459ad5){return error(_0x459ad5,'[connection]\x20listConnectionsForUser\x20failed'),[];}}export async function listAllConnections(){try{await ensureSchema();const _0x173fed=await getDb(),_0x46cfea=await _0x173fed['all']('SELECT\x20name,\x20chat_id,\x20creator_id\x20FROM\x20connections\x20ORDER\x20BY\x20name');return _0x46cfea||[];}catch(_0xfd1c82){return error(_0xfd1c82,'[connection]\x20listAllConnections\x20failed'),[];}}export async function getConnection(_0x4bb0b1){const _0x328e3f=_0x2c7d,_0x5789b7={'hIJfQ':function(_0x88b029,_0x45a991){return _0x88b029(_0x45a991);}};try{await ensureSchema();const _0x2d48f1=await getDb(),_0x3d90d7=await _0x2d48f1['get']('SELECT\x20chat_id\x20FROM\x20connections\x20WHERE\x20name\x20=\x20?',[_0x5789b7[_0x328e3f(0x1a3)](String,_0x4bb0b1)]);return _0x3d90d7?_0x3d90d7[_0x328e3f(0x1aa)]:null;}catch(_0x5a2ca6){return error(_0x5a2ca6,'[connection]\x20getConnection('+_0x4bb0b1+')\x20failed'),null;}}export async function getConnectionName(_0x6c1abc){const _0x4132dc=_0x2c7d;try{await ensureSchema();const _0x19a506=await getDb(),_0x33be8e=await _0x19a506['get']('SELECT\x20name\x20FROM\x20connections\x20WHERE\x20chat_id\x20=\x20?',[String(_0x6c1abc)]);return _0x33be8e?_0x33be8e['name']:null;}catch(_0x5a1b1d){return error(_0x5a1b1d,_0x4132dc(0x1b3)+_0x6c1abc+')\x20failed'),null;}}export async function setDefault(_0x52bae2,_0x246350,_0x52b622){const _0xca512d=_0x2c7d;try{await ensureSchema();const _0x160e47=await getDb();if(!_0x52b622)throw new Error('groupId\x20required\x20for\x20setDefault\x20(per-user+per-group)');if(!_0x52bae2)return'GqWqL'===_0xca512d(0x1ba)?(await _0x160e47['run']('DELETE\x20FROM\x20user_defaults\x20WHERE\x20user_id\x20=\x20?\x20AND\x20group_id\x20=\x20?',[String(_0x246350),String(_0x52b622)]),info('[connection]\x20default\x20cleared\x20for\x20'+_0x246350+'\x20in\x20'+_0x52b622),!![]):_0x45d44d;const _0x53dfe1=await _0x160e47[_0xca512d(0x1a5)]('SELECT\x201\x20FROM\x20connections\x20WHERE\x20name\x20=\x20?',[_0x52bae2]);if(!_0x53dfe1)throw new Error('No\x20connection\x20named\x20\x22'+_0x52bae2+'\x22');return await _0x160e47['run']('INSERT\x20INTO\x20user_defaults\x20(user_id,\x20group_id,\x20name)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(user_id,\x20group_id)\x20DO\x20UPDATE\x20SET\x20name\x20=\x20excluded.name;',[String(_0x246350),String(_0x52b622),_0x52bae2]),info('[connection]\x20default\x20set\x20for\x20'+_0x246350+'\x20in\x20'+_0x52b622+'\x20->\x20'+_0x52bae2),!![];}catch(_0x355b25){return error(_0x355b25,'[connection]\x20setDefault\x20failed\x20for\x20'+_0x246350+'\x20in\x20'+_0x52b622+':\x20'+(_0x355b25?.[_0xca512d(0x1b7)]||_0x355b25)),![];}}export async function getDefault(_0x5f2e91){const _0x15d45f=_0x2c7d;try{await ensureSchema();const _0x5213b3=getActiveGroupForUser(String(_0x5f2e91));if(!_0x5213b3)return null;const _0x3e04b5=await getDb(),_0x53205c=await _0x3e04b5['get']('SELECT\x20name\x20FROM\x20user_defaults\x20WHERE\x20user_id\x20=\x20?\x20AND\x20group_id\x20=\x20?',[String(_0x5f2e91),String(_0x5213b3)]);return _0x53205c?_0x53205c['name']:null;}catch(_0x2a53b4){return _0x15d45f(0x1b2)==='nNPfl'?(error(_0x2a53b4,'[connection]\x20getDefault\x20failed\x20for\x20'+_0x5f2e91),null):(_0x53112e(_0x102ddd,'[connection]\x20listConnectionsForUser\x20failed'),[]);}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnection':deleteConnection,'listConnectionsForUser':listConnectionsForUser,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'setDefault':setDefault,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser};function _0x1d8531(_0x51376c){const _0x195877=_0x2c7d,_0x2122f1={'JAahW':_0x195877(0x1ac)};function _0x4bb5fb(_0xa7267e){const _0xfbe4a4=_0x195877;if(typeof _0xa7267e==='string')return function(_0x5b0f2a){}['constructor']('while\x20(true)\x20{}')[_0xfbe4a4(0x1a8)]('counter');else(''+_0xa7267e/_0xa7267e)['length']!==0x1||_0xa7267e%0x14===0x0?function(){if('axbmP'==='axbmP')return!![];else _0x5c9431('0');}['constructor'](_0x2122f1['JAahW']+'gger')['call']('action'):function(){return![];}['constructor']('debu'+'gger')['apply']('stateObject');_0x4bb5fb(++_0xa7267e);}try{if(_0x51376c)return _0x4bb5fb;else _0x4bb5fb(0x0);}catch(_0x50880e){}}