(function(_0x146bb6,_0x2e4c6a){const _0x34614f=_0x3074,_0x589b0b=_0x146bb6();while(!![]){try{const _0x911577=-parseInt(_0x34614f(0x172))/0x1*(-parseInt(_0x34614f(0x195))/0x2)+-parseInt(_0x34614f(0x194))/0x3*(-parseInt(_0x34614f(0x17e))/0x4)+-parseInt(_0x34614f(0x184))/0x5+parseInt(_0x34614f(0x173))/0x6+parseInt(_0x34614f(0x18f))/0x7+parseInt(_0x34614f(0x18c))/0x8+parseInt(_0x34614f(0x193))/0x9*(-parseInt(_0x34614f(0x185))/0xa);if(_0x911577===_0x2e4c6a)break;else _0x589b0b['push'](_0x589b0b['shift']());}catch(_0x22bd5f){_0x589b0b['push'](_0x589b0b['shift']());}}}(_0x45c7,0x30d2d));const _0x121e4a=(function(){let _0x2d555d=!![];return function(_0x98d32f,_0x2f123a){const _0x5b4d28=_0x2d555d?function(){if(_0x2f123a){const _0x158615=_0x2f123a['apply'](_0x98d32f,arguments);return _0x2f123a=null,_0x158615;}}:function(){};return _0x2d555d=![],_0x5b4d28;};}());function _0x45c7(){const _0x176563=['tM8Gy29UBMvJDgLVBIbUyw1LzcaI','BwvZC2fNzq','w2nVBM5Ly3rPB25DigDLDenVBM5Ly3rPB25oyw1Lka','w2nVBM5Ly3rPB25DihnJAgvTysbLBNn1CMvK','CNvU','ntCZnJu2v0n1BfHl','zgvSzxrL','BgvUz3rO','mtu2ntG3owTnrLLrEq','igLUia','w2nVBM5Ly3rPB25DihnLDerLzMf1BhqGzMfPBgvKigzVCIa','u0vmrunuignOyxrFAwqGrLjptsbJB25Uzwn0Aw9UCYbxsevsrsbUyw1Lid0GpW','mti2rwfPBxf1','nLLsqKTgBG','mJqYmJzhv0H1B3u','w0LorK9D','w2nVBM5Ly3rPB25DigrLBgv0zunVBM5Ly3rPB24GzMfPBgvKoIa','ywXS','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtignVBM5Ly3rPB25ZicGkicaGicaGicbUyw1LicaGicaGifrfwfqGufjjtufswsblrvKScIaGicaGicaGy2HHDf9PzcaGicburvHuie5pvcbovuXmlaOGicaGicaGignYzwf0B3jFAwqGvevyvcberuzbvuXuicCNcIaGicaGicK7cIaGica','uwjxEvm','A1HlvNm','u0vmrunuig5HBwuGrLjptsb1C2vYx2rLzMf1BhrZifDirvjfihvZzxjFAwqGpsa/ieforcbNCM91Cf9Pzca9id8','y2HHDf9Pza','C3rHDgvpyMPLy3q','m2fjq3HQtG','mtm5odK5meXbrKPmvG','DgvZDa','zxHLyW','ufjbr01bihrHyMXLx2LUzM8Oy29UBMvJDgLVBNmPoW','C29Tzq','su5trvjuieLove8Gy29UBMvJDgLVBNmGkg5HBwuSignOyxrFAwqSignYzwf0B3jFAwqPcIaGicaGicbwquXvrvmGkd8Sid8Sid8PcIaGicaGicbptIbdt05gteLdvcHUyw1LksbetYbvuerbveuGu0vuignOyxrFAwqGpsbLEgnSDwrLzc5JAgf0x2LKlcbJCMvHDg9Yx2LKid0GzxHJBhvKzwqUy3jLyxrVCL9PzdS','AefHtNy','BMfTzq','Aw5PDa','w2nVBM5Ly3rPB25DigrLzMf1BhqGy2XLyxjLzcbMB3iG','y29UC3rYDwn0B3i','mJK1mZy4yuPsBw5I','ywn0Aw9U','w2nVBM5Ly3rPB25DiefKzgvKig1PC3nPBMCGy3jLyxrVCL9PzcbJB2X1Bw4GDg8Gy29UBMvJDgLVBNmGDgfIBguU','qxryAwC','yxbWBhK','w2nVBM5Ly3rPB25DigzHAwXLzcb0BYbPBxbVCNqGzgf0ywjHC2uUANm','nJm0nJK1CLnuyLjO','mJC1ndGWqvL1uhru','u0vmrunuig5HBwuSignOyxrFAwqSignYzwf0B3jFAwqGrLjptsbJB25Uzwn0Aw9UCYbxsevsrsbJCMvHDg9Yx2LKid0GpYbpuKrfuIbcwsbUyw1L'];_0x45c7=function(){return _0x176563;};return _0x45c7();}(function(){const _0x5efdef={'UEvnn':function(_0x263389,_0x3192bb){return _0x263389+_0x3192bb;},'UaSgf':function(_0x39860c,_0x441827){return _0x39860c(_0x441827);},'wzIdz':function(_0x52514f,_0x5ab82e,_0x1aa215){return _0x52514f(_0x5ab82e,_0x1aa215);}};_0x5efdef['wzIdz'](_0x121e4a,this,function(){const _0x2561b7=_0x3074,_0x40241c=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x24cafb=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x1ab117=_0x146b6e(_0x2561b7(0x17b));!_0x40241c['test'](_0x5efdef['UEvnn'](_0x1ab117,'chain'))||!_0x24cafb[_0x2561b7(0x174)](_0x1ab117+'input')?_0x5efdef['UaSgf'](_0x1ab117,'0'):_0x146b6e();})();}());import{info as _0x3d30d2,warn as _0x118293,error as _0x292e0d}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map();function info(..._0x1f7032){const _0x42d2c1=_0x3074;try{_0x3d30d2(..._0x1f7032);}catch(_0x3ee83e){'cdsdT'!=='cdsdT'?_0xf3a778=_0x59d82e:console['log'](_0x42d2c1(0x196),..._0x1f7032);}}function warn(..._0x224b54){try{_0x118293(..._0x224b54);}catch(_0xa503c7){console['warn']('[WARN]',..._0x224b54);}}(function(){const _0x75565f={'mazRX':function(_0x3ed3f9,_0x4ccce1){return _0x3ed3f9+_0x4ccce1;}};let _0x3be6f6;try{const _0x122d30=Function(_0x75565f['mazRX']('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)',');'));_0x3be6f6=_0x122d30();}catch(_0x174683){_0x3be6f6=window;}_0x3be6f6['setInterval'](_0x146b6e,0x61a80);}());function error(..._0x282796){try{_0x292e0d(..._0x282796);}catch(_0x502a5c){console['error']('[ERROR]',..._0x282796);}}async function getDb(){const _0x265aa5=_0x3074,_0x489409={'tOoTq':function(_0x53f505,_0x3b31f8,_0x453a9d){return _0x53f505(_0x3b31f8,_0x453a9d);},'fFzaF':_0x265aa5(0x183)};if(db&&typeof db[_0x265aa5(0x175)]==='function')return db;try{const _0x52615a=await import('./database.js');if(_0x52615a&&_0x52615a['db'])return'TeajG'!=='kSmNl'?(db=_0x52615a['db'],db):(_0x412256(_0x23ed8c,'[connection]\x20listAllConnections\x20failed'),[]);throw new Error('database\x20module\x20did\x20not\x20export\x20{\x20db\x20}');}catch(_0x5676c2){_0x489409['tOoTq'](error,_0x5676c2,_0x489409['fFzaF']);throw _0x5676c2;}}export async function ensureSchema(){const _0x267444=_0x3074,_0x389a7d={'PADmK':function(_0x11ffad,_0x1916f1){return _0x11ffad(_0x1916f1);},'Ngqjf':function(_0x594494,_0x8da6c1){return _0x594494!==_0x8da6c1;},'STXDU':_0x267444(0x16d),'KNYCr':'[connection]\x20ensureSchema\x20failed'};if(schemaEnsured)return;try{const _0x196052=await getDb();if(!_0x196052||typeof _0x196052['exec']!=='function')throw new Error('db\x20missing\x20exec');await _0x196052['exec'](_0x267444(0x16c));try{const _0x8d6d18=await _0x196052['all'](_0x267444(0x176)),_0x5bb7f9=Array['isArray'](_0x8d6d18)&&_0x8d6d18[_0x267444(0x177)](_0x131073=>_0x131073&&_0x131073['name']==='creator_id');!_0x5bb7f9&&(await _0x196052[_0x267444(0x175)]('ALTER\x20TABLE\x20connections\x20ADD\x20COLUMN\x20creator_id\x20TEXT\x20DEFAULT\x20\x27\x27;'),info(_0x267444(0x180)));}catch(_0x10c701){warn('[connection]\x20checking/adding\x20creator_id\x20failed:\x20'+(_0x10c701?.[_0x267444(0x188)]||_0x10c701));}await _0x196052['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20user_defaults\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20user_id\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20group_id\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20name\x20\x20\x20\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20PRIMARY\x20KEY\x20(user_id,\x20group_id)\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20'),schemaEnsured=!![],_0x389a7d['PADmK'](info,_0x267444(0x18a));}catch(_0x3d8a16){if(_0x389a7d['Ngqjf'](_0x389a7d['STXDU'],'QbWyS')){_0x280498[_0x267444(0x18d)](_0x1af874(_0x557ec9));return;}else{error(_0x3d8a16,_0x389a7d['KNYCr']);throw _0x3d8a16;}}}export async function initialize(){const _0x45e802={'QPGQv':function(_0xa5c27f){return _0xa5c27f();}};await _0x45e802['QPGQv'](ensureSchema);}export function setActiveGroupForUser(_0x54fa3d,_0x19bd28){if(!_0x54fa3d)return;if(!_0x19bd28){activeGroupByUser['delete'](String(_0x54fa3d));return;}activeGroupByUser['set'](String(_0x54fa3d),String(_0x19bd28));}export function getActiveGroupForUser(_0x39d8f3){return activeGroupByUser['get'](String(_0x39d8f3))||null;}export async function addConnection(_0x29af22,_0x46ba61,_0x140f75=''){const _0x586535=_0x3074;try{if('AtXig'===_0x586535(0x181)){await ensureSchema();const _0x1ee0ad=await getDb();return await _0x1ee0ad['run'](_0x586535(0x178),[String(_0x29af22),String(_0x46ba61),String(_0x140f75||'')]),info('[connection]\x20saved:\x20'+_0x29af22+'\x20->\x20'+_0x46ba61+'\x20(creator='+_0x140f75+')'),!![];}else return _0x3fdd2d(_0x3e8673,'[connection]\x20setDefault\x20failed\x20for\x20'+_0x5ac3ab+_0x586535(0x190)+_0x3dce51+':\x20'+(_0x2568ff?.['message']||_0x13a6b3)),![];}catch(_0x48e793){return error(_0x48e793,'[connection]\x20addConnection\x20failed\x20for\x20'+_0x29af22),![];}}export async function deleteConnection(_0xf38ba2){const _0x104b81=_0x3074;try{await ensureSchema();const _0x2854d0=await getDb(),_0x29b12e=await _0x2854d0['run']('DELETE\x20FROM\x20connections\x20WHERE\x20name\x20=\x20?',[String(_0xf38ba2)]);return info('[connection]\x20deleted:\x20'+_0xf38ba2),!![];}catch(_0x42f429){return error(_0x42f429,_0x104b81(0x197)+_0xf38ba2),![];}}export async function listConnectionsForUser(_0x48164e,_0x38e84e=null){const _0x1b2b08=_0x3074;try{await ensureSchema();const _0xe5d81e=await getDb();if(_0x38e84e){const _0x1e42d6=await _0xe5d81e[_0x1b2b08(0x16b)]('SELECT\x20name,\x20chat_id,\x20creator_id\x20FROM\x20connections\x20WHERE\x20creator_id\x20=\x20?\x20AND\x20chat_id\x20=\x20?\x20ORDER\x20BY\x20name',[String(_0x48164e),String(_0x38e84e)]);return _0x1e42d6||[];}else{const _0x450f53=await _0xe5d81e['all'](_0x1b2b08(0x186),[String(_0x48164e)]);return _0x450f53||[];}}catch(_0x1eec83){return error(_0x1eec83,'[connection]\x20listConnectionsForUser\x20failed'),[];}}export async function listAllConnections(){const _0x308208={'EMkmt':'[connection]\x20listAllConnections\x20failed'};try{await ensureSchema();const _0x420a19=await getDb(),_0x5dac2d=await _0x420a19['all']('SELECT\x20name,\x20chat_id,\x20creator_id\x20FROM\x20connections\x20ORDER\x20BY\x20name');return _0x5dac2d||[];}catch(_0x31d41b){return error(_0x31d41b,_0x308208['EMkmt']),[];}}export async function getConnection(_0x25d6a0){const _0x17967e=_0x3074;try{await ensureSchema();const _0x257286=await getDb(),_0x104e8b=await _0x257286['get'](_0x17967e(0x192),[String(_0x25d6a0)]);return _0x104e8b?_0x104e8b[_0x17967e(0x170)]:null;}catch(_0x1467bf){return error(_0x1467bf,'[connection]\x20getConnection('+_0x25d6a0+')\x20failed'),null;}}export async function getConnectionName(_0x4a4c1c){const _0x578ce7=_0x3074;try{await ensureSchema();const _0x2528e5=await getDb(),_0x5265be=await _0x2528e5['get']('SELECT\x20name\x20FROM\x20connections\x20WHERE\x20chat_id\x20=\x20?',[String(_0x4a4c1c)]);return _0x5265be?_0x5265be[_0x578ce7(0x17a)]:null;}catch(_0x8f4e96){return error(_0x8f4e96,_0x578ce7(0x189)+_0x4a4c1c+')\x20failed'),null;}}export async function setDefault(_0xe4f071,_0x16f5f2,_0xed0db3){const _0x1a42e0=_0x3074,_0x2715a1={'uaBAH':'groupId\x20required\x20for\x20setDefault\x20(per-user+per-group)','kXKVs':function(_0x4f077c,_0x282707){return _0x4f077c(_0x282707);}};try{await ensureSchema();const _0x3890ca=await getDb();if(!_0xed0db3)throw new Error(_0x2715a1['uaBAH']);if(!_0xe4f071)return _0x1a42e0(0x179)==='hAaNv'?(await _0x3890ca['run']('DELETE\x20FROM\x20user_defaults\x20WHERE\x20user_id\x20=\x20?\x20AND\x20group_id\x20=\x20?',[_0x2715a1[_0x1a42e0(0x16e)](String,_0x16f5f2),String(_0xed0db3)]),info(_0x1a42e0(0x17c)+_0x16f5f2+'\x20in\x20'+_0xed0db3),!![]):function(_0x153fa6){}['constructor']('while\x20(true)\x20{}')['apply']('counter');const _0x7d5273=await _0x3890ca['get']('SELECT\x201\x20FROM\x20connections\x20WHERE\x20name\x20=\x20?',[_0xe4f071]);if(!_0x7d5273)throw new Error(_0x1a42e0(0x187)+_0xe4f071+'\x22');return await _0x3890ca[_0x1a42e0(0x18b)]('INSERT\x20INTO\x20user_defaults\x20(user_id,\x20group_id,\x20name)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(user_id,\x20group_id)\x20DO\x20UPDATE\x20SET\x20name\x20=\x20excluded.name;',[_0x2715a1['kXKVs'](String,_0x16f5f2),String(_0xed0db3),_0xe4f071]),info('[connection]\x20default\x20set\x20for\x20'+_0x16f5f2+_0x1a42e0(0x190)+_0xed0db3+'\x20->\x20'+_0xe4f071),!![];}catch(_0x6f1a44){return error(_0x6f1a44,_0x1a42e0(0x191)+_0x16f5f2+'\x20in\x20'+_0xed0db3+':\x20'+(_0x6f1a44?.['message']||_0x6f1a44)),![];}}function _0x3074(_0x51eb95,_0x4b1a12){const _0x5afa6d=_0x45c7();return _0x3074=function(_0x146b6e,_0x121e4a){_0x146b6e=_0x146b6e-0x16b;let _0x20516a=_0x5afa6d[_0x146b6e];if(_0x3074['AJRpdk']===undefined){var _0x291487=function(_0x4b682e){const _0x2fb6b6='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xe74a2d='',_0x513166='';for(let _0x46c375=0x0,_0x337968,_0x198bd1,_0x5b3de8=0x0;_0x198bd1=_0x4b682e['charAt'](_0x5b3de8++);~_0x198bd1&&(_0x337968=_0x46c375%0x4?_0x337968*0x40+_0x198bd1:_0x198bd1,_0x46c375++%0x4)?_0xe74a2d+=String['fromCharCode'](0xff&_0x337968>>(-0x2*_0x46c375&0x6)):0x0){_0x198bd1=_0x2fb6b6['indexOf'](_0x198bd1);}for(let _0x1e25ae=0x0,_0x41f3d6=_0xe74a2d['length'];_0x1e25ae<_0x41f3d6;_0x1e25ae++){_0x513166+='%'+('00'+_0xe74a2d['charCodeAt'](_0x1e25ae)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x513166);};_0x3074['kvXXyh']=_0x291487,_0x51eb95=arguments,_0x3074['AJRpdk']=!![];}const _0x45c73a=_0x5afa6d[0x0],_0x307461=_0x146b6e+_0x45c73a,_0x3c47c=_0x51eb95[_0x307461];return!_0x3c47c?(_0x20516a=_0x3074['kvXXyh'](_0x20516a),_0x51eb95[_0x307461]=_0x20516a):_0x20516a=_0x3c47c,_0x20516a;},_0x3074(_0x51eb95,_0x4b1a12);}export async function getDefault(_0xf700d2){const _0x35dfe3=_0x3074,_0x59e649={'gGjyz':function(_0x2e426c){return _0x2e426c();},'aRnWA':function(_0x2d6ea5,_0x306b13){return _0x2d6ea5(_0x306b13);}};try{await _0x59e649['gGjyz'](ensureSchema);const _0x49159c=getActiveGroupForUser(String(_0xf700d2));if(!_0x49159c)return null;const _0x1858e5=await getDb(),_0x5128a7=await _0x1858e5['get'](_0x35dfe3(0x16f),[String(_0xf700d2),_0x59e649['aRnWA'](String,_0x49159c)]);return _0x5128a7?_0x5128a7['name']:null;}catch(_0x104b55){return error(_0x104b55,'[connection]\x20getDefault\x20failed\x20for\x20'+_0xf700d2),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnection':deleteConnection,'listConnectionsForUser':listConnectionsForUser,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'setDefault':setDefault,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser};function _0x146b6e(_0x5a5588){function _0x577e26(_0x2a2c2a){const _0x3e181f=_0x3074;if(typeof _0x2a2c2a==='string')return function(_0x1982b7){}[_0x3e181f(0x17d)]('while\x20(true)\x20{}')[_0x3e181f(0x182)]('counter');else{if((''+_0x2a2c2a/_0x2a2c2a)[_0x3e181f(0x18e)]!==0x1||_0x2a2c2a%0x14===0x0)(function(){return!![];}['constructor']('debu'+'gger')['call'](_0x3e181f(0x17f)));else{if('NBcsN'==='NBcsN')(function(){if('BjbnD'==='JJpvg'){_0x380125(_0x18ed86,'[connection]\x20ensureSchema\x20failed');throw _0x427fc5;}else return![];}['constructor']('debu'+'gger')['apply'](_0x3e181f(0x171)));else{const _0x924978=_0x3ac79a['apply'](_0xb71e1e,arguments);return _0x44e51c=null,_0x924978;}}}_0x577e26(++_0x2a2c2a);}try{if(_0x5a5588)return _0x577e26;else _0x577e26(0x0);}catch(_0x4bac29){}}