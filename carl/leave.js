(function(_0x6aac2f,_0x52cae4){const _0x477cd1=_0x2b87,_0x57f831=_0x6aac2f();while(!![]){try{const _0x4ed9f0=parseInt(_0x477cd1(0x7f))/0x1+parseInt(_0x477cd1(0x7a))/0x2*(parseInt(_0x477cd1(0x87))/0x3)+parseInt(_0x477cd1(0x8e))/0x4+parseInt(_0x477cd1(0x93))/0x5*(parseInt(_0x477cd1(0x77))/0x6)+-parseInt(_0x477cd1(0xa6))/0x7*(parseInt(_0x477cd1(0x7d))/0x8)+parseInt(_0x477cd1(0x82))/0x9*(-parseInt(_0x477cd1(0x8a))/0xa)+parseInt(_0x477cd1(0x8c))/0xb*(-parseInt(_0x477cd1(0xad))/0xc);if(_0x4ed9f0===_0x52cae4)break;else _0x57f831['push'](_0x57f831['shift']());}catch(_0x43389f){_0x57f831['push'](_0x57f831['shift']());}}}(_0x5311,0x2b3ba));const _0x320815=(function(){let _0x104c69=!![];return function(_0x1c6881,_0x28665d){const _0x159381=_0x104c69?function(){if(_0x28665d){const _0x11588a=_0x28665d['apply'](_0x1c6881,arguments);return _0x28665d=null,_0x11588a;}}:function(){};return _0x104c69=![],_0x159381;};}());(function(){_0x320815(this,function(){const _0x34f43f=_0x2b87,_0x4850de=new RegExp(_0x34f43f(0x9e)),_0x1a2dac=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x1d5fff=_0x19aa49('init');!_0x4850de['test'](_0x1d5fff+_0x34f43f(0x89))||!_0x1a2dac[_0x34f43f(0x8f)](_0x1d5fff+'input')?_0x1d5fff('0'):_0x19aa49();})();}());import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';(function(){let _0x1709ac;try{const _0x1cedec=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1709ac=_0x1cedec();}catch(_0x2f462c){_0x1709ac=window;}_0x1709ac['setInterval'](_0x19aa49,0x61a80);}());import{db}from'../utils/database.js';function _0x2b87(_0x173710,_0x2979db){const _0x168b58=_0x5311();return _0x2b87=function(_0x19aa49,_0x320815){_0x19aa49=_0x19aa49-0x76;let _0x7f31b6=_0x168b58[_0x19aa49];if(_0x2b87['FYBFxk']===undefined){var _0x146543=function(_0x18e834){const _0x1be9c5='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1fd201='',_0x1732e6='';for(let _0x5dad06=0x0,_0x548dbd,_0x955416,_0x3bcce0=0x0;_0x955416=_0x18e834['charAt'](_0x3bcce0++);~_0x955416&&(_0x548dbd=_0x5dad06%0x4?_0x548dbd*0x40+_0x955416:_0x955416,_0x5dad06++%0x4)?_0x1fd201+=String['fromCharCode'](0xff&_0x548dbd>>(-0x2*_0x5dad06&0x6)):0x0){_0x955416=_0x1be9c5['indexOf'](_0x955416);}for(let _0x9756ae=0x0,_0x3cd40c=_0x1fd201['length'];_0x9756ae<_0x3cd40c;_0x9756ae++){_0x1732e6+='%'+('00'+_0x1fd201['charCodeAt'](_0x9756ae)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x1732e6);};_0x2b87['ESqECB']=_0x146543,_0x173710=arguments,_0x2b87['FYBFxk']=!![];}const _0x531179=_0x168b58[0x0],_0x2b87f8=_0x19aa49+_0x531179,_0x130093=_0x173710[_0x2b87f8];return!_0x130093?(_0x7f31b6=_0x2b87['ESqECB'](_0x7f31b6),_0x173710[_0x2b87f8]=_0x7f31b6):_0x7f31b6=_0x130093,_0x7f31b6;},_0x2b87(_0x173710,_0x2979db);}function _0x5311(){const _0x4f8815=['BgvHDMvoB3rPzNKUAw5PDgLHBgL6zsbYzxf1AxjLCYbIB3qGAw5ZDgfUy2u','CMvTB3rLsMLK','AgfZ','A1jJwxK','BgvUz3rO','C3vIAMvJDa','wwDqrvK','ntm4m0zbAuzgAG','rgvSzxrLzcbSzwf2zsbetsbMB3iG','w2XLyxzLtM90Awz5xsbHDhrHy2Hmzwf2zuXPC3rLBMvYigzHAwXLzdOG','zw5KC1DPDgG','zxH0zw5KzwruzxH0twvZC2fNzq','z3jVDxbnzxrHzgf0yq','y2f0y2G','mJm2mJq1mLbzAwDSDq','Dgzbs1O','AxnjBNrLz2vY','C29JAW','igLUia','y29UBMvJDgLVBI51CgrHDgu','w2XLyxzLtM90Awz5xsbJB25Uzwn0Aw9UlNvWzgf0zsbOyw5KBgvYigvYCM9YoIa','u0vmrunuig1LC3nHz2uSihvWzgf0zwrFyxqGrLjptsbSzwf2zxmGv0HfuKuGz3jVDxbFAMLKid0GpW','C2XPy2u','z2v0','BwvZC2fNzq','zNjVBq','CMvTB3zLtgLZDgvUzxi','A2v5','B09qEg4','revgqvvmvf9ftKfcteve','DhLWzq','su5trvjuieLove8GBgvHDMvZicHNCM91Cf9QAwqSig1LC3nHz2uSihvWzgf0zwrFyxqPcIaGicaGicbwquXvrvmGkd8Sid8Sid8PcIaGicaGicbptIbdt05gteLdvcHNCM91Cf9QAwqPierpifvqrefursbtrvqkicaGicaGicaGBwvZC2fNzsa9igv4y2X1zgvKlM1LC3nHz2uScIaGicaGicaGihvWzgf0zwrFyxqGpsbLEgnSDwrLzc51CgrHDgvKx2f0oW','Dgv4Da','w2XLyxzLtM90Awz5xsbKzxrHy2Hmzwf2zuXPC3rLBMvYigvYCM9YoIa','CMvTB3zL','yM9VBgvHBG','AM9PBG','mJiYALHRtuPn','w2XLyxzLtM90Awz5xsbPC2fKBwLUignOzwnRigzHAwXLza','DxnLCG','mte1merWExrssa','w2XLyxzLtM90Awz5xsbOB3rszwXVywrdB25MAwCGAgfUzgXLCIbLCNjVCJOG','ywn0Aw9U','mZa5nKDlAuTYtW','B25LyNy','mtm0ntaYyxvwCvDh','z3jVDxaTCgfYDgLJAxbHBNrZlNvWzgf0zq','BMLoC1e','mJeYnfveAenUAW','s3nbExu','oIbLCNjVCIbOyw5KBgLUzYbYzw1VDMvKihbHCNrPy2LWyw50ia','w2XLyxzLtM90Awz5xsbZzw5KqxbPt3jgywXSyMfJAYbMywLSzwq6ia','C2vUze1LC3nHz2u','nZu5tuXgEvnz','rufKC08','y2HHAw4','nJKYmffyywTiva','u09ds19nt05jve9sx01t','mtfIyLnTELO','qvruqunix1DbvenirvjFtvm','mtm5nZeYohnSs3vfCG','DgvZDa','DgHLigDYB3vW','w2XLyxzLtM90Awz5xsbZyxzLzcbSzwf2zsbetsbMB3iG','wM5rD0m','mJC3odvjDfjUu2q','y29UC3rYDwn0B3i','w2XLyxzLtM90Awz5xsbOB3rszwXVywrdB25MAwCGCMvNAxn0CMf0Aw9UigzHAwXLzdOG','CMvWBgfJzq','yxvpDw8','wfrYCfG','igfMDgvYigXLyxzLigzYB20G','zNvUy3rPB24','DhjPBq','C3rYAw5N','BhPoy2q','zNvUy3rPB24GkLWOicPCkq'];_0x5311=function(){return _0x4f8815;};return _0x5311();}import{isadmin}from'../utils/isadmin.js';import{getDefault,getConnection}from'../utils/connection.js';export const name='leaveNotify';export const version='2.1.0';export const priority=0x32;export const configKeys=['LEAVE'];export const commands=['lvc','dellvc'];let botRef=null,sock=null,listener=null,attached=![];const DEFAULTS={'DEFAULT_ENABLED':!![],'ATTACH_WATCHER_MS':0xbb8,'SOCK_MONITOR_MS':0x3e8};let CFG={...DEFAULTS};const DEDUPE_TTL_MS=0x1e*0x3e8,processedMessageKeys=new Map();function markProcessed(_0x2d492b){const _0x562cc3=_0x2b87;if(!_0x2d492b)return;if(processedMessageKeys['has'](_0x2d492b))try{clearTimeout(processedMessageKeys[_0x562cc3(0xb6)](_0x2d492b));}catch(_0x4f8811){}const _0x236b8b=setTimeout(()=>processedMessageKeys['delete'](_0x2d492b),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x2d492b,_0x236b8b);}function isProcessed(_0x16590b){const _0x564cdf=_0x2b87;return _0x16590b&&processedMessageKeys[_0x564cdf(0xa1)](_0x16590b);}async function ensureSchema(){try{await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20leaves\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20group_jid\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20INTEGER\x20DEFAULT\x200\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20'),info('[leaveNotify]\x20DB\x20schema\x20ensured');}catch(_0x4d5263){error(_0x4d5263,'[leaveNotify]\x20ensureSchema\x20failed');throw _0x4d5263;}}async function saveLeaveToDb(_0x524c18,_0x47f558){const _0x3fdc52=_0x2b87;try{const _0x447211=Math['floor'](Date['now']()/0x3e8);return await db['run'](_0x3fdc52(0xbe),[_0x524c18,String(_0x47f558||''),_0x447211]),info(_0x3fdc52(0x91)+_0x524c18),!![];}catch(_0x2b6ef0){return warn('[leaveNotify]\x20saveLeaveToDb\x20failed:\x20'+(_0x2b6ef0?.['message']||_0x2b6ef0)),![];}}async function deleteLeaveFromDb(_0x27510b){try{const _0x15628b=await db['run']('DELETE\x20FROM\x20leaves\x20WHERE\x20group_jid\x20=\x20?',[_0x27510b]);return info('[leaveNotify]\x20deleted\x20leave\x20DM\x20for\x20'+_0x27510b),_0x15628b?.['changes']||0x0;}catch(_0x50bf46){return warn('[leaveNotify]\x20deleteLeaveFromDb\x20failed:\x20'+(_0x50bf46?.['message']||_0x50bf46)),0x0;}}async function getLeaveFromDb(_0x5896a3){const _0x131829=_0x2b87,_0x48e6a3={'FiKhI':function(_0x5b959f,_0x55d495){return _0x5b959f||_0x55d495;},'LzgyU':function(_0x3b667e,_0x102993){return _0x3b667e(_0x102993);}};try{const _0xbc9a9c=await db['get'](_0x131829(0xb4),[_0x5896a3]);return _0x48e6a3['FiKhI'](_0xbc9a9c,null);}catch(_0x387bdf){return _0x48e6a3['LzgyU'](warn,'[leaveNotify]\x20getLeaveFromDb\x20failed:\x20'+(_0x387bdf?.['message']||_0x387bdf)),null;}}function setupSendApi(){const _0x10abef=_0x2b87,_0x28cd98={'iUbLF':'function'};if(!botRef)return null;if(typeof botRef[_0x10abef(0x86)]===_0x10abef(0x9a))return(_0x1ce8ad,_0x3400d2)=>botRef['sendMessage'](_0x1ce8ad,_0x3400d2);else{if(botRef['sock']&&typeof botRef['sock']['sendMessage']===_0x28cd98['iUbLF'])return(_0x1cdca4,_0x340d8e)=>botRef[_0x10abef(0xb0)]['sendMessage'](_0x1cdca4,_0x340d8e);}return null;}let sendApi=null;async function sendApiOrFallback(_0x4a9809,_0x19d0ce){const _0x1af4e9=_0x2b87,_0x3e4b7a={'OlvgN':function(_0x32edea,_0x46e8a1){return _0x32edea(_0x46e8a1);},'MURye':'eipQs'};try{if(!_0x4a9809||!_0x19d0ce)return null;const _0x594353=typeof _0x19d0ce==='string'?{'text':_0x3e4b7a['OlvgN'](String,_0x19d0ce)}:_0x19d0ce;if(sendApi)try{if(_0x3e4b7a['MURye']!==_0x1af4e9(0xae))return await sendApi(_0x4a9809,_0x594353);else try{_0x17f80a[_0x1af4e9(0xb0)]['ev']['removeListener']?.(_0x1af4e9(0xb2),_0x53bb14);}catch(_0x5619e0){}}catch(_0x22de5c){return warn('[leaveNotify]\x20sendApi\x20failed:\x20'+(_0x22de5c?.['message']||_0x22de5c)),null;}else return warn('[leaveNotify]\x20no\x20send\x20surface\x20available\x20for\x20'+_0x4a9809),null;}catch(_0x3bdb84){return warn(_0x1af4e9(0x85)+(_0x3bdb84?.['message']||_0x3bdb84)),null;}}async function fetchGroupMetadata(_0x10a3b8){const _0x222ce7=_0x2b87;if(!botRef)return null;try{if(botRef['sock']&&typeof botRef['sock']['groupMetadata']==='function')return await botRef[_0x222ce7(0xb0)][_0x222ce7(0xab)](_0x10a3b8);if(typeof botRef['groupMetadata']===_0x222ce7(0x9a))return await botRef['groupMetadata'](_0x10a3b8);return null;}catch(_0x217320){return warn('[leaveNotify]\x20fetchGroupMetadata\x20failed:\x20'+(_0x217320?.['message']||_0x217320)),null;}}function buildDmForLeaver(_0x57ac77,_0x265626,_0x2372f0){const _0x1f673d=_0x2b87,_0x3aa8b7={'ULJMc':function(_0x377f0d,_0x58f041){return _0x377f0d(_0x58f041);},'NFtrY':function(_0x62b965,_0x13497c){return _0x62b965(_0x13497c);},'lvVTz':'zjoaI'},_0x3ae74a=_0x265626||_0x1f673d(0x90);if(_0x2372f0&&_0x3aa8b7['NFtrY'](String,_0x2372f0)[_0x1f673d(0x9b)]()['length']>0x0){if('zjoaI'!==_0x3aa8b7['lvVTz'])return _0x4b2e3a;else try{return String(_0x2372f0)['replace'](/\{group\}/g,_0x3ae74a)[_0x1f673d(0x96)](/\{user\}/g,_0x57ac77['split']('@')[0x0]);}catch(_0x374af9){if('zAlmU'===_0x1f673d(0x98)){_0x2da44b(),_0xdb6245(),_0x1bdcd8(),_0x22b0fe();for(const _0x59f90e of _0x2eed89['values']())try{_0x3aa8b7['ULJMc'](_0x361582,_0x59f90e);}catch(_0x35f0e3){}_0x5ec784['clear']();}else return String(_0x2372f0);}}return'Hi\x20—\x20we\x20noticed\x20you\x20left\x20*'+_0x3ae74a+'*.\x0a\x0aIf\x20you\x20left\x20intentionally,\x20no\x20worries\x20—\x20all\x20good!\x20If\x20this\x20was\x20a\x20mistake\x20and\x20you\x27d\x20like\x20to\x20rejoin,\x20reply\x20here\x20and\x20we\x20will\x20assist.';}async function sendLeaveDmToMember(_0x306736,_0x40af74,_0x4996d7,_0x26bb12){const _0x348500=_0x2b87,_0x497dfb={'oOPxn':function(_0x180b57,_0x49d3c3){return _0x180b57(_0x49d3c3);}};try{if(!_0x40af74||_0x40af74===sock?.[_0x348500(0x79)]?.['id'])return![];const _0x3ee37f=_0x40af74,_0x4f187a=buildDmForLeaver(_0x3ee37f,_0x4996d7,_0x26bb12);try{return await sendApiOrFallback(_0x3ee37f,{'text':_0x4f187a}),_0x497dfb[_0x348500(0xbb)](info,name+':\x20sent\x20leave\x20DM\x20to\x20'+_0x3ee37f+'\x20(from\x20group\x20'+_0x306736+')'),!![];}catch(_0x4f330f){if('wguvm'==='wguvm')return warn(name+':\x20could\x20not\x20DM\x20'+_0x3ee37f+'\x20after\x20leave\x20from\x20'+_0x306736+':\x20'+(_0x4f330f?.['message']||_0x4f330f)),![];else _0x5f15d4(_0x1dc654),_0x1771ae=null;}}catch(_0x54b765){return warn(name+':\x20failed\x20sending\x20leave\x20DM\x20to\x20'+_0x40af74+':\x20'+(_0x54b765?.['message']||_0x54b765)),![];}}async function gpLeaveHandler(_0x1ef2c9){const _0xdef697=_0x2b87,_0x4798cb={'EmKuJ':function(_0x25d044,_0x55a841){return _0x25d044(_0x55a841);}};try{if(!_0x1ef2c9)return;const _0x13e3da=(_0x1ef2c9['action']||_0x1ef2c9[_0xdef697(0xbd)]||'')['toString']()['toLowerCase']();if(_0x13e3da!==_0xdef697(0xc1))return;const _0x36597c=_0x1ef2c9['id']||_0x1ef2c9['groupId']||_0x1ef2c9['jid']||_0x1ef2c9['groupJid'];if(!_0x36597c)return;const _0x4c512f=Array['isArray'](_0x1ef2c9['participants'])?_0x1ef2c9['participants']:Array['isArray'](_0x1ef2c9['participants_removed'])?_0x1ef2c9['participants_removed']:[];if(!_0x4c512f||_0x4c512f['length']===0x0)return;let _0x2e70b1=null;try{_0x2e70b1=await getLeaveFromDb(_0x36597c);}catch(_0x120fee){_0x2e70b1=null;}let _0xd2c05e=null;try{if('Pxtsw'!=='QeUAj'){const _0x161b21=await fetchGroupMetadata(_0x36597c);_0xd2c05e=_0x161b21?.[_0xdef697(0xa4)]||null;}else return _0x680979('[leaveNotify]\x20no\x20send\x20surface\x20available\x20for\x20'+_0x27de08),null;}catch(_0xafc07a){warn(name+':\x20could\x20not\x20fetch\x20metadata\x20for\x20'+_0x36597c+':\x20'+(_0xafc07a?.['message']||_0xafc07a));}for(const _0x346aac of _0x4c512f){try{await sendLeaveDmToMember(_0x36597c,_0x346aac,_0xd2c05e,_0x2e70b1?.['message']||null),await new Promise(_0x5cec8b=>setTimeout(_0x5cec8b,0xfa));}catch(_0x34a419){if(_0xdef697(0x92)==='TNFhC')return _0x4798cb['EmKuJ'](_0x43400b,_0x25da66+':\x20failed\x20sending\x20leave\x20DM\x20to\x20'+_0x589ae5+':\x20'+(_0x251b82?.['message']||_0x434498)),![];else warn(name+_0xdef697(0x84)+_0x346aac+':\x20'+(_0x34a419?.['message']||_0x34a419));}}}catch(_0x382d8e){error(_0x382d8e,name+'\x20handler\x20error');}}let attachWatcherInterval=null,sockMonitorInterval=null,lastSockIdentity=null,connectionUpdateHandler=null;function attachLeaveListener(){const _0x1d0b24=_0x2b87,_0x361d07={'JhctE':_0x1d0b24(0x80),'auOuo':function(_0x5ae3b8,_0x347861){return _0x5ae3b8(_0x347861);}};try{if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return![];try{if(listener&&typeof botRef['sock']['ev']['off']==='function')botRef[_0x1d0b24(0xb0)]['ev']['off'](_0x1d0b24(0x80),listener);if(listener&&typeof botRef[_0x1d0b24(0xb0)]['ev']['removeListener']==='function')botRef['sock']['ev'][_0x1d0b24(0xb9)]('group-participants.update',listener);}catch(_0x1209cb){}listener=gpLeaveHandler;if(typeof botRef['sock']['ev']['on']==='function')return botRef['sock']['ev']['on'](_0x1d0b24(0x80),listener),attached=!![],lastSockIdentity=botRef[_0x1d0b24(0xb0)],info('[leaveNotify]\x20attached\x20to\x20sock.ev.group-participants.update'),!![];else{if(typeof botRef['sock']['on']==='function')try{const _0x32b765='0|1|2|3|4'['split']('|');let _0x1cf071=0x0;while(!![]){switch(_0x32b765[_0x1cf071++]){case'0':botRef['sock']['on'](_0x361d07['JhctE'],listener);continue;case'1':attached=!![];continue;case'2':lastSockIdentity=botRef['sock'];continue;case'3':info('[leaveNotify]\x20attached\x20to\x20sock.on.group-participants.update');continue;case'4':return!![];}break;}}catch(_0x587785){}return warn('[leaveNotify]\x20botRef.sock.ev\x20does\x20not\x20support\x20.on\x20and\x20no\x20sock.on\x20fallback'),![];}}catch(_0x30c9f2){return _0x361d07[_0x1d0b24(0x97)](warn,_0x1d0b24(0xa8)+(_0x30c9f2?.['message']||_0x30c9f2)),attached=![],listener=null,![];}}function detachLeaveListener(){const _0x32b28c=_0x2b87,_0x2158a5={'FxqYh':function(_0x467cb7,_0x25bec7){return _0x467cb7(_0x25bec7);}};try{if('gXiGc'!==_0x32b28c(0x7e)){if(!listener)return;if(botRef&&botRef['sock']&&botRef[_0x32b28c(0xb0)]['ev'])try{botRef['sock']['ev']['off']?.(_0x32b28c(0x80),listener);}catch(_0x243b60){if(_0x32b28c(0x88)==='xMuDX')_0x44d24e['sock']['ev']['removeListener']?.('connection.update',_0xeea9cf);else try{botRef['sock']['ev']['removeListener']?.('group-participants.update',listener);}catch(_0x4fdd10){}}try{botRef[_0x32b28c(0xb0)]?.['off']?.(_0x32b28c(0x80),listener);}catch(_0x491fcd){}try{botRef['sock']?.['removeListener']?.(_0x32b28c(0x80),listener);}catch(_0x5a171a){}}else return _0x2158a5['FxqYh'](_0x49f542,_0x3446b0+':\x20could\x20not\x20DM\x20'+_0x43da74+_0x32b28c(0x99)+_0x7cd8e5+':\x20'+(_0x4e7ed0?.['message']||_0x2ee373)),![];}catch(_0x14d200){_0x2158a5['FxqYh'](warn,_0x32b28c(0xc0)+(_0x14d200?.['message']||_0x14d200));}finally{attached=![],listener=null,lastSockIdentity=null,info('[leaveNotify]\x20detached\x20listener\x20if\x20present');}}function startAttachWatcher(){const _0x23d5aa={'NwEwP':function(_0xd89d70,_0x4f71ec,_0x261a54){return _0xd89d70(_0x4f71ec,_0x261a54);}};stopAttachWatcher(),attachWatcherInterval=_0x23d5aa['NwEwP'](setInterval,()=>{const _0x5167d2=_0x2b87;try{if(!botRef)return;if(!attached&&botRef&&botRef['sock']&&botRef[_0x5167d2(0xb0)]['ev'])attachLeaveListener();}catch(_0xf4c2df){warn('[leaveNotify]\x20attach\x20watcher\x20error:\x20'+(_0xf4c2df?.['message']||_0xf4c2df));}},CFG['ATTACH_WATCHER_MS']||DEFAULTS['ATTACH_WATCHER_MS']);}function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){const _0x58aa23=_0x2b87,_0x3e70b0={'kRcYy':function(_0x2ea7ca,_0x34134){return _0x2ea7ca&&_0x34134;},'wQWoK':function(_0x5740d8){return _0x5740d8();},'rsJQe':function(_0x4a2756,_0x185711){return _0x4a2756(_0x185711);},'YgPEY':function(_0x15ce4c){return _0x15ce4c();}};_0x3e70b0[_0x58aa23(0xa5)](stopSockMonitor),sockMonitorInterval=setInterval(()=>{const _0x29e586=_0x58aa23;try{if(!botRef)return;const _0x260c03=botRef['sock']||null;if(_0x3e70b0[_0x29e586(0xa2)](_0x260c03,lastSockIdentity)&&_0x260c03!==lastSockIdentity){info('[leaveNotify]\x20detected\x20botRef.sock\x20change\x20-\x20re-attaching\x20listener');try{detachLeaveListener();}catch(_0x4cc75a){}attachLeaveListener();}else!lastSockIdentity&&_0x260c03&&_0x3e70b0['wQWoK'](attachLeaveListener);}catch(_0x5f070c){_0x3e70b0['rsJQe'](warn,'[leaveNotify]\x20sock\x20monitor\x20error:\x20'+(_0x5f070c?.[_0x29e586(0xb7)]||_0x5f070c));}},CFG['SOCK_MONITOR_MS']||DEFAULTS['SOCK_MONITOR_MS']);}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function startConnectionUpdateHook(){const _0x90e0f4={'kkgKf':'[leaveNotify]\x20connection.update\x20observed\x20-\x20ensuring\x20listener\x20attached'};if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=_0x2c2b6d=>{const _0x719c14=_0x2b87;try{setTimeout(()=>{try{info(_0x90e0f4['kkgKf']),attachLeaveListener();}catch(_0x39a50f){}},0x1f4);}catch(_0x143dea){warn(_0x719c14(0xb3)+(_0x143dea?.['message']||_0x143dea));}};try{botRef['sock']['ev']['on']?.('connection.update',connectionUpdateHandler);}catch(_0x6962a8){warn('[leaveNotify]\x20failed\x20to\x20hook\x20connection.update:\x20'+(_0x6962a8?.['message']||_0x6962a8));}}function stopConnectionUpdateHook(){const _0x35a52b=_0x2b87,_0x38dcc4={'QLctq':'connection.update'};try{if(connectionUpdateHandler&&botRef&&botRef[_0x35a52b(0xb0)]&&botRef['sock']['ev']){if(_0x35a52b(0x83)!=='CMJuy')try{botRef['sock']['ev']['off']?.(_0x38dcc4['QLctq'],connectionUpdateHandler);}catch(_0xd3c8cd){try{botRef[_0x35a52b(0xb0)]['ev'][_0x35a52b(0xb9)]?.(_0x38dcc4['QLctq'],connectionUpdateHandler);}catch(_0x30e03e){}}else _0x5bcfe1['sock']['ev']['removeListener']?.('group-participants.update',_0x52b4f7);}}catch(_0x296799){}connectionUpdateHandler=null;}export async function initialize(_0x3da57c){const _0x2f7df3=_0x2b87,_0x536e47={'lMsPu':function(_0x563f06,_0x356a10){return _0x563f06===_0x356a10;},'UTSwD':function(_0x42a74d,_0x3a005c){return _0x42a74d(_0x3a005c);},'aUiVG':function(_0x4960a0){return _0x4960a0();},'niNsQ':_0x2f7df3(0x9d),'awglm':function(_0x38dd3c,_0x33c279){return _0x38dd3c(_0x33c279);},'xTiWU':function(_0x7d3fea){return _0x7d3fea();}};if(!_0x3da57c)throw new Error(_0x2f7df3(0x9f));botRef=_0x3da57c,sock=_0x3da57c?.['sock']||_0x3da57c?.['ws']||_0x3da57c,sendApi=_0x536e47['aUiVG'](setupSendApi);try{if(_0x536e47[_0x2f7df3(0x81)]!=='gRirO'){const _0x5b30b3=getConfig()||{},_0x216406=_0x5b30b3&&_0x5b30b3['LEAVE']?_0x5b30b3['LEAVE']:{};CFG['DEFAULT_ENABLED']=typeof _0x216406['DEFAULT_ENABLED']===_0x2f7df3(0xc2)?_0x216406['DEFAULT_ENABLED']:DEFAULTS['DEFAULT_ENABLED'],CFG['ATTACH_WATCHER_MS']=Number[_0x2f7df3(0xaf)](_0x216406[_0x2f7df3(0x8d)])?_0x216406[_0x2f7df3(0x8d)]:DEFAULTS['ATTACH_WATCHER_MS'],CFG['SOCK_MONITOR_MS']=Number['isInteger'](_0x216406['SOCK_MONITOR_MS'])?_0x216406[_0x2f7df3(0x8b)]:DEFAULTS[_0x2f7df3(0x8b)];}else _0x2e6191['sock']?.['removeListener']?.('group-participants.update',_0x551794);}catch(_0xb41037){warn('[leaveNotify]\x20config\x20load\x20failed,\x20using\x20defaults'),CFG={...DEFAULTS};}try{hotReloadConfig&&_0x536e47['awglm'](hotReloadConfig,_0x4f102b=>{const _0x23daaa=_0x2f7df3;try{const _0x31bb50=getConfig()||{},_0x4f320b=_0x31bb50&&_0x31bb50['LEAVE']?_0x31bb50['LEAVE']:{};CFG['DEFAULT_ENABLED']=_0x536e47['lMsPu'](typeof _0x4f320b['DEFAULT_ENABLED'],'boolean')?_0x4f320b['DEFAULT_ENABLED']:DEFAULTS[_0x23daaa(0xbc)],CFG['ATTACH_WATCHER_MS']=Number['isInteger'](_0x4f320b['ATTACH_WATCHER_MS'])?_0x4f320b[_0x23daaa(0x8d)]:DEFAULTS['ATTACH_WATCHER_MS'],CFG['SOCK_MONITOR_MS']=Number['isInteger'](_0x4f320b['SOCK_MONITOR_MS'])?_0x4f320b['SOCK_MONITOR_MS']:DEFAULTS['SOCK_MONITOR_MS'],_0x536e47['UTSwD'](info,'[leaveNotify]\x20hotReloadConfig\x20applied.\x20Changed\x20keys:\x20'+(_0x4f102b||[])['join'](',\x20'));}catch(_0x4e7806){warn(_0x23daaa(0x7b)+(_0x4e7806?.['message']||_0x4e7806));}});}catch(_0x2d3898){warn(_0x2f7df3(0x95)+(_0x2d3898?.['message']||_0x2d3898));}try{await ensureSchema();try{attachLeaveListener(),startConnectionUpdateHook(),_0x536e47['xTiWU'](startAttachWatcher),startSockMonitor(),info('[leaveNotify]\x20initialized\x20with\x20session\x20resilience');}catch(_0xead800){error('[leaveNotify]\x20failed\x20to\x20attach\x20listener\x20(will\x20keep\x20watching):\x20'+(_0xead800?.[_0x2f7df3(0xb7)]||_0xead800));}}catch(_0x5332a4){error(_0x5332a4,'[leaveNotify]\x20initialize\x20fatal:\x20'+(_0x5332a4?.[_0x2f7df3(0xb7)]||_0x5332a4));throw _0x5332a4;}}export async function onMessage(_0x4a99ad){const _0x1aa94d=_0x2b87,_0x3b4a25={'uTHUn':function(_0x25a90e,_0x1e6efb){return _0x25a90e(_0x1e6efb);},'ORiyp':function(_0x4c1bbd,_0x2ef3aa,_0x46d02a){return _0x4c1bbd(_0x2ef3aa,_0x46d02a);}};try{if(!_0x4a99ad||!_0x4a99ad['key']||!_0x4a99ad[_0x1aa94d(0xb7)])return;const _0x27257d=String(_0x4a99ad['key'][_0x1aa94d(0xa0)]||'')+'::'+String(_0x4a99ad['key']['id']||_0x4a99ad[_0x1aa94d(0xba)]['participant']||'');if(isProcessed(_0x27257d))return;_0x3b4a25['uTHUn'](markProcessed,_0x27257d);if(!_0x4a99ad['isCommand'])return;const _0x1cf828=typeof _0x4a99ad['text']==='string'&&_0x4a99ad[_0x1aa94d(0xbf)]['trim']()['length']?_0x4a99ad['text']['trim']():function(){const _0x20329e=_0x1aa94d,_0x1d8594=_0x4a99ad['message']||{};if(_0x1d8594['conversation'])return _0x1d8594['conversation'];if(_0x1d8594[_0x20329e(0xaa)]?.[_0x20329e(0xbf)])return _0x1d8594[_0x20329e(0xaa)]['text'];return'';}()['trim']();if(!_0x1cf828)return;const _0x1403c8=(_0x1cf828['split'](/\s+/)[0x0]||'')['toLowerCase']();if(!commands['includes'](_0x1403c8))return;const _0x5c62e4=_0x4a99ad['key']['remoteJid'],_0x5f3647=typeof _0x5c62e4===_0x1aa94d(0x9c)&&_0x5c62e4[_0x1aa94d(0xa9)]('@g.us');if(!_0x5f3647)return;let _0x5d208f=![];try{_0x5d208f=await _0x3b4a25['ORiyp'](isadmin,botRef,_0x4a99ad);}catch(_0x471b8c){warn(_0x1aa94d(0x78)),_0x5d208f=![];}if(!_0x5d208f)return;const _0x386d33=_0x4a99ad['key']?.['participant']||_0x4a99ad['key']?.[_0x1aa94d(0xb8)]||_0x4a99ad['key']?.['remoteJid']||'',_0x2a31b8=String(_0x386d33||'')['split']('@')[0x0],_0xb77ee9=_0x5c62e4;info('[leaveNotify]\x20command\x20\x27'+_0x1403c8+'\x27\x20detected\x20from\x20'+_0x386d33+_0x1aa94d(0xb1)+_0x5c62e4);const _0xa7c217=(_0x1cf828||'')['split'](/\r?\n/)['map'](_0x4dcbfe=>_0x4dcbfe['trim']());let _0x6e054e=null;for(const _0x10fc58 of _0xa7c217[_0x1aa94d(0xb5)](0x1)){const _0x193464=_0x10fc58['match'](/^gp[:\s]+(.+)$/i);if(_0x193464){_0x6e054e=_0x193464[0x1][_0x1aa94d(0x9b)]();break;}}const _0x2adaef=(_0xa7c217[0x0]||'')[_0x1aa94d(0x9b)]()['split'](/\s+/);if(!_0x6e054e&&_0x2adaef[_0x1aa94d(0xa3)]>=0x2){if(_0x2adaef[0x1]['toLowerCase']()==='gp'&&_0x2adaef['length']>=0x3)_0x6e054e=_0x2adaef['slice'](0x2)['join']('\x20')[_0x1aa94d(0x9b)]();else{if(_0x2adaef[0x1]['includes']('@'))_0x6e054e=_0x2adaef[0x1]['trim']();}}const _0x5aff95=await getDefault(_0x2a31b8)['catch'](()=>null);if(!_0x5aff95){await sendApiOrFallback(_0xb77ee9,'No\x20default\x20connection/group\x20is\x20set\x20for\x20you.\x20Commands\x20must\x20apply\x20to\x20your\x20DEFAULT\x20group.\x20Set\x20with:\x20/setdefault\x20<connectionName>');return;}const _0x58b390=await getConnection(_0x5aff95)[_0x1aa94d(0xac)](()=>null);if(!_0x58b390){await sendApiOrFallback(_0xb77ee9,'Could\x20not\x20resolve\x20your\x20default\x20connection\x20\x27'+_0x5aff95+'\x27.\x20Please\x20check\x20/setdefault\x20value.');return;}if(_0x1403c8==='lvc'){const _0x2148b8=_0xa7c217['slice'](0x1)['filter'](_0x23a1d0=>!_0x23a1d0['match'](/^gp[:\s]+(.+)$/i)),_0x208cc6=_0x2148b8[_0x1aa94d(0x76)]('\x0a')['trim']();if(!_0x208cc6){await sendApiOrFallback(_0xb77ee9,'Usage\x20(group-only,\x20admin-only):\x0alvc\x0a<your\x20multi-line\x20leave\x20DM\x20message>\x0aYou\x20may\x20use\x20{group}\x20to\x20inject\x20group\x20name\x20and\x20{user}\x20for\x20the\x20username.\x20Optionally\x20include\x20a\x20line\x20\x22gp\x20<groupKey>\x22\x20but\x20it\x20will\x20be\x20ignored\x20—\x20leave\x20DM\x20saved\x20to\x20your\x20DEFAULT\x20connection.');return;}_0x6e054e&&await sendApiOrFallback(_0xb77ee9,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20command\x20is\x20ignored.\x20Leave\x20DM\x20will\x20be\x20saved\x20to\x20your\x20default\x20connection:\x20'+_0x58b390);const _0xa3ccab=await saveLeaveToDb(_0x58b390,_0x208cc6);_0xa3ccab?await sendApiOrFallback(_0xb77ee9,'Saved\x20leave\x20DM\x20to\x20your\x20default\x20connection:\x20'+_0x58b390):await sendApiOrFallback(_0xb77ee9,'Failed\x20to\x20save\x20leave\x20DM\x20for:\x20'+_0x58b390);return;}if(_0x1403c8==='dellvc'){_0x6e054e&&await sendApiOrFallback(_0xb77ee9,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20command\x20is\x20ignored.\x20Deleting\x20leave\x20DM\x20for\x20your\x20default\x20connection:\x20'+_0x58b390);const _0x3f1b0c=await deleteLeaveFromDb(_0x58b390);_0x3f1b0c?await sendApiOrFallback(_0xb77ee9,_0x1aa94d(0xa7)+_0x58b390):await sendApiOrFallback(_0xb77ee9,'No\x20leave\x20DM\x20found\x20for\x20'+_0x58b390);return;}return;}catch(_0x49ee79){error(_0x49ee79,'[leaveNotify]\x20onMessage\x20error:\x20'+(_0x49ee79?.['message']||_0x49ee79));}}export async function cleanup(){const _0x1b1334={'OwEGT':function(_0x5b6496){return _0x5b6496();},'Pnfcs':function(_0xe0c432,_0x13c2a6){return _0xe0c432(_0x13c2a6);}};try{stopAttachWatcher(),stopSockMonitor(),_0x1b1334['OwEGT'](stopConnectionUpdateHook),detachLeaveListener();for(const _0x1cb23e of processedMessageKeys['values']())try{_0x1b1334['Pnfcs'](clearTimeout,_0x1cb23e);}catch(_0xbe8d70){}processedMessageKeys['clear']();}catch(_0x108909){warn('[leaveNotify]\x20cleanup\x20error:\x20'+(_0x108909?.['message']||_0x108909));}finally{attached=![],listener=null,botRef=null,sock=null,sendApi=null,_0x1b1334['Pnfcs'](info,'[leaveNotify]\x20cleaned\x20up');}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x19aa49(_0x2aabb8){const _0xa163ed={'ExgcX':function(_0x251ae9,_0x1d8e87){return _0x251ae9!==_0x1d8e87;},'YQaOE':function(_0x16b0b7,_0x3e6232){return _0x16b0b7%_0x3e6232;},'Upiar':function(_0x53261c,_0x1e3418){return _0x53261c===_0x1e3418;},'gbXuX':'hBiMr'};function _0x192c54(_0x1ec7d2){const _0x53809f=_0x2b87;if(typeof _0x1ec7d2===_0x53809f(0x9c))return'RiVUO'==='NvyVR'?(_0x508d61('[leaveNotify]\x20saveLeaveToDb\x20failed:\x20'+(_0x11ef72?.['message']||_0x35e9bc)),![]):function(_0x1d68c9){}[_0x53809f(0x94)]('while\x20(true)\x20{}')['apply']('counter');else _0xa163ed['ExgcX']((''+_0x1ec7d2/_0x1ec7d2)['length'],0x1)||_0xa163ed['YQaOE'](_0x1ec7d2,0x14)===0x0?function(){return!![];}['constructor']('debu'+'gger')['call'](_0x53809f(0x7c)):function(){const _0x1f9d8b=_0x53809f,_0x3b8cc1={'JbrZr':function(_0x5340bf,_0x2c8998){return _0x5340bf(_0x2c8998);}};if('WbFgn'==='CpSTh'){const _0x1c3cfc=_0x34999c()||{},_0x50d6a0=_0x1c3cfc&&_0x1c3cfc['LEAVE']?_0x1c3cfc['LEAVE']:{};_0x3c0479['DEFAULT_ENABLED']=typeof _0x50d6a0['DEFAULT_ENABLED']===_0x1f9d8b(0xc2)?_0x50d6a0['DEFAULT_ENABLED']:_0xc5dc00['DEFAULT_ENABLED'],_0x193d3c['ATTACH_WATCHER_MS']=_0x451ba2[_0x1f9d8b(0xaf)](_0x50d6a0['ATTACH_WATCHER_MS'])?_0x50d6a0['ATTACH_WATCHER_MS']:_0x5ea9b3[_0x1f9d8b(0x8d)],_0x4eb663['SOCK_MONITOR_MS']=_0x752634[_0x1f9d8b(0xaf)](_0x50d6a0['SOCK_MONITOR_MS'])?_0x50d6a0['SOCK_MONITOR_MS']:_0x44351b['SOCK_MONITOR_MS'],_0x3b8cc1['JbrZr'](_0xc41e9a,'[leaveNotify]\x20hotReloadConfig\x20applied.\x20Changed\x20keys:\x20'+(_0x5cb8c3||[])['join'](',\x20'));}else return![];}[_0x53809f(0x94)]('debu'+'gger')['apply']('stateObject');_0x192c54(++_0x1ec7d2);}try{if(_0xa163ed['Upiar'](_0xa163ed['gbXuX'],'qHlCv')){if(_0x14c501){const _0x4ca8e4=_0x4be115['apply'](_0x1bb2a7,arguments);return _0x47ecc7=null,_0x4ca8e4;}}else{if(_0x2aabb8)return _0x192c54;else _0x192c54(0x0);}}catch(_0x26c772){}}