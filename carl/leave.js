const _0x505a1a=_0x3499;(function(_0x172d96,_0x235061){const _0x35d615=_0x3499,_0x3cb137=_0x172d96();while(!![]){try{const _0x26f82e=-parseInt(_0x35d615(0x159))/0x1+-parseInt(_0x35d615(0x14d))/0x2*(-parseInt(_0x35d615(0x184))/0x3)+parseInt(_0x35d615(0x17e))/0x4*(parseInt(_0x35d615(0x185))/0x5)+-parseInt(_0x35d615(0x177))/0x6+parseInt(_0x35d615(0x188))/0x7*(parseInt(_0x35d615(0x169))/0x8)+-parseInt(_0x35d615(0x165))/0x9+parseInt(_0x35d615(0x168))/0xa;if(_0x26f82e===_0x235061)break;else _0x3cb137['push'](_0x3cb137['shift']());}catch(_0x3ac719){_0x3cb137['push'](_0x3cb137['shift']());}}}(_0x25eb,0x1b3df));const _0x642123=(function(){let _0x3abd67=!![];return function(_0x356461,_0x57df50){const _0x6937b5=_0x3abd67?function(){if(_0x57df50){const _0x171323=_0x57df50['apply'](_0x356461,arguments);return _0x57df50=null,_0x171323;}}:function(){};return _0x3abd67=![],_0x6937b5;};}());(function(){const _0x26e24c={'gwatr':'input'};_0x642123(this,function(){const _0x23d03f=_0x3499,_0x594225=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x108528=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x1bb5e9=_0x466983('init');if(!_0x594225['test'](_0x1bb5e9+'chain')||!_0x108528['test'](_0x1bb5e9+_0x26e24c['gwatr']))_0x1bb5e9('0');else{if('ZUQKI'==='kITHC')return _0x27addd('[leaveNotify]\x20saveLeaveToDb\x20failed:\x20'+(_0x2c0fcd?.[_0x23d03f(0x155)]||_0x1484c1)),![];else _0x466983();}})();}());import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isadmin}from'../utils/isadmin.js';import{getDefault,getConnection}from'../utils/connection.js';export const name='leaveNotify';export const version='2.2.0';export const priority=0x32;export const configKeys=['LEAVE'];export const commands=['lvc',_0x505a1a(0x18b)];let botRef=null,sock=null,listener=null,attached=![],sendApi=null;const DEFAULTS={'DEFAULT_ENABLED':![],'ATTACH_WATCHER_MS':0xbb8,'SOCK_MONITOR_MS':0x3e8};function _0x3499(_0x392386,_0x134e2b){const _0x2da9ff=_0x25eb();return _0x3499=function(_0x466983,_0x642123){_0x466983=_0x466983-0x14b;let _0x3366cc=_0x2da9ff[_0x466983];if(_0x3499['yqndrU']===undefined){var _0x54d478=function(_0x54992b){const _0xd94fa3='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xb46c84='',_0xae3257='';for(let _0x99c30c=0x0,_0x160375,_0x5c4c8e,_0x1bfd6f=0x0;_0x5c4c8e=_0x54992b['charAt'](_0x1bfd6f++);~_0x5c4c8e&&(_0x160375=_0x99c30c%0x4?_0x160375*0x40+_0x5c4c8e:_0x5c4c8e,_0x99c30c++%0x4)?_0xb46c84+=String['fromCharCode'](0xff&_0x160375>>(-0x2*_0x99c30c&0x6)):0x0){_0x5c4c8e=_0xd94fa3['indexOf'](_0x5c4c8e);}for(let _0x54b0db=0x0,_0x4d9e6e=_0xb46c84['length'];_0x54b0db<_0x4d9e6e;_0x54b0db++){_0xae3257+='%'+('00'+_0xb46c84['charCodeAt'](_0x54b0db)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xae3257);};_0x3499['FsUxhf']=_0x54d478,_0x392386=arguments,_0x3499['yqndrU']=!![];}const _0x25ebd2=_0x2da9ff[0x0],_0x349958=_0x466983+_0x25ebd2,_0x1fdd31=_0x392386[_0x349958];return!_0x1fdd31?(_0x3366cc=_0x3499['FsUxhf'](_0x3366cc),_0x392386[_0x349958]=_0x3366cc):_0x3366cc=_0x1fdd31,_0x3366cc;},_0x3499(_0x392386,_0x134e2b);}let CFG={...DEFAULTS};const DEDUPE_TTL_MS=0x1e*0x3e8,processedMessageKeys=new Map();function markProcessed(_0xb8bab){if(!_0xb8bab)return;if(processedMessageKeys['has'](_0xb8bab))try{clearTimeout(processedMessageKeys['get'](_0xb8bab));}catch(_0x241f82){}const _0x19431a=setTimeout(()=>processedMessageKeys['delete'](_0xb8bab),DEDUPE_TTL_MS);processedMessageKeys['set'](_0xb8bab,_0x19431a);}function isProcessed(_0x472915){return _0x472915&&processedMessageKeys['has'](_0x472915);}async function ensureSchema(){try{await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20leaves\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20group_jid\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20enabled\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20INTEGER\x20DEFAULT\x200\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');try{await db['exec']('ALTER\x20TABLE\x20leaves\x20ADD\x20COLUMN\x20enabled\x20INTEGER\x20DEFAULT\x200;');}catch(_0x2cb68e){}info('[leaveNotify]\x20DB\x20schema\x20ensured');}catch(_0x1960be){error(_0x1960be,'[leaveNotify]\x20ensureSchema\x20failed');throw _0x1960be;}}async function saveLeaveToDb(_0x4dc048,_0x44e0f6,_0x568a89=0x1){const _0x10e008=_0x505a1a;try{const _0x1642af=Math['floor'](Date[_0x10e008(0x191)]()/0x3e8);return await db['run']('INSERT\x20INTO\x20leaves\x20(group_jid,\x20message,\x20enabled,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(group_jid)\x20DO\x20UPDATE\x20SET\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20message\x20=\x20excluded.message,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20enabled\x20=\x20excluded.enabled,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20=\x20excluded.updated_at;',[_0x4dc048,String(_0x44e0f6||''),Number(_0x568a89?0x1:0x0),_0x1642af]),info(_0x10e008(0x14f)+_0x4dc048+'\x20(enabled='+(_0x568a89?0x1:0x0)+')'),!![];}catch(_0x53cee3){return warn(_0x10e008(0x14c)+(_0x53cee3?.[_0x10e008(0x155)]||_0x53cee3)),![];}}async function deleteLeaveFromDb(_0xbaa06d){const _0x1a4fea=_0x505a1a;try{const _0x251a9a=await db['run']('DELETE\x20FROM\x20leaves\x20WHERE\x20group_jid\x20=\x20?',[_0xbaa06d]);return info('[leaveNotify]\x20deleted\x20leave\x20DM\x20for\x20'+_0xbaa06d),_0x251a9a?.['changes']||0x0;}catch(_0xa09a5d){return warn(_0x1a4fea(0x17a)+(_0xa09a5d?.['message']||_0xa09a5d)),0x0;}}async function getLeaveFromDb(_0x60e713){const _0x10fa87=_0x505a1a;try{const _0x1f91d4=await db['get']('SELECT\x20message,\x20enabled,\x20updated_at\x20FROM\x20leaves\x20WHERE\x20group_jid\x20=\x20?',[_0x60e713]);if(!_0x1f91d4)return null;return{'message':_0x1f91d4[_0x10fa87(0x155)],'enabled':Number(_0x1f91d4['enabled']||0x0)===0x1,'updated_at':_0x1f91d4['updated_at']||0x0};}catch(_0x50215a){return warn('[leaveNotify]\x20getLeaveFromDb\x20failed:\x20'+(_0x50215a?.['message']||_0x50215a)),null;}}async function setLeaveEnabled(_0x3b1f32,_0xb7a592){const _0x45b77b=_0x505a1a;try{const _0x1f8ad0=Math[_0x45b77b(0x192)](Date['now']()/0x3e8),_0xdf40bc=await db['run']('UPDATE\x20leaves\x20SET\x20enabled\x20=\x20?,\x20updated_at\x20=\x20?\x20WHERE\x20group_jid\x20=\x20?',[Number(_0xb7a592?0x1:0x0),_0x1f8ad0,_0x3b1f32]);if(_0xdf40bc?.['changes'])return info('[leaveNotify]\x20set\x20enabled='+(_0xb7a592?0x1:0x0)+'\x20for\x20'+_0x3b1f32),!![];return![];}catch(_0x15d027){return warn('[leaveNotify]\x20setLeaveEnabled\x20failed:\x20'+(_0x15d027?.['message']||_0x15d027)),![];}}(function(){const _0x56fcc4={'YAaPb':function(_0x3e2510,_0x5eea61){return _0x3e2510(_0x5eea61);}},_0x36e275=function(){const _0x46266a=_0x3499;let _0xa59691;try{_0xa59691=_0x56fcc4['YAaPb'](Function,'return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1c7281){_0x46266a(0x173)!==_0x46266a(0x164)?_0xa59691=window:(_0x193192=![],_0x544c97=null,_0x1485a0=null,_0x17e407=null,_0x34a1bb=null,_0x4f282f('[leaveNotify]\x20cleaned\x20up'));}return _0xa59691;},_0x1a797d=_0x36e275();_0x1a797d['setInterval'](_0x466983,0x61a80);}());function setupSendApi(){const _0x1978dd=_0x505a1a;if(!botRef)return null;if(typeof botRef['sendMessage']==='function')sendApi=(_0x3e6f33,_0x551348)=>botRef['sendMessage'](_0x3e6f33,_0x551348);else botRef[_0x1978dd(0x16f)]&&typeof botRef['sock']['sendMessage']==='function'?sendApi=(_0x941752,_0x2b7123)=>botRef[_0x1978dd(0x16f)]['sendMessage'](_0x941752,_0x2b7123):'keCuD'!=='TuuEL'?sendApi=null:_0x525da8(_0x4e9828['get'](_0x535a6f));}async function sendApiOrFallback(_0x5f0d32,_0x347050){const _0x5ba277=_0x505a1a;try{if(!_0x5f0d32||!_0x347050)return null;const _0x4424eb=typeof _0x347050==='string'?{'text':String(_0x347050)}:_0x347050;if(sendApi)try{return await sendApi(_0x5f0d32,_0x4424eb);}catch(_0x39131f){if('cIADo'==='cIADo')return warn('[leaveNotify]\x20sendApi\x20failed:\x20'+(_0x39131f?.['message']||_0x39131f)),null;else _0x1e43bd[_0x5ba277(0x16f)]['ev']['off']?.('group-participants.update',_0x5533bd);}else return warn('[leaveNotify]\x20no\x20send\x20surface\x20available\x20for\x20'+_0x5f0d32),null;}catch(_0xd37226){return warn('[leaveNotify]\x20sendApiOrFallback\x20failed:\x20'+(_0xd37226?.['message']||_0xd37226)),null;}}async function fetchGroupMetadata(_0x57e09f){const _0x103072=_0x505a1a,_0x4e8697={'ItsXn':'function'};if(!botRef)return null;try{if(botRef['sock']&&typeof botRef['sock'][_0x103072(0x175)]===_0x4e8697[_0x103072(0x18d)])return await botRef['sock']['groupMetadata'](_0x57e09f);if(typeof botRef[_0x103072(0x175)]==='function')return await botRef['groupMetadata'](_0x57e09f);return null;}catch(_0x275c5f){return warn('[leaveNotify]\x20fetchGroupMetadata\x20failed:\x20'+(_0x275c5f?.[_0x103072(0x155)]||_0x275c5f)),null;}}function buildDmForLeaver(_0x5ecb81,_0x4febee,_0x49450e){const _0x4cdec8=_0x4febee||'the\x20group';if(_0x49450e&&String(_0x49450e)['trim']()['length']>0x0)try{return String(_0x49450e)['replace'](/\{group\}/g,_0x4cdec8)['replace'](/\{user\}/g,_0x5ecb81['split']('@')[0x0]);}catch(_0x77ee24){return String(_0x49450e);}return'Hi\x20—\x20we\x20noticed\x20you\x20left\x20*'+_0x4cdec8+'*.\x0a\x0aIf\x20you\x20left\x20intentionally,\x20no\x20worries\x20—\x20all\x20good!\x20If\x20this\x20was\x20a\x20mistake\x20and\x20you\x27d\x20like\x20to\x20rejoin,\x20reply\x20here\x20and\x20we\x20will\x20assist.';}async function sendLeaveDmToMember(_0x7ed824,_0x3c1ee3,_0x4f576a,_0x16ff28){const _0x11974a=_0x505a1a;try{const _0x13f621=botRef&&botRef['sock']&&botRef['sock'][_0x11974a(0x179)]&&botRef['sock']['user']['id']?botRef['sock']['user']['id']:botRef&&botRef['user']&&botRef[_0x11974a(0x179)]['id']?botRef['user']['id']:null;if(!_0x3c1ee3||_0x13f621&&_0x3c1ee3===_0x13f621)return![];const _0x9b07a0=_0x3c1ee3,_0x4791fd=buildDmForLeaver(_0x9b07a0,_0x4f576a,_0x16ff28);try{return await sendApiOrFallback(_0x9b07a0,{'text':_0x4791fd}),info(name+':\x20sent\x20leave\x20DM\x20to\x20'+_0x9b07a0+'\x20(from\x20group\x20'+_0x7ed824+')'),!![];}catch(_0x2ae3a1){return warn(name+':\x20could\x20not\x20DM\x20'+_0x9b07a0+_0x11974a(0x172)+_0x7ed824+':\x20'+(_0x2ae3a1?.[_0x11974a(0x155)]||_0x2ae3a1)),![];}}catch(_0x101e62){return warn(name+_0x11974a(0x15f)+_0x3c1ee3+':\x20'+(_0x101e62?.['message']||_0x101e62)),![];}}async function gpLeaveHandler(_0x4f5e27){const _0x51a3c3=_0x505a1a,_0x446ff5={'plwMo':function(_0x369954){return _0x369954();},'FHAhM':function(_0x75934b,_0x2aa20a){return _0x75934b(_0x2aa20a);}};try{if(!_0x4f5e27)return;const _0x5f06e8=(_0x4f5e27[_0x51a3c3(0x14b)]||_0x4f5e27['type']||'')['toString']()['toLowerCase']();if(_0x5f06e8!=='remove')return;const _0x5228dc=_0x4f5e27['id']||_0x4f5e27['groupId']||_0x4f5e27['jid']||_0x4f5e27['groupJid'];if(!_0x5228dc)return;const _0x3512bf=Array['isArray'](_0x4f5e27['participants'])?_0x4f5e27[_0x51a3c3(0x171)]:Array['isArray'](_0x4f5e27[_0x51a3c3(0x16c)])?_0x4f5e27['participants_removed']:[];if(!_0x3512bf||_0x3512bf['length']===0x0)return;let _0x244f39=null;try{_0x244f39=await _0x446ff5['FHAhM'](getLeaveFromDb,_0x5228dc);}catch(_0x1f6134){_0x244f39=null;}if(!_0x244f39||!_0x244f39['enabled']){info('[leaveNotify]\x20leave\x20DM\x20not\x20enabled\x20for\x20'+_0x5228dc+';\x20skipping\x20DM\x20for\x20removed\x20participants');return;}let _0x3b1240=null;try{const _0x538506=await fetchGroupMetadata(_0x5228dc);_0x3b1240=_0x538506?.['subject']||null;}catch(_0x1ae917){warn(name+':\x20could\x20not\x20fetch\x20metadata\x20for\x20'+_0x5228dc+':\x20'+(_0x1ae917?.['message']||_0x1ae917));}for(const _0x56d057 of _0x3512bf){try{await sendLeaveDmToMember(_0x5228dc,_0x56d057,_0x3b1240,_0x244f39?.['message']||null),await new Promise(_0x5c6112=>setTimeout(_0x5c6112,0xfa));}catch(_0x49305f){if('COlPF'!=='VKxZA')warn(name+':\x20error\x20handling\x20removed\x20participant\x20'+_0x56d057+':\x20'+(_0x49305f?.['message']||_0x49305f));else{_0x5a0cfa(),_0x446ff5['plwMo'](_0xa418e0),_0x5952b4(),_0xc1ec70();for(const _0x2d0070 of _0x6e016[_0x51a3c3(0x153)]())try{_0x8cddb3(_0x2d0070);}catch(_0x24c33b){}_0x166ff3[_0x51a3c3(0x17f)]();}}}}catch(_0x1d0e9a){error(_0x1d0e9a,name+'\x20handler\x20error');}}let attachWatcherInterval=null,sockMonitorInterval=null,lastSockIdentity=null,connectionUpdateHandler=null;function attachLeaveListener(){const _0x3006d3=_0x505a1a;try{if(!botRef||!botRef['sock']||!botRef[_0x3006d3(0x16f)]['ev'])return![];try{if(listener&&typeof botRef[_0x3006d3(0x16f)]['ev']['off']===_0x3006d3(0x161))botRef[_0x3006d3(0x16f)]['ev'][_0x3006d3(0x15e)](_0x3006d3(0x189),listener);if(listener&&typeof botRef['sock']['ev']['removeListener']==='function')botRef['sock']['ev']['removeListener']('group-participants.update',listener);}catch(_0x459cc8){}listener=gpLeaveHandler;if(typeof botRef['sock']['ev']['on']==='function')return botRef[_0x3006d3(0x16f)]['ev']['on']('group-participants.update',listener),attached=!![],lastSockIdentity=botRef['sock'],info('[leaveNotify]\x20attached\x20to\x20sock.ev.group-participants.update'),!![];else{if(_0x3006d3(0x183)==='svECt')_0x50cc09();else{if(typeof botRef['sock']['on']==='function')try{return botRef['sock']['on']('group-participants.update',listener),attached=!![],lastSockIdentity=botRef['sock'],info(_0x3006d3(0x14e)),!![];}catch(_0x59a6e){}return warn('[leaveNotify]\x20botRef.sock.ev\x20does\x20not\x20support\x20.on\x20and\x20no\x20sock.on\x20fallback'),![];}}}catch(_0x2f88e6){return warn(_0x3006d3(0x18c)+(_0x2f88e6?.[_0x3006d3(0x155)]||_0x2f88e6)),attached=![],listener=null,![];}}function detachLeaveListener(){const _0x258bd3=_0x505a1a;try{if(!listener)return;if(botRef&&botRef['sock']&&botRef['sock']['ev'])try{if('MlotD'==='MlotD')botRef['sock']['ev']['off']?.('group-participants.update',listener);else try{_0x3810cd(_0x258bd3(0x16d)),_0x2083ad();}catch(_0x30e3c4){}}catch(_0xb8ce5a){try{botRef['sock']['ev'][_0x258bd3(0x178)]?.('group-participants.update',listener);}catch(_0x30a92c){}}try{botRef['sock']?.['off']?.('group-participants.update',listener);}catch(_0x59ae9e){}try{botRef['sock']?.['removeListener']?.(_0x258bd3(0x189),listener);}catch(_0x2eb4f4){}}catch(_0x2271fe){'aVLKD'!==_0x258bd3(0x170)?warn('[leaveNotify]\x20detachLeaveListener\x20error:\x20'+(_0x2271fe?.['message']||_0x2271fe)):_0x63a269=(_0x5b85fd,_0x8ad4f8)=>_0x266149['sock']['sendMessage'](_0x5b85fd,_0x8ad4f8);}finally{attached=![],listener=null,lastSockIdentity=null,info(_0x258bd3(0x193));}}function startAttachWatcher(){const _0xc4f52e=_0x505a1a,_0x5d3f5a={'RRZiS':'[leaveNotify]\x20attach\x20watcher\x20error:\x20'};stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{const _0x14158c=_0x3499;try{if(!botRef)return;if(!attached&&botRef&&botRef['sock']&&botRef['sock']['ev'])attachLeaveListener();}catch(_0x4b5649){warn(_0x5d3f5a[_0x14158c(0x157)]+(_0x4b5649?.[_0x14158c(0x155)]||_0x4b5649));}},CFG['ATTACH_WATCHER_MS']||DEFAULTS[_0xc4f52e(0x15a)]);}function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){const _0x58c9e0={'Fwcsp':function(_0x5a472a,_0x2e9e77){return _0x5a472a&&_0x2e9e77;},'HuDTO':function(_0x44573f,_0xab9dd1){return _0x44573f+_0xab9dd1;}};stopSockMonitor(),sockMonitorInterval=setInterval(()=>{const _0x5867b5=_0x3499,_0x2aa113={'GPCYs':function(_0x2281fe,_0x1349e9){return _0x2281fe(_0x1349e9);}};if(_0x5867b5(0x15d)==='xcxHa'){const _0xf0a913=function(){let _0x565993;try{_0x565993=eQhNjT['GPCYs'](_0x4d6a48,'return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4a0309){_0x565993=_0x2d1e7a;}return _0x565993;},_0x2ffdbb=_0xf0a913();_0x2ffdbb['setInterval'](_0x307ae5,0x61a80);}else try{if(!botRef)return;const _0xd56c5d=botRef['sock']||null;if(_0x58c9e0['Fwcsp'](_0xd56c5d,lastSockIdentity)&&_0xd56c5d!==lastSockIdentity){info(_0x5867b5(0x156));try{detachLeaveListener();}catch(_0x3aaf02){}attachLeaveListener();}else!lastSockIdentity&&_0xd56c5d&&attachLeaveListener();}catch(_0x1ecdd5){warn(_0x58c9e0['HuDTO']('[leaveNotify]\x20sock\x20monitor\x20error:\x20',_0x1ecdd5?.['message']||_0x1ecdd5));}},CFG['SOCK_MONITOR_MS']||DEFAULTS['SOCK_MONITOR_MS']);}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function _0x25eb(){const _0x56948a=['EerYq1e','nta4mtfqsvDeA2u','mtaZnJC1BfP4C1nW','C3bSAxq','uK1qs3m','mZG4odqZyu1RthP1','z3jVDxaTCgfYDgLJAxbHBNrZlNvWzgf0zq','y29UC3rYDwn0B3i','zgvSBhzJ','w2XLyxzLtM90Awz5xsbHDhrHy2Hmzwf2zuXPC3rLBMvYigzHAwXLzdOG','sxrZwg4','v1HuBha','t3rxB3e','Dg9mB3DLCKnHC2u','BM93','zMXVB3i','w2XLyxzLtM90Awz5xsbKzxrHy2HLzcbSAxn0zw5LCIbPzIbWCMvZzw50','ywn0Aw9U','w2XLyxzLtM90Awz5xsbZyxzLtgvHDMvuB0rIigzHAwXLzdOG','mtrVsenSwhm','w2XLyxzLtM90Awz5xsbHDhrHy2HLzcb0BYbZB2nRlM9UlMDYB3vWlxbHCNrPy2LWyw50CY51CgrHDgu','w2XLyxzLtM90Awz5xsbZyxzLzcbSzwf2zsbetsbMB3iG','Bwf0y2G','rwjdD3i','y291BNrLCG','DMfSDwvZ','tM8GBgvHDMuGre0GzM91BMqGzM9Yia','BwvZC2fNzq','w2XLyxzLtM90Awz5xsbKzxrLy3rLzcbIB3rszwyUC29JAYbJAgfUz2uGlsbYzs1HDhrHy2HPBMCGBgLZDgvUzxi','uLjAAvm','A2v5','mJe4mJC4D09AvNry','qvruqunix1DbvenirvjFtvm','Dhbnsxa','yxbWBhK','zhDTrNi','B2zM','oIbMywLSzwqGC2vUzgLUzYbSzwf2zsbetsb0BYa','C2XPy2u','zNvUy3rPB24','oIbJB3vSzcbUB3qGzMv0y2GGBwv0ywrHDgeGzM9Yia','zw5KC1DPDgG','sM16wgm','odq4otqZvvfysxzN','Dgv4Da','tevbvKu','otCXndiWwwnOCevA','mJrTz0zgsM8','u09ds19nt05jve9sx01t','zMLSDgvY','CgfYDgLJAxbHBNrZx3jLBw92zwq','w2XLyxzLtM90Awz5xsbJB25Uzwn0Aw9UlNvWzgf0zsbVyNnLCNzLzcaTigvUC3vYAw5NigXPC3rLBMvYigf0DgfJAgvK','y2fSBa','C29JAW','wgjQze4','CgfYDgLJAxbHBNrZ','igfMDgvYigXLyxzLigzYB20G','uMnxDwC','u1n1ENe','z3jVDxbnzxrHzgf0yq','DhjPBq','ody4nJuWzK5UuLHt','CMvTB3zLtgLZDgvUzxi','DxnLCG','w2XLyxzLtM90Awz5xsbKzwXLDgvmzwf2zuzYB21eyIbMywLSzwq6ia','CMvTB3rLsMLK','w2XLyxzLtM90Awz5xsbJB25Uzwn0Aw9UlNvWzgf0zsbOyw5KBgvYigvYCM9YoIa','u2f2zwqGyw5KigvUywjSzwqGBgvHDMuGre0GzM9YihLVDxiGzgvMyxvSDcbJB25Uzwn0Aw9UoIa','mZzOvwLjrui','y2XLyxi','ue9IDNq','Aw5JBhvKzxm','DgDUuLi'];_0x25eb=function(){return _0x56948a;};return _0x25eb();}function startConnectionUpdateHook(){if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=_0x108197=>{const _0x4460f2=_0x3499;if('UJiTD'!=='UJiTD')_0x2448b4(_0x27b34f+_0x4460f2(0x162)+_0x51eda9+':\x20'+(_0x5b8393?.['message']||_0x31b234));else try{setTimeout(()=>{try{info('[leaveNotify]\x20connection.update\x20observed\x20-\x20ensuring\x20listener\x20attached'),attachLeaveListener();}catch(_0x2edcc4){}},0x1f4);}catch(_0x253db4){warn(_0x4460f2(0x17c)+(_0x253db4?.['message']||_0x253db4));}};try{botRef['sock']['ev']['on']?.('connection.update',connectionUpdateHandler);}catch(_0x11068c){warn('[leaveNotify]\x20failed\x20to\x20hook\x20connection.update:\x20'+(_0x11068c?.['message']||_0x11068c));}}function stopConnectionUpdateHook(){const _0x444445=_0x505a1a;try{if(connectionUpdateHandler&&botRef&&botRef['sock']&&botRef[_0x444445(0x16f)]['ev'])try{botRef['sock']['ev'][_0x444445(0x15e)]?.('connection.update',connectionUpdateHandler);}catch(_0x2b843d){try{botRef['sock']['ev'][_0x444445(0x178)]?.('connection.update',connectionUpdateHandler);}catch(_0x1082f7){}}}catch(_0x49ad9f){}connectionUpdateHandler=null;}export async function initialize(_0x187bff){const _0x313d64=_0x505a1a,_0xc6d12c={'tgnRR':function(_0x313aa3){return _0x313aa3();},'spwOu':function(_0x10185b,_0xa3b8c3){return _0x10185b(_0xa3b8c3);},'zIgMO':function(_0x4a1ff2,_0x4d71e6){return _0x4a1ff2+_0x4d71e6;}};if(!_0x187bff)throw new Error('leaveNotify.initialize\x20requires\x20bot\x20instance');botRef=_0x187bff,sock=_0x187bff?.[_0x313d64(0x16f)]||_0x187bff?.['ws']||_0x187bff,setupSendApi();try{const _0x57080a=getConfig()||{},_0x124356=_0x57080a&&_0x57080a[_0x313d64(0x167)]?_0x57080a['LEAVE']:{};CFG['DEFAULT_ENABLED']=typeof _0x124356['DEFAULT_ENABLED']==='boolean'?_0x124356['DEFAULT_ENABLED']:DEFAULTS['DEFAULT_ENABLED'],CFG['ATTACH_WATCHER_MS']=Number['isInteger'](_0x124356['ATTACH_WATCHER_MS'])?_0x124356[_0x313d64(0x15a)]:DEFAULTS['ATTACH_WATCHER_MS'],CFG['SOCK_MONITOR_MS']=Number['isInteger'](_0x124356['SOCK_MONITOR_MS'])?_0x124356['SOCK_MONITOR_MS']:DEFAULTS['SOCK_MONITOR_MS'];}catch(_0x50a11a){warn('[leaveNotify]\x20config\x20load\x20failed,\x20using\x20defaults'),CFG={...DEFAULTS};}try{if('mzehd'==='ttdqp')try{_0x1785e2['sock']['ev']['removeListener']?.('connection.update',_0x3c6937);}catch(_0x47d83b){}else hotReloadConfig&&hotReloadConfig(_0x48cc9a=>{const _0x47e494=_0x313d64;try{if(_0x47e494(0x18f)!=='OtWoq')return _0x18861f['sock']['on']('group-participants.update',_0x4be10f),_0x4f150f=!![],_0xd7283d=_0x30a593['sock'],_0xa5398e('[leaveNotify]\x20attached\x20to\x20sock.on.group-participants.update'),!![];else{const _0x3e8799=getConfig()||{},_0x1533b0=_0x3e8799&&_0x3e8799['LEAVE']?_0x3e8799['LEAVE']:{};CFG['DEFAULT_ENABLED']=typeof _0x1533b0['DEFAULT_ENABLED']==='boolean'?_0x1533b0['DEFAULT_ENABLED']:DEFAULTS['DEFAULT_ENABLED'],CFG['ATTACH_WATCHER_MS']=Number['isInteger'](_0x1533b0['ATTACH_WATCHER_MS'])?_0x1533b0[_0x47e494(0x15a)]:DEFAULTS['ATTACH_WATCHER_MS'],CFG['SOCK_MONITOR_MS']=Number['isInteger'](_0x1533b0['SOCK_MONITOR_MS'])?_0x1533b0[_0x47e494(0x16a)]:DEFAULTS['SOCK_MONITOR_MS'],info('[leaveNotify]\x20hotReloadConfig\x20applied.\x20Changed\x20keys:\x20'+(_0x48cc9a||[])['join'](',\x20'));}}catch(_0xbc9c8f){warn('[leaveNotify]\x20hotReloadConfig\x20handler\x20error:\x20'+(_0xbc9c8f?.[_0x47e494(0x155)]||_0xbc9c8f));}});}catch(_0x3b2612){'niNSw'==='niNSw'?warn('[leaveNotify]\x20hotReloadConfig\x20registration\x20failed:\x20'+(_0x3b2612?.[_0x313d64(0x155)]||_0x3b2612)):_0x837d7e=null;}try{await ensureSchema();try{_0x313d64(0x18e)!=='WXTlp'?_0x5d2bb4('[leaveNotify]\x20failed\x20to\x20attach\x20listener\x20(will\x20keep\x20watching):\x20'+(_0x5b61a4?.['message']||_0x589b03)):(attachLeaveListener(),startConnectionUpdateHook(),_0xc6d12c[_0x313d64(0x182)](startAttachWatcher),startSockMonitor(),_0xc6d12c['spwOu'](info,'[leaveNotify]\x20initialized\x20with\x20session\x20resilience'));}catch(_0x2b6e37){error(_0xc6d12c['zIgMO']('[leaveNotify]\x20failed\x20to\x20attach\x20listener\x20(will\x20keep\x20watching):\x20',_0x2b6e37?.['message']||_0x2b6e37));}}catch(_0x1f309d){error(_0x1f309d,'[leaveNotify]\x20initialize\x20fatal:\x20'+(_0x1f309d?.['message']||_0x1f309d));throw _0x1f309d;}}export async function onMessage(_0x23923f){const _0x3f156f=_0x505a1a,_0x53317b={'lyMOo':function(_0x1afb9f,_0xb5f3c1){return _0x1afb9f+_0xb5f3c1;},'NcXyw':function(_0x55b946,_0x388a41){return _0x55b946(_0x388a41);},'FvnKW':function(_0x29bc49,_0x58738f){return _0x29bc49(_0x58738f);},'SSuzq':function(_0x40475a,_0x102282,_0x5c5d14){return _0x40475a(_0x102282,_0x5c5d14);}};try{if(!_0x23923f||!_0x23923f[_0x3f156f(0x158)]||!_0x23923f['message'])return;const _0x58edb5=String(_0x23923f['key'][_0x3f156f(0x17b)]||'')+'::'+String(_0x23923f['key']['id']||_0x23923f['key']['participant']||'');if(isProcessed(_0x58edb5))return;_0x53317b['NcXyw'](markProcessed,_0x58edb5);if(!_0x23923f['isCommand'])return;const _0x5e290d=typeof _0x23923f['text']==='string'&&_0x23923f[_0x3f156f(0x166)]['trim']()['length']?_0x23923f[_0x3f156f(0x166)][_0x3f156f(0x176)]():function(){const _0x160a44=_0x3f156f,_0xb0333=_0x23923f[_0x160a44(0x155)]||{};if(_0xb0333['conversation'])return _0xb0333['conversation'];if(_0xb0333['extendedTextMessage']?.['text'])return _0xb0333['extendedTextMessage'][_0x160a44(0x166)];return'';}()['trim']();if(!_0x5e290d)return;const _0x24c0de=(_0x5e290d['split'](/\s+/)[0x0]||'')[_0x3f156f(0x190)]();if(!commands['includes'](_0x24c0de))return;const _0x329884=_0x23923f['key']['remoteJid'],_0xda9204=typeof _0x329884==='string'&&_0x329884[_0x3f156f(0x163)]('@g.us');if(!_0xda9204)return;let _0x34973a=![];try{_0x34973a=await isadmin(botRef,_0x23923f);}catch(_0x3a8086){'lwuHF'==='lwuHF'?(warn('[leaveNotify]\x20isadmin\x20check\x20failed'),_0x34973a=![]):_0x275cc3['sock']?.[_0x3f156f(0x15e)]?.('group-participants.update',_0x1b924b);}if(!_0x34973a)return;const _0x1674b2=_0x23923f['key']?.['participant']||_0x23923f[_0x3f156f(0x158)]?.['from']||_0x23923f['key']?.['remoteJid']||'',_0x183734=String(_0x1674b2||'')['split']('@')[0x0],_0x704696=_0x329884;info('[leaveNotify]\x20command\x20\x27'+_0x24c0de+'\x27\x20detected\x20from\x20'+_0x1674b2+'\x20in\x20'+_0x329884);const _0x5110f5=(_0x5e290d||'')['split'](/\r?\n/)['map'](_0x527c00=>_0x527c00['trim']());let _0x449de3=null;for(const _0x46bb87 of _0x5110f5['slice'](0x1)){const _0x3f8f0d=_0x46bb87[_0x3f156f(0x150)](/^gp[:\s]+(.+)$/i);if(_0x3f8f0d){_0x449de3=_0x3f8f0d[0x1][_0x3f156f(0x176)]();break;}}const _0x415205=(_0x5110f5[0x0]||'')[_0x3f156f(0x176)]()[_0x3f156f(0x186)](/\s+/);if(!_0x449de3&&_0x415205['length']>=0x2){if(_0x415205[0x1]['toLowerCase']()==='gp'&&_0x415205['length']>=0x3)_0x449de3=_0x415205['slice'](0x2)['join']('\x20')['trim']();else{if(_0x415205[0x1][_0x3f156f(0x181)]('@'))_0x449de3=_0x415205[0x1]['trim']();}}const _0x1eafdb=await getDefault(_0x183734)['catch'](()=>null);if(!_0x1eafdb){await sendApiOrFallback(_0x704696,'No\x20default\x20connection/group\x20is\x20set\x20for\x20you.\x20Commands\x20must\x20apply\x20to\x20your\x20DEFAULT\x20group.\x20Set\x20with:\x20/setdefault\x20<connectionName>');return;}const _0x2a4491=await getConnection(_0x1eafdb)['catch'](()=>null);if(!_0x2a4491){await sendApiOrFallback(_0x704696,'Could\x20not\x20resolve\x20your\x20default\x20connection\x20\x27'+_0x1eafdb+'\x27.\x20Please\x20check\x20/setdefault\x20value.');return;}if(_0x24c0de==='lvc'){const _0x289aef=_0x415205['length']>=0x2?_0x415205[0x1][_0x3f156f(0x190)]():null;if(_0x289aef==='on'||_0x289aef==='off'){if(_0x3f156f(0x187)==='RMPKs'){_0x449de3&&await sendApiOrFallback(_0x704696,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20command\x20is\x20ignored.\x20Operation\x20will\x20apply\x20to\x20your\x20default\x20connection:\x20'+_0x2a4491);const _0x24ec60=await _0x53317b['FvnKW'](getLeaveFromDb,_0x2a4491);if(!_0x24ec60){await sendApiOrFallback(_0x704696,'No\x20leave\x20DM\x20message\x20is\x20saved\x20for\x20'+_0x2a4491+'.\x20Save\x20one\x20with:\x0a\x0alvc\x0a<your\x20multi-line\x20leave\x20DM\x20message>');return;}const _0x43fc1c=_0x289aef==='on',_0x348910=await setLeaveEnabled(_0x2a4491,_0x43fc1c);_0x348910?await sendApiOrFallback(_0x704696,(_0x43fc1c?'Enabled':'Disabled')+'\x20leave\x20DM\x20for\x20your\x20default\x20connection:\x20'+_0x2a4491):await sendApiOrFallback(_0x704696,'Failed\x20to\x20update\x20leave\x20DM\x20enabled\x20state\x20for:\x20'+_0x2a4491);return;}else return _0x19cd06(_0x53317b['lyMOo']('[leaveNotify]\x20attachLeaveListener\x20failed:\x20',_0x23a85d?.['message']||_0x5b6300)),_0x48ee4d=![],_0x5f53ec=null,![];}const _0x25c317=_0x5110f5[_0x3f156f(0x160)](0x1)[_0x3f156f(0x16b)](_0x2f07f5=>!_0x2f07f5['match'](/^gp[:\s]+(.+)$/i)),_0x16930d=_0x25c317['join']('\x0a')['trim']();if(!_0x16930d){await sendApiOrFallback(_0x704696,'Usage\x20(group-only,\x20admin-only):\x0alvc\x0a<your\x20multi-line\x20leave\x20DM\x20message>\x0aYou\x20may\x20use\x20{group}\x20to\x20inject\x20group\x20name\x20and\x20{user}\x20for\x20the\x20username.\x20You\x20may\x20also\x20use\x20\x22lvc\x20on\x22\x20or\x20\x22lvc\x20off\x22\x20to\x20toggle\x20an\x20existing\x20saved\x20message.');return;}_0x449de3&&await sendApiOrFallback(_0x704696,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20command\x20is\x20ignored.\x20Leave\x20DM\x20will\x20be\x20saved\x20to\x20your\x20default\x20connection:\x20'+_0x2a4491);const _0x3e5bf0=await saveLeaveToDb(_0x2a4491,_0x16930d,0x1);if(_0x3e5bf0){if(_0x3f156f(0x180)!==_0x3f156f(0x180)){const _0x34acf4=_0x247e73?function(){const _0x554d23=_0x3f156f;if(_0x24ff96){const _0x813b7e=_0x1e45fd[_0x554d23(0x15c)](_0x565b30,arguments);return _0x53a1c8=null,_0x813b7e;}}:function(){};return _0x4f58ce=![],_0x34acf4;}else await _0x53317b[_0x3f156f(0x174)](sendApiOrFallback,_0x704696,_0x3f156f(0x17d)+_0x2a4491);}else'BAviF'!=='gkKiv'?await sendApiOrFallback(_0x704696,'Failed\x20to\x20save\x20leave\x20DM\x20for:\x20'+_0x2a4491):_0x3ffef5('[leaveNotify]\x20cleanup\x20error:\x20'+(_0x2d1d69?.[_0x3f156f(0x155)]||_0x29ff80));return;}if(_0x24c0de==='dellvc'){_0x449de3&&await sendApiOrFallback(_0x704696,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20command\x20is\x20ignored.\x20Deleting\x20leave\x20DM\x20for\x20your\x20default\x20connection:\x20'+_0x2a4491);const _0x5d6ccf=await deleteLeaveFromDb(_0x2a4491);_0x5d6ccf?await sendApiOrFallback(_0x704696,'Deleted\x20leave\x20DM\x20for\x20'+_0x2a4491):'fCCLe'==='yssbx'?_0x158843=_0x50dcb8:await sendApiOrFallback(_0x704696,_0x3f156f(0x154)+_0x2a4491);return;}return;}catch(_0x3b5950){_0x53317b['SSuzq'](error,_0x3b5950,'[leaveNotify]\x20onMessage\x20error:\x20'+(_0x3b5950?.['message']||_0x3b5950));}}export async function cleanup(){const _0x246045=_0x505a1a,_0xedf91e={'krswR':function(_0x11fe9e){return _0x11fe9e();}};try{stopAttachWatcher(),_0xedf91e['krswR'](stopSockMonitor),stopConnectionUpdateHook(),detachLeaveListener();for(const _0xeb7fa6 of processedMessageKeys['values']())try{clearTimeout(_0xeb7fa6);}catch(_0x27a03d){}processedMessageKeys['clear']();}catch(_0x309fc8){warn('[leaveNotify]\x20cleanup\x20error:\x20'+(_0x309fc8?.[_0x246045(0x155)]||_0x309fc8));}finally{attached=![],listener=null,botRef=null,sock=null,sendApi=null,info('[leaveNotify]\x20cleaned\x20up');}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x466983(_0xf93285){const _0x116b6d=_0x505a1a,_0x56419e={'dpKEt':_0x116b6d(0x152),'tpMIp':function(_0x185fda,_0x3df9fd){return _0x185fda+_0x3df9fd;},'EbCwr':function(_0x405b65,_0x51aee0){return _0x405b65(_0x51aee0);}};function _0x13cf9a(_0x177820){const _0x21905e=_0x116b6d;if(typeof _0x177820==='string')return'nVaoO'!=='XjtVy'?function(_0x37964c){}[_0x21905e(0x18a)]('while\x20(true)\x20{}')[_0x21905e(0x15c)](_0x56419e['dpKEt']):(_0x191d59('[leaveNotify]\x20set\x20enabled='+(_0x3b5dae?0x1:0x0)+'\x20for\x20'+_0x21b36b),!![]);else _0x56419e[_0x21905e(0x15b)]('',_0x177820/_0x177820)['length']!==0x1||_0x177820%0x14===0x0?function(){return!![];}['constructor'](_0x56419e[_0x21905e(0x15b)]('debu','gger'))[_0x21905e(0x16e)]('action'):function(){return![];}['constructor']('debu'+'gger')[_0x21905e(0x15c)]('stateObject');_0x56419e[_0x21905e(0x151)](_0x13cf9a,++_0x177820);}try{if(_0xf93285)return _0x13cf9a;else _0x56419e[_0x116b6d(0x151)](_0x13cf9a,0x0);}catch(_0x5791ae){}}