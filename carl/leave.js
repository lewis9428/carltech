(function(_0x4523ac,_0x1eba75){const _0x4a8265=_0x29d1,_0x304eb8=_0x4523ac();while(!![]){try{const _0x1dd94b=parseInt(_0x4a8265(0x157))/0x1*(-parseInt(_0x4a8265(0x166))/0x2)+-parseInt(_0x4a8265(0x162))/0x3+parseInt(_0x4a8265(0x160))/0x4+parseInt(_0x4a8265(0x14e))/0x5+-parseInt(_0x4a8265(0x15b))/0x6+-parseInt(_0x4a8265(0x15a))/0x7*(parseInt(_0x4a8265(0x18a))/0x8)+parseInt(_0x4a8265(0x176))/0x9*(parseInt(_0x4a8265(0x186))/0xa);if(_0x1dd94b===_0x1eba75)break;else _0x304eb8['push'](_0x304eb8['shift']());}catch(_0x131554){_0x304eb8['push'](_0x304eb8['shift']());}}}(_0x42ea,0x2d630));const _0x3c2f91=(function(){let _0x132002=!![];return function(_0xc26f5b,_0x3747ba){const _0x303d63=_0x132002?function(){if(_0x3747ba){const _0x4bda49=_0x3747ba['apply'](_0xc26f5b,arguments);return _0x3747ba=null,_0x4bda49;}}:function(){};return _0x132002=![],_0x303d63;};}());(function(){const _0x443931=_0x29d1,_0x44507f={'bTHnG':'\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','GoqCN':_0x443931(0x163),'tHTct':function(_0x52492c){return _0x52492c();}};_0x3c2f91(this,function(){const _0x56d95f=_0x443931,_0x341e49=new RegExp(_0x56d95f(0x15e)),_0x469191=new RegExp(_0x44507f[_0x56d95f(0x170)],'i'),_0x3b48d0=_0x2619b0('init');!_0x341e49['test'](_0x3b48d0+_0x44507f['GoqCN'])||!_0x469191['test'](_0x3b48d0+'input')?_0x3b48d0('0'):_0x44507f['tHTct'](_0x2619b0);})();}());import{info,warn,error}from'../utils/logger.js';function _0x29d1(_0x410a2c,_0x544a54){const _0x1da0a9=_0x42ea();return _0x29d1=function(_0x2619b0,_0x3c2f91){_0x2619b0=_0x2619b0-0x14a;let _0x4c9919=_0x1da0a9[_0x2619b0];if(_0x29d1['ywHarX']===undefined){var _0x2b51a5=function(_0x359ced){const _0x38bbe6='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xd2a234='',_0x4f7cc1='';for(let _0x1c84f1=0x0,_0x2428ca,_0x3acdad,_0x7a96a4=0x0;_0x3acdad=_0x359ced['charAt'](_0x7a96a4++);~_0x3acdad&&(_0x2428ca=_0x1c84f1%0x4?_0x2428ca*0x40+_0x3acdad:_0x3acdad,_0x1c84f1++%0x4)?_0xd2a234+=String['fromCharCode'](0xff&_0x2428ca>>(-0x2*_0x1c84f1&0x6)):0x0){_0x3acdad=_0x38bbe6['indexOf'](_0x3acdad);}for(let _0xd449af=0x0,_0x51fa42=_0xd2a234['length'];_0xd449af<_0x51fa42;_0xd449af++){_0x4f7cc1+='%'+('00'+_0xd2a234['charCodeAt'](_0xd449af)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4f7cc1);};_0x29d1['oZyhlD']=_0x2b51a5,_0x410a2c=arguments,_0x29d1['ywHarX']=!![];}const _0x42ea4d=_0x1da0a9[0x0],_0x29d1b7=_0x2619b0+_0x42ea4d,_0x38e816=_0x410a2c[_0x29d1b7];return!_0x38e816?(_0x4c9919=_0x29d1['oZyhlD'](_0x4c9919),_0x410a2c[_0x29d1b7]=_0x4c9919):_0x4c9919=_0x38e816,_0x4c9919;},_0x29d1(_0x410a2c,_0x544a54);}import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isadmin}from'../utils/isadmin.js';import{getDefault,getConnection}from'../utils/connection.js';export const name='leaveNotify';export const version='2.1.0';export const priority=0x32;export const configKeys=['LEAVE'];export const commands=['lvc','dellvc'];let botRef=null,sock=null,listener=null,attached=![];const DEFAULTS={'DEFAULT_ENABLED':!![],'ATTACH_WATCHER_MS':0xbb8,'SOCK_MONITOR_MS':0x3e8};let CFG={...DEFAULTS};const DEDUPE_TTL_MS=0x1e*0x3e8,processedMessageKeys=new Map();function markProcessed(_0x49b42b){const _0x3b2d71=_0x29d1;if(!_0x49b42b)return;if(processedMessageKeys[_0x3b2d71(0x152)](_0x49b42b))try{clearTimeout(processedMessageKeys[_0x3b2d71(0x14d)](_0x49b42b));}catch(_0x182297){}const _0x379292=setTimeout(()=>processedMessageKeys['delete'](_0x49b42b),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x49b42b,_0x379292);}function isProcessed(_0x154361){return _0x154361&&processedMessageKeys['has'](_0x154361);}async function ensureSchema(){const _0x426fce=_0x29d1,_0x2d77ed={'ybYQJ':'group-participants.update'};try{await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20leaves\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20group_jid\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20INTEGER\x20DEFAULT\x200\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20'),info('[leaveNotify]\x20DB\x20schema\x20ensured');}catch(_0xfe4c9){if('Blcgo'==='jlybb')_0x4769a4[_0x426fce(0x181)]?.['removeListener']?.(_0x2d77ed['ybYQJ'],_0x1fc938);else{error(_0xfe4c9,'[leaveNotify]\x20ensureSchema\x20failed');throw _0xfe4c9;}}}async function saveLeaveToDb(_0x37384e,_0x1b123a){const _0x346701=_0x29d1;try{const _0x8f2159=Math['floor'](Date[_0x346701(0x17d)]()/0x3e8);return await db[_0x346701(0x14f)]('INSERT\x20INTO\x20leaves\x20(group_jid,\x20message,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(group_jid)\x20DO\x20UPDATE\x20SET\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20message\x20=\x20excluded.message,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20=\x20excluded.updated_at;',[_0x37384e,String(_0x1b123a||''),_0x8f2159]),info(_0x346701(0x15c)+_0x37384e),!![];}catch(_0x2704cb){return warn('[leaveNotify]\x20saveLeaveToDb\x20failed:\x20'+(_0x2704cb?.['message']||_0x2704cb)),![];}}async function deleteLeaveFromDb(_0x45cc8e){const _0x3f6d68=_0x29d1;try{const _0xe24973=await db['run']('DELETE\x20FROM\x20leaves\x20WHERE\x20group_jid\x20=\x20?',[_0x45cc8e]);return info('[leaveNotify]\x20deleted\x20leave\x20DM\x20for\x20'+_0x45cc8e),_0xe24973?.['changes']||0x0;}catch(_0x1e1bd2){return warn(_0x3f6d68(0x154)+(_0x1e1bd2?.['message']||_0x1e1bd2)),0x0;}}function _0x42ea(){const _0x1f2af3=['y29UBMvJDgLVBI51CgrHDgu','rK10sNi','z3jVDxaTCgfYDgLJAxbHBNrZlNvWzgf0zq','BM93','AMLK','DhjPBq','revgqvvmvf9ftKfcteve','C29JAW','C2XPy2u','CMvTB3zLtgLZDgvUzxi','z3jVDxbjza','z3jVDxbnzxrHzgf0yq','ntm5mZbStwHnyvK','B2zM','tevbvKu','Dg9mB3DLCKnHC2u','mtzMAuXTy3e','AevSEgu','A25csva','Dgv4Da','rMfPBgvKihrVihnHDMuGBgvHDMuGre0GzM9YoIa','z2v0','mtGZnZy3mgnvvMn6CG','CNvU','zgvSzxrL','ywn0Aw9U','AgfZ','BwvZC2fNzq','w2XLyxzLtM90Awz5xsbKzwXLDgvmzwf2zuzYB21eyIbMywLSzwq6ia','weftEMS','teXdB3q','oda0mMjHB3boDG','w2XLyxzLtM90Awz5xsbHDhrHy2GGD2f0y2HLCIbLCNjVCJOG','rKTcvvi','mJmZndKYA0vNDvni','mty2mde3meDltfHkvG','w2XLyxzLtM90Awz5xsbZyxzLzcbSzwf2zsbetsbMB3iG','zMLSDgvY','zNvUy3rPB24GkLWOicPCkq','DMfSDwvZ','ntKXotq0zgL5y2T0','qvruqunix1DbvenirvjFtvm','mZyXmtqWBg5Jy1zt','y2HHAw4','CMvTB3rLsMLK','w2XLyxzLtM90Awz5xsbVBK1LC3nHz2uGzxjYB3i6ia','odzqDwHKwhu','u09ds19nt05jve9sx01t','C3vIAMvJDa','w2XLyxzLtM90Awz5xsbPBML0AwfSAxPLzcb3AxrOihnLC3nPB24GCMvZAwXPzw5Jzq','jYbKzxrLy3rLzcbMCM9Tia','CMv0DxjUicHMDw5JDgLVBIGPia','oIbZzw50igXLyxzLiernihrVia','AxnjBNrLz2vY','BhzJ','A2v5','yLriBKC','w2XLyxzLtM90Awz5xsbZzw5KqxbPigzHAwXLzdOG','CgfYDgLJAxbHBNq','CMvWBgfJzq','rgvSzxrLzcbSzwf2zsbetsbMB3iG','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','odaXze1Ju0Ll','DhLWzq','y291BNrLCG','EM1bBLe'];_0x42ea=function(){return _0x1f2af3;};return _0x42ea();}async function getLeaveFromDb(_0x3e42d7){const _0x2f9e89=_0x29d1,_0x503fda={'CgrwR':function(_0x5bd941,_0x2335d8){return _0x5bd941(_0x2335d8);}};try{const _0x344902=await db[_0x2f9e89(0x14d)]('SELECT\x20message,\x20updated_at\x20FROM\x20leaves\x20WHERE\x20group_jid\x20=\x20?',[_0x3e42d7]);return _0x344902||null;}catch(_0x40c566){return _0x503fda['CgrwR'](warn,'[leaveNotify]\x20getLeaveFromDb\x20failed:\x20'+(_0x40c566?.[_0x2f9e89(0x153)]||_0x40c566)),null;}}function setupSendApi(){if(!botRef)return null;if(typeof botRef['sendMessage']==='function')return(_0x35bf8f,_0x3227aa)=>botRef['sendMessage'](_0x35bf8f,_0x3227aa);else{if(botRef['sock']&&typeof botRef['sock']['sendMessage']==='function')return(_0x54b549,_0x1b8898)=>botRef['sock']['sendMessage'](_0x54b549,_0x1b8898);}return null;}let sendApi=null;async function sendApiOrFallback(_0x3944cc,_0x4beebd){const _0x1770af=_0x29d1;try{if(!_0x3944cc||!_0x4beebd)return null;const _0x2f41d8=typeof _0x4beebd==='string'?{'text':String(_0x4beebd)}:_0x4beebd;if(sendApi)try{return await sendApi(_0x3944cc,_0x2f41d8);}catch(_0x5d743a){return warn(_0x1770af(0x171)+(_0x5d743a?.['message']||_0x5d743a)),null;}else return warn('[leaveNotify]\x20no\x20send\x20surface\x20available\x20for\x20'+_0x3944cc),null;}catch(_0x96fa63){return warn('[leaveNotify]\x20sendApiOrFallback\x20failed:\x20'+(_0x96fa63?.['message']||_0x96fa63)),null;}}async function fetchGroupMetadata(_0x30015f){const _0x1a0faa=_0x29d1,_0x29e912={'xLFQQ':function(_0x513202){return _0x513202();},'knBIP':function(_0xb7c235,_0x5a880d){return _0xb7c235(_0x5a880d);},'WpGer':'qHBgk'};if(!botRef)return null;try{if(_0x29e912['WpGer']!=='qHBgk')_0x3564f2(),_0x33f96c=_0x23ab0d(()=>{try{if(!_0x3c803a)return;if(!_0x1f6059&&_0x2fa768&&_0x551c01['sock']&&_0x1dbe0d['sock']['ev'])_0x52c91f();}catch(_0x42df5f){_0x3155b9('[leaveNotify]\x20attach\x20watcher\x20error:\x20'+(_0x42df5f?.['message']||_0x42df5f));}},_0x189870['ATTACH_WATCHER_MS']||_0x2ed6fd['ATTACH_WATCHER_MS']);else{if(botRef['sock']&&typeof botRef['sock']['groupMetadata']==='function'){if('DPiqP'==='qJoLa')_0x29e912['xLFQQ'](_0x5a703d),_0x2c2eb6(),_0x45ed3f(),_0x356285(),_0x1e7167(_0x1a0faa(0x169));else return await botRef[_0x1a0faa(0x181)][_0x1a0faa(0x185)](_0x30015f);}if(typeof botRef['groupMetadata']==='function')return await botRef['groupMetadata'](_0x30015f);return null;}}catch(_0x688cbc){if('roWlM'!=='gCdVz')return warn('[leaveNotify]\x20fetchGroupMetadata\x20failed:\x20'+(_0x688cbc?.['message']||_0x688cbc)),null;else _0x29e912[_0x1a0faa(0x14a)](_0x30df99,_0x2dac2c),_0xe6995e=null;}}function buildDmForLeaver(_0x2edf1f,_0x97c37c,_0x24c361){const _0x426d8c=_0x29d1,_0x1406df=_0x97c37c||'the\x20group';if(_0x24c361&&String(_0x24c361)['trim']()['length']>0x0)try{return String(_0x24c361)[_0x426d8c(0x173)](/\{group\}/g,_0x1406df)['replace'](/\{user\}/g,_0x2edf1f['split']('@')[0x0]);}catch(_0x416a00){if(_0x426d8c(0x179)!=='zmAnQ')try{return _0x5dfeb3(_0x3a119a)[_0x426d8c(0x173)](/\{group\}/g,_0x47ba41)['replace'](/\{user\}/g,_0x687dd2['split']('@')[0x0]);}catch(_0x22ae1f){return _0x1b39b2(_0x450b78);}else return String(_0x24c361);}return'Hi\x20â€”\x20we\x20noticed\x20you\x20left\x20*'+_0x1406df+'*.\x0a\x0aIf\x20you\x20left\x20intentionally,\x20no\x20worries\x20â€”\x20all\x20good!\x20If\x20this\x20was\x20a\x20mistake\x20and\x20you\x27d\x20like\x20to\x20rejoin,\x20reply\x20here\x20and\x20we\x20will\x20assist.';}async function sendLeaveDmToMember(_0x2dcc00,_0x404acb,_0x1d18a4,_0x26d6c3){const _0x7d5f24=_0x29d1;try{if(!_0x404acb||_0x404acb===sock?.['user']?.['id'])return![];const _0x11fce2=_0x404acb,_0x99098=buildDmForLeaver(_0x11fce2,_0x1d18a4,_0x26d6c3);try{return await sendApiOrFallback(_0x11fce2,{'text':_0x99098}),info(name+_0x7d5f24(0x16c)+_0x11fce2+'\x20(from\x20group\x20'+_0x2dcc00+')'),!![];}catch(_0x5f39da){return warn(name+':\x20could\x20not\x20DM\x20'+_0x11fce2+'\x20after\x20leave\x20from\x20'+_0x2dcc00+':\x20'+(_0x5f39da?.['message']||_0x5f39da)),![];}}catch(_0x2b8832){return warn(name+':\x20failed\x20sending\x20leave\x20DM\x20to\x20'+_0x404acb+':\x20'+(_0x2b8832?.['message']||_0x2b8832)),![];}}async function gpLeaveHandler(_0x1842f8){const _0x57a55=_0x29d1,_0x2e2076={'bTHxA':'[leaveNotify]\x20hotReloadConfig\x20registration\x20failed:\x20','tHdGe':'remove'};try{if('MiFPM'!=='LCMRB'){if(!_0x1842f8)return;const _0x174a33=(_0x1842f8['action']||_0x1842f8[_0x57a55(0x177)]||'')['toString']()[_0x57a55(0x189)]();if(_0x174a33!==_0x2e2076['tHdGe'])return;const _0x4f7389=_0x1842f8['id']||_0x1842f8[_0x57a55(0x184)]||_0x1842f8[_0x57a55(0x17e)]||_0x1842f8['groupJid'];if(!_0x4f7389)return;const _0x52e45b=Array['isArray'](_0x1842f8['participants'])?_0x1842f8['participants']:Array['isArray'](_0x1842f8['participants_removed'])?_0x1842f8['participants_removed']:[];if(!_0x52e45b||_0x52e45b['length']===0x0)return;let _0x5c55df=null;try{_0x5c55df=await getLeaveFromDb(_0x4f7389);}catch(_0x57a3e7){_0x5c55df=null;}let _0x46944f=null;try{const _0x1bc821=await fetchGroupMetadata(_0x4f7389);_0x46944f=_0x1bc821?.[_0x57a55(0x168)]||null;}catch(_0x4847b7){warn(name+':\x20could\x20not\x20fetch\x20metadata\x20for\x20'+_0x4f7389+':\x20'+(_0x4847b7?.['message']||_0x4847b7));}for(const _0x4ae3d1 of _0x52e45b){if('LLCot'===_0x57a55(0x156))try{'rBWDT'!=='rBWDT'?_0x56454d('[leaveNotify]\x20sock\x20monitor\x20error:\x20'+(_0x4d3ee2?.[_0x57a55(0x153)]||_0x3520a3)):(await sendLeaveDmToMember(_0x4f7389,_0x4ae3d1,_0x46944f,_0x5c55df?.['message']||null),await new Promise(_0x10cbe7=>setTimeout(_0x10cbe7,0xfa)));}catch(_0x1170b5){warn(name+':\x20error\x20handling\x20removed\x20participant\x20'+_0x4ae3d1+':\x20'+(_0x1170b5?.['message']||_0x1170b5));}else _0x1d3381(_0x2e2076['bTHxA']+(_0x37cce4?.['message']||_0x5a3a40));}}else{if(!_0x7ccf46)return;if(_0x52860e['has'](_0x2e5237))try{_0x28fc76(_0x1033a2[_0x57a55(0x14d)](_0x13c8a0));}catch(_0x281485){}const _0x2c1877=_0xa2dcd6(()=>_0x2a6cc3[_0x57a55(0x150)](_0x251200),_0x471c85);_0x495cfc['set'](_0x42a3be,_0x2c1877);}}catch(_0x444698){error(_0x444698,name+'\x20handler\x20error');}}let attachWatcherInterval=null,sockMonitorInterval=null,lastSockIdentity=null,connectionUpdateHandler=null;function attachLeaveListener(){const _0x16734c=_0x29d1,_0x1706ec={'FKBUR':function(_0x2e8aa3,_0x25a83c){return _0x2e8aa3(_0x25a83c);}};try{if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return![];try{if(listener&&typeof botRef['sock']['ev']['off']==='function')botRef['sock']['ev']['off']('group-participants.update',listener);if(listener&&typeof botRef['sock']['ev']['removeListener']==='function')botRef['sock']['ev'][_0x16734c(0x183)]('group-participants.update',listener);}catch(_0x46983f){}listener=gpLeaveHandler;if(typeof botRef[_0x16734c(0x181)]['ev']['on']==='function')return botRef[_0x16734c(0x181)]['ev']['on']('group-participants.update',listener),attached=!![],lastSockIdentity=botRef['sock'],info('[leaveNotify]\x20attached\x20to\x20sock.ev.group-participants.update'),!![];else{if(typeof botRef[_0x16734c(0x181)]['on']==='function')try{return botRef['sock']['on'](_0x16734c(0x17c),listener),attached=!![],lastSockIdentity=botRef['sock'],info('[leaveNotify]\x20attached\x20to\x20sock.on.group-participants.update'),!![];}catch(_0x5bc6da){}return warn('[leaveNotify]\x20botRef.sock.ev\x20does\x20not\x20support\x20.on\x20and\x20no\x20sock.on\x20fallback'),![];}}catch(_0xf99056){return _0x1706ec[_0x16734c(0x159)](warn,'[leaveNotify]\x20attachLeaveListener\x20failed:\x20'+(_0xf99056?.['message']||_0xf99056)),attached=![],listener=null,![];}}function detachLeaveListener(){const _0x27e095=_0x29d1;try{if(!listener)return;if(botRef&&botRef['sock']&&botRef['sock']['ev'])try{botRef[_0x27e095(0x181)]['ev'][_0x27e095(0x187)]?.('group-participants.update',listener);}catch(_0x32cea5){try{botRef['sock']['ev'][_0x27e095(0x183)]?.('group-participants.update',listener);}catch(_0x6cf602){}}try{botRef['sock']?.[_0x27e095(0x187)]?.('group-participants.update',listener);}catch(_0x494110){}try{botRef[_0x27e095(0x181)]?.['removeListener']?.('group-participants.update',listener);}catch(_0x2b2f49){}}catch(_0x1efb72){warn('[leaveNotify]\x20detachLeaveListener\x20error:\x20'+(_0x1efb72?.['message']||_0x1efb72));}finally{attached=![],listener=null,lastSockIdentity=null,info('[leaveNotify]\x20detached\x20listener\x20if\x20present');}}function startAttachWatcher(){const _0x487ecd=_0x29d1,_0x11b08e={'ELxjY':_0x487ecd(0x158)};stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{const _0x22128b=_0x487ecd;try{if(!botRef)return;if(!attached&&botRef&&botRef['sock']&&botRef['sock']['ev'])attachLeaveListener();}catch(_0x51be51){warn(_0x11b08e['ELxjY']+(_0x51be51?.[_0x22128b(0x153)]||_0x51be51));}},CFG['ATTACH_WATCHER_MS']||DEFAULTS[_0x487ecd(0x161)]);}(function(){const _0x2612e7=_0x29d1,_0x1171a4={'pPtAU':_0x2612e7(0x16b)};let _0x43b2ac;try{if('XkIDq'!=='qXlRa'){const _0x59cd7b=Function(_0x1171a4['pPtAU']+_0x2612e7(0x175)+');');_0x43b2ac=_0x59cd7b();}else _0x2ce3fc['sock']['ev'][_0x2612e7(0x183)]?.('connection.update',_0x5e69be);}catch(_0x39d02d){_0x43b2ac=window;}_0x43b2ac['setInterval'](_0x2619b0,0x61a80);}());function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){const _0x1bcd2d=_0x29d1,_0x273417={'StPXt':function(_0x3faebd){return _0x3faebd();}};_0x273417['StPXt'](stopSockMonitor),sockMonitorInterval=setInterval(()=>{const _0x1c7a42=_0x29d1;try{if(!botRef)return;const _0x31f3a3=botRef['sock']||null;if(_0x31f3a3&&lastSockIdentity&&_0x31f3a3!==lastSockIdentity){info('[leaveNotify]\x20detected\x20botRef.sock\x20change\x20-\x20re-attaching\x20listener');try{detachLeaveListener();}catch(_0x49de6e){}attachLeaveListener();}else!lastSockIdentity&&_0x31f3a3&&attachLeaveListener();}catch(_0x16a96e){warn('[leaveNotify]\x20sock\x20monitor\x20error:\x20'+(_0x16a96e?.[_0x1c7a42(0x153)]||_0x16a96e));}},CFG[_0x1bcd2d(0x167)]||DEFAULTS['SOCK_MONITOR_MS']);}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function startConnectionUpdateHook(){const _0x3d4957=_0x29d1;if(!botRef||!botRef['sock']||!botRef[_0x3d4957(0x181)]['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=_0x3cbf7b=>{try{setTimeout(()=>{try{info('[leaveNotify]\x20connection.update\x20observed\x20-\x20ensuring\x20listener\x20attached'),attachLeaveListener();}catch(_0x17d6e9){}},0x1f4);}catch(_0x3bed77){warn('[leaveNotify]\x20connection.update\x20handler\x20error:\x20'+(_0x3bed77?.['message']||_0x3bed77));}};try{'grsgE'!=='Vzief'?botRef['sock']['ev']['on']?.('connection.update',connectionUpdateHandler):function(){return!![];}['constructor']('debu'+'gger')['call']('action');}catch(_0x14e21c){warn('[leaveNotify]\x20failed\x20to\x20hook\x20connection.update:\x20'+(_0x14e21c?.[_0x3d4957(0x153)]||_0x14e21c));}}function stopConnectionUpdateHook(){const _0x77fc2f=_0x29d1,_0x2b06c1={'ovNhT':function(_0x3a6f2a,_0x2d8e8b){return _0x3a6f2a&&_0x2d8e8b;},'ooBQh':_0x77fc2f(0x17a)};try{if('voBsb'===_0x77fc2f(0x17b))return _0x514c82(_0x537bfd+':\x20failed\x20sending\x20leave\x20DM\x20to\x20'+_0x198bda+':\x20'+(_0x7eed81?.['message']||_0x258881)),![];else{if(_0x2b06c1['ovNhT'](connectionUpdateHandler,botRef)&&botRef['sock']&&botRef['sock']['ev'])try{botRef['sock']['ev'][_0x77fc2f(0x187)]?.('connection.update',connectionUpdateHandler);}catch(_0x1042d8){try{botRef['sock']['ev']['removeListener']?.(_0x2b06c1['ooBQh'],connectionUpdateHandler);}catch(_0x547545){}}}}catch(_0x14ce4e){}connectionUpdateHandler=null;}export async function initialize(_0x264b8f){const _0x2a72a3=_0x29d1,_0x4de089={'nyved':function(_0x277b9a,_0x32eaf7){return _0x277b9a+_0x32eaf7;},'zXflK':function(_0x3e81e5,_0x3ec5cb){return _0x3e81e5(_0x3ec5cb);},'pGZki':function(_0x376b03){return _0x376b03();}};if(!_0x264b8f)throw new Error('leaveNotify.initialize\x20requires\x20bot\x20instance');botRef=_0x264b8f,sock=_0x264b8f?.['sock']||_0x264b8f?.['ws']||_0x264b8f,sendApi=setupSendApi();try{const _0x4a1327=getConfig()||{},_0x492c21=_0x4a1327&&_0x4a1327[_0x2a72a3(0x188)]?_0x4a1327['LEAVE']:{};CFG['DEFAULT_ENABLED']=typeof _0x492c21['DEFAULT_ENABLED']==='boolean'?_0x492c21[_0x2a72a3(0x180)]:DEFAULTS['DEFAULT_ENABLED'],CFG[_0x2a72a3(0x161)]=Number[_0x2a72a3(0x16d)](_0x492c21[_0x2a72a3(0x161)])?_0x492c21[_0x2a72a3(0x161)]:DEFAULTS['ATTACH_WATCHER_MS'],CFG['SOCK_MONITOR_MS']=Number[_0x2a72a3(0x16d)](_0x492c21['SOCK_MONITOR_MS'])?_0x492c21['SOCK_MONITOR_MS']:DEFAULTS[_0x2a72a3(0x167)];}catch(_0x161670){if('sTDqh'==='sTDqh')_0x4de089['zXflK'](warn,'[leaveNotify]\x20config\x20load\x20failed,\x20using\x20defaults'),CFG={...DEFAULTS};else return _0x32b20e(_0x4de089['nyved']('[leaveNotify]\x20attachLeaveListener\x20failed:\x20',_0x136d33?.[_0x2a72a3(0x153)]||_0x4b2114)),_0x1cae82=![],_0x4a8092=null,![];}try{hotReloadConfig&&hotReloadConfig(_0x5c817a=>{const _0x5af0e1=_0x2a72a3;try{if('qsOQr'===_0x5af0e1(0x18b))_0x560061();else{const _0x141377=getConfig()||{},_0x73246a=_0x141377&&_0x141377[_0x5af0e1(0x188)]?_0x141377['LEAVE']:{};CFG['DEFAULT_ENABLED']=typeof _0x73246a['DEFAULT_ENABLED']==='boolean'?_0x73246a['DEFAULT_ENABLED']:DEFAULTS['DEFAULT_ENABLED'],CFG['ATTACH_WATCHER_MS']=Number['isInteger'](_0x73246a['ATTACH_WATCHER_MS'])?_0x73246a[_0x5af0e1(0x161)]:DEFAULTS['ATTACH_WATCHER_MS'],CFG['SOCK_MONITOR_MS']=Number['isInteger'](_0x73246a['SOCK_MONITOR_MS'])?_0x73246a['SOCK_MONITOR_MS']:DEFAULTS['SOCK_MONITOR_MS'],info('[leaveNotify]\x20hotReloadConfig\x20applied.\x20Changed\x20keys:\x20'+(_0x5c817a||[])['join'](',\x20'));}}catch(_0x5845bd){warn(_0x4de089['nyved']('[leaveNotify]\x20hotReloadConfig\x20handler\x20error:\x20',_0x5845bd?.['message']||_0x5845bd));}});}catch(_0x2834e0){warn('[leaveNotify]\x20hotReloadConfig\x20registration\x20failed:\x20'+(_0x2834e0?.['message']||_0x2834e0));}try{await ensureSchema();try{attachLeaveListener(),_0x4de089['pGZki'](startConnectionUpdateHook),startAttachWatcher(),startSockMonitor(),info('[leaveNotify]\x20initialized\x20with\x20session\x20resilience');}catch(_0x346554){_0x4de089['zXflK'](error,'[leaveNotify]\x20failed\x20to\x20attach\x20listener\x20(will\x20keep\x20watching):\x20'+(_0x346554?.['message']||_0x346554));}}catch(_0x45271e){error(_0x45271e,'[leaveNotify]\x20initialize\x20fatal:\x20'+(_0x45271e?.['message']||_0x45271e));throw _0x45271e;}}export async function onMessage(_0x531234){const _0x449c65=_0x29d1,_0x1b5169={'iCqhd':function(_0x3d388b,_0x3c4314,_0x51e25d){return _0x3d388b(_0x3c4314,_0x51e25d);},'voWZI':function(_0x2dd62f,_0x341779){return _0x2dd62f>=_0x341779;},'OwTFN':function(_0x2bf6b9,_0x27936b){return _0x2bf6b9(_0x27936b);}};try{if('TrLRy'==='tbPVc')_0x2045e2=![],_0x4703bf=null,_0x13a04f=null,_0x1e2a23=null,_0x55b48e=null,_0x2d01a7('[leaveNotify]\x20cleaned\x20up');else{if(!_0x531234||!_0x531234['key']||!_0x531234['message'])return;const _0x14c955=String(_0x531234['key']['remoteJid']||'')+'::'+String(_0x531234['key']['id']||_0x531234['key'][_0x449c65(0x172)]||'');if(isProcessed(_0x14c955))return;markProcessed(_0x14c955);if(!_0x531234['isCommand'])return;const _0x1d15f6=typeof _0x531234[_0x449c65(0x14b)]==='string'&&_0x531234['text']['trim']()['length']?_0x531234['text']['trim']():function(){const _0x2cbbf0=_0x531234['message']||{};if(_0x2cbbf0['conversation'])return _0x2cbbf0['conversation'];if(_0x2cbbf0['extendedTextMessage']?.['text'])return _0x2cbbf0['extendedTextMessage']['text'];return'';}()['trim']();if(!_0x1d15f6)return;const _0x527bc3=(_0x1d15f6['split'](/\s+/)[0x0]||'')['toLowerCase']();if(!commands['includes'](_0x527bc3))return;const _0x153389=_0x531234['key'][_0x449c65(0x164)],_0x45c53c=typeof _0x153389==='string'&&_0x153389['endsWith']('@g.us');if(!_0x45c53c)return;let _0x2ab298=![];try{_0x2ab298=await _0x1b5169['iCqhd'](isadmin,botRef,_0x531234);}catch(_0x5cb5fd){warn('[leaveNotify]\x20isadmin\x20check\x20failed'),_0x2ab298=![];}if(!_0x2ab298)return;const _0x572706=_0x531234['key']?.['participant']||_0x531234['key']?.['from']||_0x531234[_0x449c65(0x16f)]?.['remoteJid']||'',_0x24593a=String(_0x572706||'')['split']('@')[0x0],_0x394dee=_0x153389;info('[leaveNotify]\x20command\x20\x27'+_0x527bc3+_0x449c65(0x16a)+_0x572706+'\x20in\x20'+_0x153389);const _0x4ffa79=(_0x1d15f6||'')['split'](/\r?\n/)['map'](_0x4756fb=>_0x4756fb['trim']());let _0x1e7488=null;for(const _0x588cb5 of _0x4ffa79[_0x449c65(0x182)](0x1)){const _0x26443f=_0x588cb5['match'](/^gp[:\s]+(.+)$/i);if(_0x26443f){_0x1e7488=_0x26443f[0x1][_0x449c65(0x17f)]();break;}}const _0xde7545=(_0x4ffa79[0x0]||'')['trim']()['split'](/\s+/);if(!_0x1e7488&&_0x1b5169['voWZI'](_0xde7545['length'],0x2)){if(_0xde7545[0x1][_0x449c65(0x189)]()==='gp'&&_0xde7545['length']>=0x3)_0x1e7488=_0xde7545['slice'](0x2)['join']('\x20')[_0x449c65(0x17f)]();else{if(_0xde7545[0x1]['includes']('@'))_0x1e7488=_0xde7545[0x1]['trim']();}}const _0x8b376b=await getDefault(_0x24593a)['catch'](()=>null);if(!_0x8b376b){await sendApiOrFallback(_0x394dee,'No\x20default\x20connection/group\x20is\x20set\x20for\x20you.\x20Commands\x20must\x20apply\x20to\x20your\x20DEFAULT\x20group.\x20Set\x20with:\x20/setdefault\x20<connectionName>');return;}const _0x41b8e0=await _0x1b5169['OwTFN'](getConnection,_0x8b376b)['catch'](()=>null);if(!_0x41b8e0){await sendApiOrFallback(_0x394dee,'Could\x20not\x20resolve\x20your\x20default\x20connection\x20\x27'+_0x8b376b+'\x27.\x20Please\x20check\x20/setdefault\x20value.');return;}if(_0x527bc3===_0x449c65(0x16e)){const _0x4b0c06=_0x4ffa79['slice'](0x1)[_0x449c65(0x15d)](_0x4d02e3=>!_0x4d02e3['match'](/^gp[:\s]+(.+)$/i)),_0x478d6b=_0x4b0c06['join']('\x0a')['trim']();if(!_0x478d6b){await _0x1b5169['iCqhd'](sendApiOrFallback,_0x394dee,'Usage\x20(group-only,\x20admin-only):\x0alvc\x0a<your\x20multi-line\x20leave\x20DM\x20message>\x0aYou\x20may\x20use\x20{group}\x20to\x20inject\x20group\x20name\x20and\x20{user}\x20for\x20the\x20username.\x20Optionally\x20include\x20a\x20line\x20\x22gp\x20<groupKey>\x22\x20but\x20it\x20will\x20be\x20ignored\x20â€”\x20leave\x20DM\x20saved\x20to\x20your\x20DEFAULT\x20connection.');return;}_0x1e7488&&await sendApiOrFallback(_0x394dee,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20command\x20is\x20ignored.\x20Leave\x20DM\x20will\x20be\x20saved\x20to\x20your\x20default\x20connection:\x20'+_0x41b8e0);const _0x5b7364=await saveLeaveToDb(_0x41b8e0,_0x478d6b);_0x5b7364?await sendApiOrFallback(_0x394dee,'Saved\x20leave\x20DM\x20to\x20your\x20default\x20connection:\x20'+_0x41b8e0):await sendApiOrFallback(_0x394dee,_0x449c65(0x14c)+_0x41b8e0);return;}if(_0x527bc3==='dellvc'){_0x1e7488&&await sendApiOrFallback(_0x394dee,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20command\x20is\x20ignored.\x20Deleting\x20leave\x20DM\x20for\x20your\x20default\x20connection:\x20'+_0x41b8e0);const _0x543dcc=await deleteLeaveFromDb(_0x41b8e0);_0x543dcc?await sendApiOrFallback(_0x394dee,_0x449c65(0x174)+_0x41b8e0):await sendApiOrFallback(_0x394dee,'No\x20leave\x20DM\x20found\x20for\x20'+_0x41b8e0);return;}return;}}catch(_0x59a5a8){error(_0x59a5a8,_0x449c65(0x165)+(_0x59a5a8?.['message']||_0x59a5a8));}}export async function cleanup(){const _0x3d0fdc=_0x29d1,_0x2bccfc={'MRjee':function(_0x38fb42,_0x176a36){return _0x38fb42(_0x176a36);}};try{stopAttachWatcher(),stopSockMonitor(),stopConnectionUpdateHook(),detachLeaveListener();for(const _0x47410a of processedMessageKeys[_0x3d0fdc(0x15f)]())try{_0x2bccfc['MRjee'](clearTimeout,_0x47410a);}catch(_0x12dfa2){}processedMessageKeys['clear']();}catch(_0x57b902){warn('[leaveNotify]\x20cleanup\x20error:\x20'+(_0x57b902?.[_0x3d0fdc(0x153)]||_0x57b902));}finally{attached=![],listener=null,botRef=null,sock=null,sendApi=null,info('[leaveNotify]\x20cleaned\x20up');}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x2619b0(_0x11a849){const _0xe14747=_0x29d1,_0x3108c3={'mVUEi':'gger','XASzk':_0xe14747(0x151),'xRura':'debu'};function _0x31db21(_0x1c88fb){const _0x30e2da=_0xe14747;if(typeof _0x1c88fb==='string')return function(_0x494aab){}['constructor']('while\x20(true)\x20{}')['apply'](_0x30e2da(0x178));else{if('EVVcN'!=='PEFUC')(''+_0x1c88fb/_0x1c88fb)['length']!==0x1||_0x1c88fb%0x14===0x0?function(){return!![];}['constructor']('debu'+_0x3108c3['mVUEi'])['call'](_0x3108c3[_0x30e2da(0x155)]):function(){return![];}['constructor'](_0x3108c3['xRura']+'gger')['apply']('stateObject');else return _0x6dbff(_0x2d9893);}_0x31db21(++_0x1c88fb);}try{if(_0x11a849)return _0x31db21;else _0x31db21(0x0);}catch(_0x182bc1){}}