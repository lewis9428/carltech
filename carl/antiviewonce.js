const _0x10b679=_0x23a4;(function(_0x26ed98,_0x38f235){const _0x164c23=_0x23a4,_0x2f693d=_0x26ed98();while(!![]){try{const _0x99fb12=parseInt(_0x164c23(0x139))/0x1+parseInt(_0x164c23(0x163))/0x2+-parseInt(_0x164c23(0x168))/0x3*(parseInt(_0x164c23(0x151))/0x4)+-parseInt(_0x164c23(0x183))/0x5*(-parseInt(_0x164c23(0x147))/0x6)+parseInt(_0x164c23(0x170))/0x7+parseInt(_0x164c23(0x172))/0x8+-parseInt(_0x164c23(0x18a))/0x9;if(_0x99fb12===_0x38f235)break;else _0x2f693d['push'](_0x2f693d['shift']());}catch(_0x57c178){_0x2f693d['push'](_0x2f693d['shift']());}}}(_0xc352,0x6c63c));const _0x3db01a=(function(){let _0x3c1bea=!![];return function(_0x3e056a,_0x3b6261){const _0x14c15f=_0x3c1bea?function(){if(_0x3b6261){const _0x3100c4=_0x3b6261['apply'](_0x3e056a,arguments);return _0x3b6261=null,_0x3100c4;}}:function(){};return _0x3c1bea=![],_0x14c15f;};}());(function(){const _0x12054b={'IzWBF':function(_0x3e2f7c,_0x6e7e03){return _0x3e2f7c(_0x6e7e03);},'riiLG':'init'};_0x3db01a(this,function(){const _0x2c3b50=_0x23a4,_0x29b5eb=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x2e0e3c=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x5855dd=_0x12054b['IzWBF'](_0x5f594d,_0x12054b[_0x2c3b50(0x150)]);!_0x29b5eb['test'](_0x5855dd+_0x2c3b50(0x17c))||!_0x2e0e3c['test'](_0x5855dd+'input')?_0x5855dd('0'):_0x5f594d();})();}());import{info,warn,error}from'../utils/logger.js';import{downloadMediaMessage,downloadContentFromMessage}from'@whiskeysockets/baileys';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isadmin}from'../utils/isadmin.js';export const name='viewonce';export const version='3.0.0-rectified';export const priority=0x5f;export const configKeys=['VIEW_ONCE_TARGET_JID','VIEWONCE_ATTACH_WATCHER_MS','VIEWONCE_SOCK_MONITOR_MS','VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE','VIEWONCE_SENT_CLEANUP_DAYS',_0x10b679(0x165)];export const commands=['viewonce'];let botRef=null,sock=null,sendApi=null,attached=![],sockListener=null,connectionUpdateHandler=null,lastSockIdentity=null;(function(){const _0x1e35d1=_0x10b679,_0x30b9c9={'SdfiQ':function(_0x2fa4c2,_0x5f3cb6){return _0x2fa4c2===_0x5f3cb6;}};let _0x579b84;try{if(_0x30b9c9['SdfiQ']('EtozR','qfMYP')){const _0x179805=_0x229f59?function(){if(_0x5c84e3){const _0x46c492=_0x35bf63['apply'](_0x2907fc,arguments);return _0x21e912=null,_0x46c492;}}:function(){};return _0x36e6f2=![],_0x179805;}else{const _0x55580d=Function(_0x1e35d1(0x185)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x579b84=_0x55580d();}}catch(_0x95af74){_0x579b84=window;}_0x579b84['setInterval'](_0x5f594d,0x61a80);}());let attachWatcherInterval=null,sockMonitorInterval=null,cleanupInterval=null;const DEDUPE_TTL_MS=0x1e*0x3e8,processedKeys=new Map(),sentMap=new Map();let VIEW_ONCE_TARGET_JID=null,ATTACH_WATCHER_MS=0xbb8,SOCK_MONITOR_MS=0x3e8,SKIP_IF_TARGET_EQUALS_SOURCE=!![],MODE='p',VIEWONCE_SENT_CLEANUP_DAYS=0x7,VIEWONCE_SENT_CLEANUP_INTERVAL_MS=0x18*0x3c*0x3c*0x3e8;const SMALL_JPEG_THUMB_BASE64='/9j/4AAQSkZJRgABAQEASABIAAD/2wBDABALDA4MDRANDQ0VDxYQEBQiFhgaGB4eHB0dICAhJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCf/2wBDARESEhgSFRgaGhobJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCf/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAb/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD9A//Z',SMALL_JPEG_THUMB=Buffer['from'](SMALL_JPEG_THUMB_BASE64,_0x10b679(0x15f));function setupSendApi(){const _0x527dac=_0x10b679;if(!botRef)return;if(typeof botRef['sendMessage']==='function')sendApi=async(_0x2da295,_0x155f59)=>await botRef['sendMessage'](_0x2da295,_0x155f59);else botRef[_0x527dac(0x184)]&&typeof botRef['sock']['sendMessage']==='function'?sendApi=async(_0x325435,_0x356396)=>await botRef[_0x527dac(0x184)]['sendMessage'](_0x325435,_0x356396):sendApi=null;}async function sendApiOrWarn(_0x3eddae,_0x37fc0b){const _0x30202b=_0x10b679,_0x534b83={'dUbgN':function(_0x510bdf,_0x50bc7f){return _0x510bdf||_0x50bc7f;}};try{if(_0x534b83['dUbgN'](!_0x3eddae,!_0x37fc0b))return null;if(sendApi)return await sendApi(_0x3eddae,_0x37fc0b);return warn('['+name+']\x20no\x20send\x20surface\x20available\x20for\x20'+_0x3eddae),null;}catch(_0x1a6210){return warn('['+name+_0x30202b(0x174)+(_0x1a6210?.[_0x30202b(0x146)]||_0x1a6210)),null;}}function refreshConfig(){const _0xaf818=_0x10b679;try{const _0x541755=getConfig()||{};VIEW_ONCE_TARGET_JID=typeof _0x541755['VIEW_ONCE_TARGET_JID']==='string'&&_0x541755['VIEW_ONCE_TARGET_JID']['includes']('@')?_0x541755['VIEW_ONCE_TARGET_JID']:null,ATTACH_WATCHER_MS=Number(_0x541755[_0xaf818(0x136)]??ATTACH_WATCHER_MS),SOCK_MONITOR_MS=Number(_0x541755['VIEWONCE_SOCK_MONITOR_MS']??SOCK_MONITOR_MS),SKIP_IF_TARGET_EQUALS_SOURCE=_0x541755['VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE']!==undefined?Boolean(_0x541755['VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE']):!![],VIEWONCE_SENT_CLEANUP_DAYS=Number(_0x541755['VIEWONCE_SENT_CLEANUP_DAYS']??VIEWONCE_SENT_CLEANUP_DAYS),VIEWONCE_SENT_CLEANUP_INTERVAL_MS=Number(_0x541755[_0xaf818(0x165)]??VIEWONCE_SENT_CLEANUP_INTERVAL_MS),info('['+name+']\x20config\x20refreshed\x20->\x20viewOnceTarget:'+(VIEW_ONCE_TARGET_JID?'set':'unset')+_0xaf818(0x13f)+ATTACH_WATCHER_MS+_0xaf818(0x15e)+SOCK_MONITOR_MS+'ms,\x20skipIfEqual='+SKIP_IF_TARGET_EQUALS_SOURCE+',\x20cleanupDays='+VIEWONCE_SENT_CLEANUP_DAYS);}catch(_0xfde894){warn('['+name+']\x20refreshConfig\x20error:\x20'+(_0xfde894?.['message']||_0xfde894));}}try{typeof hotReloadConfig===_0x10b679(0x148)&&hotReloadConfig((_0x4dee6e=[])=>{const _0x3b1289=_0x10b679,_0x2b73c3={'KrAmz':'pGudY'};try{const _0x36af82=['VIEW_ONCE_TARGET_JID','VIEWONCE_ATTACH_WATCHER_MS','VIEWONCE_SOCK_MONITOR_MS','VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE','VIEWONCE_SENT_CLEANUP_DAYS',_0x3b1289(0x165)];if((_0x4dee6e||[])['some'](_0x4e53c8=>_0x36af82['includes'](_0x4e53c8)))refreshConfig();}catch(_0x56f40b){if(_0x2b73c3['KrAmz']==='yOjvN'){const _0x4dfa4f=_0x346ae3()||{},_0x481254=_0x4dfa4f['COMMAND_PREFIX']??_0x4dfa4f['PREFIX']??null;if(_0x308a94[_0x3b1289(0x142)](_0x481254))return _0x481254;if(typeof _0x481254===_0x3b1289(0x18c))return[_0x481254];return[];}else warn(name+':\x20hotReload\x20handler\x20error:\x20'+(_0x56f40b?.[_0x3b1289(0x146)]||_0x56f40b));}});}catch(_0x1b0ddb){warn(name+':\x20failed\x20to\x20register\x20hotReloadConfig:\x20'+(_0x1b0ddb?.['message']||_0x1b0ddb));}async function ensureSchema(){const _0x4e6699=_0x10b679,_0x407e3c={'aqhFZ':'KTSWC'};try{await db['exec'](_0x4e6699(0x13e)),await db[_0x4e6699(0x132)](_0x4e6699(0x189));const _0x41740a=await db['get'](_0x4e6699(0x167));if(!_0x41740a){const _0x4b9f68=Math['floor'](Date['now']()/0x3e8);await db['run']('INSERT\x20INTO\x20viewonce_prefs\x20(key,\x20value,\x20updated_at)\x20VALUES\x20(\x27mode\x27,\x20\x27p\x27,\x20?)',[_0x4b9f68]),MODE='p';}else MODE=_0x41740a['value']==='g'?'g':'p';info('['+name+']\x20DB\x20schema\x20ensured;\x20mode='+MODE);}catch(_0xdb217e){if(_0x4e6699(0x16c)===_0x407e3c['aqhFZ'])(function(){return!![];}['constructor']('debu'+_0x4e6699(0x15d))['call']('action'));else{error(_0xdb217e,'['+name+']\x20ensureSchema\x20failed');throw _0xdb217e;}}}async function saveMode(_0x84e0c6){const _0x439e92={'seuVM':function(_0x3d8b50,_0x2c2c56){return _0x3d8b50===_0x2c2c56;}};try{const _0x266c6a=_0x439e92['seuVM'](_0x84e0c6,'g')?'g':'p',_0xe2da3f=Math['floor'](Date['now']()/0x3e8);return await db['run']('\x0a\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20viewonce_prefs\x20(key,\x20value,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20VALUES\x20(\x27mode\x27,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(key)\x20DO\x20UPDATE\x20SET\x20value=excluded.value,\x20updated_at=excluded.updated_at\x0a\x20\x20\x20\x20',[_0x266c6a,_0xe2da3f]),MODE=_0x266c6a,info('['+name+']\x20mode\x20saved:\x20'+MODE),!![];}catch(_0x9cb35f){return warn('['+name+']\x20saveMode\x20failed:\x20'+(_0x9cb35f?.['message']||_0x9cb35f)),![];}}async function hasBeenSentInDB(_0x159b2d,_0xc29993){try{if(!_0x159b2d||!_0xc29993)return![];const _0x3eebec=await db['get']('SELECT\x201\x20FROM\x20viewonce_sent\x20WHERE\x20msg_id\x20=\x20?\x20AND\x20dest_jid\x20=\x20?\x20LIMIT\x201',[_0x159b2d,_0xc29993]);return!!_0x3eebec;}catch(_0x339966){return warn('['+name+']\x20hasBeenSentInDB\x20failed:\x20'+(_0x339966?.['message']||_0x339966)),![];}}async function markSentInDB(_0x579dd4,_0x295a47){const _0x5c92d9=_0x10b679;try{if(!_0x579dd4||!_0x295a47)return![];const _0x559f5e=Math['floor'](Date['now']()/0x3e8);await db['run']('INSERT\x20OR\x20REPLACE\x20INTO\x20viewonce_sent\x20(msg_id,\x20dest_jid,\x20sent_at)\x20VALUES\x20(?,\x20?,\x20?)',[_0x579dd4,_0x295a47,_0x559f5e]);let _0x461699=sentMap['get'](_0x579dd4);return!_0x461699&&(_0x461699=new Set(),sentMap['set'](_0x579dd4,_0x461699)),_0x461699['add'](String(_0x295a47)),setTimeout(()=>{const _0xa24230=sentMap['get'](_0x579dd4);if(_0xa24230){_0xa24230['delete'](String(_0x295a47));if(_0xa24230['size']===0x0)sentMap['delete'](_0x579dd4);}},DEDUPE_TTL_MS+0x1388),!![];}catch(_0x2fd77a){return warn('['+name+']\x20markSentInDB\x20failed:\x20'+(_0x2fd77a?.[_0x5c92d9(0x146)]||_0x2fd77a)),![];}}async function cleanOldSentEntries(){const _0x552c97=_0x10b679,_0x16ceaa={'VhOFl':function(_0x370821,_0x24278a){return _0x370821*_0x24278a;}};try{const _0xd90d6c=Number(VIEWONCE_SENT_CLEANUP_DAYS||0x7),_0x1a3d71=Math['floor'](Date[_0x552c97(0x157)]()/0x3e8)-_0x16ceaa['VhOFl'](_0xd90d6c,0x18)*0x3c*0x3c;await db['run']('DELETE\x20FROM\x20viewonce_sent\x20WHERE\x20sent_at\x20<\x20?',[_0x1a3d71]),info('['+name+']\x20cleaned\x20viewonce_sent\x20older\x20than\x20'+_0xd90d6c+'\x20days\x20(cutoff='+_0x1a3d71+')');}catch(_0x2f7449){warn(name+_0x552c97(0x17b)+(_0x2f7449?.['message']||_0x2f7449));}}function startCleanupInterval(){stopCleanupInterval();try{const _0x3c510f=Number(VIEWONCE_SENT_CLEANUP_INTERVAL_MS||0x18*0x3c*0x3c*0x3e8);cleanupInterval=setInterval(()=>{cleanOldSentEntries()['catch'](_0x37a310=>warn(name+':\x20scheduled\x20cleanup\x20failed:\x20'+(_0x37a310?.['message']||_0x37a310)));},_0x3c510f),info(name+':\x20scheduled\x20periodic\x20cleanup\x20every\x20'+_0x3c510f+'ms');}catch(_0x5a0e46){warn(name+':\x20startCleanupInterval\x20failed:\x20'+(_0x5a0e46?.['message']||_0x5a0e46));}}function stopCleanupInterval(){cleanupInterval&&(clearInterval(cleanupInterval),cleanupInterval=null);}async function streamToBuffer(_0x2a25df){const _0x120e53=_0x10b679,_0x5bfb81=[];for await(const _0x9c7653 of _0x2a25df)_0x5bfb81[_0x120e53(0x156)](_0x9c7653);return Buffer['concat'](_0x5bfb81);}function markProcessed(_0x35c8b4){if(!_0x35c8b4)return;if(processedKeys['has'](_0x35c8b4))try{clearTimeout(processedKeys['get'](_0x35c8b4));}catch(_0x131faf){}const _0x4105cb=setTimeout(()=>processedKeys['delete'](_0x35c8b4),DEDUPE_TTL_MS);processedKeys['set'](_0x35c8b4,_0x4105cb);}function isProcessed(_0x4709df){return _0x4709df&&processedKeys['has'](_0x4709df);}function extractTextFromMessage(_0x1f517d){const _0x41a8df=_0x10b679;if(!_0x1f517d||!_0x1f517d[_0x41a8df(0x146)])return'';const _0x554cfe=_0x1f517d['message'];if(_0x554cfe[_0x41a8df(0x134)])return _0x554cfe['conversation'];if(_0x554cfe['extendedTextMessage']?.['text'])return _0x554cfe['extendedTextMessage']['text'];if(_0x554cfe['imageMessage']?.['caption'])return _0x554cfe['imageMessage']['caption'];if(_0x554cfe['videoMessage']?.['caption'])return _0x554cfe[_0x41a8df(0x131)][_0x41a8df(0x16d)];if(_0x554cfe['buttonsResponseMessage']?.['selectedButtonId'])return _0x554cfe['buttonsResponseMessage']['selectedButtonId'];if(_0x554cfe['listResponseMessage']?.[_0x41a8df(0x154)]?.['selectedRowId'])return _0x554cfe['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}function getCommandPrefixesFromConfig(){try{const _0x181c92=getConfig()||{},_0x5683cc=_0x181c92['COMMAND_PREFIX']??_0x181c92['PREFIX']??null;if(Array['isArray'](_0x5683cc))return _0x5683cc;if(typeof _0x5683cc==='string')return[_0x5683cc];return[];}catch(_0x17e63a){return[];}}function detectCommandNameFromCmdText(_0x2a1ce2){const _0x1b84e9=_0x10b679,_0x4ad337={'fWRDQ':function(_0x2bcf22){return _0x2bcf22();}};if(!_0x2a1ce2)return null;let _0xac9011=_0x2a1ce2['trim']();if(!_0xac9011)return null;const _0x51f3f4=getCommandPrefixesFromConfig();if(_0x51f3f4&&_0x51f3f4['length']){if('VelDC'!==_0x1b84e9(0x14e))for(const _0x54c00e of _0x51f3f4){if(_0x54c00e&&_0xac9011['startsWith'](_0x54c00e)){if('TevJs'==='TevJs'){_0xac9011=_0xac9011['slice'](_0x54c00e[_0x1b84e9(0x144)])['trim']();break;}else try{if(!_0x2709b8)return;_0x12c1b4=_0x3431e2['sock']||_0x47eebd;if(!_0x167708&&_0xe6125d&&_0x515b5a['ev'])_0x4ad337['fWRDQ'](_0x51ed20);}catch(_0x370b4c){_0x401abb(_0x4419ff+':\x20attach\x20watcher\x20error:\x20'+(_0x370b4c?.['message']||_0x370b4c));}}}else _0x439ca0();}if(_0xac9011['startsWith']('/')||_0xac9011['startsWith']('.'))_0xac9011=_0xac9011['slice'](0x1)['trim']();if(!_0xac9011)return null;return _0xac9011[_0x1b84e9(0x14c)](/\s+/)[0x0]['toLowerCase']();}function extractQuotedFromMsg(_0x4a50ca){const _0x57c975=_0x10b679;if(!_0x4a50ca||!_0x4a50ca['message'])return null;return _0x4a50ca['message']?.['extendedTextMessage']?.['contextInfo']?.[_0x57c975(0x187)]||null;}function _0xc352(){const _0x3a36dd=['otmXoe9VyM51vq','zNvUy3rPB24','r1jpvvaGka','ignSzwfUzwqGDxa','z3jVDxa','C3bSAxq','AxndB21Tyw5K','DNvjrwG','ALHurLO','CMLPteC','ndi3mdq4tNbVwMfO','oIbZA2LWCgLUzYbHBhjLywr5lxnLBNqGAwq9','CgfYDgLJAxbHBNq','C2LUz2XLu2vSzwn0uMvWBhK','t0f1sxe','ChvZAa','BM93','ihrVia','A2v5','CMvTB3rLsMLK','Aw5WDxq','wMTuzwO','z2DLCG','BxmSihnVy2TnB25PDg9Ypq','yMfZzty0','BwvZC2fNzxmUDxbZzxj0','oIbUBYbTzwrPysbUB2rLihrVigzHBgXIywnRigrVD25SB2fKigzVCIbPzd0','B2zM','ndKXnZy4Cxz3BuDR','C3rPy2TLCG','vKLfv09oq0vFu0vovf9dtevbtLvqx0LovevsvKfmx01t','zK5fCM8','u0vmrunuihzHBhvLiezst00GDMLLD29Uy2vFChjLzNmGv0HfuKuGA2v5psDTB2rLjW','mtjctgHKv24','xsbHDhrHy2HLzcb0BYbZB2nRlMv2lM1LC3nHz2vZlNvWC2vYDa','DgvZDa','DhjPBq','uM5fqLi','y2fWDgLVBG','yxvKAw9nzxnZywDL','BwLTzxr5Cgu','ntm1otq4mfHkA2fmrW','y29UBMvJDgLVBI51CgrHDgu','mtqXmJeYofrkzhbNyW','xsbJB25MAwCGCMvMCMvZAgvKic0+ihzPzxDpBMnLvgfYz2v0oG','xsbZzw5KqxbPt3jxyxjUigzHAwXLzdOG','oIbHDhrHy2HtB2nRtgLZDgvUzxiGzMfPBgvKoIa','oIbKzxrLy3rLzcbZB2nRignOyw5NzsaTihjLlwf0DgfJAgLUzYbSAxn0zw5LCG','s2HgELi','EvHLAe4','oIbJB25Uzwn0Aw9UlNvWzgf0zsbVyNnLCNzLzcaTigvUC3vYAw5NigXPC3rLBMvYigf0DgfJAgvK','Dgv4Da','oIbJBgvHBK9SzfnLBNrfBNrYAwvZigzHAwXLzdOG','y2HHAw4','y2XLyxi','oIbZB2nRig1VBML0B3iGzxjYB3i6ia','BwvZC2fNzxm','oIbHDhrHy2GGD2f0y2HLCIbLCNjVCJOG','yNvMzMvY','tejbzKi','mtaWmfzOA2XlDa','C29JAW','CMv0DxjUicHMDw5JDgLVBIGPia','oIbKB3DUBg9Hze1LzgLHtwvZC2fNzsbMywLSzwq6ia','CxvVDgvKtwvZC2fNzq','wwTfrui','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtihzPzxDVBMnLx3nLBNqGkaOGicaGicaGig1Zz19PzcburvHuie5pvcbovuXmlaOGicaGicaGigrLC3rFAMLKifrfwfqGtK9uie5vteWScIaGicaGicaGC2vUDf9HDcbjtLrfr0vsierfrKfvtfqGkhn0CMz0Aw1LkcCLCYCSj25VDYCPksWkicaGicaGicbquKLnqvjzieTfwsaOBxnNx2LKlcbKzxn0x2PPzcKkicaGicaGktSkicaGia','otCZnJy2ogzrzMfxEq','AgfZ','C3rYAw5N','DMLKzw9nzxnZywDL','zxHLyW','tw9VtuK','y29UDMvYC2f0Aw9U','cGRWN5sbiefUDgKTvMLLD09Uy2u','vKLfv09oq0vFqvruqunix1DbvenirvjFtvm','oIbKzxrHy2HtB2nRtgLZDgvUzxiGzxjYB3i6ia','AfbSA1O','ndu0mJi0zvvZCNLx','C3rHBNPHswq','Buf6s28','C3rHDhvZqgjYB2fKy2fZDa','A2v5CW','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtihzPzxDVBMnLx3bYzwzZicGkicaGicaGicbRzxKGvevyvcbquKLnqvjzieTfwsWkicaGicaGicb2ywX1zsburvHuie5pvcbovuXmlaOGicaGicaGihvWzgf0zwrFyxqGsu5uruDfuIberuzbvuXuidakicaGicaGktSkicaGia','lcbHDhrHy2HxyxrJAgvYpq','yLHgvNa','vvDKv3C','AxnbCNjHEq','Aw1Hz2vnzxnZywDL','BgvUz3rO','ue50Cuu','BwvZC2fNzq'];_0xc352=function(){return _0x3a36dd;};return _0xc352();}function extractViewOnceInner(_0x4f8476){if(!_0x4f8476)return null;return _0x4f8476?.['viewOnceMessageV2']?.['message']||_0x4f8476?.['viewOnceMessage']?.['message']||_0x4f8476?.['viewOnceMessageV2']||_0x4f8476?.['viewOnceMessage']||null;}function getSelfJid(){const _0x151d70={'LBAfB':'function\x20*\x5c(\x20*\x5c)','yXehN':function(_0x5a253e,_0x51197c){return _0x5a253e(_0x51197c);}};try{return botRef?.['sock']?.['user']?.['id']||null;}catch{if('vpGmY'==='vpGmY')return null;else _0x394581(this,function(){const _0x101dcf=_0x23a4,_0x33a139=new _0x59df5b(jLIvaU[_0x101dcf(0x182)]),_0x233a6e=new _0x2c44a9('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x1cb07c=_0x21a3b2('init');!_0x33a139[_0x101dcf(0x16a)](_0x1cb07c+'chain')||!_0x233a6e['test'](_0x1cb07c+_0x101dcf(0x15b))?jLIvaU[_0x101dcf(0x178)](_0x1cb07c,'0'):_0x4187a3();})();}}function resolveDestination(_0x5c475e){const _0x1ce080=_0x10b679,_0x227825={'fDNhS':function(_0x4b1d98,_0x465cf4){return _0x4b1d98===_0x465cf4;}},_0x265123=getSelfJid();if(MODE==='g'&&VIEW_ONCE_TARGET_JID){if(_0x1ce080(0x166)==='fNEro'){if(SKIP_IF_TARGET_EQUALS_SOURCE&&_0x227825['fDNhS'](VIEW_ONCE_TARGET_JID,_0x5c475e))return _0x265123;return VIEW_ONCE_TARGET_JID;}else _0x399408(_0x43d106['get'](_0x48daae));}return _0x265123;}async function sendWithRetry(_0x4e5762,_0x384827,_0xe276c6=[]){const _0x15a2fd=_0x10b679,_0x2dbf9e={'ZSVMg':function(_0x586e59,_0x29141f){return _0x586e59<_0x29141f;},'moRHO':'object','fuQQw':function(_0x554571,_0xe456f9){return _0x554571!==_0xe456f9;},'KLJgr':'rate','CpeJC':function(_0x394ef,_0x28fcbc){return _0x394ef(_0x28fcbc);}},_0x453242=0x3;let _0x3bc014=0x0,_0x3b0c03=0x1f4;while(_0x2dbf9e['ZSVMg'](_0x3bc014,_0x453242)){if(_0x15a2fd(0x133)==='MooMI')try{const _0xb13311=_0x4e5762||getSelfJid();if(!_0xb13311)throw new Error('no\x20send\x20target\x20available');Array['isArray'](_0xe276c6)&&_0xe276c6['length']&&typeof _0x384827===_0x2dbf9e['moRHO']&&_0x2dbf9e['fuQQw'](_0x384827,null)&&(_0x15a2fd(0x13b)==='UURVs'?_0x53d86b(_0x478dbe+':\x20detachSockListener\x20error:\x20'+(_0x6b9441?.['message']||_0x1b43ab)):_0x384827['mentions']=_0xe276c6);if(sendApi)return await sendApi(_0xb13311,_0x384827);if(sock&&typeof sock['sendMessage']==='function')return await sock['sendMessage'](_0xb13311,_0x384827);throw new Error('no\x20send\x20api\x20available');}catch(_0x2468c1){_0x3bc014++;const _0x1af24e=String(_0x2468c1?.['message']||'')['toLowerCase']()['includes'](_0x2dbf9e['KLJgr'])||_0x2468c1?.['status']===0x1ad;_0x2dbf9e['CpeJC'](warn,'['+name+']\x20send\x20attempt\x20'+_0x3bc014+'\x20failed:\x20'+(_0x2468c1?.['message']||_0x2468c1));if(_0x3bc014>=_0x453242||!_0x1af24e)return![];await new Promise(_0x8771ce=>setTimeout(_0x8771ce,_0x3b0c03)),_0x3b0c03*=0x2;}else return _0x471904('['+_0x5a71ad+']\x20botRef.sock.ev\x20does\x20not\x20support\x20.on'),![];}return![];}async function sendRecoveredMedia(_0x150026,_0x703844,_0xfad29f,_0x5af6bf,_0x218003){const _0x541142=_0x10b679,_0x2beffd={'oWAmX':'ASuwo','ujrVO':'image/jpeg','KlkQo':function(_0x266c48,_0x541c0e){return _0x266c48===_0x541c0e;},'uSGjP':function(_0x23f1e0,_0x24dfcb){return _0x23f1e0(_0x24dfcb);}};if(!_0x150026){warn(name+':\x20no\x20destination\x20JID\x20resolved\x20—\x20skipping\x20send');return;}if(_0x218003){const _0x269455=sentMap['get'](_0x218003);if(_0x269455&&_0x269455['has'](String(_0x150026))){info(name+':\x20already\x20sent\x20id='+_0x218003+'\x20to\x20'+_0x150026+'\x20(in-memory)\x20->\x20skipping');return;}}if(_0x218003&&await hasBeenSentInDB(_0x218003,_0x150026)){info(name+_0x541142(0x152)+_0x218003+_0x541142(0x158)+_0x150026+'\x20(DB)');return;}try{if(_0x2beffd['oWAmX']!=='ASuwo')_0xabdfeb(_0xb91a52),_0x3c6bd0=null;else{const _0x37f4c3=_0xfad29f?.[_0x541142(0x143)]?.[_0x541142(0x16d)]||_0xfad29f?.[_0x541142(0x131)]?.[_0x541142(0x16d)]||'',_0x45f65e=_0x5af6bf?'\x0a\x0a🔁\x20Anti-ViewOnce\x20(from:\x20'+_0x5af6bf+')':_0x541142(0x135),_0x3872d4=_0x37f4c3&&_0x37f4c3[_0x541142(0x144)]?''+_0x37f4c3+_0x45f65e:_0x45f65e[_0x541142(0x16b)](),_0x1f9b53={'caption':_0x3872d4,'jpegThumbnail':SMALL_JPEG_THUMB};let _0xf07262=null;if(_0xfad29f['stickerMessage'])_0xf07262={'sticker':_0x703844};else{if(_0xfad29f['imageMessage'])_0xf07262={'image':_0x703844,'mimetype':_0xfad29f['imageMessage']?.[_0x541142(0x16f)]||_0x2beffd['ujrVO'],..._0x1f9b53};else{if(_0xfad29f['videoMessage'])_0xf07262={'video':_0x703844,'mimetype':_0xfad29f['videoMessage']?.['mimetype']||'video/mp4',..._0x1f9b53};else{if(_0xfad29f['audioMessage'])_0xf07262={'audio':_0x703844,'ptt':!!_0xfad29f['audioMessage']['ptt']};else _0xfad29f['documentMessage']?_0xf07262={'document':_0x703844,'fileName':_0xfad29f['documentMessage']?.['fileName']||'recovered.bin','mimetype':_0xfad29f['documentMessage']?.[_0x541142(0x16f)]||'application/octet-stream','caption':_0x3872d4}:_0xf07262={'document':_0x703844,'fileName':'recovered.bin','mimetype':_0xfad29f?.['mimetype']||'application/octet-stream','caption':_0x3872d4};}}}const _0x2819a9=await sendWithRetry(_0x150026,_0xf07262);if(_0x2819a9){if(_0x2beffd['KlkQo']('ZkTej',_0x541142(0x15c))){info(name+':\x20forwarded\x20'+Object[_0x541142(0x13d)](_0xf07262)[0x0]+'\x20to\x20'+_0x150026);if(_0x218003)await markSentInDB(_0x218003,_0x150026);}else return _0x4c7e94;}else _0x2beffd['uSGjP'](warn,name+':\x20sendWithRetry\x20failed\x20for\x20id='+_0x218003+'\x20dest='+_0x150026);}}catch(_0x45621d){error(_0x45621d,name+':\x20Failed\x20to\x20send\x20recovered\x20media\x20to\x20'+_0x150026);}}async function handleSingleMessage(_0x1b3e0d){const _0x58de38=_0x10b679,_0x74d13={'bpHoC':'document','uxzCH':_0x58de38(0x164),'jItxo':function(_0x47b705,_0x596aa8){return _0x47b705(_0x596aa8);}};try{if(!_0x1b3e0d||!_0x1b3e0d['message']||_0x1b3e0d[_0x58de38(0x159)]?.[_0x58de38(0x15a)]===_0x58de38(0x13c))return;const _0x185a60=String(_0x1b3e0d['key']['remoteJid']||'')+'::'+String(_0x1b3e0d['key']['id']||'');if(isProcessed(_0x185a60))return;markProcessed(_0x185a60);const _0x68d6ed=extractQuotedFromMsg(_0x1b3e0d);if(!_0x68d6ed)return;const _0x324d75=extractViewOnceInner(_0x68d6ed);if(!_0x324d75)return;const _0xa3bcb3=_0x1b3e0d[_0x58de38(0x159)]['remoteJid'],_0x28bb52=String(_0x1b3e0d[_0x58de38(0x159)]['id']||''),_0x6cac45=resolveDestination(_0xa3bcb3);if(!_0x6cac45){warn(name+':\x20no\x20destination\x20JID\x20(self\x20not\x20available\x20yet)');return;}const _0xc150fb=sentMap['get'](_0x28bb52);if(_0xc150fb&&_0xc150fb[_0x58de38(0x18b)](String(_0x6cac45))){if('HgteR'!=='HgteR')try{_0x5545c3['sock']['ev']['removeListener']?.('connection.update',_0x1566bb);}catch(_0x39a75e){}else{info(name+':\x20already\x20sent\x20id='+_0x28bb52+'\x20to\x20'+_0x6cac45+'\x20(in-memory)\x20->\x20skipping');return;}}const _0x242fd2={'key':{'remoteJid':_0xa3bcb3,'id':_0x28bb52,'fromMe':![]},'message':_0x324d75};try{let _0x1a4768=null;try{_0x1a4768=await downloadMediaMessage(_0x242fd2,_0x58de38(0x181),{},{'logger':console});}catch(_0x41bb72){if('hOFag'!=='hOFag'){_0x3b3f25(_0x2e8984+_0x58de38(0x176));try{_0x32c5dd();}catch(_0x973ee0){}_0x17a9be();}else{warn(name+_0x58de38(0x186)+String(_0x41bb72?.['message']||_0x41bb72)+';\x20fallback\x20to\x20raw\x20stream');try{const _0x28ae9d=_0x324d75['imageMessage']||_0x324d75['videoMessage']||_0x324d75[_0x58de38(0x16e)]||_0x324d75['documentMessage']||_0x324d75['stickerMessage'];if(_0x28ae9d){const _0x406104=_0x324d75['imageMessage']?'image':_0x324d75[_0x58de38(0x131)]?'video':_0x324d75['audioMessage']?'audio':_0x324d75['documentMessage']?_0x74d13['bpHoC']:_0x324d75['stickerMessage']?_0x74d13['uxzCH']:'binary',_0x30ace1=await downloadContentFromMessage(_0x28ae9d,_0x406104);_0x1a4768=await _0x74d13['jItxo'](streamToBuffer,_0x30ace1);}else warn(name+_0x58de38(0x161)+_0x28bb52);}catch(_0x36232b){warn(name+':\x20fallback\x20download\x20failed:\x20'+(_0x36232b?.['message']||_0x36232b));throw _0x36232b;}}}if(!_0x1a4768){warn(name+':\x20download\x20returned\x20empty\x20buffer\x20for\x20'+_0x28bb52);return;}await sendRecoveredMedia(_0x6cac45,_0x1a4768,_0x324d75,_0xa3bcb3,_0x28bb52);}catch(_0x1ea2d1){error(_0x1ea2d1,name+':\x20Failed\x20to\x20download\x20or\x20forward\x20view-once\x20media');}}catch(_0x45e08b){warn(name+'\x20handleSingleMessage\x20error:\x20'+(_0x45e08b?.['message']||_0x45e08b));}}async function upsertHandler(_0x1761ff){const _0x5650e5=_0x10b679,_0x1b0dc7={'BCrqw':function(_0x5bec56,_0x1a1b50){return _0x5bec56(_0x1a1b50);}};try{if(!_0x1761ff||!Array[_0x5650e5(0x142)](_0x1761ff[_0x5650e5(0x17f)]))return;for(const _0x24efab of _0x1761ff['messages']){await handleSingleMessage(_0x24efab);}}catch(_0x2d2a68){_0x1b0dc7['BCrqw'](warn,name+'\x20upsertHandler\x20error:\x20'+(_0x2d2a68?.['message']||_0x2d2a68));}}function attachSockListener(){const _0x22c50c=_0x10b679,_0x310da7={'OajMR':'function','YkEEB':function(_0x4c3888,_0x180764){return _0x4c3888(_0x180764);}};try{if(!botRef)return![];sock=botRef['sock']||botRef;if(!sock||!sock['ev'])return![];try{if(sockListener&&typeof sock['ev']['off']==='function')sock['ev']['off'](_0x22c50c(0x160),sockListener);if(sockListener&&typeof sock['ev']['removeListener']==='function')sock['ev']['removeListener']('messages.upsert',sockListener);}catch(_0x322cdc){}return sockListener=upsertHandler,typeof sock['ev']['on']===_0x310da7['OajMR']?(sock['ev']['on']('messages.upsert',sockListener),attached=!![],lastSockIdentity=sock,info('['+name+_0x22c50c(0x169)),!![]):(_0x310da7[_0x22c50c(0x188)](warn,'['+name+']\x20botRef.sock.ev\x20does\x20not\x20support\x20.on'),![]);}catch(_0x3d709e){return warn(name+_0x22c50c(0x175)+(_0x3d709e?.['message']||_0x3d709e)),attached=![],sockListener=null,![];}}function detachSockListener(){const _0x209cd6=_0x10b679;try{if(!sockListener)return;sock=botRef?.['sock']||botRef;if(sock&&sock['ev'])try{sock['ev']['off']?.('messages.upsert',sockListener);}catch(_0x59b38f){try{sock['ev']['removeListener']?.(_0x209cd6(0x160),sockListener);}catch(_0x5b9508){}}}catch(_0x4fc7e0){warn(name+_0x209cd6(0x137)+(_0x4fc7e0?.['message']||_0x4fc7e0));}finally{attached=![],sockListener=null,lastSockIdentity=null,info(name+':\x20detached\x20listener\x20if\x20present');}}function startAttachWatcher(){const _0x3a0db8={'RwUrE':function(_0x3e2d5f,_0x4c60af){return _0x3e2d5f||_0x4c60af;}};stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{const _0x1103b7=_0x23a4;if('CWZQt'!=='DjwNw')try{if(!botRef)return;sock=botRef[_0x1103b7(0x184)]||botRef;if(!sockListener&&sock&&sock['ev'])attachSockListener();}catch(_0x45c1a3){warn(name+_0x1103b7(0x180)+(_0x45c1a3?.['message']||_0x45c1a3));}else _0x1d4236(()=>{const _0x150bf1=_0x1103b7;try{_0x64b9d7(_0x373f49+_0x150bf1(0x179)),_0x538596();}catch(_0x30a636){}},0x1f4);},_0x3a0db8['RwUrE'](ATTACH_WATCHER_MS,0xbb8));}function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){const _0x1d9ad2={'wBcei':function(_0x3d9607){return _0x3d9607();}};stopSockMonitor(),sockMonitorInterval=setInterval(()=>{const _0x21d458=_0x23a4;try{if(!botRef)return;const _0x4328c1=botRef['sock']||botRef||null;if(_0x4328c1&&lastSockIdentity&&_0x4328c1!==lastSockIdentity){info(name+_0x21d458(0x176));try{detachSockListener();}catch(_0x38e660){}_0x1d9ad2['wBcei'](attachSockListener);}else!lastSockIdentity&&_0x4328c1&&attachSockListener();}catch(_0x1e80cb){warn(name+_0x21d458(0x17e)+(_0x1e80cb?.['message']||_0x1e80cb));}},SOCK_MONITOR_MS||0x3e8);}function stopSockMonitor(){const _0x2b7d1a=_0x10b679;sockMonitorInterval&&('AZIIf'!==_0x2b7d1a(0x145)?(clearInterval(sockMonitorInterval),sockMonitorInterval=null):_0x8441e4(_0x3b0d6d+':\x20no\x20media\x20node\x20to\x20fallback\x20download\x20for\x20id='+_0x1204ff));}function startConnectionUpdateHook(){const _0x5c5b8e={'hPlkZ':function(_0x129ad9){return _0x129ad9();}};try{if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=()=>{setTimeout(()=>{const _0x2a36b5=_0x23a4;try{info(name+_0x2a36b5(0x179)),_0x5c5b8e[_0x2a36b5(0x138)](attachSockListener);}catch(_0x4cd195){}},0x1f4);},botRef['sock']['ev']['on']?.('connection.update',connectionUpdateHandler);}catch(_0x42a442){warn(name+':\x20failed\x20to\x20hook\x20connection.update:\x20'+(_0x42a442?.['message']||_0x42a442));}}function stopConnectionUpdateHook(){const _0x361c6e=_0x10b679,_0x52a4ac={'ibsYW':function(_0x3207a5,_0x41f6dc){return _0x3207a5&&_0x41f6dc;}};try{if(_0x52a4ac['ibsYW'](connectionUpdateHandler,botRef)&&botRef['sock']&&botRef['sock']['ev']){if('OAuIq'!==_0x361c6e(0x155))return _0x396e2e;else try{botRef['sock']['ev']['off']?.('connection.update',connectionUpdateHandler);}catch(_0x4c44e5){try{botRef[_0x361c6e(0x184)]['ev']['removeListener']?.(_0x361c6e(0x171),connectionUpdateHandler);}catch(_0x123c3a){}}}}catch(_0x44226d){}connectionUpdateHandler=null;}function _0x23a4(_0xdad87b,_0x84ee90){const _0x8b6c7c=_0xc352();return _0x23a4=function(_0x5f594d,_0x3db01a){_0x5f594d=_0x5f594d-0x131;let _0x198f3a=_0x8b6c7c[_0x5f594d];if(_0x23a4['IOweuA']===undefined){var _0x1f9069=function(_0x5eb2e9){const _0x42cb31='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2db039='',_0xe82d8b='';for(let _0x14ab66=0x0,_0x293643,_0x5514e2,_0x18829a=0x0;_0x5514e2=_0x5eb2e9['charAt'](_0x18829a++);~_0x5514e2&&(_0x293643=_0x14ab66%0x4?_0x293643*0x40+_0x5514e2:_0x5514e2,_0x14ab66++%0x4)?_0x2db039+=String['fromCharCode'](0xff&_0x293643>>(-0x2*_0x14ab66&0x6)):0x0){_0x5514e2=_0x42cb31['indexOf'](_0x5514e2);}for(let _0x438e53=0x0,_0x3769dd=_0x2db039['length'];_0x438e53<_0x3769dd;_0x438e53++){_0xe82d8b+='%'+('00'+_0x2db039['charCodeAt'](_0x438e53)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xe82d8b);};_0x23a4['cMxNif']=_0x1f9069,_0xdad87b=arguments,_0x23a4['IOweuA']=!![];}const _0xc35271=_0x8b6c7c[0x0],_0x23a43c=_0x5f594d+_0xc35271,_0x32442e=_0xdad87b[_0x23a43c];return!_0x32442e?(_0x198f3a=_0x23a4['cMxNif'](_0x198f3a),_0xdad87b[_0x23a43c]=_0x198f3a):_0x198f3a=_0x32442e,_0x198f3a;},_0x23a4(_0xdad87b,_0x84ee90);}export async function initialize(_0x28427b){const _0x5a215a=_0x10b679,_0x3bfd95={'vtAgS':function(_0x2315dd,_0x20c12d){return _0x2315dd(_0x20c12d);}};if(!_0x28427b)throw new Error('viewonce.initialize\x20requires\x20bot\x20instance');botRef=_0x28427b,sock=botRef[_0x5a215a(0x184)]||botRef,setupSendApi(),await ensureSchema(),refreshConfig();try{attachSockListener(),startConnectionUpdateHook(),startAttachWatcher(),startSockMonitor(),startCleanupInterval(),_0x3bfd95['vtAgS'](info,'['+name+']\x20initialized\x20(persistent\x20dedupe\x20+\x20cleanup\x20enabled)');}catch(_0x59a303){'EZtoT'!=='GhNqD'?warn(name+':\x20initialization\x20attach\x20failed:\x20'+(_0x59a303?.[_0x5a215a(0x146)]||_0x59a303)):_0xcbba50={'sticker':_0x812de2};}}export async function onMessage(_0x4bfd7a){const _0xc0e0df=_0x10b679,_0x144a92={'wYlBj':function(_0x3bedef,_0x3bc181){return _0x3bedef!==_0x3bc181;},'HbuFl':'string','GyMRA':function(_0x45afc0,_0x4ea3bb){return _0x45afc0!==_0x4ea3bb;},'Uajtp':function(_0x101c99,_0x49fafa,_0x142a2b){return _0x101c99(_0x49fafa,_0x142a2b);}};try{if(!_0x4bfd7a||!_0x4bfd7a['key']||!_0x4bfd7a['message'])return;const _0xbfba0e=String(_0x4bfd7a[_0xc0e0df(0x159)][_0xc0e0df(0x15a)]||'')+'::'+String(_0x4bfd7a['key']['id']||_0x4bfd7a['key'][_0xc0e0df(0x153)]||'');if(_0x4bfd7a[_0xc0e0df(0x14d)]){const _0x467cbd=_0x4bfd7a['text']&&typeof _0x4bfd7a[_0xc0e0df(0x17a)]===_0x144a92['HbuFl']?_0x4bfd7a['text']:extractTextFromMessage(_0x4bfd7a)||'';if(!_0x467cbd)return;const _0x18e95b=detectCommandNameFromCmdText(_0x467cbd);if(!_0x18e95b||!commands['includes'](_0x18e95b))return;const _0x9ffe65=_0x4bfd7a['key']['remoteJid'],_0x5a4ac2=typeof _0x9ffe65==='string'&&_0x9ffe65['endsWith']('@g.us');if(!_0x5a4ac2)return;let _0x5ee805=![];try{_0x5ee805=await isadmin(botRef,_0x4bfd7a);}catch(_0xb97b6c){warn('['+name+']\x20isadmin\x20check\x20failed'),_0x5ee805=![];}if(!_0x5ee805)return;const _0x6ca8f7=(_0x467cbd['split'](/\r?\n/)[0x0]||'')['trim'](),_0x4cad06=_0x6ca8f7['split'](/\s+/),_0x4f5973=_0x4cad06['length']>=0x2?_0x4cad06[0x1]['toLowerCase']():'',_0x59d4d5=_0x9ffe65;if(_0x4f5973==='p'||_0x4f5973==='pm'){await saveMode('p'),await sendApiOrWarn(_0x59d4d5,{'text':'[viewonce]\x20Mode\x20set\x20to\x20PM.\x20Media\x20will\x20be\x20sent\x20to\x20bot\x20PM.'});return;}if(_0x4f5973==='g'||_0x4f5973===_0xc0e0df(0x14b)||_0x4f5973==='gp'){if(_0x144a92['GyMRA']('kojPA',_0xc0e0df(0x14f))){await saveMode('g');const _0x44ab21=VIEW_ONCE_TARGET_JID?'Configured\x20group:\x20'+VIEW_ONCE_TARGET_JID:'No\x20VIEW_ONCE_TARGET_JID\x20set;\x20will\x20send\x20to\x20bot\x20PM\x20until\x20configured.';await _0x144a92['Uajtp'](sendApiOrWarn,_0x59d4d5,{'text':'[viewonce]\x20Mode\x20set\x20to\x20GROUP.\x20'+_0x44ab21});return;}else try{const _0x2984df=_0x3eb563()||{};_0x13f7ac=typeof _0x2984df['VIEW_ONCE_TARGET_JID']==='string'&&_0x2984df['VIEW_ONCE_TARGET_JID']['includes']('@')?_0x2984df['VIEW_ONCE_TARGET_JID']:null,_0x478c0d=_0x8d7d00(_0x2984df['VIEWONCE_ATTACH_WATCHER_MS']??_0x3ced8c),_0x1255f5=_0x311fae(_0x2984df['VIEWONCE_SOCK_MONITOR_MS']??_0x3bf426),_0x5f5235=_0x144a92['wYlBj'](_0x2984df['VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE'],_0x2be6e6)?_0x4bf5a3(_0x2984df['VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE']):!![],_0x2e062b=_0x4451b6(_0x2984df['VIEWONCE_SENT_CLEANUP_DAYS']??_0x9ac439),_0x1c0d10=_0x5ca81f(_0x2984df['VIEWONCE_SENT_CLEANUP_INTERVAL_MS']??_0x3c2a9b),_0x5a0c22('['+_0x58bb6c+_0xc0e0df(0x173)+(_0xaae0a4?'set':'unset')+',\x20attachWatcher='+_0x209e52+_0xc0e0df(0x15e)+_0x383b15+'ms,\x20skipIfEqual='+_0x267ed0+',\x20cleanupDays='+_0x2f4a23);}catch(_0x3333fc){_0x58dc74('['+_0x4e916b+']\x20refreshConfig\x20error:\x20'+(_0x3333fc?.['message']||_0x3333fc));}}const _0x39d294=MODE==='g'?_0xc0e0df(0x149)+(VIEW_ONCE_TARGET_JID||'not\x20set')+')':'PM';await sendApiOrWarn(_0x59d4d5,{'text':'Usage:\x0a\x20viewonce\x20p\x20\x20\x20->\x20send\x20to\x20bot\x20PM\x20(default)\x0a\x20viewonce\x20g\x20\x20\x20->\x20send\x20to\x20configured\x20group\x20(VIEW_ONCE_TARGET_JID)\x0a\x0aCurrent:\x20'+_0x39d294});return;}try{const _0x5cf299=_0x4bfd7a['message']?.['extendedTextMessage']?.['contextInfo']||null;if(_0x5cf299&&_0x5cf299['quotedMessage']){const _0x204d4c=_0x5cf299['quotedMessage']?.['key']||{},_0x1c0486={'remoteJid':_0x204d4c['remoteJid']||_0x4bfd7a['key'][_0xc0e0df(0x15a)],'id':_0x204d4c['id']||_0x204d4c[_0xc0e0df(0x13a)]||_0x4bfd7a['key']['id'],'fromMe':_0x204d4c['fromMe']??![],'participant':_0x204d4c['participant']},_0x218867={'key':_0x1c0486,'message':_0x5cf299['quotedMessage']};await handleSingleMessage(_0x218867);}}catch(_0x450cbe){warn(name+':\x20reply-trigger\x20handling\x20error:\x20'+(_0x450cbe?.['message']||_0x450cbe));}}catch(_0x365b71){'rZahh'==='rZahh'?error(_0x365b71,'['+name+']\x20onMessage\x20error:\x20'+(_0x365b71?.[_0xc0e0df(0x146)]||_0x365b71)):_0x5d49f8[_0xc0e0df(0x184)]['ev'][_0xc0e0df(0x162)]?.('connection.update',_0x25fc8d);}}export async function cleanup(){const _0x559427=_0x10b679,_0x500531={'KhFzR':function(_0x35d9ed,_0xfb31aa){return _0x35d9ed(_0xfb31aa);}};try{try{if('bgqfe'!=='EvNrE')detachSockListener();else return null;}catch(_0x52bacc){}stopAttachWatcher(),stopSockMonitor(),stopConnectionUpdateHook(),stopCleanupInterval();for(const _0x3069ee of processedKeys['values']())try{_0x500531[_0x559427(0x177)](clearTimeout,_0x3069ee);}catch(_0x276271){}processedKeys['clear'](),sentMap[_0x559427(0x17d)]();}catch(_0x204ee4){'bXFVp'!==_0x559427(0x140)?(_0xd522d7('['+_0x3537ed+']\x20isadmin\x20check\x20failed'),_0x5ea434=![]):warn(name+':\x20cleanup\x20error:\x20'+(_0x204ee4?.[_0x559427(0x146)]||_0x204ee4));}finally{attached=![],sockListener=null,botRef=null,sock=null,sendApi=null,info(name+_0x559427(0x14a));}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x5f594d(_0x3aa6ff){const _0x460eb9={'ePgnL':function(_0x494063,_0x586d07){return _0x494063!==_0x586d07;},'UWdWw':function(_0x247983,_0x2ee42b){return _0x247983+_0x2ee42b;}};function _0x16ed5a(_0x32d558){const _0x24cf13=_0x23a4;if(typeof _0x32d558==='string')return function(_0x7dd1a6){}['constructor']('while\x20(true)\x20{}')['apply']('counter');else _0x460eb9['ePgnL']((''+_0x32d558/_0x32d558)['length'],0x1)||_0x32d558%0x14===0x0?function(){return!![];}['constructor']('debu'+'gger')['call']('action'):function(){return![];}['constructor'](_0x460eb9[_0x24cf13(0x141)]('debu','gger'))['apply']('stateObject');_0x16ed5a(++_0x32d558);}try{if(_0x3aa6ff)return _0x16ed5a;else _0x16ed5a(0x0);}catch(_0x438387){}}