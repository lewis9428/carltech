const _0x86304a=_0x3a10;(function(_0x494887,_0x1b7b5e){const _0x1fedd8=_0x3a10,_0x31c933=_0x494887();while(!![]){try{const _0x429ec=parseInt(_0x1fedd8(0x1aa))/0x1+-parseInt(_0x1fedd8(0x1d3))/0x2*(parseInt(_0x1fedd8(0x1b6))/0x3)+-parseInt(_0x1fedd8(0x1e4))/0x4*(-parseInt(_0x1fedd8(0x1c2))/0x5)+-parseInt(_0x1fedd8(0x1c1))/0x6*(-parseInt(_0x1fedd8(0x1be))/0x7)+-parseInt(_0x1fedd8(0x1cd))/0x8+-parseInt(_0x1fedd8(0x1ad))/0x9*(parseInt(_0x1fedd8(0x1b5))/0xa)+-parseInt(_0x1fedd8(0x1ce))/0xb*(parseInt(_0x1fedd8(0x1b9))/0xc);if(_0x429ec===_0x1b7b5e)break;else _0x31c933['push'](_0x31c933['shift']());}catch(_0xa842b8){_0x31c933['push'](_0x31c933['shift']());}}}(_0x31b5,0xdb7af));const _0x176d29=(function(){let _0x3dc7ff=!![];return function(_0x96ecc3,_0x438df0){const _0x15a472=_0x3dc7ff?function(){if(_0x438df0){const _0x5b8517=_0x438df0['apply'](_0x96ecc3,arguments);return _0x438df0=null,_0x5b8517;}}:function(){};return _0x3dc7ff=![],_0x15a472;};}());(function(){const _0x41a21f={'DHaMp':'init'};_0x176d29(this,function(){const _0x37a13c=_0x3a10,_0x4cf931={'vxcec':_0x37a13c(0x1c0)},_0x44ed2b=new RegExp(_0x37a13c(0x1b8)),_0x207c4c=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x826467=_0x561118(_0x41a21f[_0x37a13c(0x1c3)]);!_0x44ed2b[_0x37a13c(0x1ca)](_0x826467+'chain')||!_0x207c4c[_0x37a13c(0x1ca)](_0x826467+_0x37a13c(0x1e6))?'eqGWS'!=='eqGWS'?_0x7eb244={'image':_0x1f6511,'mimetype':_0x45217d['imageMessage']?.['mimetype']||_0x4cf931['vxcec'],..._0x32ddcc}:_0x826467('0'):_0x561118();})();}());import{info,warn,error}from'../utils/logger.js';import{downloadMediaMessage,downloadContentFromMessage}from'@whiskeysockets/baileys';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isadmin}from'../utils/isadmin.js';export const name='viewonce';export const version='3.0.0-rectified';export const priority=0x5f;export const configKeys=['VIEW_ONCE_TARGET_JID',_0x86304a(0x197),_0x86304a(0x1bd),_0x86304a(0x1c7),'VIEWONCE_SENT_CLEANUP_DAYS',_0x86304a(0x1c5)];export const commands=['viewonce'];let botRef=null,sock=null,sendApi=null,attached=![],sockListener=null,connectionUpdateHandler=null,lastSockIdentity=null,attachWatcherInterval=null,sockMonitorInterval=null,cleanupInterval=null;const DEDUPE_TTL_MS=0x1e*0x3e8;(function(){const _0x1be95f={'NxTed':function(_0x112212,_0x35002e){return _0x112212+_0x35002e;}};let _0x14cf16;try{const _0x246269=Function(_0x1be95f['NxTed']('return\x20(function()\x20','{}.constructor(\x22return\x20this\x22)(\x20)')+');');_0x14cf16=_0x246269();}catch(_0x3fceb2){_0x14cf16=window;}_0x14cf16['setInterval'](_0x561118,0x61a80);}());const processedKeys=new Map(),sentMap=new Map();let VIEW_ONCE_TARGET_JID=null,ATTACH_WATCHER_MS=0xbb8,SOCK_MONITOR_MS=0x3e8,SKIP_IF_TARGET_EQUALS_SOURCE=!![],MODE='p',VIEWONCE_SENT_CLEANUP_DAYS=0x7,VIEWONCE_SENT_CLEANUP_INTERVAL_MS=0x18*0x3c*0x3c*0x3e8;function _0x31b5(){const _0x2d6af6=['oIbMywLSzwqGDg8GCMvNAxn0zxiGAg90uMvSB2fKq29UzMLNoIa','CMvTB3zLtgLZDgvUzxi','DgvZDa','AxnbCNjHEq','BwvZC2fNzq','ntG0mZq4ofvUq3nMDW','otaYquDfENvi','C29Tzq','D0TjBgC','CMvJB3zLCMvKlMjPBG','zNjVBu1L','nty4u21XEeXR','BwvZC2fNzxm','DMfSDwvZ','yxvKAw8','CMvTB3rLsMLK','wMPvywi','ignSzwfUzwqGDxa','vKLfv19ptKnfx1rbuKDfvf9ksuq','xsbHDhrHy2HLzcb0BYbZB2nRlMv2lM1LC3nHz2vZlNvWC2vYDa','Dg9mB3DLCKnHC2u','xsbPC2fKBwLUignOzwnRigzHAwXLza','A2v5','C2vUze1LC3nHz2u','ALzIEMq','oIbgywLSzwqGDg8Gzg93BMXVywqGB3iGzM9YD2fYzcb2Awv3lw9Uy2uGBwvKAwe','BM93','Dgv4Da','nfvTDuP5va','zgvSzxrL','Aw5WDxq','BgvUz3rO','EePgu3e','C2vSzwn0zwrcDxr0B25jza','C3rYAw5N','oIbYzxbSEs10CMLNz2vYigHHBMrSAw5NigvYCM9YoIa','BwvZC2fNzxmUDxbZzxj0','BM8GC2vUzcb0yxjNzxqGyxzHAwXHyMXL','oIbJBgvHBK9SzfnLBNrfBNrYAwvZigzHAwXLzdOG','icHPBI1Tzw1VCNKPic0+ihnRAxbWAw5N','igHHBMrSzvnPBMDSzu1LC3nHz2uGzxjYB3i6ia','z2v0','CgfYDgLJAxbHBNq','xsbZzw5KqxbPt3jxyxjUigzHAwXLzdOG','vKLfv09oq0vFqvruqunix1DbvenirvjFtvm','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtihzPzxDVBMnLx3bYzwzZicGkicaGicaGicbRzxKGvevyvcbquKLnqvjzieTfwsWkicaGicaGicb2ywX1zsburvHuie5pvcbovuXmlaOGicaGicaGihvWzgf0zwrFyxqGsu5uruDfuIberuzbvuXuidakicaGicaGktSkicaGia','C3rPy2TLCK1LC3nHz2u','zMXVB3i','zg9JDw1LBNrnzxnZywDL','y29UDMvYC2f0Aw9U','y2fWDgLVBG','vM5QCgG','oIbMywLSzwqGDg8GAg9VAYbJB25Uzwn0Aw9UlNvWzgf0ztOG','ENbltw4','rLnvDMS','oIbHDhrHy2GGD2f0y2HLCIbLCNjVCJOG','yM9JCfG','zgvIDq','ywn0Aw9U','vgDJy0u','ywrK','DhD5DK4','rgjZvw0','mte0odK2m1blCwzxyW','ihvWC2vYDeHHBMrSzxiGzxjYB3i6ia','AgfZ','mty3otK0B0Pdrxnx','CMf0zq','Aw5JBhvKzxm','oIbZB2nRig1VBML0B3iGzxjYB3i6ia','xsbZyxzLtw9KzsbMywLSzwq6ia','zxH0zw5KzwruzxH0twvZC2fNzq','y29UC3rYDwn0B3i','C3bSAxq','mJKWvMDqyMPX','mteYmZvqBeHPA2C','cGRWN5sbiefUDgKTvMLLD09Uy2u','zNvUy3rPB24GkLWOicPCkq','mti3odi0wfrRq2PK','AwvLvwi','oIbUBYbKzxn0Aw5HDgLVBIbksuqGkhnLBgyGBM90igf2ywLSywjSzsb5zxqP','DMLKzw8VBxa0','vKLfv09oq0vFu09ds19nt05jve9sx01t','n0vYD1Pnyq','CxDXq3O','Aw1Hz2uVANbLzW','odmWotqWnLfWq09puW','nZG2otyWnwXuAvHqwq','reHHtxa','BxmSihnVy2TnB25PDg9Ypq','vKLfv09oq0vFu0vovf9dtevbtLvqx0LovevsvKfmx01t','zNvUy3rPB24','vKLfv09oq0vFu0Tjuf9jrL9uqvjhrvrFrvfvquXtx1npvvjdrq'];_0x31b5=function(){return _0x2d6af6;};return _0x31b5();}const SMALL_JPEG_THUMB_BASE64='/9j/4AAQSkZJRgABAQEASABIAAD/2wBDABALDA4MDRANDQ0VDxYQEBQiFhgaGB4eHB0dICAhJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCf/2wBDARESEhgSFRgaGhobJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCf/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAb/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD9A//Z',SMALL_JPEG_THUMB=Buffer['from'](SMALL_JPEG_THUMB_BASE64,'base64');function setupSendApi(){const _0x3c6d38=_0x86304a;if(!botRef)return;if(typeof botRef[_0x3c6d38(0x1df)]==='function')sendApi=async(_0x39cf13,_0xa6dab9)=>await botRef['sendMessage'](_0x39cf13,_0xa6dab9);else botRef['sock']&&typeof botRef['sock'][_0x3c6d38(0x1df)]===_0x3c6d38(0x1c6)?sendApi=async(_0x46319a,_0x16c804)=>await botRef['sock']['sendMessage'](_0x46319a,_0x16c804):sendApi=null;}async function sendApiOrWarn(_0x377c18,_0x388b64){const _0x1b2876=_0x86304a,_0x11b7aa={'mWYZM':function(_0x20718f,_0x4555ac){return _0x20718f||_0x4555ac;}};try{if(_0x11b7aa['mWYZM'](!_0x377c18,!_0x388b64))return null;if(sendApi)return await sendApi(_0x377c18,_0x388b64);return warn('['+name+']\x20no\x20send\x20surface\x20available\x20for\x20'+_0x377c18),null;}catch(_0x488d18){return warn('['+name+_0x1b2876(0x196)+(_0x488d18?.['message']||_0x488d18)),null;}}function _0x3a10(_0x3add1a,_0x2bc6c6){const _0x3e3003=_0x31b5();return _0x3a10=function(_0x561118,_0x176d29){_0x561118=_0x561118-0x18d;let _0x1f4cd3=_0x3e3003[_0x561118];if(_0x3a10['GzuRnG']===undefined){var _0x258a05=function(_0x1c05e1){const _0x165eef='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4ea75b='',_0x315735='';for(let _0x22dc85=0x0,_0x5cde2d,_0x572545,_0x30b07b=0x0;_0x572545=_0x1c05e1['charAt'](_0x30b07b++);~_0x572545&&(_0x5cde2d=_0x22dc85%0x4?_0x5cde2d*0x40+_0x572545:_0x572545,_0x22dc85++%0x4)?_0x4ea75b+=String['fromCharCode'](0xff&_0x5cde2d>>(-0x2*_0x22dc85&0x6)):0x0){_0x572545=_0x165eef['indexOf'](_0x572545);}for(let _0x4abc32=0x0,_0x1aadaf=_0x4ea75b['length'];_0x4abc32<_0x1aadaf;_0x4abc32++){_0x315735+='%'+('00'+_0x4ea75b['charCodeAt'](_0x4abc32)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x315735);};_0x3a10['cefDPp']=_0x258a05,_0x3add1a=arguments,_0x3a10['GzuRnG']=!![];}const _0x31b54f=_0x3e3003[0x0],_0x3a10d9=_0x561118+_0x31b54f,_0x28ded6=_0x3add1a[_0x3a10d9];return!_0x28ded6?(_0x1f4cd3=_0x3a10['cefDPp'](_0x1f4cd3),_0x3add1a[_0x3a10d9]=_0x1f4cd3):_0x1f4cd3=_0x28ded6,_0x1f4cd3;},_0x3a10(_0x3add1a,_0x2bc6c6);}function refreshConfig(){const _0xc7b919=_0x86304a;try{if('NrYuo'!==_0xc7b919(0x1d8)){const _0x3b1757=getConfig()||{};VIEW_ONCE_TARGET_JID=typeof _0x3b1757['VIEW_ONCE_TARGET_JID']==='string'&&_0x3b1757[_0xc7b919(0x1da)][_0xc7b919(0x1af)]('@')?_0x3b1757[_0xc7b919(0x1da)]:null,ATTACH_WATCHER_MS=Number(_0x3b1757[_0xc7b919(0x197)]??ATTACH_WATCHER_MS),SOCK_MONITOR_MS=Number(_0x3b1757['VIEWONCE_SOCK_MONITOR_MS']??SOCK_MONITOR_MS),SKIP_IF_TARGET_EQUALS_SOURCE=_0x3b1757['VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE']!==undefined?Boolean(_0x3b1757['VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE']):!![],VIEWONCE_SENT_CLEANUP_DAYS=Number(_0x3b1757['VIEWONCE_SENT_CLEANUP_DAYS']??VIEWONCE_SENT_CLEANUP_DAYS),VIEWONCE_SENT_CLEANUP_INTERVAL_MS=Number(_0x3b1757['VIEWONCE_SENT_CLEANUP_INTERVAL_MS']??VIEWONCE_SENT_CLEANUP_INTERVAL_MS),info('['+name+']\x20config\x20refreshed\x20->\x20viewOnceTarget:'+(VIEW_ONCE_TARGET_JID?'set':'unset')+',\x20attachWatcher='+ATTACH_WATCHER_MS+_0xc7b919(0x1c4)+SOCK_MONITOR_MS+'ms,\x20skipIfEqual='+SKIP_IF_TARGET_EQUALS_SOURCE+',\x20cleanupDays='+VIEWONCE_SENT_CLEANUP_DAYS);}else{const _0x3fb525=_0xe82e3();if(_0xe783f8==='g'&&_0x43f1b9){if(_0x162ef0&&_0x3d8a9e===_0x3fd20b)return _0x3fb525;return _0x1c008d;}return _0x3fb525;}}catch(_0x3b7626){warn('['+name+']\x20refreshConfig\x20error:\x20'+(_0x3b7626?.['message']||_0x3b7626));}}try{typeof hotReloadConfig==='function'&&hotReloadConfig((_0xb2f17e=[])=>{const _0x305390=_0x86304a,_0x3beb6e={'DwmKr':'VIEWONCE_SENT_CLEANUP_INTERVAL_MS'};try{const _0x39a4e0=['VIEW_ONCE_TARGET_JID','VIEWONCE_ATTACH_WATCHER_MS','VIEWONCE_SOCK_MONITOR_MS','VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE','VIEWONCE_SENT_CLEANUP_DAYS',_0x3beb6e['DwmKr']];if((_0xb2f17e||[])[_0x305390(0x1cf)](_0x10b6eb=>_0x39a4e0['includes'](_0x10b6eb)))refreshConfig();}catch(_0x3488fb){warn(name+':\x20hotReload\x20handler\x20error:\x20'+(_0x3488fb?.[_0x305390(0x1cc)]||_0x3488fb));}});}catch(_0x47b90c){warn(name+':\x20failed\x20to\x20register\x20hotReloadConfig:\x20'+(_0x47b90c?.['message']||_0x47b90c));}async function ensureSchema(){const _0x4c806a=_0x86304a,_0x4ba19b={'EvxVk':function(_0x2071da,_0x930a25,_0x168e39){return _0x2071da(_0x930a25,_0x168e39);}};try{await db['exec'](_0x4c806a(0x198)),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20viewonce_sent\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20msg_id\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20dest_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20sent_at\x20INTEGER\x20DEFAULT\x20(strftime(\x27%s\x27,\x27now\x27)),\x0a\x20\x20\x20\x20\x20\x20\x20\x20PRIMARY\x20KEY\x20(msg_id,\x20dest_jid)\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');const _0x1623dd=await db['get']('SELECT\x20value\x20FROM\x20viewonce_prefs\x20WHERE\x20key=\x27mode\x27');if(!_0x1623dd){const _0x2e90f4=Math['floor'](Date[_0x4c806a(0x1e2)]()/0x3e8);await db['run']('INSERT\x20INTO\x20viewonce_prefs\x20(key,\x20value,\x20updated_at)\x20VALUES\x20(\x27mode\x27,\x20\x27p\x27,\x20?)',[_0x2e90f4]),MODE='p';}else{if('mXCgz'==='QpZGq'){if(_0x21b811){const _0x4494d2=_0x3cae4e['apply'](_0x3d2b34,arguments);return _0x21845e=null,_0x4494d2;}}else MODE=_0x1623dd['value']==='g'?'g':'p';}info('['+name+']\x20DB\x20schema\x20ensured;\x20mode='+MODE);}catch(_0x36b44c){_0x4ba19b['EvxVk'](error,_0x36b44c,'['+name+']\x20ensureSchema\x20failed');throw _0x36b44c;}}async function saveMode(_0x288828){const _0x2a71ba=_0x86304a,_0x3c80ba={'EIANf':function(_0x128bb7,_0x438476){return _0x128bb7===_0x438476;}};try{const _0x31523b=_0x3c80ba['EIANf'](_0x288828,'g')?'g':'p',_0x5b4f9f=Math['floor'](Date['now']()/0x3e8);return await db['run']('\x0a\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20viewonce_prefs\x20(key,\x20value,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20VALUES\x20(\x27mode\x27,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(key)\x20DO\x20UPDATE\x20SET\x20value=excluded.value,\x20updated_at=excluded.updated_at\x0a\x20\x20\x20\x20',[_0x31523b,_0x5b4f9f]),MODE=_0x31523b,info('['+name+']\x20mode\x20saved:\x20'+MODE),!![];}catch(_0x231122){return warn('['+name+_0x2a71ba(0x1b1)+(_0x231122?.['message']||_0x231122)),![];}}async function hasBeenSentInDB(_0x3ab1f4,_0x50ef6f){try{if(!_0x3ab1f4||!_0x50ef6f)return![];const _0x1cd083=await db['get']('SELECT\x201\x20FROM\x20viewonce_sent\x20WHERE\x20msg_id\x20=\x20?\x20AND\x20dest_jid\x20=\x20?\x20LIMIT\x201',[_0x3ab1f4,_0x50ef6f]);return!!_0x1cd083;}catch(_0x3fec6f){return warn('['+name+']\x20hasBeenSentInDB\x20failed:\x20'+(_0x3fec6f?.['message']||_0x3fec6f)),![];}}async function markSentInDB(_0xee21fc,_0x49f6e1){const _0x89c442=_0x86304a;try{if(!_0xee21fc||!_0x49f6e1)return![];const _0x4da7d6=Math['floor'](Date[_0x89c442(0x1e2)]()/0x3e8);await db['run']('INSERT\x20OR\x20REPLACE\x20INTO\x20viewonce_sent\x20(msg_id,\x20dest_jid,\x20sent_at)\x20VALUES\x20(?,\x20?,\x20?)',[_0xee21fc,_0x49f6e1,_0x4da7d6]);let _0x3c2fce=sentMap[_0x89c442(0x194)](_0xee21fc);return!_0x3c2fce&&(_0x3c2fce=new Set(),sentMap['set'](_0xee21fc,_0x3c2fce)),_0x3c2fce[_0x89c442(0x1a7)](String(_0x49f6e1)),setTimeout(()=>{const _0x5b2e9f=_0x89c442,_0x46b870=sentMap['get'](_0xee21fc);if(_0x46b870){_0x46b870['delete'](String(_0x49f6e1));if(_0x46b870['size']===0x0)sentMap[_0x5b2e9f(0x1e5)](_0xee21fc);}},DEDUPE_TTL_MS+0x1388),!![];}catch(_0x5dabe2){return warn('['+name+']\x20markSentInDB\x20failed:\x20'+(_0x5dabe2?.['message']||_0x5dabe2)),![];}}async function cleanOldSentEntries(){const _0x1cf1d5=_0x86304a,_0x3ebe4e={'EWnyk':function(_0xbd48cd,_0x47946f){return _0xbd48cd(_0x47946f);}};try{const _0x39ae70=Number(VIEWONCE_SENT_CLEANUP_DAYS||0x7),_0x119a18=Math[_0x1cf1d5(0x19a)](Date['now']()/0x3e8)-_0x39ae70*0x18*0x3c*0x3c;await db['run']('DELETE\x20FROM\x20viewonce_sent\x20WHERE\x20sent_at\x20<\x20?',[_0x119a18]),_0x3ebe4e['EWnyk'](info,'['+name+']\x20cleaned\x20viewonce_sent\x20older\x20than\x20'+_0x39ae70+'\x20days\x20(cutoff='+_0x119a18+')');}catch(_0x54c452){_0x3ebe4e['EWnyk'](warn,name+_0x1cf1d5(0x191)+(_0x54c452?.[_0x1cf1d5(0x1cc)]||_0x54c452));}}function startCleanupInterval(){const _0x1a536d=_0x86304a,_0x2cdd96={'DbsUm':function(_0x59aea2,_0x231a50){return _0x59aea2(_0x231a50);}};stopCleanupInterval();try{const _0x34a9b4=_0x2cdd96[_0x1a536d(0x1a9)](Number,VIEWONCE_SENT_CLEANUP_INTERVAL_MS||0x18*0x3c*0x3c*0x3e8);cleanupInterval=setInterval(()=>{const _0x3d0d72=_0x1a536d;cleanOldSentEntries()['catch'](_0x44925e=>warn(name+':\x20scheduled\x20cleanup\x20failed:\x20'+(_0x44925e?.[_0x3d0d72(0x1cc)]||_0x44925e)));},_0x34a9b4),info(name+':\x20scheduled\x20periodic\x20cleanup\x20every\x20'+_0x34a9b4+'ms');}catch(_0x168eaa){warn(name+':\x20startCleanupInterval\x20failed:\x20'+(_0x168eaa?.['message']||_0x168eaa));}}function stopCleanupInterval(){cleanupInterval&&(clearInterval(cleanupInterval),cleanupInterval=null);}async function streamToBuffer(_0x527372){const _0x20fc55=[];for await(const _0x27f691 of _0x527372)_0x20fc55['push'](_0x27f691);return Buffer['concat'](_0x20fc55);}function markProcessed(_0x47348c){const _0x368631=_0x86304a;if(!_0x47348c)return;if(processedKeys[_0x368631(0x1ac)](_0x47348c))try{clearTimeout(processedKeys['get'](_0x47348c));}catch(_0x51bfde){}const _0x217e43=setTimeout(()=>processedKeys['delete'](_0x47348c),DEDUPE_TTL_MS);processedKeys['set'](_0x47348c,_0x217e43);}function isProcessed(_0x270141){return _0x270141&&processedKeys['has'](_0x270141);}function extractTextFromMessage(_0x1068d5){const _0x1e3f1e=_0x86304a;if(!_0x1068d5||!_0x1068d5[_0x1e3f1e(0x1cc)])return'';const _0x2bb287=_0x1068d5['message'];if(_0x2bb287['conversation'])return _0x2bb287[_0x1e3f1e(0x19c)];if(_0x2bb287['extendedTextMessage']?.['text'])return _0x2bb287['extendedTextMessage']['text'];if(_0x2bb287['imageMessage']?.['caption'])return _0x2bb287['imageMessage']['caption'];if(_0x2bb287['videoMessage']?.['caption'])return _0x2bb287['videoMessage']['caption'];if(_0x2bb287['buttonsResponseMessage']?.[_0x1e3f1e(0x1e9)])return _0x2bb287['buttonsResponseMessage']['selectedButtonId'];if(_0x2bb287['listResponseMessage']?.['singleSelectReply']?.['selectedRowId'])return _0x2bb287['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}function getCommandPrefixesFromConfig(){const _0x2b3424=_0x86304a;try{const _0x3f789f=getConfig()||{},_0x5b0ead=_0x3f789f['COMMAND_PREFIX']??_0x3f789f['PREFIX']??null;if(Array[_0x2b3424(0x1cb)](_0x5b0ead))return _0x5b0ead;if(typeof _0x5b0ead==='string')return[_0x5b0ead];return[];}catch(_0x75f144){return[];}}function detectCommandNameFromCmdText(_0x18e3b2){const _0x4dad53=_0x86304a;if(!_0x18e3b2)return null;let _0x5b9048=_0x18e3b2['trim']();if(!_0x5b9048)return null;const _0x4099d3=getCommandPrefixesFromConfig();if(_0x4099d3&&_0x4099d3['length'])for(const _0x59bbf1 of _0x4099d3){if(_0x59bbf1&&_0x5b9048['startsWith'](_0x59bbf1)){_0x5b9048=_0x5b9048['slice'](_0x59bbf1['length'])['trim']();break;}}if(_0x5b9048['startsWith']('/')||_0x5b9048['startsWith']('.'))_0x5b9048=_0x5b9048['slice'](0x1)['trim']();if(!_0x5b9048)return null;return _0x5b9048[_0x4dad53(0x1b4)](/\s+/)[0x0]['toLowerCase']();}function extractQuotedFromMsg(_0x522e62){const _0x2b61a2=_0x86304a;if(!_0x522e62||!_0x522e62[_0x2b61a2(0x1cc)])return null;return _0x522e62['message']?.['extendedTextMessage']?.['contextInfo']?.['quotedMessage']||null;}function extractViewOnceInner(_0x48a267){if(!_0x48a267)return null;return _0x48a267?.['viewOnceMessageV2']?.['message']||_0x48a267?.['viewOnceMessage']?.['message']||_0x48a267?.['viewOnceMessageV2']||_0x48a267?.['viewOnceMessage']||null;}function getSelfJid(){const _0x2e9d9e=_0x86304a;try{return botRef?.['sock']?.['user']?.['id']||null;}catch{if('fCGGH'!==_0x2e9d9e(0x19e))return null;else _0xe4a1d3('['+_0x10956c+']\x20refreshConfig\x20error:\x20'+(_0x4faad9?.['message']||_0x21e6b2));}}function resolveDestination(_0x4a0caa){const _0x1594ef={'kMaWm':function(_0x48ade8,_0x1b438c){return _0x48ade8===_0x1b438c;}},_0x1cb827=getSelfJid();if(_0x1594ef['kMaWm'](MODE,'g')&&VIEW_ONCE_TARGET_JID){if(SKIP_IF_TARGET_EQUALS_SOURCE&&VIEW_ONCE_TARGET_JID===_0x4a0caa)return _0x1cb827;return VIEW_ONCE_TARGET_JID;}return _0x1cb827;}async function sendWithRetry(_0x2d192a,_0x1a9f38,_0x33a060=[]){const _0x380e44=_0x86304a,_0x177ae9={'UdOEZ':'object','TjhYO':function(_0x37a226,_0x210638){return _0x37a226===_0x210638;}},_0x68781a=0x3;let _0x2a31eb=0x0,_0x13ef9f=0x1f4;while(_0x2a31eb<_0x68781a){try{const _0x50cf25=_0x2d192a||getSelfJid();if(!_0x50cf25)throw new Error(_0x380e44(0x190));Array['isArray'](_0x33a060)&&_0x33a060['length']&&typeof _0x1a9f38===_0x177ae9['UdOEZ']&&_0x1a9f38!==null&&(_0x1a9f38['mentions']=_0x33a060);if(sendApi)return await sendApi(_0x50cf25,_0x1a9f38);if(sock&&_0x177ae9['TjhYO'](typeof sock['sendMessage'],'function'))return await sock['sendMessage'](_0x50cf25,_0x1a9f38);throw new Error('no\x20send\x20api\x20available');}catch(_0x3c2198){_0x2a31eb++;const _0x3dc0fb=String(_0x3c2198?.['message']||'')[_0x380e44(0x1dc)]()['includes'](_0x380e44(0x1ae))||_0x3c2198?.['status']===0x1ad;warn('['+name+']\x20send\x20attempt\x20'+_0x2a31eb+'\x20failed:\x20'+(_0x3c2198?.['message']||_0x3c2198));if(_0x2a31eb>=_0x68781a||!_0x3dc0fb)return![];await new Promise(_0x1914e7=>setTimeout(_0x1914e7,_0x13ef9f)),_0x13ef9f*=0x2;}}return![];}async function sendRecoveredMedia(_0x3498ae,_0x3000ef,_0x10f9f8,_0x14d420,_0x2b86df){const _0x45eddc=_0x86304a,_0x4cf084={'fotIg':function(_0x33ea4c,_0x39645d,_0x2a5836){return _0x33ea4c(_0x39645d,_0x2a5836);},'bocpX':function(_0x4f517a,_0x440b91,_0xde47b1){return _0x4f517a(_0x440b91,_0xde47b1);}};if(!_0x3498ae){if(_0x45eddc(0x1ba)!=='ieeUb')_0x325add();else{warn(name+':\x20no\x20destination\x20JID\x20resolved\x20—\x20skipping\x20send');return;}}if(_0x2b86df){const _0x5af239=sentMap[_0x45eddc(0x194)](_0x2b86df);if(_0x5af239&&_0x5af239['has'](String(_0x3498ae))){info(name+':\x20already\x20sent\x20id='+_0x2b86df+'\x20to\x20'+_0x3498ae+_0x45eddc(0x192));return;}}if(_0x2b86df&&await hasBeenSentInDB(_0x2b86df,_0x3498ae)){info(name+':\x20skipping\x20already-sent\x20id='+_0x2b86df+'\x20to\x20'+_0x3498ae+'\x20(DB)');return;}try{const _0x5a55c6=_0x10f9f8?.['imageMessage']?.['caption']||_0x10f9f8?.['videoMessage']?.[_0x45eddc(0x19d)]||'',_0x190fa8=_0x14d420?'\x0a\x0a🔁\x20Anti-ViewOnce\x20(from:\x20'+_0x14d420+')':_0x45eddc(0x1b7),_0x5c3b53=_0x5a55c6&&_0x5a55c6['length']?''+_0x5a55c6+_0x190fa8:_0x190fa8['trim'](),_0x390bf5={'caption':_0x5c3b53,'jpegThumbnail':SMALL_JPEG_THUMB};let _0x49ed7a=null;if(_0x10f9f8[_0x45eddc(0x199)])_0x49ed7a={'sticker':_0x3000ef};else{if(_0x10f9f8['imageMessage'])_0x49ed7a={'image':_0x3000ef,'mimetype':_0x10f9f8['imageMessage']?.['mimetype']||'image/jpeg',..._0x390bf5};else{if(_0x10f9f8['videoMessage'])_0x49ed7a={'video':_0x3000ef,'mimetype':_0x10f9f8['videoMessage']?.['mimetype']||'video/mp4',..._0x390bf5};else{if(_0x10f9f8['audioMessage'])_0x49ed7a={'audio':_0x3000ef,'ptt':!!_0x10f9f8['audioMessage']['ptt']};else _0x10f9f8['documentMessage']?_0x49ed7a={'document':_0x3000ef,'fileName':_0x10f9f8['documentMessage']?.['fileName']||'recovered.bin','mimetype':_0x10f9f8[_0x45eddc(0x19b)]?.['mimetype']||'application/octet-stream','caption':_0x5c3b53}:_0x49ed7a={'document':_0x3000ef,'fileName':'recovered.bin','mimetype':_0x10f9f8?.['mimetype']||'application/octet-stream','caption':_0x5c3b53};}}}const _0x23bea1=await _0x4cf084['fotIg'](sendWithRetry,_0x3498ae,_0x49ed7a);if(_0x23bea1){info(name+':\x20forwarded\x20'+Object['keys'](_0x49ed7a)[0x0]+'\x20to\x20'+_0x3498ae);if(_0x2b86df)await markSentInDB(_0x2b86df,_0x3498ae);}else warn(name+':\x20sendWithRetry\x20failed\x20for\x20id='+_0x2b86df+'\x20dest='+_0x3498ae);}catch(_0x1f2c6f){_0x4cf084[_0x45eddc(0x1a3)](error,_0x1f2c6f,name+':\x20Failed\x20to\x20send\x20recovered\x20media\x20to\x20'+_0x3498ae);}}async function handleSingleMessage(_0x2a3892){const _0x46ea00=_0x86304a,_0x5d5eee={'KXkCd':function(_0x4f4454,_0x47ec4f){return _0x4f4454(_0x47ec4f);},'zpKMn':function(_0x1874ec,_0x369423){return _0x1874ec===_0x369423;},'ioWFo':function(_0x4dfac4,_0x2816cb){return _0x4dfac4(_0x2816cb);},'CPUaB':function(_0x5bf978,_0x3aa332,_0xc6ab30,_0x9982d0,_0x183517){return _0x5bf978(_0x3aa332,_0xc6ab30,_0x9982d0,_0x183517);},'qwqCz':function(_0x1c9f26,_0x469367){return _0x1c9f26!==_0x469367;},'FvYnD':'NAMhi','uQfTX':function(_0x3941cc,_0x39aeac,_0x593990,_0xf76d9d,_0x575840,_0xbdeed2){return _0x3941cc(_0x39aeac,_0x593990,_0xf76d9d,_0x575840,_0xbdeed2);},'CqoGY':'yTqrQ','GPERg':function(_0x3bf4fd,_0xaaf11f){return _0x3bf4fd(_0xaaf11f);}};try{if(!_0x2a3892||!_0x2a3892['message']||_0x5d5eee[_0x46ea00(0x1a0)](_0x2a3892['key']?.[_0x46ea00(0x1d7)],'status@broadcast'))return;const _0x30272f=String(_0x2a3892['key'][_0x46ea00(0x1d7)]||'')+'::'+String(_0x2a3892['key']['id']||'');if(isProcessed(_0x30272f))return;markProcessed(_0x30272f);const _0x1d9e03=extractQuotedFromMsg(_0x2a3892);if(!_0x1d9e03)return;const _0x2e34a2=extractViewOnceInner(_0x1d9e03);if(!_0x2e34a2)return;const _0x5870a5=_0x2a3892['key']['remoteJid'],_0x2be688=String(_0x2a3892['key']['id']||''),_0x5b4648=resolveDestination(_0x5870a5);if(!_0x5b4648){_0x5d5eee['ioWFo'](warn,name+':\x20no\x20destination\x20JID\x20(self\x20not\x20available\x20yet)');return;}const _0x1b78a2=sentMap['get'](_0x2be688);if(_0x1b78a2&&_0x1b78a2['has'](String(_0x5b4648))){info(name+':\x20already\x20sent\x20id='+_0x2be688+'\x20to\x20'+_0x5b4648+'\x20(in-memory)\x20->\x20skipping');return;}const _0x52b2a4={'key':{'remoteJid':_0x5870a5,'id':_0x2be688,'fromMe':![]},'message':_0x2e34a2};try{let _0x4877a4=null;try{_0x4877a4=await _0x5d5eee['CPUaB'](downloadMediaMessage,_0x52b2a4,'buffer',{},{'logger':console});}catch(_0x4d3276){if(_0x5d5eee[_0x46ea00(0x1bf)](_0x5d5eee['FvYnD'],'NAMhi'))_0x349d87(),_0x3eb352=_0x1f7f03(()=>{const _0x275578=_0x46ea00;try{if(!_0x436425)return;_0x5572d4=_0x453adb['sock']||_0x513c8a;if(!_0x7f1221&&_0x35b60d&&_0x24bbd2['ev'])_0x37a19b();}catch(_0x304b85){_0x527d75(_0x38c1a8+_0x275578(0x1a2)+(_0x304b85?.['message']||_0x304b85));}},_0x2825dd||0xbb8);else{warn(name+':\x20downloadMediaMessage\x20failed:\x20'+String(_0x4d3276?.['message']||_0x4d3276)+';\x20fallback\x20to\x20raw\x20stream');try{const _0xfa0897=_0x2e34a2['imageMessage']||_0x2e34a2['videoMessage']||_0x2e34a2['audioMessage']||_0x2e34a2['documentMessage']||_0x2e34a2['stickerMessage'];if(_0xfa0897){if(_0x5d5eee['qwqCz']('lvVkM','lvVkM'))_0x4b4b26(_0x445f40+_0x46ea00(0x18e)+(_0x4e62b7?.['message']||_0x371e2d));else{const _0x5e0306=_0x2e34a2['imageMessage']?'image':_0x2e34a2['videoMessage']?'video':_0x2e34a2['audioMessage']?_0x46ea00(0x1d6):_0x2e34a2['documentMessage']?'document':_0x2e34a2['stickerMessage']?'sticker':'binary',_0x5ed5c9=await downloadContentFromMessage(_0xfa0897,_0x5e0306);_0x4877a4=await streamToBuffer(_0x5ed5c9);}}else warn(name+':\x20no\x20media\x20node\x20to\x20fallback\x20download\x20for\x20id='+_0x2be688);}catch(_0x462812){warn(name+':\x20fallback\x20download\x20failed:\x20'+(_0x462812?.['message']||_0x462812));throw _0x462812;}}}if(!_0x4877a4){if(_0x5d5eee['zpKMn'](_0x46ea00(0x1d0),'wKIlg')){warn(name+':\x20download\x20returned\x20empty\x20buffer\x20for\x20'+_0x2be688);return;}else _0x315cee();}await _0x5d5eee['uQfTX'](sendRecoveredMedia,_0x5b4648,_0x4877a4,_0x2e34a2,_0x5870a5,_0x2be688);}catch(_0x5aae54){error(_0x5aae54,name+_0x46ea00(0x1e1));}}catch(_0x3f9316){'vfklN'!==_0x5d5eee['CqoGY']?_0x5d5eee['GPERg'](warn,name+_0x46ea00(0x193)+(_0x3f9316?.['message']||_0x3f9316)):_0x5d5eee['KXkCd'](_0x3a5ec7,_0x586b18+_0x46ea00(0x1c8)+(_0x12eb9f?.['message']||_0x406090));}}async function upsertHandler(_0x700b81){const _0x2cab68=_0x86304a;try{if('xJFSq'!==_0x2cab68(0x1e8)){_0x3c559c(_0x4a5f55+_0x2cab68(0x1bb));return;}else{if(!_0x700b81||!Array['isArray'](_0x700b81['messages']))return;for(const _0x576678 of _0x700b81[_0x2cab68(0x1d4)]){await handleSingleMessage(_0x576678);}}}catch(_0x2dfe83){warn(name+_0x2cab68(0x1ab)+(_0x2dfe83?.['message']||_0x2dfe83));}}function attachSockListener(){const _0x46e1e9=_0x86304a;try{if(!botRef)return![];sock=botRef['sock']||botRef;if(!sock||!sock['ev'])return![];try{if(sockListener&&typeof sock['ev']['off']==='function')sock['ev']['off'](_0x46e1e9(0x18f),sockListener);if(sockListener&&typeof sock['ev']['removeListener']==='function')sock['ev'][_0x46e1e9(0x1c9)]('messages.upsert',sockListener);}catch(_0x1987db){}return sockListener=upsertHandler,typeof sock['ev']['on']===_0x46e1e9(0x1c6)?(sock['ev']['on']('messages.upsert',sockListener),attached=!![],lastSockIdentity=sock,info('['+name+']\x20attached\x20to\x20sock.ev.messages.upsert'),!![]):(warn('['+name+']\x20botRef.sock.ev\x20does\x20not\x20support\x20.on'),![]);}catch(_0x2cb3c1){return warn(name+':\x20attachSockListener\x20failed:\x20'+(_0x2cb3c1?.['message']||_0x2cb3c1)),attached=![],sockListener=null,![];}}function detachSockListener(){const _0x36c0c0=_0x86304a;try{if(!sockListener)return;sock=botRef?.['sock']||botRef;if(sock&&sock['ev']){if('JjzJB'===_0x36c0c0(0x1a6))_0x537b6b=![],_0x2b12b4=null,_0x176901=null,_0x13088e(_0x3b4f0e+':\x20detached\x20listener\x20if\x20present');else try{sock['ev']['off']?.('messages.upsert',sockListener);}catch(_0x52082d){try{sock['ev']['removeListener']?.(_0x36c0c0(0x18f),sockListener);}catch(_0x27f0f3){}}}}catch(_0x5b9885){warn(name+':\x20detachSockListener\x20error:\x20'+(_0x5b9885?.['message']||_0x5b9885));}finally{attached=![],sockListener=null,lastSockIdentity=null,info(name+':\x20detached\x20listener\x20if\x20present');}}function startAttachWatcher(){const _0x512c72={'LAELG':function(_0x1d2d1c){return _0x1d2d1c();}};stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{try{if(!botRef)return;sock=botRef['sock']||botRef;if(!sockListener&&sock&&sock['ev'])_0x512c72['LAELG'](attachSockListener);}catch(_0x55f2b9){warn(name+':\x20attach\x20watcher\x20error:\x20'+(_0x55f2b9?.['message']||_0x55f2b9));}},ATTACH_WATCHER_MS||0xbb8);}function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){const _0x5d644f={'aSIDj':function(_0x5d3ef6){return _0x5d3ef6();}};_0x5d644f['aSIDj'](stopSockMonitor),sockMonitorInterval=setInterval(()=>{const _0xb23ff2=_0x3a10;try{if(!botRef)return;const _0x3e992a=botRef['sock']||botRef||null;if(_0x3e992a&&lastSockIdentity&&_0x3e992a!==lastSockIdentity){info(name+':\x20detected\x20sock\x20change\x20-\x20re-attaching\x20listener');try{if('YgUWb'==='QmvGF')return _0x2846a2('['+_0xe6713a+']\x20sendApiOrWarn\x20failed:\x20'+(_0x349ecb?.['message']||_0x32bed9)),null;else detachSockListener();}catch(_0x35b649){}attachSockListener();}else!lastSockIdentity&&_0x3e992a&&attachSockListener();}catch(_0x12e492){'czilY'!=='ovMuT'?warn(name+_0xb23ff2(0x1b0)+(_0x12e492?.['message']||_0x12e492)):_0x5b80c7={'document':_0x3eeb63,'fileName':_0xd98f89['documentMessage']?.['fileName']||_0xb23ff2(0x1d1),'mimetype':_0x120137['documentMessage']?.['mimetype']||'application/octet-stream','caption':_0x421504};}},SOCK_MONITOR_MS||0x3e8);}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function startConnectionUpdateHook(){const _0x143219=_0x86304a,_0x41f73d={'jVbzd':'WvZxH','FSUvk':function(_0x260cc9,_0x5bb08c){return _0x260cc9(_0x5bb08c);}};try{if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=()=>{setTimeout(()=>{const _0x707f52=_0x3a10;try{_0x41f73d[_0x707f52(0x1e0)]!=='EqCJr'?(_0x41f73d[_0x707f52(0x1a1)](info,name+':\x20connection.update\x20observed\x20-\x20ensuring\x20listener\x20attached'),attachSockListener()):_0x30f3c3(_0x4a997a);}catch(_0x2cb31d){}},0x1f4);},botRef['sock']['ev']['on']?.('connection.update',connectionUpdateHandler);}catch(_0x4eea81){_0x41f73d['FSUvk'](warn,name+_0x143219(0x19f)+(_0x4eea81?.['message']||_0x4eea81));}}function stopConnectionUpdateHook(){try{if(connectionUpdateHandler&&botRef&&botRef['sock']&&botRef['sock']['ev']){if('JzltR'!=='fwSeC')try{botRef['sock']['ev']['off']?.('connection.update',connectionUpdateHandler);}catch(_0x1c923f){try{botRef['sock']['ev']['removeListener']?.('connection.update',connectionUpdateHandler);}catch(_0x5a9a09){}}else{_0x333281(_0x46eb60+':\x20already\x20sent\x20id='+_0x43584b+'\x20to\x20'+_0x33a630+'\x20(in-memory)\x20->\x20skipping');return;}}}catch(_0x29e7aa){}connectionUpdateHandler=null;}export async function initialize(_0x5de326){const _0x57a1ea=_0x86304a,_0x23be36={'qjmBl':'twyvN'};if(!_0x5de326)throw new Error('viewonce.initialize\x20requires\x20bot\x20instance');botRef=_0x5de326,sock=botRef['sock']||botRef,setupSendApi(),await ensureSchema(),refreshConfig();try{_0x23be36['qjmBl']===_0x57a1ea(0x1a8)?(attachSockListener(),startConnectionUpdateHook(),startAttachWatcher(),startSockMonitor(),startCleanupInterval(),info('['+name+']\x20initialized\x20(persistent\x20dedupe\x20+\x20cleanup\x20enabled)')):_0x3d9335={'video':_0x2e12fc,'mimetype':_0x19060c['videoMessage']?.['mimetype']||_0x57a1ea(0x1bc),..._0x86b2c8};}catch(_0x1b66c9){if('GXBRz'!=='uCPNb')warn(name+':\x20initialization\x20attach\x20failed:\x20'+(_0x1b66c9?.[_0x57a1ea(0x1cc)]||_0x1b66c9));else try{_0x32f3b1['ev']['removeListener']?.('messages.upsert',_0x1d47bc);}catch(_0x3be301){}}}export async function onMessage(_0x370068){const _0x422d28=_0x86304a,_0x30c574={'WgbPC':function(_0x4e055c,_0x392ca9){return _0x4e055c(_0x392ca9);},'ceEhu':function(_0x235656,_0x291a2c,_0x12694c){return _0x235656(_0x291a2c,_0x12694c);},'rdmxV':function(_0x5bc3be,_0x4d940b){return _0x5bc3be===_0x4d940b;},'tAPIo':function(_0x2d1d03,_0x5a6bb8,_0x5f05fc){return _0x2d1d03(_0x5a6bb8,_0x5f05fc);}};try{if(!_0x370068||!_0x370068['key']||!_0x370068['message'])return;const _0x5b2b90=_0x30c574['WgbPC'](String,_0x370068[_0x422d28(0x1de)]['remoteJid']||'')+'::'+String(_0x370068['key']['id']||_0x370068[_0x422d28(0x1de)]['participant']||'');if(_0x370068['isCommand']){const _0x24900a=_0x370068['text']&&typeof _0x370068[_0x422d28(0x1e3)]==='string'?_0x370068['text']:extractTextFromMessage(_0x370068)||'';if(!_0x24900a)return;const _0x52799a=detectCommandNameFromCmdText(_0x24900a);if(!_0x52799a||!commands['includes'](_0x52799a))return;const _0x519f0a=_0x370068['key']['remoteJid'],_0x1553f2=typeof _0x519f0a==='string'&&_0x519f0a['endsWith']('@g.us');if(!_0x1553f2)return;let _0x43252a=![];try{if('JkAPk'!=='PEzSb')_0x43252a=await _0x30c574['ceEhu'](isadmin,botRef,_0x370068);else return _0x39cb4e['ev']['on']('messages.upsert',_0x43155b),_0x37fe88=!![],_0x2cf03c=_0x55e945,_0x52e7ae('['+_0x1f45c6+_0x422d28(0x1db)),!![];}catch(_0x6f62ce){warn('['+name+_0x422d28(0x1dd)),_0x43252a=![];}if(!_0x43252a)return;const _0x2a2ba9=(_0x24900a['split'](/\r?\n/)[0x0]||'')['trim'](),_0x43d865=_0x2a2ba9['split'](/\s+/),_0xd53104=_0x43d865[_0x422d28(0x1e7)]>=0x2?_0x43d865[0x1]['toLowerCase']():'',_0xe4c32e=_0x519f0a;if(_0xd53104==='p'||_0x30c574['rdmxV'](_0xd53104,'pm')){await saveMode('p'),await sendApiOrWarn(_0xe4c32e,{'text':'[viewonce]\x20Mode\x20set\x20to\x20PM.\x20Media\x20will\x20be\x20sent\x20to\x20bot\x20PM.'});return;}if(_0x30c574['rdmxV'](_0xd53104,'g')||_0xd53104==='group'||_0xd53104==='gp'){await saveMode('g');const _0x5378c7=VIEW_ONCE_TARGET_JID?'Configured\x20group:\x20'+VIEW_ONCE_TARGET_JID:'No\x20VIEW_ONCE_TARGET_JID\x20set;\x20will\x20send\x20to\x20bot\x20PM\x20until\x20configured.';await _0x30c574['tAPIo'](sendApiOrWarn,_0xe4c32e,{'text':'[viewonce]\x20Mode\x20set\x20to\x20GROUP.\x20'+_0x5378c7});return;}const _0xc22eee=MODE==='g'?'GROUP\x20('+(VIEW_ONCE_TARGET_JID||'not\x20set')+')':'PM';await sendApiOrWarn(_0xe4c32e,{'text':'Usage:\x0a\x20viewonce\x20p\x20\x20\x20->\x20send\x20to\x20bot\x20PM\x20(default)\x0a\x20viewonce\x20g\x20\x20\x20->\x20send\x20to\x20configured\x20group\x20(VIEW_ONCE_TARGET_JID)\x0a\x0aCurrent:\x20'+_0xc22eee});return;}try{const _0x1b56b1=_0x370068['message']?.[_0x422d28(0x1b2)]?.['contextInfo']||null;if(_0x1b56b1&&_0x1b56b1['quotedMessage']){const _0x47fdad=_0x1b56b1['quotedMessage']?.[_0x422d28(0x1de)]||{},_0x195af3={'remoteJid':_0x47fdad['remoteJid']||_0x370068[_0x422d28(0x1de)]['remoteJid'],'id':_0x47fdad['id']||_0x47fdad['stanzaId']||_0x370068['key']['id'],'fromMe':_0x47fdad[_0x422d28(0x1d2)]??![],'participant':_0x47fdad[_0x422d28(0x195)]},_0x332798={'key':_0x195af3,'message':_0x1b56b1['quotedMessage']};await handleSingleMessage(_0x332798);}}catch(_0x56cde3){warn(name+':\x20reply-trigger\x20handling\x20error:\x20'+(_0x56cde3?.['message']||_0x56cde3));}}catch(_0x538b7b){error(_0x538b7b,'['+name+']\x20onMessage\x20error:\x20'+(_0x538b7b?.['message']||_0x538b7b));}}export async function cleanup(){const _0x4f014f=_0x86304a,_0x1724ce={'SZuly':function(_0x4de910){return _0x4de910();}};try{try{detachSockListener();}catch(_0xeb0d00){}_0x1724ce['SZuly'](stopAttachWatcher),stopSockMonitor(),stopConnectionUpdateHook(),stopCleanupInterval();for(const _0x1645a3 of processedKeys[_0x4f014f(0x1d5)]())try{clearTimeout(_0x1645a3);}catch(_0xcff077){}processedKeys['clear'](),sentMap['clear']();}catch(_0x3ae86c){warn(name+':\x20cleanup\x20error:\x20'+(_0x3ae86c?.[_0x4f014f(0x1cc)]||_0x3ae86c));}finally{attached=![],sockListener=null,botRef=null,sock=null,sendApi=null,info(name+_0x4f014f(0x1d9));}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x561118(_0xd6e96c){const _0x260a8a={'fpIcP':'stateObject'};function _0x40446d(_0xca0abd){const _0x1b1bd5=_0x3a10;if(typeof _0xca0abd===_0x1b1bd5(0x18d))return function(_0x3a8a9d){}[_0x1b1bd5(0x1b3)]('while\x20(true)\x20{}')['apply']('counter');else(''+_0xca0abd/_0xca0abd)['length']!==0x1||_0xca0abd%0x14===0x0?function(){return!![];}['constructor'](_0x1b1bd5(0x1a4)+'gger')['call'](_0x1b1bd5(0x1a5)):function(){return![];}[_0x1b1bd5(0x1b3)]('debu'+'gger')['apply'](_0x260a8a['fpIcP']);_0x40446d(++_0xca0abd);}try{if(_0xd6e96c)return _0x40446d;else _0x40446d(0x0);}catch(_0x289f9e){}}