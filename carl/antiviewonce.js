const _0x51e4eb=_0x1a27;(function(_0x15d077,_0x42e600){const _0x285ec=_0x1a27,_0x11a71e=_0x15d077();while(!![]){try{const _0x17b9ff=-parseInt(_0x285ec(0xcb))/0x1+parseInt(_0x285ec(0xf3))/0x2+-parseInt(_0x285ec(0xf6))/0x3+parseInt(_0x285ec(0xc2))/0x4*(-parseInt(_0x285ec(0xc3))/0x5)+parseInt(_0x285ec(0xd9))/0x6+parseInt(_0x285ec(0xd6))/0x7+parseInt(_0x285ec(0xea))/0x8;if(_0x17b9ff===_0x42e600)break;else _0x11a71e['push'](_0x11a71e['shift']());}catch(_0x5dd752){_0x11a71e['push'](_0x11a71e['shift']());}}}(_0x1841,0x62c95));const _0x56ce8a=(function(){const _0x157017={'IoRTw':function(_0x5f28cc,_0x4a0d0d){return _0x5f28cc===_0x4a0d0d;}};let _0x1cded7=!![];return function(_0x71942,_0x3b4e5e){const _0x166023={'mnxWa':'messages.upsert'},_0x5dbbd0=_0x1cded7?function(){if('TtHPO'!=='RMETj'){if(_0x3b4e5e){if(_0x157017['IoRTw']('BsCrE','PZmJJ'))return _0x3ba6b8['ev']['on'](_0x166023['mnxWa'],_0x85d44b),_0x67b37a=!![],_0x3dc3c3=_0x21c687,_0x3c07ac('['+_0x227673+']\x20attached\x20to\x20sock.ev.messages.upsert'),!![];else{const _0x1ebec0=_0x3b4e5e['apply'](_0x71942,arguments);return _0x3b4e5e=null,_0x1ebec0;}}}else _0x34142b(),_0xa8ab75=_0x4129bf(()=>{try{if(!_0x338e12)return;_0x1c6108=_0x32f784['sock']||_0x252d7e;if(!_0x529b85&&_0x5001f3&&_0x20d008['ev'])_0x37ee09();}catch(_0x1f6cc2){_0x3f6dde(_0x71d0f1+':\x20attach\x20watcher\x20error:\x20'+(_0x1f6cc2?.['message']||_0x1f6cc2));}},_0x4fd897||0xbb8);}:function(){};return _0x1cded7=![],_0x5dbbd0;};}());function _0x1a27(_0x4aa7fb,_0x1464d2){const _0x3c1b7f=_0x1841();return _0x1a27=function(_0x4d389d,_0x56ce8a){_0x4d389d=_0x4d389d-0xb9;let _0x8cd272=_0x3c1b7f[_0x4d389d];if(_0x1a27['aovzzp']===undefined){var _0x31261b=function(_0x6c2d68){const _0x58cf78='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2450f5='',_0x3290d3='';for(let _0xeb9dee=0x0,_0x2caa57,_0x20d7ab,_0x4688b7=0x0;_0x20d7ab=_0x6c2d68['charAt'](_0x4688b7++);~_0x20d7ab&&(_0x2caa57=_0xeb9dee%0x4?_0x2caa57*0x40+_0x20d7ab:_0x20d7ab,_0xeb9dee++%0x4)?_0x2450f5+=String['fromCharCode'](0xff&_0x2caa57>>(-0x2*_0xeb9dee&0x6)):0x0){_0x20d7ab=_0x58cf78['indexOf'](_0x20d7ab);}for(let _0x3fa9b5=0x0,_0x4fd38e=_0x2450f5['length'];_0x3fa9b5<_0x4fd38e;_0x3fa9b5++){_0x3290d3+='%'+('00'+_0x2450f5['charCodeAt'](_0x3fa9b5)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3290d3);};_0x1a27['KvvmPN']=_0x31261b,_0x4aa7fb=arguments,_0x1a27['aovzzp']=!![];}const _0x184139=_0x3c1b7f[0x0],_0x1a27ed=_0x4d389d+_0x184139,_0x4497d1=_0x4aa7fb[_0x1a27ed];return!_0x4497d1?(_0x8cd272=_0x1a27['KvvmPN'](_0x8cd272),_0x4aa7fb[_0x1a27ed]=_0x8cd272):_0x8cd272=_0x4497d1,_0x8cd272;},_0x1a27(_0x4aa7fb,_0x1464d2);}(function(){_0x56ce8a(this,function(){const _0x178f8b=_0x1a27,_0x5b5f04=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x2846f0=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x1a1f7c=_0x4d389d('init');!_0x5b5f04['test'](_0x1a1f7c+'chain')||!_0x2846f0[_0x178f8b(0xd4)](_0x1a1f7c+'input')?_0x1a1f7c('0'):_0x4d389d();})();}());import{info,warn,error}from'../utils/logger.js';import{downloadMediaMessage,downloadContentFromMessage}from'@whiskeysockets/baileys';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';(function(){const _0x4efcd2={'EOzRJ':function(_0x1f7162){return _0x1f7162();}},_0x4931f1=function(){const _0x2e089c=_0x1a27;let _0x1542b5;try{_0x1542b5=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2f3823){if('pOJpi'!==_0x2e089c(0xbd))_0x1542b5=window;else return _0x58195b('['+_0x5db22a+_0x2e089c(0x110)+(_0x4fae65?.['message']||_0x5bcc8b)),![];}return _0x1542b5;},_0x5c46a9=_0x4efcd2['EOzRJ'](_0x4931f1);_0x5c46a9['setInterval'](_0x4d389d,0x61a80);}());import{isadmin}from'../utils/isadmin.js';export const name='viewonce';export const version='3.0.0-rectified';export const priority=0x5f;export const configKeys=['VIEW_ONCE_TARGET_JID','VIEWONCE_ATTACH_WATCHER_MS','VIEWONCE_SOCK_MONITOR_MS','VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE',_0x51e4eb(0xe2),'VIEWONCE_SENT_CLEANUP_INTERVAL_MS'];export const commands=['viewonce'];let botRef=null,sock=null,sendApi=null,attached=![],sockListener=null,connectionUpdateHandler=null,lastSockIdentity=null,attachWatcherInterval=null,sockMonitorInterval=null,cleanupInterval=null;const DEDUPE_TTL_MS=0x1e*0x3e8,processedKeys=new Map(),sentMap=new Map();let VIEW_ONCE_TARGET_JID=null,ATTACH_WATCHER_MS=0xbb8,SOCK_MONITOR_MS=0x3e8,SKIP_IF_TARGET_EQUALS_SOURCE=!![],MODE='p',VIEWONCE_SENT_CLEANUP_DAYS=0x7,VIEWONCE_SENT_CLEANUP_INTERVAL_MS=0x18*0x3c*0x3c*0x3e8;const SMALL_JPEG_THUMB_BASE64=_0x51e4eb(0xe4),SMALL_JPEG_THUMB=Buffer['from'](SMALL_JPEG_THUMB_BASE64,'base64');function setupSendApi(){const _0xb011ac=_0x51e4eb,_0x23a711={'nWMaw':function(_0x2d79b7,_0x2317a2){return _0x2d79b7===_0x2317a2;}};if(!botRef)return;if(_0x23a711['nWMaw'](typeof botRef['sendMessage'],_0xb011ac(0xe7)))sendApi=async(_0x5ec49e,_0x531f2e)=>await botRef['sendMessage'](_0x5ec49e,_0x531f2e);else botRef['sock']&&typeof botRef['sock']['sendMessage']===_0xb011ac(0xe7)?sendApi=async(_0x29bc0b,_0x1c14f6)=>await botRef[_0xb011ac(0xe0)]['sendMessage'](_0x29bc0b,_0x1c14f6):sendApi=null;}async function sendApiOrWarn(_0x4fe8cd,_0x32d3e8){const _0x52e303=_0x51e4eb,_0x5629e7={'YiCIf':function(_0x334f7c,_0x160ec9){return _0x334f7c(_0x160ec9);}};try{if(!_0x4fe8cd||!_0x32d3e8)return null;if(sendApi)return await sendApi(_0x4fe8cd,_0x32d3e8);return warn('['+name+_0x52e303(0x102)+_0x4fe8cd),null;}catch(_0x12576c){return _0x5629e7['YiCIf'](warn,'['+name+']\x20sendApiOrWarn\x20failed:\x20'+(_0x12576c?.['message']||_0x12576c)),null;}}function refreshConfig(){const _0x56ce6f=_0x51e4eb;try{const _0x2a52da=getConfig()||{};VIEW_ONCE_TARGET_JID=typeof _0x2a52da['VIEW_ONCE_TARGET_JID']==='string'&&_0x2a52da['VIEW_ONCE_TARGET_JID']['includes']('@')?_0x2a52da['VIEW_ONCE_TARGET_JID']:null,ATTACH_WATCHER_MS=Number(_0x2a52da['VIEWONCE_ATTACH_WATCHER_MS']??ATTACH_WATCHER_MS),SOCK_MONITOR_MS=Number(_0x2a52da['VIEWONCE_SOCK_MONITOR_MS']??SOCK_MONITOR_MS),SKIP_IF_TARGET_EQUALS_SOURCE=_0x2a52da['VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE']!==undefined?Boolean(_0x2a52da[_0x56ce6f(0xba)]):!![],VIEWONCE_SENT_CLEANUP_DAYS=Number(_0x2a52da['VIEWONCE_SENT_CLEANUP_DAYS']??VIEWONCE_SENT_CLEANUP_DAYS),VIEWONCE_SENT_CLEANUP_INTERVAL_MS=Number(_0x2a52da[_0x56ce6f(0xf0)]??VIEWONCE_SENT_CLEANUP_INTERVAL_MS),info('['+name+']\x20config\x20refreshed\x20->\x20viewOnceTarget:'+(VIEW_ONCE_TARGET_JID?_0x56ce6f(0xcc):'unset')+',\x20attachWatcher='+ATTACH_WATCHER_MS+'ms,\x20sockMonitor='+SOCK_MONITOR_MS+'ms,\x20skipIfEqual='+SKIP_IF_TARGET_EQUALS_SOURCE+',\x20cleanupDays='+VIEWONCE_SENT_CLEANUP_DAYS);}catch(_0xfb258b){warn('['+name+']\x20refreshConfig\x20error:\x20'+(_0xfb258b?.['message']||_0xfb258b));}}try{typeof hotReloadConfig===_0x51e4eb(0xe7)&&hotReloadConfig((_0x27ca95=[])=>{const _0x4806d9=_0x51e4eb,_0x2f6fd6={'mguoI':_0x4806d9(0xe2)};try{const _0x3b8c1e=[_0x4806d9(0xf9),'VIEWONCE_ATTACH_WATCHER_MS',_0x4806d9(0xdd),'VIEWONCE_SKIP_IF_TARGET_EQUALS_SOURCE',_0x2f6fd6[_0x4806d9(0x101)],'VIEWONCE_SENT_CLEANUP_INTERVAL_MS'];if((_0x27ca95||[])['some'](_0x29799a=>_0x3b8c1e['includes'](_0x29799a)))refreshConfig();}catch(_0x4a0720){warn(name+':\x20hotReload\x20handler\x20error:\x20'+(_0x4a0720?.['message']||_0x4a0720));}});}catch(_0x41dc8){warn(name+':\x20failed\x20to\x20register\x20hotReloadConfig:\x20'+(_0x41dc8?.['message']||_0x41dc8));}function _0x1841(){const _0x30db59=['oIbUBYbKzxn0Aw5HDgLVBIbksuqGCMvZB2X2zwqG4OcuihnRAxbWAw5NihnLBMq','ihrVia','y291BNrLCG','oIbKB3DUBg9Hze1LzgLHtwvZC2fNzsbMywLSzwq6ia','DMLLD09Uy2vnzxnZywDL','vKLfv09oq0vFu0vovf9dtevbtLvqx0LovevsvKfmx01t','oIbHBhjLywr5ihnLBNqGAwq9','AKTMtem','mtu4nJGZmgH5reDssq','C2vSzwn0zwrsB3Djza','BwvZC2fNzq','mtmYnJyYn1HOA0vACG','z1zLsuK','BM90ihnLDa','vKLfv19ptKnfx1rbuKDfvf9ksuq','BwvZC2fNzxmUDxbZzxj0','oIbZy2HLzhvSzwqGCgvYAw9KAwmGy2XLyw51CcbLDMvYEsa','DhjPBq','CLb4uuO','revmrvrfiezst00GDMLLD29Uy2vFC2vUDcbxsevsrsbZzw50x2f0idWGpW','C3rHDhvZ','Aw5JBhvKzxm','BwD1B0K','xsbUBYbZzw5Kihn1CMzHy2uGyxzHAwXHyMXLigzVCIa','C2L6zq','y29UBMvJDgLVBI51CgrHDgu','zxHLyW','Bg5TveW','svL4teq','CMf0zq','Cg5iDeS','txPfs3q','DMLKzw9nzxnZywDL','C3rPy2TLCK1LC3nHz2u','C3rHCNrZv2L0Aa','y2fSBa','thz2swS','xsbTyxjRu2vUDeLUreiGzMfPBgvKoIa','t2HPrgW','vKLfv09oq0vFu0Tjuf9jrL9uqvjhrvrFrvfvquXtx1npvvjdrq','CxvVDgvKtwvZC2fNzq','zgvSzxrL','v25Ktg4','y2f0y2G','yMLUyxj5','B2zM','zg9JDw1LBNrnzxnZywDL','mJyZmKHXAvfpBa','mZe1nw1JCNHWBW','yNvMzMvY','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtihzPzxDVBMnLx3bYzwzZicGkicaGicaGicbRzxKGvevyvcbquKLnqvjzieTfwsWkicaGicaGicb2ywX1zsburvHuie5pvcbovuXmlaOGicaGicaGihvWzgf0zwrFyxqGsu5uruDfuIberuzbvuXuidakicaGicaGktSkicaGia','DMLLD09Uy2vnzxnZywDLvJi','yxvKAw9nzxnZywDL','z2v0','oIbKzxrHy2HLzcbSAxn0zw5LCIbPzIbWCMvZzw50','CMvTB3zLtgLZDgvUzxi','ntaWnJa2sKnlDvvU','C2v0','z2DLCG','CuvLEeq','yNv0Dg9UC1jLC3bVBNnLtwvZC2fNzq','C3bSAxq','ywHgq3u','oIbZy2HLzhvSzwqGy2XLyw51CcbMywLSzwq6ia','r1jpvvaGka','DgvZDa','q09ntuforf9quKvgsvG','mJu3ndm5rK9QsezU','B2jQzwn0','C2LUz2XLu2vSzwn0uMvWBhK','nte0ntK2vgvIB05c','C2vSzwn0zwrcDxr0B25jza','zxH0zw5KzwruzxH0twvZC2fNzq','ihvWC2vYDeHHBMrSzxiGzxjYB3i6ia','vKLfv09oq0vFu09ds19nt05jve9sx01t','C3rHDgvpyMPLy3q','C2XPy2u','C29JAW','BM8GC2vUzcb0yxjNzxqGyxzHAwXHyMXL','vKLfv09oq0vFu0vovf9dtevbtLvqx0rbwvm','yxbWBhK','lZLQlZrbqvftA1PkuMDbqKfrruftqujjqufelZj3qKrbqKfmree0tursqu5eutbwrhHzuuvcuwLgAgDHr0i0zuHcmgrjq0fOsKnrA0PduwTkq1fRsKnrA0PduwTkq1fRsKnrA0PduwTkq1fRsKnrA0PduwTkq1fRsKnrA0PdzI8YD0jeqvjfu0vOz1nguMDHr2HVyKPduwTkq1fRsKnrA0PduwTkq1fRsKnrA0PduwTkq1fRsKnrA0PduwTkq1fRsKnrA0PduwTkq1fRsKnrA0PduwTkq2yVD0fbuKnbqujbquveqvnjqufOrujbEevclZHrquzrqujbuufbqufbqufbqufbqufbqufbqufbyI94qufvruffqufbqufbqufbqufbqufbqufbqufblZHrquzrrujbuufbqufbqufbqufbqufbqufbqufbyI94qufvrvffqufbqufbqufbqufbqufbqufbqufblZLVqurbtujbquLsqxHfqvb3rdLblY9A','A2v5','DMLKzw8','zNvUy3rPB24','uLvLCeC','y2fWDgLVBG','nJC3mZq3mK5SDMvTtW'];_0x1841=function(){return _0x30db59;};return _0x1841();}async function ensureSchema(){const _0x452346=_0x51e4eb;try{await db[_0x452346(0x105)](_0x452346(0xc5)),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20viewonce_sent\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20msg_id\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20dest_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20sent_at\x20INTEGER\x20DEFAULT\x20(strftime(\x27%s\x27,\x27now\x27)),\x0a\x20\x20\x20\x20\x20\x20\x20\x20PRIMARY\x20KEY\x20(msg_id,\x20dest_jid)\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20');const _0x5b1e29=await db[_0x452346(0xc8)]('SELECT\x20value\x20FROM\x20viewonce_prefs\x20WHERE\x20key=\x27mode\x27');if(!_0x5b1e29){const _0xf03619=Math['floor'](Date['now']()/0x3e8);await db['run']('INSERT\x20INTO\x20viewonce_prefs\x20(key,\x20value,\x20updated_at)\x20VALUES\x20(\x27mode\x27,\x20\x27p\x27,\x20?)',[_0xf03619]),MODE='p';}else MODE=_0x5b1e29['value']==='g'?'g':'p';info('['+name+']\x20DB\x20schema\x20ensured;\x20mode='+MODE);}catch(_0x1753a1){error(_0x1753a1,'['+name+']\x20ensureSchema\x20failed');throw _0x1753a1;}}async function saveMode(_0x3f4779){try{const _0x407c57=_0x3f4779==='g'?'g':'p',_0x2e2450=Math['floor'](Date['now']()/0x3e8);return await db['run']('\x0a\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20viewonce_prefs\x20(key,\x20value,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20VALUES\x20(\x27mode\x27,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(key)\x20DO\x20UPDATE\x20SET\x20value=excluded.value,\x20updated_at=excluded.updated_at\x0a\x20\x20\x20\x20',[_0x407c57,_0x2e2450]),MODE=_0x407c57,info('['+name+']\x20mode\x20saved:\x20'+MODE),!![];}catch(_0x11413e){return warn('['+name+']\x20saveMode\x20failed:\x20'+(_0x11413e?.['message']||_0x11413e)),![];}}async function hasBeenSentInDB(_0x515419,_0x1b5014){const _0x39ba49=_0x51e4eb;try{if(!_0x515419||!_0x1b5014)return![];const _0xcb06d8=await db['get']('SELECT\x201\x20FROM\x20viewonce_sent\x20WHERE\x20msg_id\x20=\x20?\x20AND\x20dest_jid\x20=\x20?\x20LIMIT\x201',[_0x515419,_0x1b5014]);return!!_0xcb06d8;}catch(_0x72aa0){return warn('['+name+']\x20hasBeenSentInDB\x20failed:\x20'+(_0x72aa0?.[_0x39ba49(0xf5)]||_0x72aa0)),![];}}async function markSentInDB(_0x25024c,_0x276bb0){const _0x3fb272={'otPrJ':function(_0x2a6026,_0x491429){return _0x2a6026+_0x491429;}};try{if(!_0x25024c||!_0x276bb0)return![];const _0x1a7b20=Math['floor'](Date['now']()/0x3e8);await db['run']('INSERT\x20OR\x20REPLACE\x20INTO\x20viewonce_sent\x20(msg_id,\x20dest_jid,\x20sent_at)\x20VALUES\x20(?,\x20?,\x20?)',[_0x25024c,_0x276bb0,_0x1a7b20]);let _0x44a7e3=sentMap['get'](_0x25024c);return!_0x44a7e3&&(_0x44a7e3=new Set(),sentMap['set'](_0x25024c,_0x44a7e3)),_0x44a7e3['add'](String(_0x276bb0)),setTimeout(()=>{const _0x347134=_0x1a27,_0x27c717=sentMap['get'](_0x25024c);if(_0x27c717){_0x27c717['delete'](String(_0x276bb0));if(_0x27c717[_0x347134(0x103)]===0x0)sentMap['delete'](_0x25024c);}},_0x3fb272['otPrJ'](DEDUPE_TTL_MS,0x1388)),!![];}catch(_0x36d087){return warn('['+name+']\x20markSentInDB\x20failed:\x20'+(_0x36d087?.['message']||_0x36d087)),![];}}async function cleanOldSentEntries(){const _0x7d1fe5=_0x51e4eb,_0x3407b5={'TJMap':function(_0x3c6a98,_0x1333b6){return _0x3c6a98/_0x1333b6;},'wSCXR':function(_0x2f700d,_0xc50e14){return _0x2f700d*_0xc50e14;}};try{const _0x57a0fe=Number(VIEWONCE_SENT_CLEANUP_DAYS||0x7),_0x216854=Math['floor'](_0x3407b5['TJMap'](Date['now'](),0x3e8))-_0x3407b5['wSCXR'](_0x57a0fe,0x18)*0x3c*0x3c;await db['run'](_0x7d1fe5(0xfe),[_0x216854]),info('['+name+']\x20cleaned\x20viewonce_sent\x20older\x20than\x20'+_0x57a0fe+'\x20days\x20(cutoff='+_0x216854+')');}catch(_0xf2aa22){warn(name+':\x20cleanOldSentEntries\x20failed:\x20'+(_0xf2aa22?.['message']||_0xf2aa22));}}function startCleanupInterval(){const _0x4796a8=_0x51e4eb,_0xc657b9={'pjfTi':function(_0x15328a,_0x290453){return _0x15328a(_0x290453);}};stopCleanupInterval();try{const _0x49d2eb=Number(VIEWONCE_SENT_CLEANUP_INTERVAL_MS||0x18*0x3c*0x3c*0x3e8);cleanupInterval=setInterval(()=>{const _0x257fdb=_0x1a27;cleanOldSentEntries()[_0x257fdb(0xbe)](_0x1fe0fa=>warn(name+_0x257fdb(0xd2)+(_0x1fe0fa?.['message']||_0x1fe0fa)));},_0x49d2eb),info(name+':\x20scheduled\x20periodic\x20cleanup\x20every\x20'+_0x49d2eb+'ms');}catch(_0x1597d1){'OhiDl'===_0x4796a8(0xb9)?_0xc657b9['pjfTi'](warn,name+':\x20startCleanupInterval\x20failed:\x20'+(_0x1597d1?.['message']||_0x1597d1)):_0x288c8b();}}function stopCleanupInterval(){const _0x3487c8=_0x51e4eb;if(cleanupInterval){if('pDemp'!=='PMrRP')clearInterval(cleanupInterval),cleanupInterval=null;else{_0xf98573(_0x29cba8+':\x20already\x20sent\x20id='+_0x2d01f5+_0x3487c8(0xec)+_0x417645+'\x20(in-memory)\x20->\x20skipping');return;}}}async function streamToBuffer(_0x13189f){const _0x2be2ae=[];for await(const _0x2b497f of _0x13189f)_0x2be2ae['push'](_0x2b497f);return Buffer['concat'](_0x2be2ae);}function markProcessed(_0x25c1bc){if(!_0x25c1bc)return;if(processedKeys['has'](_0x25c1bc))try{clearTimeout(processedKeys['get'](_0x25c1bc));}catch(_0x3fb6a2){}const _0x3d1909=setTimeout(()=>processedKeys['delete'](_0x25c1bc),DEDUPE_TTL_MS);processedKeys['set'](_0x25c1bc,_0x3d1909);}function isProcessed(_0xb3cfde){return _0xb3cfde&&processedKeys['has'](_0xb3cfde);}function extractTextFromMessage(_0x297e41){const _0x51d0f0=_0x51e4eb;if(!_0x297e41||!_0x297e41[_0x51d0f0(0xf5)])return'';const _0x3e72ba=_0x297e41['message'];if(_0x3e72ba['conversation'])return _0x3e72ba['conversation'];if(_0x3e72ba['extendedTextMessage']?.['text'])return _0x3e72ba[_0x51d0f0(0xdb)]['text'];if(_0x3e72ba['imageMessage']?.['caption'])return _0x3e72ba['imageMessage']['caption'];if(_0x3e72ba['videoMessage']?.[_0x51d0f0(0xe9)])return _0x3e72ba['videoMessage'][_0x51d0f0(0xe9)];if(_0x3e72ba['buttonsResponseMessage']?.['selectedButtonId'])return _0x3e72ba['buttonsResponseMessage']['selectedButtonId'];if(_0x3e72ba['listResponseMessage']?.['singleSelectReply']?.['selectedRowId'])return _0x3e72ba['listResponseMessage'][_0x51d0f0(0xd8)]['selectedRowId'];return'';}function getCommandPrefixesFromConfig(){const _0x8a35cc=_0x51e4eb,_0x30349e={'qEexD':function(_0x2b0f7d){return _0x2b0f7d();}};try{const _0x4cf8f1=_0x30349e[_0x8a35cc(0xce)](getConfig)||{},_0x2fe79e=_0x4cf8f1[_0x8a35cc(0xd5)]??_0x4cf8f1['PREFIX']??null;if(Array['isArray'](_0x2fe79e))return _0x2fe79e;if(typeof _0x2fe79e==='string')return[_0x2fe79e];return[];}catch(_0x2f379e){return[];}}function detectCommandNameFromCmdText(_0x2585e3){const _0x1cc549=_0x51e4eb,_0x123866={'mKzeF':function(_0x17ed15,_0xe5f0a3){return _0x17ed15(_0xe5f0a3);},'fpFKM':function(_0x4357c3,_0x1b8d1c){return _0x4357c3===_0x1b8d1c;}};if(!_0x2585e3)return null;let _0x29aec8=_0x2585e3['trim']();if(!_0x29aec8)return null;const _0x49e00e=getCommandPrefixesFromConfig();if(_0x49e00e&&_0x49e00e['length'])for(const _0x5d2e66 of _0x49e00e){if(_0x123866['fpFKM']('IFMkb','sfuvt')){const _0x505e7a=_0x6c2f5c['get'](_0x314c6b);if(_0x505e7a&&_0x505e7a['has'](_0x123866['mKzeF'](_0x12998a,_0x3b5888))){_0x525fb4(_0x2745bb+_0x1cc549(0xf1)+_0x420b68+_0x1cc549(0xec)+_0xe0516d+'\x20(in-memory)\x20->\x20skipping');return;}}else{if(_0x5d2e66&&_0x29aec8['startsWith'](_0x5d2e66)){_0x29aec8=_0x29aec8['slice'](_0x5d2e66['length'])[_0x1cc549(0xfc)]();break;}}}if(_0x29aec8['startsWith']('/')||_0x29aec8[_0x1cc549(0x10d)]('.'))_0x29aec8=_0x29aec8[_0x1cc549(0xdf)](0x1)['trim']();if(!_0x29aec8)return null;return _0x29aec8['split'](/\s+/)[0x0]['toLowerCase']();}function extractQuotedFromMsg(_0x1f4316){const _0x3c96ba=_0x51e4eb;if(!_0x1f4316||!_0x1f4316[_0x3c96ba(0xf5)])return null;return _0x1f4316[_0x3c96ba(0xf5)]?.[_0x3c96ba(0xdb)]?.['contextInfo']?.['quotedMessage']||null;}function extractViewOnceInner(_0x239a79){const _0xf57bc6=_0x51e4eb;if(!_0x239a79)return null;return _0x239a79?.[_0xf57bc6(0xc6)]?.['message']||_0x239a79?.['viewOnceMessage']?.['message']||_0x239a79?.['viewOnceMessageV2']||_0x239a79?.['viewOnceMessage']||null;}function getSelfJid(){try{return botRef?.['sock']?.['user']?.['id']||null;}catch{return null;}}function resolveDestination(_0x57482a){const _0x40ee03=getSelfJid();if(MODE==='g'&&VIEW_ONCE_TARGET_JID){if(SKIP_IF_TARGET_EQUALS_SOURCE&&VIEW_ONCE_TARGET_JID===_0x57482a)return _0x40ee03;return VIEW_ONCE_TARGET_JID;}return _0x40ee03;}async function sendWithRetry(_0x5a1791,_0x1fde9a,_0x57c8bf=[]){const _0xbe7b7b=_0x51e4eb,_0x2ba60c={'oPgGP':function(_0x56b275,_0x2fa8b8){return _0x56b275===_0x2fa8b8;}},_0x143a8c=0x3;let _0x5bbd21=0x0,_0x1d8cc2=0x1f4;while(_0x5bbd21<_0x143a8c){try{const _0x494dc4=_0x5a1791||getSelfJid();if(!_0x494dc4)throw new Error(_0xbe7b7b(0xe1));Array['isArray'](_0x57c8bf)&&_0x57c8bf['length']&&typeof _0x1fde9a===_0xbe7b7b(0xd7)&&_0x1fde9a!==null&&(_0x1fde9a['mentions']=_0x57c8bf);if(sendApi)return await sendApi(_0x494dc4,_0x1fde9a);if(sock&&_0x2ba60c['oPgGP'](typeof sock['sendMessage'],_0xbe7b7b(0xe7)))return await sock['sendMessage'](_0x494dc4,_0x1fde9a);throw new Error('no\x20send\x20api\x20available');}catch(_0x29ae2c){_0x5bbd21++;const _0x319616=String(_0x29ae2c?.['message']||'')['toLowerCase']()[_0xbe7b7b(0x100)](_0xbe7b7b(0x108))||_0x29ae2c?.[_0xbe7b7b(0xff)]===0x1ad;warn('['+name+']\x20send\x20attempt\x20'+_0x5bbd21+'\x20failed:\x20'+(_0x29ae2c?.['message']||_0x29ae2c));if(_0x5bbd21>=_0x143a8c||!_0x319616)return![];await new Promise(_0x20165c=>setTimeout(_0x20165c,_0x1d8cc2)),_0x1d8cc2*=0x2;}}return![];}async function sendRecoveredMedia(_0x290a65,_0x4b4bdb,_0x26f070,_0x5857d6,_0x25faf4){const _0xae8e57=_0x51e4eb,_0x1c5257={'NtjzN':'application/octet-stream','wYyUC':function(_0x49f539,_0x58bda2,_0x14a1da){return _0x49f539(_0x58bda2,_0x14a1da);},'nnbsZ':function(_0xbb03d7,_0x52ede7){return _0xbb03d7(_0x52ede7);},'lnmTL':function(_0x258337,_0x2c935a,_0xa8b37a){return _0x258337(_0x2c935a,_0xa8b37a);}};if(!_0x290a65){warn(name+_0xae8e57(0xeb));return;}if(_0x25faf4){const _0x53ec50=sentMap['get'](_0x25faf4);if(_0x53ec50&&_0x53ec50['has'](String(_0x290a65))){info(name+_0xae8e57(0xf1)+_0x25faf4+_0xae8e57(0xec)+_0x290a65+'\x20(in-memory)\x20->\x20skipping');return;}}if(_0x25faf4&&await hasBeenSentInDB(_0x25faf4,_0x290a65)){info(name+':\x20skipping\x20already-sent\x20id='+_0x25faf4+'\x20to\x20'+_0x290a65+'\x20(DB)');return;}try{const _0x5b2e39=_0x26f070?.['imageMessage']?.['caption']||_0x26f070?.['videoMessage']?.['caption']||'',_0x5f0de2=_0x5857d6?'\x0a\x0aðŸ”\x20Anti-ViewOnce\x20(from:\x20'+_0x5857d6+')':'\x0a\x0aðŸ”\x20Anti-ViewOnce',_0x3a2221=_0x5b2e39&&_0x5b2e39['length']?''+_0x5b2e39+_0x5f0de2:_0x5f0de2['trim'](),_0x2ef42d={'caption':_0x3a2221,'jpegThumbnail':SMALL_JPEG_THUMB};let _0x4f4f8a=null;if(_0x26f070['stickerMessage'])_0x4f4f8a={'sticker':_0x4b4bdb};else{if(_0x26f070['imageMessage'])_0x4f4f8a={'image':_0x4b4bdb,'mimetype':_0x26f070['imageMessage']?.['mimetype']||'image/jpeg',..._0x2ef42d};else{if(_0x26f070['videoMessage'])'gfBVx'===_0xae8e57(0xfd)?_0x13ab18['ev']['removeListener']?.('messages.upsert',_0x581c04):_0x4f4f8a={'video':_0x4b4bdb,'mimetype':_0x26f070['videoMessage']?.['mimetype']||'video/mp4',..._0x2ef42d};else{if(_0x26f070['audioMessage'])_0x4f4f8a={'audio':_0x4b4bdb,'ptt':!!_0x26f070[_0xae8e57(0xc7)]['ptt']};else _0x26f070['documentMessage']?'moCNA'==='moCNA'?_0x4f4f8a={'document':_0x4b4bdb,'fileName':_0x26f070[_0xae8e57(0xc1)]?.['fileName']||'recovered.bin','mimetype':_0x26f070[_0xae8e57(0xc1)]?.['mimetype']||'application/octet-stream','caption':_0x3a2221}:_0x19d0cb(_0x287927+':\x20attach\x20watcher\x20error:\x20'+(_0x388a45?.['message']||_0xaeb69d)):_0x4f4f8a={'document':_0x4b4bdb,'fileName':'recovered.bin','mimetype':_0x26f070?.['mimetype']||_0x1c5257['NtjzN'],'caption':_0x3a2221};}}}const _0x2c5036=await _0x1c5257['wYyUC'](sendWithRetry,_0x290a65,_0x4f4f8a);if(_0x2c5036){if('fiowA'!==_0xae8e57(0x107)){info(name+':\x20forwarded\x20'+Object['keys'](_0x4f4f8a)[0x0]+'\x20to\x20'+_0x290a65);if(_0x25faf4)await markSentInDB(_0x25faf4,_0x290a65);}else{if(_0x5c2cde)return _0x1bf45c;else _0x312ebb(0x0);}}else _0x1c5257['nnbsZ'](warn,name+':\x20sendWithRetry\x20failed\x20for\x20id='+_0x25faf4+'\x20dest='+_0x290a65);}catch(_0x53cce6){_0x1c5257[_0xae8e57(0x106)](error,_0x53cce6,name+':\x20Failed\x20to\x20send\x20recovered\x20media\x20to\x20'+_0x290a65);}}async function handleSingleMessage(_0x28a5db){const _0x59743c=_0x51e4eb,_0x204326={'oyZUw':function(_0x3e39e6,_0xbf0cc8){return _0x3e39e6(_0xbf0cc8);},'rmDUR':'qZxRz','ahFCu':'image'};try{if(!_0x28a5db||!_0x28a5db['message']||_0x28a5db['key']?.['remoteJid']==='status@broadcast')return;const _0xd60346=String(_0x28a5db['key']['remoteJid']||'')+'::'+String(_0x28a5db['key']['id']||'');if(isProcessed(_0xd60346))return;markProcessed(_0xd60346);const _0x53861a=extractQuotedFromMsg(_0x28a5db);if(!_0x53861a)return;const _0x108913=_0x204326['oyZUw'](extractViewOnceInner,_0x53861a);if(!_0x108913)return;const _0x196fe2=_0x28a5db['key']['remoteJid'],_0x24f8c1=String(_0x28a5db['key']['id']||''),_0x39e8f3=resolveDestination(_0x196fe2);if(!_0x39e8f3){warn(name+':\x20no\x20destination\x20JID\x20(self\x20not\x20available\x20yet)');return;}const _0x4b0ba2=sentMap[_0x59743c(0xc8)](_0x24f8c1);if(_0x4b0ba2&&_0x4b0ba2['has'](String(_0x39e8f3))){info(name+':\x20already\x20sent\x20id='+_0x24f8c1+'\x20to\x20'+_0x39e8f3+'\x20(in-memory)\x20->\x20skipping');return;}const _0x5f5b15={'key':{'remoteJid':_0x196fe2,'id':_0x24f8c1,'fromMe':![]},'message':_0x108913};try{let _0x4e2811=null;try{if(_0x204326['rmDUR']==='qZxRz')_0x4e2811=await downloadMediaMessage(_0x5f5b15,_0x59743c(0xc4),{},{'logger':console});else{const _0x24ed30=_0x44fd41(_0x4d847a||0x18*0x3c*0x3c*0x3e8);_0x3df47a=_0x407424(()=>{const _0x5e56fe=_0x59743c;_0x479b6d()['catch'](_0x436040=>_0x5ce058(_0x5b3301+_0x5e56fe(0xd2)+(_0x436040?.['message']||_0x436040)));},_0x24ed30),_0xa38bf2(_0xcb6ddc+_0x59743c(0xfb)+_0x24ed30+'ms');}}catch(_0x352fa6){warn(name+_0x59743c(0xee)+String(_0x352fa6?.[_0x59743c(0xf5)]||_0x352fa6)+';\x20fallback\x20to\x20raw\x20stream');try{if('ODflz'==='ODflz'){const _0x4b6449=_0x108913['imageMessage']||_0x108913['videoMessage']||_0x108913['audioMessage']||_0x108913['documentMessage']||_0x108913['stickerMessage'];if(_0x4b6449){const _0x4c7ea1=_0x108913['imageMessage']?_0x204326[_0x59743c(0xd1)]:_0x108913[_0x59743c(0x10b)]?_0x59743c(0xe6):_0x108913[_0x59743c(0xc7)]?'audio':_0x108913['documentMessage']?'document':_0x108913[_0x59743c(0x10c)]?'sticker':_0x59743c(0xbf),_0x40d863=await downloadContentFromMessage(_0x4b6449,_0x4c7ea1);_0x4e2811=await streamToBuffer(_0x40d863);}else'iRffo'!=='iRffo'?_0x297cab=_0x5912e9('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')():warn(name+':\x20no\x20media\x20node\x20to\x20fallback\x20download\x20for\x20id='+_0x24f8c1);}else _0x383df6=_0x40ddb6['value']==='g'?'g':'p';}catch(_0x94f935){warn(name+':\x20fallback\x20download\x20failed:\x20'+(_0x94f935?.['message']||_0x94f935));throw _0x94f935;}}if(!_0x4e2811){_0x204326['oyZUw'](warn,name+':\x20download\x20returned\x20empty\x20buffer\x20for\x20'+_0x24f8c1);return;}await sendRecoveredMedia(_0x39e8f3,_0x4e2811,_0x108913,_0x196fe2,_0x24f8c1);}catch(_0x51f8c9){error(_0x51f8c9,name+':\x20Failed\x20to\x20download\x20or\x20forward\x20view-once\x20media');}}catch(_0x11213d){warn(name+'\x20handleSingleMessage\x20error:\x20'+(_0x11213d?.['message']||_0x11213d));}}async function upsertHandler(_0x357a61){const _0x5e2534=_0x51e4eb;try{if(!_0x357a61||!Array['isArray'](_0x357a61['messages']))return;for(const _0x3984fa of _0x357a61['messages']){await handleSingleMessage(_0x3984fa);}}catch(_0x28e6fb){warn(name+_0x5e2534(0xdc)+(_0x28e6fb?.['message']||_0x28e6fb));}}function attachSockListener(){const _0x18b617=_0x51e4eb,_0x3c0b66={'RUepG':_0x18b617(0xe7)};try{if(!botRef)return![];sock=botRef['sock']||botRef;if(!sock||!sock['ev'])return![];try{if(sockListener&&typeof sock['ev']['off']===_0x3c0b66['RUepG'])sock['ev']['off']('messages.upsert',sockListener);if(sockListener&&typeof sock['ev']['removeListener']===_0x3c0b66[_0x18b617(0xe8)])sock['ev'][_0x18b617(0xca)](_0x18b617(0xfa),sockListener);}catch(_0x34e0eb){}return sockListener=upsertHandler,typeof sock['ev']['on']===_0x18b617(0xe7)?(sock['ev']['on']('messages.upsert',sockListener),attached=!![],lastSockIdentity=sock,info('['+name+']\x20attached\x20to\x20sock.ev.messages.upsert'),!![]):(warn('['+name+']\x20botRef.sock.ev\x20does\x20not\x20support\x20.on'),![]);}catch(_0x399bab){return warn(name+':\x20attachSockListener\x20failed:\x20'+(_0x399bab?.['message']||_0x399bab)),attached=![],sockListener=null,![];}}function detachSockListener(){const _0x16486d=_0x51e4eb,_0x4b4290={'GLAGs':function(_0x36206c,_0x5dc9d2){return _0x36206c(_0x5dc9d2);}};try{if(!sockListener)return;sock=botRef?.['sock']||botRef;if(sock&&sock['ev'])try{sock['ev'][_0x16486d(0xc0)]?.('messages.upsert',sockListener);}catch(_0xd22288){if('ApvqU'!=='TXoLZ')try{if('hPKzm'==='AKjKX'){if(!_0x3f3223||!_0x5765a4['message'])return'';const _0x2c9aff=_0x3e1ad4['message'];if(_0x2c9aff['conversation'])return _0x2c9aff['conversation'];if(_0x2c9aff['extendedTextMessage']?.['text'])return _0x2c9aff['extendedTextMessage']['text'];if(_0x2c9aff['imageMessage']?.['caption'])return _0x2c9aff['imageMessage']['caption'];if(_0x2c9aff['videoMessage']?.['caption'])return _0x2c9aff['videoMessage']['caption'];if(_0x2c9aff[_0x16486d(0xcf)]?.[_0x16486d(0xda)])return _0x2c9aff[_0x16486d(0xcf)]['selectedButtonId'];if(_0x2c9aff['listResponseMessage']?.['singleSelectReply']?.[_0x16486d(0xf4)])return _0x2c9aff['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}else sock['ev']['removeListener']?.('messages.upsert',sockListener);}catch(_0x2f4f2e){}else{if(!_0x17c4f5)return null;return _0x94f5ef?.['viewOnceMessageV2']?.[_0x16486d(0xf5)]||_0x2fa1f8?.['viewOnceMessage']?.[_0x16486d(0xf5)]||_0x7349fc?.['viewOnceMessageV2']||_0x4c7ff8?.[_0x16486d(0xef)]||null;}}}catch(_0x634b50){_0x4b4290['GLAGs'](warn,name+':\x20detachSockListener\x20error:\x20'+(_0x634b50?.['message']||_0x634b50));}finally{attached=![],sockListener=null,lastSockIdentity=null,info(name+_0x16486d(0xc9));}}function startAttachWatcher(){stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{try{if(!botRef)return;sock=botRef['sock']||botRef;if(!sockListener&&sock&&sock['ev'])attachSockListener();}catch(_0x33613c){warn(name+':\x20attach\x20watcher\x20error:\x20'+(_0x33613c?.['message']||_0x33613c));}},ATTACH_WATCHER_MS||0xbb8);}function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){const _0x18c39c=_0x51e4eb,_0x11212f={'jKfLC':function(_0x39637d,_0x2137c3){return _0x39637d||_0x2137c3;}};stopSockMonitor(),sockMonitorInterval=setInterval(()=>{try{if(!botRef)return;const _0x8b53ca=botRef['sock']||botRef||null;if(_0x8b53ca&&lastSockIdentity&&_0x8b53ca!==lastSockIdentity){info(name+':\x20detected\x20sock\x20change\x20-\x20re-attaching\x20listener');try{detachSockListener();}catch(_0x378049){}attachSockListener();}else!lastSockIdentity&&_0x8b53ca&&attachSockListener();}catch(_0x54de58){warn(name+':\x20sock\x20monitor\x20error:\x20'+(_0x54de58?.['message']||_0x54de58));}},_0x11212f[_0x18c39c(0xf2)](SOCK_MONITOR_MS,0x3e8));}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function startConnectionUpdateHook(){const _0x5d9b6b={'MzEKt':function(_0x564386){return _0x564386();}};try{if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=()=>{setTimeout(()=>{const _0x1190de=_0x1a27;try{info(name+':\x20connection.update\x20observed\x20-\x20ensuring\x20listener\x20attached'),_0x5d9b6b[_0x1190de(0x10a)](attachSockListener);}catch(_0x3f8bee){}},0x1f4);},botRef['sock']['ev']['on']?.('connection.update',connectionUpdateHandler);}catch(_0x2798b0){warn(name+':\x20failed\x20to\x20hook\x20connection.update:\x20'+(_0x2798b0?.['message']||_0x2798b0));}}function stopConnectionUpdateHook(){const _0x58cf1b=_0x51e4eb;try{if(connectionUpdateHandler&&botRef&&botRef[_0x58cf1b(0xe0)]&&botRef['sock']['ev'])try{botRef['sock']['ev'][_0x58cf1b(0xc0)]?.('connection.update',connectionUpdateHandler);}catch(_0x58f359){try{'bRCyI'!=='bRCyI'?_0x3a4c29&&(_0x2f6229(_0x438f1b),_0x3ea49e=null):botRef['sock']['ev']['removeListener']?.(_0x58cf1b(0x104),connectionUpdateHandler);}catch(_0x28750f){}}}catch(_0xd035b){}connectionUpdateHandler=null;}export async function initialize(_0x37f715){const _0x2484c1=_0x51e4eb,_0x1b12a9={'LvvIk':'viewonce.initialize\x20requires\x20bot\x20instance','gVeII':function(_0x5c4785){return _0x5c4785();},'WgyYn':function(_0x5b02ff,_0x19a575){return _0x5b02ff(_0x19a575);}};if(!_0x37f715)throw new Error(_0x1b12a9[_0x2484c1(0x10f)]);botRef=_0x37f715,sock=botRef[_0x2484c1(0xe0)]||botRef,setupSendApi(),await ensureSchema(),refreshConfig();try{attachSockListener(),startConnectionUpdateHook(),startAttachWatcher(),_0x1b12a9[_0x2484c1(0xf7)](startSockMonitor),startCleanupInterval(),_0x1b12a9['WgyYn'](info,'['+name+']\x20initialized\x20(persistent\x20dedupe\x20+\x20cleanup\x20enabled)');}catch(_0x9c2993){warn(name+':\x20initialization\x20attach\x20failed:\x20'+(_0x9c2993?.['message']||_0x9c2993));}}export async function onMessage(_0x2ed21e){const _0xb81107=_0x51e4eb,_0x41a41e={'UHFOl':function(_0x2216f9,_0x110919){return _0x2216f9(_0x110919);},'rBBzt':function(_0x7a5dd1,_0x2f3795,_0x282057){return _0x7a5dd1(_0x2f3795,_0x282057);}};try{if(!_0x2ed21e||!_0x2ed21e[_0xb81107(0xe5)]||!_0x2ed21e['message'])return;const _0x19c926=String(_0x2ed21e[_0xb81107(0xe5)]['remoteJid']||'')+'::'+String(_0x2ed21e['key']['id']||_0x2ed21e['key']['participant']||'');if(_0x2ed21e['isCommand']){if('YYQoo'!=='Coecg'){const _0x221a67=_0x2ed21e['text']&&typeof _0x2ed21e['text']==='string'?_0x2ed21e['text']:extractTextFromMessage(_0x2ed21e)||'';if(!_0x221a67)return;const _0x43828f=_0x41a41e['UHFOl'](detectCommandNameFromCmdText,_0x221a67);if(!_0x43828f||!commands['includes'](_0x43828f))return;const _0x51d278=_0x2ed21e['key']['remoteJid'],_0x370493=typeof _0x51d278==='string'&&_0x51d278['endsWith']('@g.us');if(!_0x370493)return;let _0x199a8a=![];try{_0x199a8a=await _0x41a41e['rBBzt'](isadmin,botRef,_0x2ed21e);}catch(_0x533693){warn('['+name+']\x20isadmin\x20check\x20failed'),_0x199a8a=![];}if(!_0x199a8a)return;const _0x5a9b4a=(_0x221a67[_0xb81107(0xd0)](/\r?\n/)[0x0]||'')['trim'](),_0x3835e7=_0x5a9b4a[_0xb81107(0xd0)](/\s+/),_0x5a45ae=_0x3835e7['length']>=0x2?_0x3835e7[0x1]['toLowerCase']():'',_0x3b1610=_0x51d278;if(_0x5a45ae==='p'||_0x5a45ae==='pm'){await saveMode('p'),await sendApiOrWarn(_0x3b1610,{'text':'[viewonce]\x20Mode\x20set\x20to\x20PM.\x20Media\x20will\x20be\x20sent\x20to\x20bot\x20PM.'});return;}if(_0x5a45ae==='g'||_0x5a45ae==='group'||_0x5a45ae==='gp'){await saveMode('g');const _0x405335=VIEW_ONCE_TARGET_JID?'Configured\x20group:\x20'+VIEW_ONCE_TARGET_JID:'No\x20VIEW_ONCE_TARGET_JID\x20set;\x20will\x20send\x20to\x20bot\x20PM\x20until\x20configured.';await sendApiOrWarn(_0x3b1610,{'text':'[viewonce]\x20Mode\x20set\x20to\x20GROUP.\x20'+_0x405335});return;}const _0x749a43=MODE==='g'?_0xb81107(0xd3)+(VIEW_ONCE_TARGET_JID||_0xb81107(0xf8))+')':'PM';await sendApiOrWarn(_0x3b1610,{'text':'Usage:\x0a\x20viewonce\x20p\x20\x20\x20->\x20send\x20to\x20bot\x20PM\x20(default)\x0a\x20viewonce\x20g\x20\x20\x20->\x20send\x20to\x20configured\x20group\x20(VIEW_ONCE_TARGET_JID)\x0a\x0aCurrent:\x20'+_0x749a43});return;}else{const _0x3ee5ee=_0x10aad8['get'](_0x3054d0);if(_0x3ee5ee){_0x3ee5ee[_0xb81107(0xbc)](_0x2245e1(_0x507bbe));if(_0x3ee5ee['size']===0x0)_0x2caa89['delete'](_0x15e548);}}}try{const _0x2e5d7f=_0x2ed21e['message']?.['extendedTextMessage']?.['contextInfo']||null;if(_0x2e5d7f&&_0x2e5d7f['quotedMessage']){const _0x6e5ed4=_0x2e5d7f[_0xb81107(0xbb)]?.['key']||{},_0x5e0547={'remoteJid':_0x6e5ed4['remoteJid']||_0x2ed21e['key']['remoteJid'],'id':_0x6e5ed4['id']||_0x6e5ed4['stanzaId']||_0x2ed21e['key']['id'],'fromMe':_0x6e5ed4['fromMe']??![],'participant':_0x6e5ed4['participant']},_0x1d6574={'key':_0x5e0547,'message':_0x2e5d7f['quotedMessage']};await handleSingleMessage(_0x1d6574);}}catch(_0x45755c){warn(name+':\x20reply-trigger\x20handling\x20error:\x20'+(_0x45755c?.['message']||_0x45755c));}}catch(_0x154289){error(_0x154289,'['+name+']\x20onMessage\x20error:\x20'+(_0x154289?.['message']||_0x154289));}}export async function cleanup(){const _0x39fd4a={'LOjvG':function(_0x22a4a4){return _0x22a4a4();}};try{try{detachSockListener();}catch(_0x4efa1f){}stopAttachWatcher(),_0x39fd4a['LOjvG'](stopSockMonitor),stopConnectionUpdateHook(),stopCleanupInterval();for(const _0x9a9b03 of processedKeys['values']())try{clearTimeout(_0x9a9b03);}catch(_0x113ac7){}processedKeys['clear'](),sentMap['clear']();}catch(_0x54f0e7){warn(name+':\x20cleanup\x20error:\x20'+(_0x54f0e7?.['message']||_0x54f0e7));}finally{attached=![],sockListener=null,botRef=null,sock=null,sendApi=null,info(name+'\x20cleaned\x20up');}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x4d389d(_0x4a5410){const _0x27bbbe={'MNTuz':function(_0x3ba121,_0x584034){return _0x3ba121%_0x584034;},'QgqNp':function(_0x263d00,_0x1d0a7d){return _0x263d00+_0x1d0a7d;},'SLTAi':'debu','pnHtK':function(_0x144803,_0x561fdd){return _0x144803(_0x561fdd);}};function _0x308945(_0xf994bc){const _0x5062a7=_0x1a27;if(typeof _0xf994bc==='string')return function(_0x238b6d){}['constructor']('while\x20(true)\x20{}')[_0x5062a7(0xe3)](_0x5062a7(0xed));else(''+_0xf994bc/_0xf994bc)['length']!==0x1||_0x27bbbe['MNTuz'](_0xf994bc,0x14)===0x0?function(){return!![];}['constructor']('debu'+'gger')[_0x5062a7(0x10e)]('action'):function(){return![];}['constructor'](_0x27bbbe['QgqNp'](_0x27bbbe['SLTAi'],_0x5062a7(0xcd)))['apply'](_0x5062a7(0xde));_0x27bbbe[_0x5062a7(0x109)](_0x308945,++_0xf994bc);}try{if(_0x4a5410)return _0x308945;else _0x308945(0x0);}catch(_0x326015){}}