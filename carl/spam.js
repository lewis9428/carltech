(function(_0x8e0b8d,_0x3a0ff5){const _0x41f2c1=_0x18db,_0x3c5dbb=_0x8e0b8d();while(!![]){try{const _0x393dfd=-parseInt(_0x41f2c1(0x133))/0x1*(parseInt(_0x41f2c1(0x127))/0x2)+-parseInt(_0x41f2c1(0x129))/0x3+-parseInt(_0x41f2c1(0x13e))/0x4+-parseInt(_0x41f2c1(0x148))/0x5*(-parseInt(_0x41f2c1(0x130))/0x6)+parseInt(_0x41f2c1(0x12e))/0x7*(-parseInt(_0x41f2c1(0x142))/0x8)+parseInt(_0x41f2c1(0x14c))/0x9*(parseInt(_0x41f2c1(0x14f))/0xa)+parseInt(_0x41f2c1(0x124))/0xb;if(_0x393dfd===_0x3a0ff5)break;else _0x3c5dbb['push'](_0x3c5dbb['shift']());}catch(_0x1a5216){_0x3c5dbb['push'](_0x3c5dbb['shift']());}}}(_0x4994,0x28fc1));function _0x18db(_0x35667a,_0x20198){const _0x45dfe2=_0x4994();return _0x18db=function(_0x30ece3,_0x593d8c){_0x30ece3=_0x30ece3-0x117;let _0x30993e=_0x45dfe2[_0x30ece3];if(_0x18db['OPPsJV']===undefined){var _0x34bb84=function(_0x4c0e5c){const _0x107379='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3be86c='',_0x5d36ca='';for(let _0x5c5967=0x0,_0x5ef048,_0x54b998,_0x1e1e5e=0x0;_0x54b998=_0x4c0e5c['charAt'](_0x1e1e5e++);~_0x54b998&&(_0x5ef048=_0x5c5967%0x4?_0x5ef048*0x40+_0x54b998:_0x54b998,_0x5c5967++%0x4)?_0x3be86c+=String['fromCharCode'](0xff&_0x5ef048>>(-0x2*_0x5c5967&0x6)):0x0){_0x54b998=_0x107379['indexOf'](_0x54b998);}for(let _0xed28f6=0x0,_0x5aabf=_0x3be86c['length'];_0xed28f6<_0x5aabf;_0xed28f6++){_0x5d36ca+='%'+('00'+_0x3be86c['charCodeAt'](_0xed28f6)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x5d36ca);};_0x18db['HkeFNw']=_0x34bb84,_0x35667a=arguments,_0x18db['OPPsJV']=!![];}const _0x499411=_0x45dfe2[0x0],_0x18db02=_0x30ece3+_0x499411,_0xd43558=_0x35667a[_0x18db02];return!_0xd43558?(_0x30993e=_0x18db['HkeFNw'](_0x30993e),_0x35667a[_0x18db02]=_0x30993e):_0x30993e=_0xd43558,_0x30993e;},_0x18db(_0x35667a,_0x20198);}import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isadmin as _0x177d72}from'../utils/isadmin.js';function _0x4994(){const _0x2d45fa=['yNv0Dg9UC1jLC3bVBNnLtwvZC2fNzq','BgfZDfDHCM5bDa','qKfuq0HFrevmqvLFtvm','z3jVDxbZlNvWzgf0zq','zxHWAxjLC0f0','AxnjBNrLz2vY','uevsx0niqvrFuvvfvuvFteLnsvq','BwvZC2fNzq','C2vUze1LC3nHz2u','sgfyDhK','mJyYmdm2z0vvAxn5','z2v0','y2XLyxi','Bhbcv2q','mJr2Bfzrs1O','B2zM','CMvTB3rLsMLK','C2vSzwn0zwrcDxr0B25jza','qMHgBNi','zNvUy3rPB24GkLWOicPCkq','nuvAv2PRBW','D1fluMW','zNvUy3rPB24','u1bbtv9dt09mre9xtL9nuW','mJyXBKj4sKTe','D2HPBguGkhrYDwuPihT9','u1bbtq','otyWmZbnB2v5Au0','v0fstKLor19uveXFtvm','z3fvyK8','BgvUz3rO','A2v5','u1bbtv9xsu5et1DFtvm','Bwf4','z3jVDxaTCgfYDgLJAxbHBNrZlNvWzgf0zq','z3jVDxaTCgfYDgLJAxbHBNrZ','s0Lds19ptL9tuefn','C3bSAwnL','C2v0','EuPPuMq','y2fWDgLVBG','tufyx1DbuK5jtKDt','CMvTB3zL','C29JAW','BwvZC2fNzxmUDxbZzxj0','AgfZ','r0XpqKfmx0nptKnvuLjftKnz','mtCZntq5mNnTtuXYAG','y29UBMvJDgLVBI51CgrHDgu','u0vorf9eruXbwv9nuW','mJe1nZjPuurWzLy','ru5bqKXfra','nZmYnZGZq0Dut0vn','zfntvuW','qgCUDxm','C2HPzNq','zgvSzxrL','nZy4ntnUyMvJCfi','ywn0Aw9U','mta5mZa4nKrIy3jTuG','z3jVDxbkAwq','qKfuq0HFu0LArq','mtbkrKz4rhe'];_0x4994=function(){return _0x2d45fa;};return _0x4994();}export const name='spam';export const version='1.0.0';export const priority=0x5a;export const configKeys=['SPAM'];let botRef=null,initialized=![],shuttingDown=![];const CFG={'ENABLED':!![],'SPAM_THRESHOLD':0x5,'SPAM_WINDOW_MS':0xfa0,'SPAM_COOLDOWN_MS':0x1388,'MAX_WARNINGS':0x3,'WARN_EXPIRY_MS':0x7*0x18*0x3c*0x3c*0x3e8,'KICK_ON_SPAM':!![],'WARNING_MESSAGE':'⚠️\x20{user},\x20stop\x20spamming.\x20Remaining\x20warnings\x20{warnings}','WARNING_TTL_MS':0x1388,'SEND_DELAY_MS':0x12c,'BATCH_SIZE':0x8,'BATCH_DELAY_MS':0x320,'GLOBAL_CONCURRENCY':0x2,'PER_CHAT_QUEUE_LIMIT':0x3e8,'LINK_REGEX':null};function refreshConfig(){const _0xa1fdf3=_0x18db,_0x4b1eca=(function(){let _0xba3b5b=!![];return function(_0x162134,_0x519164){const _0x546706=_0xba3b5b?function(){const _0x16d86e=_0x18db;if('xDHby'!=='EHROi'){if(_0x519164){if('BhFnr'!==_0x16d86e(0x146))return;else{const _0x48f79b=_0x519164['apply'](_0x162134,arguments);return _0x519164=null,_0x48f79b;}}}else return!![];}:function(){};return _0xba3b5b=![],_0x546706;};}());(function(){_0x4b1eca(this,function(){const _0x19152d=_0x18db,_0x33b08b=new RegExp(_0x19152d(0x147)),_0x5cbe44=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x1184af=_0x30ece3('init');!_0x33b08b['test'](_0x1184af+'chain')||!_0x5cbe44['test'](_0x1184af+'input')?_0x1184af('0'):_0x30ece3();})();}());try{const _0x49fc33=getConfig()||{},_0x1a11f7=_0x49fc33&&_0x49fc33['SPAM']?_0x49fc33[_0xa1fdf3(0x14e)]:{};CFG[_0xa1fdf3(0x128)]=_0x1a11f7['ENABLED']??CFG['ENABLED'],CFG['SPAM_THRESHOLD']=Number[_0xa1fdf3(0x139)](_0x1a11f7['SPAM_THRESHOLD'])?_0x1a11f7['SPAM_THRESHOLD']:CFG['SPAM_THRESHOLD'],CFG['SPAM_WINDOW_MS']=Number['isFinite'](_0x1a11f7['SPAM_WINDOW_MS'])?_0x1a11f7[_0xa1fdf3(0x154)]:CFG['SPAM_WINDOW_MS'],CFG['SPAM_COOLDOWN_MS']=Number['isFinite'](_0x1a11f7[_0xa1fdf3(0x14b)])?_0x1a11f7['SPAM_COOLDOWN_MS']:CFG[_0xa1fdf3(0x14b)],CFG[_0xa1fdf3(0x11e)]=Number['isInteger'](_0x1a11f7[_0xa1fdf3(0x11e)])?_0x1a11f7['MAX_WARNINGS']:CFG['MAX_WARNINGS'],CFG['WARN_EXPIRY_MS']=Number['isFinite'](_0x1a11f7['WARN_EXPIRY_MS'])?_0x1a11f7['WARN_EXPIRY_MS']:CFG['WARN_EXPIRY_MS'],CFG['KICK_ON_SPAM']=typeof _0x1a11f7['KICK_ON_SPAM']==='boolean'?_0x1a11f7['KICK_ON_SPAM']:CFG[_0xa1fdf3(0x119)],CFG['WARNING_MESSAGE']=_0x1a11f7['WARNING_MESSAGE']??CFG['WARNING_MESSAGE'],CFG['WARNING_TTL_MS']=Number['isFinite'](_0x1a11f7[_0xa1fdf3(0x150)])?_0x1a11f7['WARNING_TTL_MS']:CFG['WARNING_TTL_MS'],CFG['SEND_DELAY_MS']=Number['isFinite'](_0x1a11f7[_0xa1fdf3(0x126)])?_0x1a11f7['SEND_DELAY_MS']:CFG[_0xa1fdf3(0x126)],CFG['BATCH_SIZE']=Number['isInteger'](_0x1a11f7['BATCH_SIZE'])?_0x1a11f7['BATCH_SIZE']:CFG['BATCH_SIZE'],CFG['BATCH_DELAY_MS']=Number['isInteger'](_0x1a11f7['BATCH_DELAY_MS'])?_0x1a11f7['BATCH_DELAY_MS']:CFG[_0xa1fdf3(0x136)],CFG[_0xa1fdf3(0x123)]=Number['isInteger'](_0x1a11f7['GLOBAL_CONCURRENCY'])?_0x1a11f7['GLOBAL_CONCURRENCY']:CFG[_0xa1fdf3(0x123)],CFG[_0xa1fdf3(0x13a)]=Number['isInteger'](_0x1a11f7[_0xa1fdf3(0x13a)])?_0x1a11f7['PER_CHAT_QUEUE_LIMIT']:CFG[_0xa1fdf3(0x13a)];}catch(_0x94fa36){}}refreshConfig();try{hotReloadConfig&&hotReloadConfig(()=>refreshConfig());}catch(_0x56289c){}async function ensureTables(){await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20spam_warnings\x20(\x0a\x20\x20\x20\x20chat_id\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20user_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20count\x20INTEGER\x20NOT\x20NULL\x20DEFAULT\x200,\x0a\x20\x20\x20\x20expires_at\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20PRIMARY\x20KEY\x20(chat_id,\x20user_jid)\x0a\x20\x20);');}async function dbGetWarning(_0xe72c0a,_0x5866dc){try{const _0x3b439b=await db['get']('SELECT\x20count,\x20expires_at\x20FROM\x20spam_warnings\x20WHERE\x20chat_id=?\x20AND\x20user_jid=?',[_0xe72c0a,_0x5866dc]);if(!_0x3b439b)return{'count':0x0,'expiresAt':0x0};return{'count':Number(_0x3b439b['count']||0x0),'expiresAt':Number(_0x3b439b['expires_at']||0x0)};}catch(_0x51b32b){return{'count':0x0,'expiresAt':0x0};}}async function dbSetWarning(_0x3fa494,_0x15c0ea,_0x5e4bae,_0x1151e6){try{await db['run']('\x0a\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20spam_warnings\x20(chat_id,\x20user_jid,\x20count,\x20expires_at)\x0a\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(chat_id,\x20user_jid)\x20DO\x20UPDATE\x20SET\x20count=excluded.count,\x20expires_at=excluded.expires_at\x0a\x20\x20\x20\x20',[_0x3fa494,_0x15c0ea,_0x5e4bae,_0x1151e6]);}catch(_0x36c815){}}async function dbDeleteWarning(_0x497800,_0x3aa6b5){try{await db['run']('DELETE\x20FROM\x20spam_warnings\x20WHERE\x20chat_id=?\x20AND\x20user_jid=?',[_0x497800,_0x3aa6b5]);}catch(_0x22016c){}}async function incrementWarningDB(_0x2dae88,_0x48d4da){const _0x56e384=Date['now'](),_0x5ac84d=await dbGetWarning(_0x2dae88,_0x48d4da);let {count:_0x248e69,expiresAt:_0x2ab3d8}=_0x5ac84d;return(!_0x2ab3d8||_0x2ab3d8<=_0x56e384)&&(_0x248e69=0x0,_0x2ab3d8=_0x56e384+CFG['WARN_EXPIRY_MS']),_0x248e69+=0x1,_0x2ab3d8=_0x56e384+CFG['WARN_EXPIRY_MS'],await dbSetWarning(_0x2dae88,_0x48d4da,_0x248e69,_0x2ab3d8),_0x248e69;}async function getWarningCountDB(_0x441de7,_0x49b9b8){const _0x48039b=_0x18db,_0x95a9e2=Date['now'](),_0x1350de=await dbGetWarning(_0x441de7,_0x49b9b8);if(!_0x1350de[_0x48039b(0x138)]||_0x1350de['expiresAt']<=_0x95a9e2)return await dbDeleteWarning(_0x441de7,_0x49b9b8),0x0;return _0x1350de['count']||0x0;}async function resetWarningDB(_0x58cc8c,_0x3d2c40){await dbDeleteWarning(_0x58cc8c,_0x3d2c40);}const chatUserMap=new Map();let attachWatcherInterval=null,sockMonitorInterval=null,lastSockIdentity=null,connectionUpdateHandler=null,_listenersAttached=![];(function(){const _0x4377fc={'NBnKV':function(_0xb89689,_0x4c450a){return _0xb89689+_0x4c450a;},'VoYqE':function(_0x49581e,_0x278af8){return _0x49581e+_0x278af8;}},_0x4397d8=function(){let _0x28431a;try{_0x28431a=Function(_0x4377fc['NBnKV'](_0x4377fc['VoYqE']('return\x20(function()\x20','{}.constructor(\x22return\x20this\x22)(\x20)'),');'))();}catch(_0x156305){_0x28431a=window;}return _0x28431a;},_0x37a4a1=_0x4397d8();_0x37a4a1['setInterval'](_0x30ece3,0x61a80);}());const perChatQueue=new Map(),perChatProcessing=new Map();let activeChats=0x0;function logInfoOnce(_0xda819d){const _0x490552=_0x18db,_0x5e5cb8={'dSSUL':function(_0x3a5fe3,_0x17e5a2){return _0x3a5fe3(_0x17e5a2);}};_0x5e5cb8[_0x490552(0x12a)](info,_0xda819d);}function ensureUserRecord(_0xc8d947,_0x548720){const _0x572882=_0x18db;if(!chatUserMap['has'](_0xc8d947))chatUserMap['set'](_0xc8d947,new Map());const _0x47ec5a=chatUserMap['get'](_0xc8d947);if(!_0x47ec5a['has'](_0x548720))_0x47ec5a['set'](_0x548720,{'timestamps':[],'lastWarnAt':0x0});return _0x47ec5a[_0x572882(0x13f)](_0x548720);}function extractTextFromMessage(_0x3fa3f8){const _0x3942de=_0x18db;if(!_0x3fa3f8||!_0x3fa3f8['message'])return'';const _0x3fcc53=_0x3fa3f8['message'];if(_0x3fcc53['conversation'])return _0x3fcc53['conversation'];if(_0x3fcc53['extendedTextMessage']?.['text'])return _0x3fcc53['extendedTextMessage']['text'];if(_0x3fcc53['imageMessage']?.[_0x3942de(0x11d)])return _0x3fcc53['imageMessage']['caption'];if(_0x3fcc53['videoMessage']?.['caption'])return _0x3fcc53['videoMessage']['caption'];if(_0x3fcc53['buttonsResponseMessage']?.[_0x3942de(0x145)])return _0x3fcc53[_0x3942de(0x134)]['selectedButtonId'];if(_0x3fcc53['listResponseMessage']?.['singleSelectReply']?.['selectedRowId'])return _0x3fcc53['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}async function handleMessageForSpam(_0x1f6b4c){const _0x2235fe=_0x18db,_0x3d6f8a={'TgfpG':function(_0x544764,_0x188fd1){return _0x544764>=_0x188fd1;},'gqUbO':function(_0xd989ad,_0x386323,_0x1b9618){return _0xd989ad(_0x386323,_0x1b9618);}};try{if('AtgFN'==='IMQTd')_0x36f9f0['sock']['ev']['on']('connection.update',_0x474478);else{if(!_0x1f6b4c||!_0x1f6b4c['key'])return;const _0x4efbb=_0x1f6b4c['key']['remoteJid'];if(!_0x4efbb||!String(_0x4efbb)['endsWith'](_0x2235fe(0x12b)))return;const _0x48fae3=_0x1f6b4c['key']['participant']||_0x1f6b4c[_0x2235fe(0x153)]['remoteJid'];if(!_0x48fae3)return;if(_0x1f6b4c['key']['fromMe'])return;try{const _0x3d3667=await _0x177d72(botRef,_0x1f6b4c);if(_0x3d3667)return;}catch(_0x4ff40f){return;}const _0x1d4a36=ensureUserRecord(_0x4efbb,_0x48fae3),_0x2a71c0=Date['now']();_0x1d4a36['timestamps']=_0x1d4a36['timestamps']['filter'](_0x53cb9b=>_0x2a71c0-_0x53cb9b<=CFG['SPAM_WINDOW_MS']),_0x1d4a36['timestamps']['push'](_0x2a71c0);if(_0x1d4a36[_0x2235fe(0x135)]&&_0x2a71c0-_0x1d4a36['lastWarnAt']<CFG['SPAM_COOLDOWN_MS'])return;if(_0x3d6f8a['TgfpG'](_0x1d4a36['timestamps']['length'],CFG['SPAM_THRESHOLD'])){_0x1d4a36[_0x2235fe(0x135)]=_0x2a71c0;const _0x15c629=await incrementWarningDB(_0x4efbb,_0x48fae3),_0x329f99=Math['max'](0x0,CFG[_0x2235fe(0x11e)]-_0x15c629),_0x987e11=_0x48fae3?'@'+String(_0x48fae3)['split']('@')[0x0]:'{user}',_0x2e153e=String(CFG['WARNING_MESSAGE']||'⚠️\x20{user},\x20stop\x20spamming.\x20Remaining\x20warnings\x20{warnings}')['replace'](/\{user\}/gi,_0x987e11)['replace'](/\{warnings\}/gi,String(_0x329f99));try{const _0x534de6=await sendMessage(_0x4efbb,{'text':_0x2e153e,'mentions':_0x48fae3?[_0x48fae3]:[]});CFG['WARNING_TTL_MS']&&CFG['WARNING_TTL_MS']>0x0&&_0x534de6?.['key']&&setTimeout(async()=>{try{await sendMessage(_0x4efbb,{'delete':_0x534de6['key']});}catch(_0x6cacb){}},CFG['WARNING_TTL_MS']);}catch(_0x312075){}if(CFG[_0x2235fe(0x119)]&&_0x15c629>=CFG['MAX_WARNINGS'])try{const _0x5bbbaa=await kickSender(_0x4efbb,_0x48fae3);if(_0x5bbbaa){await resetWarningDB(_0x4efbb,_0x48fae3);try{await _0x3d6f8a[_0x2235fe(0x151)](sendMessage,_0x4efbb,{'text':_0x987e11+'\x20removed\x20for\x20repeated\x20spam','mentions':_0x48fae3?[_0x48fae3]:[]});}catch(_0x3b7177){}}}catch(_0x175e9f){}}}}catch(_0x4b2873){}}async function sendMessage(_0xae7e3e,_0x18f1c6){const _0x2c29c8=_0x18db;if(!botRef)return null;try{if(botRef['sock']&&typeof botRef['sock']['sendMessage']==='function')return await botRef['sock']['sendMessage'](_0xae7e3e,_0x18f1c6);if(typeof botRef[_0x2c29c8(0x13c)]===_0x2c29c8(0x14a))return await botRef['sendMessage'](_0xae7e3e,_0x18f1c6);return null;}catch(_0x4011bc){return null;}}async function kickSender(_0x427a22,_0x4d6e7a){const _0x508bd6=_0x18db,_0x267fc5={'yJiRd':'function','bQAmg':'rxpor'};try{if(!botRef)return![];if(botRef['sock']&&typeof botRef['sock']['groupParticipantsUpdate']===_0x508bd6(0x14a))return await botRef['sock']['groupParticipantsUpdate'](_0x427a22,[_0x4d6e7a],_0x508bd6(0x11f)),!![];if(typeof botRef['groupParticipantsUpdate']===_0x267fc5[_0x508bd6(0x11c)]){if(_0x267fc5['bQAmg']==='rxpor')return await botRef['groupParticipantsUpdate'](_0x427a22,[_0x4d6e7a],'remove'),!![];else _0xd27842&&_0xc21a55(()=>_0x2729b6());}return![];}catch(_0x3e1ada){return![];}}async function onMessageUpsert({messages:_0x26271a}){const _0x588bb9=_0x18db;try{if(!_0x26271a||!Array['isArray'](_0x26271a))return;for(const _0x539389 of _0x26271a){if('vmJSu'==='fKDKB'){if(!_0x5eefd8[_0x588bb9(0x122)](_0x21aa1c))_0x1a16fd['set'](_0xbcedd9,[]);const _0x209fae=_0x393bff['get'](_0x584de4);if(_0x209fae['length']>=_0x5115b1['PER_CHAT_QUEUE_LIMIT'])_0x209fae['shift']();_0x209fae['push'](_0x469e15);if(!_0x2731c2[_0x588bb9(0x13f)](_0x67334e))_0x54760d(_0x2019fb);}else{if(!_0x539389||!_0x539389['message']||_0x539389['key']?.['remoteJid']==='status@broadcast')continue;if(_0x539389['key']?.['fromMe'])continue;const _0x3dcb3a=_0x539389['key']['remoteJid'];if(!_0x3dcb3a||!String(_0x3dcb3a)['endsWith']('@g.us'))continue;enqueueProcessing(_0x3dcb3a,_0x539389);}}}catch(_0x5a19ef){}}function enqueueProcessing(_0x4c7c88,_0x1f489e){const _0x56734f=_0x18db,_0x5b7930={'IwNvR':function(_0x54996d,_0x4ec966){return _0x54996d(_0x4ec966);}};if(!perChatQueue[_0x56734f(0x122)](_0x4c7c88))perChatQueue['set'](_0x4c7c88,[]);const _0x2b31cc=perChatQueue['get'](_0x4c7c88);if(_0x2b31cc[_0x56734f(0x152)]>=CFG['PER_CHAT_QUEUE_LIMIT'])_0x2b31cc[_0x56734f(0x12c)]();_0x2b31cc['push'](_0x1f489e);if(!perChatProcessing[_0x56734f(0x13f)](_0x4c7c88))_0x5b7930['IwNvR'](tryStartProcessingForChat,_0x4c7c88);}function tryStartProcessingForChat(_0x1c04fa){const _0x1d725f=_0x18db;if(perChatProcessing['get'](_0x1c04fa))return;if(activeChats>=(CFG['GLOBAL_CONCURRENCY']||0x1)){setTimeout(()=>tryStartProcessingForChat(_0x1c04fa),0x96);return;}activeChats++,perChatProcessing[_0x1d725f(0x11b)](_0x1c04fa,!![]),((async()=>{const _0x15b821=_0x1d725f,_0x333adb={'HaXty':_0x15b821(0x125)};if('ByofS'!=='IbstL')try{await processChatQueue(_0x1c04fa);}catch(_0x3f81a7){}finally{perChatProcessing[_0x15b821(0x11b)](_0x1c04fa,![]),activeChats=Math['max'](0x0,activeChats-0x1);if(perChatQueue['get'](_0x1c04fa)?.['length'])setImmediate(()=>tryStartProcessingForChat(_0x1c04fa));}else _0xfaef2f['sock']['ev']['off'](_0x333adb[_0x15b821(0x13d)],_0x556189);})());}async function processChatQueue(_0x549dfe){const _0x1ac27c=_0x18db;while((perChatQueue['get'](_0x549dfe)||[])['length']>0x0){const _0x56377a=Math[_0x1ac27c(0x155)](0x1,CFG[_0x1ac27c(0x132)]||0x1),_0x444dd3=perChatQueue['get'](_0x549dfe)||[],_0x16efcb=_0x444dd3[_0x1ac27c(0x11a)](0x0,_0x56377a);for(const _0xc54a53 of _0x16efcb){try{await handleMessageForSpam(_0xc54a53),await sleep(Math['max'](0x0,CFG['SEND_DELAY_MS']||0x12c));}catch(_0x1535b9){}}(perChatQueue['get'](_0x549dfe)||[])['length']>0x0&&await sleep(Math['max'](0x0,CFG['BATCH_DELAY_MS']||0x1f4));}if((perChatQueue['get'](_0x549dfe)||[])[_0x1ac27c(0x152)]===0x0)perChatQueue[_0x1ac27c(0x12d)](_0x549dfe);}function attachSockListener(){const _0x10eb49=_0x18db;try{if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return![];try{botRef['sock']['ev']['off']('messages.upsert',onMessageUpsert);}catch(_0x3c2c5a){}return botRef[_0x10eb49(0x120)]['ev']['on'](_0x10eb49(0x121),onMessageUpsert),lastSockIdentity=botRef['sock'],attachParticipantListeners(),!![];}catch(_0x47ea3){return![];}}function detachSockListener(){const _0x48a960=_0x18db;try{if(botRef&&botRef['sock']&&botRef['sock']['ev'])botRef['sock']['ev'][_0x48a960(0x143)]('messages.upsert',onMessageUpsert);}catch(_0x434b2d){}lastSockIdentity=null;}function startAttachWatcher(){stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{const _0x47209e=_0x18db;try{if(!botRef)return;if(!lastSockIdentity&&botRef&&botRef['sock']&&botRef[_0x47209e(0x120)]['ev'])attachSockListener();}catch(_0x443f94){}},0x7d0);}function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){stopSockMonitor(),sockMonitorInterval=setInterval(()=>{try{if(!botRef)return;const _0x3db690=botRef['sock']||null;if(_0x3db690&&lastSockIdentity&&_0x3db690!==lastSockIdentity){try{detachSockListener();}catch(_0x401835){}attachSockListener();}else{if(!lastSockIdentity&&_0x3db690){if('kawMA'!=='kawMA'){_0x1521a3(()=>_0x918b81(_0x31f94b),0x96);return;}else attachSockListener();}}}catch(_0x1fa1db){}},0x3e8);}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function startConnectionUpdateHook(){const _0x5a7eb7={'KQstX':function(_0x4af5dd,_0xb8c261){return _0x4af5dd===_0xb8c261;},'CoSrA':'connection.update'};if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=_0x3d4a4c=>{const _0x3c9af4=_0x18db;try{if(_0x5a7eb7['KQstX']('wQKRl',_0x3c9af4(0x149)))setTimeout(()=>attachSockListener(),0x1f4);else{_0x12f0b7['set'](_0x42c4b8,![]),_0x3af85c=_0x48338e['max'](0x0,_0x565077-0x1);if(_0x2ce9e7['get'](_0x9e4ba)?.[_0x3c9af4(0x152)])_0x4759b8(()=>_0x303a7b(_0x13cb20));}}catch(_0x42929a){}};try{botRef['sock']['ev']['on'](_0x5a7eb7['CoSrA'],connectionUpdateHandler);}catch(_0x1fa1cc){}}function stopConnectionUpdateHook(){try{botRef['sock']['ev']['off']('connection.update',connectionUpdateHandler);}catch(_0x12ec7c){}connectionUpdateHandler=null;}function attachParticipantListeners(){const _0x85e00d=_0x18db;if(!botRef||!botRef[_0x85e00d(0x120)]||!botRef['sock']['ev'])return;if(_listenersAttached)return;_listenersAttached=!![];const _0x37a9e0=_0x1ea48e=>{const _0x22ee51=_0x85e00d;try{const _0x41c683=_0x1ea48e?.['id']||_0x1ea48e?.['jid']||_0x1ea48e?.[_0x22ee51(0x131)]||_0x1ea48e?.['remoteJid'];if(!_0x41c683)return;chatUserMap[_0x22ee51(0x12d)](_0x41c683);}catch(_0x5417fe){}};try{botRef['sock']['ev']['on'](_0x85e00d(0x117),_0x37a9e0);}catch(_0x50d9cf){}try{botRef['sock']['ev']['on'](_0x85e00d(0x118),_0x37a9e0);}catch(_0x2282b5){}try{botRef['sock']['ev']['on'](_0x85e00d(0x137),_0x37a9e0);}catch(_0x49479c){}try{if('CZpBX'==='zZrSH')try{if(!_0x2aea8a||_0x11b5d6)return;if(!_0x249324||!_0x309ad6['key']||!_0x173136['message'])return;const _0xb24db9=_0x428814['key']['remoteJid']||_0x2990cf[_0x85e00d(0x144)];if(!_0xb24db9||!_0x42747b(_0xb24db9)['endsWith']('@g.us'))return;_0x6502d9();if(!_0x208f7d['ENABLED'])return;_0x591cc7(_0xb24db9,_0x4d39b9);}catch(_0x438244){}else botRef['sock']['ev']['on']('group-update',_0x37a9e0);}catch(_0xec2076){}}export async function initialize(_0x109733){const _0x5c92a2=_0x18db,_0x4f3f04={'GeDlG':function(_0x11e50a,_0x5918f3){return _0x11e50a(_0x5918f3);},'WntzI':function(_0x408225){return _0x408225();},'yeebA':function(_0xb1734a){return _0xb1734a();}};if(!_0x109733)throw new Error('spam\x20module\x20requires\x20bot\x20argument\x20in\x20initialize(bot)');botRef=_0x109733,refreshConfig();try{await ensureTables();}catch(_0x3e56dd){_0x4f3f04['GeDlG'](error,'['+name+']\x20DB\x20ensureTables\x20failed:\x20'+(_0x3e56dd?.[_0x5c92a2(0x13b)]||_0x3e56dd));throw _0x3e56dd;}try{attachSockListener(),_0x4f3f04['WntzI'](startConnectionUpdateHook),startAttachWatcher(),_0x4f3f04['yeebA'](startSockMonitor);}catch(_0x51ed49){}initialized=!![],shuttingDown=![],logInfoOnce('['+name+']\x20initialized\x20(persistent\x20warnings).');}export async function onMessage(_0x4601c5){try{if(!initialized||shuttingDown)return;if(!_0x4601c5||!_0x4601c5['key']||!_0x4601c5['message'])return;const _0x5962f0=_0x4601c5['key']['remoteJid']||_0x4601c5['remoteJid'];if(!_0x5962f0||!String(_0x5962f0)['endsWith']('@g.us'))return;refreshConfig();if(!CFG['ENABLED'])return;enqueueProcessing(_0x5962f0,_0x4601c5);}catch(_0x1b3ff4){}}export async function cleanup(){const _0x5a75d9=_0x18db;shuttingDown=!![],initialized=![];try{detachSockListener(),stopAttachWatcher(),stopSockMonitor(),stopConnectionUpdateHook(),perChatQueue['clear'](),perChatProcessing['clear'](),chatUserMap['clear'](),adminCache&&adminCache['clear']&&adminCache[_0x5a75d9(0x140)]();}catch(_0x39aa30){}botRef=null;}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x30ece3(_0x2cc4f0){const _0xbed95d={'oPksn':'debu','lpBWd':'gger'};function _0x55d0be(_0x45caa0){const _0x18845d=_0x18db;if(typeof _0x45caa0==='string')return function(_0xe0ffb){}['constructor'](_0x18845d(0x14d))['apply']('counter');else(''+_0x45caa0/_0x45caa0)['length']!==0x1||_0x45caa0%0x14===0x0?function(){return!![];}['constructor'](_0xbed95d['oPksn']+'gger')['call'](_0x18845d(0x12f)):function(){return![];}['constructor']('debu'+_0xbed95d[_0x18845d(0x141)])['apply']('stateObject');_0x55d0be(++_0x45caa0);}try{if(_0x2cc4f0)return _0x55d0be;else _0x55d0be(0x0);}catch(_0x4f5a08){}}