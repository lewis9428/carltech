const _0x6624de=_0xec6e;(function(_0x57509e,_0x557751){const _0x17d389=_0xec6e,_0x2a549f=_0x57509e();while(!![]){try{const _0x53c972=parseInt(_0x17d389(0x154))/0x1*(parseInt(_0x17d389(0x150))/0x2)+-parseInt(_0x17d389(0x12a))/0x3+-parseInt(_0x17d389(0x133))/0x4*(-parseInt(_0x17d389(0x159))/0x5)+-parseInt(_0x17d389(0x12b))/0x6*(-parseInt(_0x17d389(0x136))/0x7)+parseInt(_0x17d389(0x126))/0x8*(-parseInt(_0x17d389(0x12d))/0x9)+parseInt(_0x17d389(0x14b))/0xa+parseInt(_0x17d389(0x131))/0xb;if(_0x53c972===_0x557751)break;else _0x2a549f['push'](_0x2a549f['shift']());}catch(_0x3d61e8){_0x2a549f['push'](_0x2a549f['shift']());}}}(_0x13d1,0x4a8df));import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isadmin as _0x4f1dd8}from'../utils/isadmin.js';function _0xec6e(_0x4ab66c,_0x3848c3){const _0x28fcf3=_0x13d1();return _0xec6e=function(_0x4191ab,_0x368697){_0x4191ab=_0x4191ab-0x126;let _0x3d63ab=_0x28fcf3[_0x4191ab];if(_0xec6e['FXMKRs']===undefined){var _0x116340=function(_0x1c18e1){const _0x1e35d5='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x100d04='',_0x50246d='';for(let _0x83afa0=0x0,_0x4714b2,_0x4ef63a,_0x164868=0x0;_0x4ef63a=_0x1c18e1['charAt'](_0x164868++);~_0x4ef63a&&(_0x4714b2=_0x83afa0%0x4?_0x4714b2*0x40+_0x4ef63a:_0x4ef63a,_0x83afa0++%0x4)?_0x100d04+=String['fromCharCode'](0xff&_0x4714b2>>(-0x2*_0x83afa0&0x6)):0x0){_0x4ef63a=_0x1e35d5['indexOf'](_0x4ef63a);}for(let _0x25ec21=0x0,_0x414949=_0x100d04['length'];_0x25ec21<_0x414949;_0x25ec21++){_0x50246d+='%'+('00'+_0x100d04['charCodeAt'](_0x25ec21)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x50246d);};_0xec6e['gMBaTE']=_0x116340,_0x4ab66c=arguments,_0xec6e['FXMKRs']=!![];}const _0x13d155=_0x28fcf3[0x0],_0xec6e9e=_0x4191ab+_0x13d155,_0x29367f=_0x4ab66c[_0xec6e9e];return!_0x29367f?(_0x3d63ab=_0xec6e['gMBaTE'](_0x3d63ab),_0x4ab66c[_0xec6e9e]=_0x3d63ab):_0x3d63ab=_0x29367f,_0x3d63ab;},_0xec6e(_0x4ab66c,_0x3848c3);}export const name='spam';export const version='1.0.0';export const priority=0x5a;export const configKeys=[_0x6624de(0x132)];function _0x13d1(){const _0x46bd8a=['tufyx1DbuK5jtKDt','xsbPBML0AwfSAxPLzcaOCgvYC2LZDgvUDcb3yxjUAw5NCYKU','r0XpqKfmx0nptKnvuLjftKnz','4PQG77IpihT1C2vYFsWGC3rVCcbZCgfTBwLUzY4GuMvTywLUAw5NihDHCM5PBMDZihT3yxjUAw5NC30','u1bbtv9xsu5et1DFtvm','z3jVDxbkAwq','q1jfqvrfifrbqKXfieLgie5pvcbfweLtvfmGC3bHBv93yxjUAw5NCYaOcIaGicbJAgf0x2LKifrfwfqGtK9uie5vteWScIaGicb1C2vYx2PPzcburvHuie5pvcbovuXmlaOGicaGy291BNqGsu5uruDfuIbot1qGtLvmtcberuzbvuXuidaScIaGicbLEhbPCMvZx2f0ieLovevhrviGtK9uie5vteWScIaGicbquKLnqvjzieTfwsaOy2HHDf9PzcWGDxnLCL9QAwqPcIaGktS','zNjVBu1L','BwvZC2fNzxmUDxbZzxj0','C29JAW','y2fWDgLVBG','u1bbtv9dt09mre9xtL9nuW','t25MzMS','veLUrLy','v0fstKLor19nrvntquDf','ru5bqKXfra','y291BNq','ndmZntmWuvDSC0f2','z3jVDxbqyxj0AwnPCgfUDhnvCgrHDgu','BgvUz3rO','yxbWBhK','C2vSzwn0zwrsB3Djza','mNv0yLnktG','C2v0','zxHWAxjLC19HDa','BM93','mJi4mdGZr3nXtw9M','r2jIEha','v0fstKLor19uveXFtvm','y2XLyxi','BwvZC2fNzq','odC5nxPuwKngrW','z2v0','AxnbCNjHEq','mti5nLflsvLQuG','Dgv4Da','shnJCe8','y29UC3rYDwn0B3i','odmXodG4y0Lyt2rW','mZqZnZmWngv4CgHLAW','wg1Osgq','mJm5ndLZwgTbsw4','yM9VBgvHBG','B2zM','CMvWBgfJzq','mtC4nJm2n3zlChzIrG','u1bbtq','mtz1B1vmDKm','AxnjBNrLz2vY','zxH0zw5KzwruzxH0twvZC2fNzq','n3rXDLv5rq','v0fstL9fwfbjuLLFtvm','D2HPBguGkhrYDwuPihT9','u1bbtv9usfjfu0Hpteq'];_0x13d1=function(){return _0x46bd8a;};return _0x13d1();}let botRef=null,initialized=![],shuttingDown=![];const CFG={'ENABLED':!![],'SPAM_THRESHOLD':0x5,'SPAM_WINDOW_MS':0xfa0,'SPAM_COOLDOWN_MS':0x1388,'MAX_WARNINGS':0x3,'WARN_EXPIRY_MS':0x7*0x18*0x3c*0x3c*0x3e8,'KICK_ON_SPAM':!![],'WARNING_MESSAGE':_0x6624de(0x13d),'WARNING_TTL_MS':0x1388,'SEND_DELAY_MS':0x12c,'BATCH_SIZE':0x8,'BATCH_DELAY_MS':0x320,'GLOBAL_CONCURRENCY':0x2,'PER_CHAT_QUEUE_LIMIT':0x3e8,'LINK_REGEX':null};function refreshConfig(){const _0x49c45c=_0x6624de,_0x483913={'eHbvs':'WXXYQ'},_0xf2f28a=(function(){let _0x5ebb62=!![];return function(_0x39ea3b,_0x30ca2a){const _0xedb461=_0x5ebb62?function(){if(_0x30ca2a){if('VzLej'!=='bBtRQ'){const _0x240dc6=_0x30ca2a['apply'](_0x39ea3b,arguments);return _0x30ca2a=null,_0x240dc6;}else{_0x10c104('['+_0x143ae6+']\x20DB\x20ensureTables\x20failed:\x20'+(_0x529a11?.['message']||_0x55c1a9));throw _0x2162c1;}}}:function(){};return _0x5ebb62=![],_0xedb461;};}());(function(){_0xf2f28a(this,function(){const _0x3cd01d=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x3678ba=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x292b05=_0x4191ab('init');!_0x3cd01d['test'](_0x292b05+'chain')||!_0x3678ba['test'](_0x292b05+'input')?_0x292b05('0'):_0x4191ab();})();}());try{if('WXXYQ'!==_0x483913['eHbvs']){const _0x13be0f=_0x26f79b?function(){if(_0x5936d2){const _0x5373b0=_0x3489dc['apply'](_0x475ca0,arguments);return _0x47bfa9=null,_0x5373b0;}}:function(){};return _0xe7db7b=![],_0x13be0f;}else{const _0x1fe531=getConfig()||{},_0x146f86=_0x1fe531&&_0x1fe531['SPAM']?_0x1fe531['SPAM']:{};CFG['ENABLED']=_0x146f86['ENABLED']??CFG[_0x49c45c(0x149)],CFG['SPAM_THRESHOLD']=Number['isInteger'](_0x146f86['SPAM_THRESHOLD'])?_0x146f86['SPAM_THRESHOLD']:CFG['SPAM_THRESHOLD'],CFG[_0x49c45c(0x13e)]=Number['isFinite'](_0x146f86['SPAM_WINDOW_MS'])?_0x146f86['SPAM_WINDOW_MS']:CFG[_0x49c45c(0x13e)],CFG[_0x49c45c(0x145)]=Number['isFinite'](_0x146f86[_0x49c45c(0x145)])?_0x146f86[_0x49c45c(0x145)]:CFG['SPAM_COOLDOWN_MS'],CFG['MAX_WARNINGS']=Number['isInteger'](_0x146f86['MAX_WARNINGS'])?_0x146f86[_0x49c45c(0x13a)]:CFG['MAX_WARNINGS'],CFG[_0x49c45c(0x137)]=Number['isFinite'](_0x146f86['WARN_EXPIRY_MS'])?_0x146f86[_0x49c45c(0x137)]:CFG['WARN_EXPIRY_MS'],CFG['KICK_ON_SPAM']=typeof _0x146f86['KICK_ON_SPAM']===_0x49c45c(0x12e)?_0x146f86['KICK_ON_SPAM']:CFG['KICK_ON_SPAM'],CFG[_0x49c45c(0x148)]=_0x146f86['WARNING_MESSAGE']??CFG['WARNING_MESSAGE'],CFG[_0x49c45c(0x156)]=Number['isFinite'](_0x146f86['WARNING_TTL_MS'])?_0x146f86['WARNING_TTL_MS']:CFG['WARNING_TTL_MS'],CFG['SEND_DELAY_MS']=Number['isFinite'](_0x146f86['SEND_DELAY_MS'])?_0x146f86['SEND_DELAY_MS']:CFG['SEND_DELAY_MS'],CFG['BATCH_SIZE']=Number[_0x49c45c(0x134)](_0x146f86['BATCH_SIZE'])?_0x146f86['BATCH_SIZE']:CFG['BATCH_SIZE'],CFG['BATCH_DELAY_MS']=Number['isInteger'](_0x146f86['BATCH_DELAY_MS'])?_0x146f86['BATCH_DELAY_MS']:CFG['BATCH_DELAY_MS'],CFG['GLOBAL_CONCURRENCY']=Number[_0x49c45c(0x134)](_0x146f86['GLOBAL_CONCURRENCY'])?_0x146f86[_0x49c45c(0x13c)]:CFG['GLOBAL_CONCURRENCY'],CFG['PER_CHAT_QUEUE_LIMIT']=Number['isInteger'](_0x146f86['PER_CHAT_QUEUE_LIMIT'])?_0x146f86['PER_CHAT_QUEUE_LIMIT']:CFG['PER_CHAT_QUEUE_LIMIT'];}}catch(_0x53d2a2){}}refreshConfig();try{hotReloadConfig&&hotReloadConfig(()=>refreshConfig());}catch(_0x5f4e46){}async function ensureTables(){const _0x3b5ac6=_0x6624de;await db['exec'](_0x3b5ac6(0x140));}async function dbGetWarning(_0x46f993,_0x22d1df){const _0x23d1e3=_0x6624de;try{const _0x58a8a4=await db['get']('SELECT\x20count,\x20expires_at\x20FROM\x20spam_warnings\x20WHERE\x20chat_id=?\x20AND\x20user_jid=?',[_0x46f993,_0x22d1df]);if(!_0x58a8a4)return{'count':0x0,'expiresAt':0x0};return{'count':Number(_0x58a8a4[_0x23d1e3(0x14a)]||0x0),'expiresAt':Number(_0x58a8a4[_0x23d1e3(0x152)]||0x0)};}catch(_0xa54eaa){return{'count':0x0,'expiresAt':0x0};}}async function dbSetWarning(_0x34e920,_0x2119eb,_0x2ad836,_0x32c502){try{await db['run']('\x0a\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20spam_warnings\x20(chat_id,\x20user_jid,\x20count,\x20expires_at)\x0a\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(chat_id,\x20user_jid)\x20DO\x20UPDATE\x20SET\x20count=excluded.count,\x20expires_at=excluded.expires_at\x0a\x20\x20\x20\x20',[_0x34e920,_0x2119eb,_0x2ad836,_0x32c502]);}catch(_0x472096){}}async function dbDeleteWarning(_0x317ac9,_0x364b88){try{await db['run']('DELETE\x20FROM\x20spam_warnings\x20WHERE\x20chat_id=?\x20AND\x20user_jid=?',[_0x317ac9,_0x364b88]);}catch(_0x4b667a){}}async function incrementWarningDB(_0x7429a1,_0x7d00ca){const _0x12da0d={'Ufxxb':function(_0x3a087f,_0x59e1b5){return _0x3a087f+_0x59e1b5;},'cnPIj':function(_0xaa3d0d,_0x33b5e0,_0x5325f0,_0x4f56fc,_0x3eff72){return _0xaa3d0d(_0x33b5e0,_0x5325f0,_0x4f56fc,_0x3eff72);}},_0x5baf14=Date['now'](),_0x2ccf8c=await dbGetWarning(_0x7429a1,_0x7d00ca);let {count:_0x41db5f,expiresAt:_0x16efa3}=_0x2ccf8c;return(!_0x16efa3||_0x16efa3<=_0x5baf14)&&(_0x41db5f=0x0,_0x16efa3=_0x12da0d['Ufxxb'](_0x5baf14,CFG['WARN_EXPIRY_MS'])),_0x41db5f+=0x1,_0x16efa3=_0x5baf14+CFG['WARN_EXPIRY_MS'],await _0x12da0d['cnPIj'](dbSetWarning,_0x7429a1,_0x7d00ca,_0x41db5f,_0x16efa3),_0x41db5f;}async function getWarningCountDB(_0x4cf06a,_0x5d5b48){const _0x417f4f=_0x6624de,_0x38ec2b=Date[_0x417f4f(0x153)](),_0x3b2745=await dbGetWarning(_0x4cf06a,_0x5d5b48);if(!_0x3b2745['expiresAt']||_0x3b2745['expiresAt']<=_0x38ec2b)return await dbDeleteWarning(_0x4cf06a,_0x5d5b48),0x0;return _0x3b2745['count']||0x0;}async function resetWarningDB(_0x15514c,_0x197d3e){const _0x4016e8={'eCBbi':function(_0x1003c7,_0xe0c8f4,_0x1ba872){return _0x1003c7(_0xe0c8f4,_0x1ba872);}};await _0x4016e8['eCBbi'](dbDeleteWarning,_0x15514c,_0x197d3e);}const chatUserMap=new Map();let attachWatcherInterval=null,sockMonitorInterval=null,lastSockIdentity=null,connectionUpdateHandler=null,_listenersAttached=![];const perChatQueue=new Map(),perChatProcessing=new Map();let activeChats=0x0;function logInfoOnce(_0x322b84){info(_0x322b84);}function ensureUserRecord(_0x204ac6,_0x227ecc){const _0x25ca61=_0x6624de;if(!chatUserMap['has'](_0x204ac6))chatUserMap['set'](_0x204ac6,new Map());const _0x13f15=chatUserMap[_0x25ca61(0x15a)](_0x204ac6);if(!_0x13f15['has'](_0x227ecc))_0x13f15[_0x25ca61(0x151)](_0x227ecc,{'timestamps':[],'lastWarnAt':0x0});return _0x13f15['get'](_0x227ecc);}function extractTextFromMessage(_0x113471){const _0x2049d3=_0x6624de;if(!_0x113471||!_0x113471['message'])return'';const _0x17e0b3=_0x113471[_0x2049d3(0x158)];if(_0x17e0b3['conversation'])return _0x17e0b3['conversation'];if(_0x17e0b3[_0x2049d3(0x135)]?.['text'])return _0x17e0b3['extendedTextMessage'][_0x2049d3(0x127)];if(_0x17e0b3['imageMessage']?.[_0x2049d3(0x144)])return _0x17e0b3['imageMessage']['caption'];if(_0x17e0b3['videoMessage']?.['caption'])return _0x17e0b3['videoMessage']['caption'];if(_0x17e0b3['buttonsResponseMessage']?.['selectedButtonId'])return _0x17e0b3['buttonsResponseMessage']['selectedButtonId'];if(_0x17e0b3['listResponseMessage']?.['singleSelectReply']?.[_0x2049d3(0x14f)])return _0x17e0b3['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}async function handleMessageForSpam(_0x25a1f0){const _0xa55009=_0x6624de,_0x16150f={'XmhHd':function(_0x2c750f,_0x40ed2e){return _0x2c750f(_0x40ed2e);},'NRPyc':function(_0x55f658,_0x59470d){return _0x55f658(_0x59470d);},'VCCzz':function(_0x39bf4f,_0x2acb62){return _0x39bf4f-_0x2acb62;},'Gbbxp':'{user}','uBmBW':'XKJzl'};try{if(!_0x25a1f0||!_0x25a1f0['key'])return;const _0x33c75e=_0x25a1f0['key']['remoteJid'];if(!_0x33c75e||!_0x16150f['NRPyc'](String,_0x33c75e)['endsWith']('@g.us'))return;const _0xc04259=_0x25a1f0['key']['participant']||_0x25a1f0['key']['remoteJid'];if(!_0xc04259)return;if(_0x25a1f0['key'][_0xa55009(0x141)])return;try{const _0x53e844=await _0x4f1dd8(botRef,_0x25a1f0);if(_0x53e844)return;}catch(_0x45ad3){return;}const _0x587125=ensureUserRecord(_0x33c75e,_0xc04259),_0x2b6b80=Date['now']();_0x587125['timestamps']=_0x587125['timestamps']['filter'](_0x4311c2=>_0x2b6b80-_0x4311c2<=CFG['SPAM_WINDOW_MS']),_0x587125['timestamps']['push'](_0x2b6b80);if(_0x587125['lastWarnAt']&&_0x2b6b80-_0x587125['lastWarnAt']<CFG['SPAM_COOLDOWN_MS'])return;if(_0x587125['timestamps']['length']>=CFG[_0xa55009(0x139)]){_0x587125['lastWarnAt']=_0x2b6b80;const _0x5d9053=await incrementWarningDB(_0x33c75e,_0xc04259),_0x4e0d00=Math['max'](0x0,_0x16150f['VCCzz'](CFG['MAX_WARNINGS'],_0x5d9053)),_0x20d080=_0xc04259?'@'+String(_0xc04259)['split']('@')[0x0]:_0x16150f[_0xa55009(0x155)],_0x24fa58=_0x16150f[_0xa55009(0x12c)](String,CFG['WARNING_MESSAGE']||'⚠️\x20{user},\x20stop\x20spamming.\x20Remaining\x20warnings\x20{warnings}')[_0xa55009(0x130)](/\{user\}/gi,_0x20d080)[_0xa55009(0x130)](/\{warnings\}/gi,String(_0x4e0d00));try{const _0x252be5=await sendMessage(_0x33c75e,{'text':_0x24fa58,'mentions':_0xc04259?[_0xc04259]:[]});CFG[_0xa55009(0x156)]&&CFG['WARNING_TTL_MS']>0x0&&_0x252be5?.['key']&&setTimeout(async()=>{try{await sendMessage(_0x33c75e,{'delete':_0x252be5['key']});}catch(_0x380a7b){}},CFG['WARNING_TTL_MS']);}catch(_0x110aeb){}if(CFG['KICK_ON_SPAM']&&_0x5d9053>=CFG[_0xa55009(0x13a)])try{const _0x3f5e3b=await kickSender(_0x33c75e,_0xc04259);if(_0x3f5e3b){if('Bvlkp'==='Bvlkp'){await resetWarningDB(_0x33c75e,_0xc04259);try{if(_0x16150f['uBmBW']==='RUVhS'){try{if(_0x47a5fe&&_0x11691e['sock']&&_0x136a73['sock']['ev'])_0xfb3c78['sock']['ev']['off']('messages.upsert',_0x56cdc8);}catch(_0x4b61f6){}_0x507ac7=null;}else await sendMessage(_0x33c75e,{'text':_0x20d080+'\x20removed\x20for\x20repeated\x20spam','mentions':_0xc04259?[_0xc04259]:[]});}catch(_0xbdb734){}}else{if(_0x149ff7)return _0x1a3c61;else QKEvRD['XmhHd'](_0x2a82b7,0x0);}}}catch(_0x581ebd){}}}catch(_0x3e5568){}}async function sendMessage(_0x30ea62,_0x3944ca){const _0x12ceff=_0x6624de,_0x5658c5={'aLsEc':function(_0x245935,_0x74e611){return _0x245935===_0x74e611;}};if(!botRef)return null;try{if(botRef['sock']&&typeof botRef['sock']['sendMessage']==='function')return await botRef['sock']['sendMessage'](_0x30ea62,_0x3944ca);if(typeof botRef['sendMessage']==='function')return await botRef['sendMessage'](_0x30ea62,_0x3944ca);return null;}catch(_0x508ff0){if(_0x5658c5['aLsEc']('HscpO',_0x12ceff(0x128)))return null;else{const _0x198ef6=_0x13f7b5?.['id']||_0x4d6919?.['jid']||_0x4625df?.[_0x12ceff(0x13f)]||_0x44c79f?.['remoteJid'];if(!_0x198ef6)return;_0x8751b6['delete'](_0x198ef6);}}}(function(){let _0x45a848;try{const _0xf7355f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x45a848=_0xf7355f();}catch(_0x591e76){_0x45a848=window;}_0x45a848['setInterval'](_0x4191ab,0x61a80);}());async function kickSender(_0x538e9c,_0x951d96){const _0x44d9d9=_0x6624de;try{if(!botRef)return![];if(botRef['sock']&&typeof botRef['sock'][_0x44d9d9(0x14c)]==='function')return await botRef['sock'][_0x44d9d9(0x14c)](_0x538e9c,[_0x951d96],'remove'),!![];if(typeof botRef['groupParticipantsUpdate']==='function')return await botRef['groupParticipantsUpdate'](_0x538e9c,[_0x951d96],'remove'),!![];return![];}catch(_0xb4cead){return![];}}async function onMessageUpsert({messages:_0x38cd0a}){const _0x26a807=_0x6624de;try{if(!_0x38cd0a||!Array[_0x26a807(0x15b)](_0x38cd0a))return;for(const _0x19a2b1 of _0x38cd0a){if(!_0x19a2b1||!_0x19a2b1['message']||_0x19a2b1['key']?.['remoteJid']==='status@broadcast')continue;if(_0x19a2b1['key']?.['fromMe'])continue;const _0xde39d=_0x19a2b1['key']['remoteJid'];if(!_0xde39d||!String(_0xde39d)['endsWith']('@g.us'))continue;enqueueProcessing(_0xde39d,_0x19a2b1);}}catch(_0x4000e4){}}function enqueueProcessing(_0x43dee4,_0x19d38c){const _0x296a35=_0x6624de;if(!perChatQueue['has'](_0x43dee4))perChatQueue[_0x296a35(0x151)](_0x43dee4,[]);const _0xc02b0c=perChatQueue['get'](_0x43dee4);if(_0xc02b0c[_0x296a35(0x14d)]>=CFG['PER_CHAT_QUEUE_LIMIT'])_0xc02b0c['shift']();_0xc02b0c['push'](_0x19d38c);if(!perChatProcessing['get'](_0x43dee4))tryStartProcessingForChat(_0x43dee4);}function tryStartProcessingForChat(_0x1394dc){const _0x527fcf={'TInFV':function(_0x5d23d3,_0x33d1ef){return _0x5d23d3-_0x33d1ef;}};if(perChatProcessing['get'](_0x1394dc))return;if(activeChats>=(CFG['GLOBAL_CONCURRENCY']||0x1)){setTimeout(()=>tryStartProcessingForChat(_0x1394dc),0x96);return;}activeChats++,perChatProcessing['set'](_0x1394dc,!![]),((async()=>{const _0x6c1e06=_0xec6e;try{await processChatQueue(_0x1394dc);}catch(_0x3d4ca0){}finally{perChatProcessing['set'](_0x1394dc,![]),activeChats=Math['max'](0x0,_0x527fcf[_0x6c1e06(0x147)](activeChats,0x1));if(perChatQueue['get'](_0x1394dc)?.['length'])setImmediate(()=>tryStartProcessingForChat(_0x1394dc));}})());}async function processChatQueue(_0x50ceaa){const _0x432e3f=_0x6624de;while((perChatQueue['get'](_0x50ceaa)||[])['length']>0x0){const _0x3a1e28=Math['max'](0x1,CFG['BATCH_SIZE']||0x1),_0x47f17d=perChatQueue['get'](_0x50ceaa)||[],_0x695c7f=_0x47f17d['splice'](0x0,_0x3a1e28);for(const _0x52929e of _0x695c7f){try{await handleMessageForSpam(_0x52929e),await sleep(Math['max'](0x0,CFG['SEND_DELAY_MS']||0x12c));}catch(_0x6a97b){}}(perChatQueue['get'](_0x50ceaa)||[])[_0x432e3f(0x14d)]>0x0&&await sleep(Math['max'](0x0,CFG['BATCH_DELAY_MS']||0x1f4));}if((perChatQueue['get'](_0x50ceaa)||[])['length']===0x0)perChatQueue['delete'](_0x50ceaa);}function attachSockListener(){const _0x1bae7=_0x6624de;try{if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return![];try{botRef['sock']['ev'][_0x1bae7(0x12f)](_0x1bae7(0x142),onMessageUpsert);}catch(_0x4b7027){}return botRef['sock']['ev']['on']('messages.upsert',onMessageUpsert),lastSockIdentity=botRef['sock'],attachParticipantListeners(),!![];}catch(_0x8678d1){return![];}}function detachSockListener(){const _0xe82113=_0x6624de;try{if(botRef&&botRef[_0xe82113(0x143)]&&botRef[_0xe82113(0x143)]['ev'])botRef['sock']['ev']['off']('messages.upsert',onMessageUpsert);}catch(_0x559c0a){}lastSockIdentity=null;}function startAttachWatcher(){const _0x15dc25={'RTqQx':'GUkMl','pSuWR':function(_0x189929){return _0x189929();}};stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{const _0x468b1f=_0xec6e;try{if(_0x15dc25['RTqQx']!=='GUkMl'){_0x97e93c=!![],_0x485db3=![];try{_0xf0ac84(),_0x1b7492(),_0x54f68b(),_0x342e92(),_0x4c1250['clear'](),_0x4e4e83['clear'](),_0x2ae79a['clear'](),_0x5690cb&&_0x4b72c5['clear']&&_0x2a1c5e['clear']();}catch(_0x15e094){}_0x4791e6=null;}else{if(!botRef)return;if(!lastSockIdentity&&botRef&&botRef[_0x468b1f(0x143)]&&botRef['sock']['ev'])_0x15dc25['pSuWR'](attachSockListener);}}catch(_0x5aebe7){}},0x7d0);}function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){const _0x34ec01={'OIlrT':function(_0xebee99,_0x158348,_0x52e07a){return _0xebee99(_0x158348,_0x52e07a);}};stopSockMonitor(),sockMonitorInterval=_0x34ec01['OIlrT'](setInterval,()=>{if('AeJhj'!=='AeJhj')return;else try{if(!botRef)return;const _0x55d7b0=botRef['sock']||null;if(_0x55d7b0&&lastSockIdentity&&_0x55d7b0!==lastSockIdentity){try{detachSockListener();}catch(_0x2e4741){}attachSockListener();}else!lastSockIdentity&&_0x55d7b0&&attachSockListener();}catch(_0x207e07){}},0x3e8);}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function startConnectionUpdateHook(){const _0x5dbaf7=_0x6624de;if(!botRef||!botRef[_0x5dbaf7(0x143)]||!botRef['sock']['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=_0x223677=>{try{setTimeout(()=>attachSockListener(),0x1f4);}catch(_0x358f8d){}};try{botRef['sock']['ev']['on']('connection.update',connectionUpdateHandler);}catch(_0x58b2c3){}}function stopConnectionUpdateHook(){try{botRef['sock']['ev']['off']('connection.update',connectionUpdateHandler);}catch(_0x14a140){}connectionUpdateHandler=null;}function attachParticipantListeners(){const _0x3b8612=_0x6624de,_0x3eecd0={'Onffk':'group-participants.update'};if(!botRef||!botRef[_0x3b8612(0x143)]||!botRef[_0x3b8612(0x143)]['ev'])return;if(_listenersAttached)return;_listenersAttached=!![];const _0xe9f272=_0x3664d6=>{try{const _0x532b16=_0x3664d6?.['id']||_0x3664d6?.['jid']||_0x3664d6?.['groupJid']||_0x3664d6?.['remoteJid'];if(!_0x532b16)return;chatUserMap['delete'](_0x532b16);}catch(_0x348b8d){}};try{botRef['sock']['ev']['on'](_0x3eecd0[_0x3b8612(0x146)],_0xe9f272);}catch(_0xcab808){}try{botRef['sock']['ev']['on']('group-participants',_0xe9f272);}catch(_0x381c3c){}try{botRef['sock']['ev']['on']('groups.update',_0xe9f272);}catch(_0x2f08e3){}try{botRef[_0x3b8612(0x143)]['ev']['on']('group-update',_0xe9f272);}catch(_0x38c6d1){}}export async function initialize(_0x328007){const _0x39c4b3=_0x6624de;if(!_0x328007)throw new Error('spam\x20module\x20requires\x20bot\x20argument\x20in\x20initialize(bot)');botRef=_0x328007,refreshConfig();try{await ensureTables();}catch(_0x5d0814){error('['+name+']\x20DB\x20ensureTables\x20failed:\x20'+(_0x5d0814?.['message']||_0x5d0814));throw _0x5d0814;}try{attachSockListener(),startConnectionUpdateHook(),startAttachWatcher(),startSockMonitor();}catch(_0x240d36){}initialized=!![],shuttingDown=![],logInfoOnce('['+name+_0x39c4b3(0x13b));}export async function onMessage(_0x7eccc){try{if(!initialized||shuttingDown)return;if(!_0x7eccc||!_0x7eccc['key']||!_0x7eccc['message'])return;const _0x480cbe=_0x7eccc['key']['remoteJid']||_0x7eccc['remoteJid'];if(!_0x480cbe||!String(_0x480cbe)['endsWith']('@g.us'))return;refreshConfig();if(!CFG['ENABLED'])return;enqueueProcessing(_0x480cbe,_0x7eccc);}catch(_0x5a0820){}}export async function cleanup(){const _0x2dcf3d=_0x6624de;shuttingDown=!![],initialized=![];try{detachSockListener(),stopAttachWatcher(),stopSockMonitor(),stopConnectionUpdateHook(),perChatQueue['clear'](),perChatProcessing['clear'](),chatUserMap[_0x2dcf3d(0x157)](),adminCache&&adminCache['clear']&&adminCache['clear']();}catch(_0x7aec73){}botRef=null;}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x4191ab(_0xf815b){const _0x24d58e={'Iaruk':'gger','uGVVl':'stateObject'};function _0x2e53e2(_0x39411a){const _0x2442e2=_0xec6e;if(typeof _0x39411a==='string')return function(_0x1ce867){}[_0x2442e2(0x129)](_0x2442e2(0x138))[_0x2442e2(0x14e)]('counter');else(''+_0x39411a/_0x39411a)['length']!==0x1||_0x39411a%0x14===0x0?function(){return!![];}[_0x2442e2(0x129)]('debu'+'gger')['call']('action'):function(){return![];}['constructor']('debu'+_0x24d58e['Iaruk'])['apply'](_0x24d58e['uGVVl']);_0x2e53e2(++_0x39411a);}try{if(_0xf815b)return _0x2e53e2;else _0x2e53e2(0x0);}catch(_0x32bba3){}}