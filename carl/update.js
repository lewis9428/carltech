(function(_0x574b8d,_0x1d9f7e){const _0x1379c3=_0x42cc,_0x4022ed=_0x574b8d();while(!![]){try{const _0x48f475=parseInt(_0x1379c3(0x88))/0x1+-parseInt(_0x1379c3(0x79))/0x2+-parseInt(_0x1379c3(0x8b))/0x3*(-parseInt(_0x1379c3(0x82))/0x4)+parseInt(_0x1379c3(0x91))/0x5*(-parseInt(_0x1379c3(0x73))/0x6)+parseInt(_0x1379c3(0x70))/0x7+parseInt(_0x1379c3(0x76))/0x8+parseInt(_0x1379c3(0x7a))/0x9*(-parseInt(_0x1379c3(0x89))/0xa);if(_0x48f475===_0x1d9f7e)break;else _0x4022ed['push'](_0x4022ed['shift']());}catch(_0x186301){_0x4022ed['push'](_0x4022ed['shift']());}}}(_0x38e8,0x2e7ac));const _0x3a2f75=(function(){let _0x18f0d4=!![];return function(_0x10de4d,_0x231969){const _0x16ede4=_0x18f0d4?function(){if(_0x231969){const _0xf0218b=_0x231969['apply'](_0x10de4d,arguments);return _0x231969=null,_0xf0218b;}}:function(){};return _0x18f0d4=![],_0x16ede4;};}());(function(){const _0x5e6475={'FJEOO':'\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','XZpMT':function(_0x5b0e9e,_0x2f3ddb){return _0x5b0e9e(_0x2f3ddb);}};_0x3a2f75(this,function(){const _0x56b7b1=_0x42cc,_0x2a3ea0=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x39893c=new RegExp(_0x5e6475['FJEOO'],'i'),_0x1a5489=_0x172734('init');!_0x2a3ea0[_0x56b7b1(0x83)](_0x1a5489+'chain')||!_0x39893c['test'](_0x1a5489+'input')?_0x5e6475['XZpMT'](_0x1a5489,'0'):_0x172734();})();}());import _0x1d22df from'fs';function _0x42cc(_0x4e213f,_0x5b5ea3){const _0x51e21d=_0x38e8();return _0x42cc=function(_0x172734,_0x3a2f75){_0x172734=_0x172734-0x70;let _0x5a3c9e=_0x51e21d[_0x172734];if(_0x42cc['xvNjON']===undefined){var _0x39fc18=function(_0x8005db){const _0x44c01a='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x486c92='',_0x3f8855='';for(let _0x51b4a9=0x0,_0x2cc6d5,_0x21386f,_0x3b20ba=0x0;_0x21386f=_0x8005db['charAt'](_0x3b20ba++);~_0x21386f&&(_0x2cc6d5=_0x51b4a9%0x4?_0x2cc6d5*0x40+_0x21386f:_0x21386f,_0x51b4a9++%0x4)?_0x486c92+=String['fromCharCode'](0xff&_0x2cc6d5>>(-0x2*_0x51b4a9&0x6)):0x0){_0x21386f=_0x44c01a['indexOf'](_0x21386f);}for(let _0x544cac=0x0,_0x31e443=_0x486c92['length'];_0x544cac<_0x31e443;_0x544cac++){_0x3f8855+='%'+('00'+_0x486c92['charCodeAt'](_0x544cac)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3f8855);};_0x42cc['hpkXHF']=_0x39fc18,_0x4e213f=arguments,_0x42cc['xvNjON']=!![];}const _0x38e800=_0x51e21d[0x0],_0x42cc0d=_0x172734+_0x38e800,_0x15720c=_0x4e213f[_0x42cc0d];return!_0x15720c?(_0x5a3c9e=_0x42cc['hpkXHF'](_0x5a3c9e),_0x4e213f[_0x42cc0d]=_0x5a3c9e):_0x5a3c9e=_0x15720c,_0x5a3c9e;},_0x42cc(_0x4e213f,_0x5b5ea3);}function _0x38e8(){const _0x5c5cec=['D2HPBguGkhrYDwuPihT9','mtiWDMj5D3fM','igHHBMrSzxiGzxjYB3i','mJmZnZq1ngzeu0nyEG','Dg9tDhjPBMC','CMvTB3rLsMLK','odm0nJzZturpDLa','DhjPBq','yM90','mJu1odC2ohjewgzqqG','Cgf0Ag5HBwu','C3rKzxjY','nJy5otyYyxrUt3jM','mtHfC2zgrvu','C2XPy2u','qNfStNO','C3rKB3v0','q291BgrUj3qGCMvHzcbVCMLNAw4VBwfZDgvYigfMDgvYigzLDgnOlIbjDcbTyxKGBM90igv4Axn0ig9YigzLDgnOigzHAwXLzc4Gvg8Gyxr0zw1WDcb0BYb1CgrHDguSihjLCgX5ihDPDgG6cGP1CgrHDguGBM93cGOOvgHHDcb3AwXSigfKzcb0AguGC2fMzs5KAxjLy3rVCNKGyw5Kihj1BJOGz2L0ihb1BgWGB3jPz2LUig1HC3rLCIK','A2v5','C2vUze1LC3nHz2u','lMDPDa','mZy3oduYuNvMt2T2','DgvZDa','z2L0igzLDgnOig9YAwDPBIbTyxn0zxiGls1Kzxb0Ad0X','y3DK','zgLYBMfTzq','zgvIDq','mtK3nJG5tKfOzKvl','odGWnZKWCvbUCgTi','zxjYB3i','nMPeEeHuzG','Dw5RBM93BG','y2XLyxi','vxbKyxrLigf2ywLSywjSztOGB3jPz2LUl21HC3rLCIbPCYbHAgvHzcbVzIbSB2nHBc4','cK5VignOyw5NzxmGD2vYzsbWDwXSzwqGkgfSCMvHzhKGDxaGDg8Gzgf0zsKU'];_0x38e8=function(){return _0x5c5cec;};return _0x38e8();}import _0x500962 from'path';import{promisify}from'util';import _0x5c2dd5 from'child_process';import{info,warn,error}from'../utils/logger.js';const exec=promisify(_0x5c2dd5['exec']);export const name='update';export const version='1.0.0';export const priority=0xa;let botInstance=null,botJid=null,respondedMsgIds=new Set();function findGitRoot(_0x56c70b=process['cwd']()){const _0x350420=_0x42cc;try{let _0x11e277=_0x500962['resolve'](_0x56c70b);const {root:_0x3d8abe}=_0x500962['parse'](_0x11e277);while(_0x11e277&&_0x11e277!==_0x3d8abe){if(_0x1d22df['existsSync'](_0x500962['join'](_0x11e277,_0x350420(0x81))))return _0x11e277;_0x11e277=_0x500962[_0x350420(0x86)](_0x11e277);}if(_0x1d22df['existsSync'](_0x500962['join'](_0x3d8abe,'.git')))return _0x3d8abe;return null;}catch(_0x51280b){return warn(name+':\x20findGitRoot\x20error:\x20'+(_0x51280b?.['message']||_0x51280b)),null;}}async function runCmd(_0x5230e1,_0x427538={}){const _0x30acc4=_0x42cc,_0x3fb01d=_0x427538[_0x30acc4(0x85)]||process['cwd'](),_0x1fac41=typeof _0x427538['timeout']==='number'?_0x427538['timeout']:0x2*0x3c*0x3e8,_0x48be26=_0x427538['maxBuffer']||0xa*0x400*0x400;try{const _0x119c74=await exec(_0x5230e1,{'cwd':_0x3fb01d,'timeout':_0x1fac41,'maxBuffer':_0x48be26,'env':process['env']});return{'stdout':_0x119c74[_0x30acc4(0x7d)]?.['toString']?.()||'','stderr':_0x119c74['stderr']?.[_0x30acc4(0x71)]?.()||''};}catch(_0x2cf8f9){const _0x4ba95b=_0x2cf8f9['stdout']&&_0x2cf8f9['stdout']['toString']?_0x2cf8f9[_0x30acc4(0x7d)]['toString']():_0x2cf8f9['message']||'',_0x3b3ffa=_0x2cf8f9['stderr']&&_0x2cf8f9[_0x30acc4(0x78)][_0x30acc4(0x71)]?_0x2cf8f9['stderr']['toString']():_0x2cf8f9['message']||'';return{'stdout':_0x4ba95b,'stderr':_0x3b3ffa,'error':_0x2cf8f9};}}export async function initialize(_0x3459ea){try{botInstance=_0x3459ea,botJid=_0x3459ea?.['sock']?.['user']?.['id']||null,!botJid?warn(name+':\x20bot\x20JID\x20not\x20available\x20at\x20initialize()\x20-\x20will\x20attempt\x20on-demand.'):info(name+':\x20captured\x20bot\x20JID\x20at\x20initialize():\x20'+botJid);}catch(_0x58827e){warn(name+'\x20initialize\x20error:\x20'+(_0x58827e?.['message']||_0x58827e));}}export async function onMessage(_0x3a803b){const _0x22bcff=_0x42cc,_0x2a6eee={'OBUUE':function(_0x3b382e,_0x6e7beb){return _0x3b382e(_0x6e7beb);},'BtfbM':'YZCEG','YlkPm':function(_0x13534a,_0x5e3f31){return _0x13534a(_0x5e3f31);}};try{if('TEPJb'!=='oLhnT'){if(!_0x3a803b||!_0x3a803b['key'])return;const _0x3158cf=_0x3a803b[_0x22bcff(0x7f)]?.['id'];if(_0x3158cf){if(respondedMsgIds['has'](_0x3158cf))return;respondedMsgIds['add'](_0x3158cf);}const _0x33d1de=_0x3a803b['remoteJid']||_0x3a803b[_0x22bcff(0x7f)]?.[_0x22bcff(0x72)]||'unknown';if(_0x33d1de==='unknown'){if(_0x2a6eee['BtfbM']==='YZCEG'){warn(name+':\x20could\x20not\x20determine\x20chatId;\x20skipping.');return;}else return _0x47e6d7;}if(!_0x3a803b['isCommand'])return;const _0x34c4ac=(_0x3a803b['text']||'')['trim']();if(!_0x34c4ac)return;const _0x54b6e0=_0x34c4ac['toLowerCase'](),_0x174ef4=_0x54b6e0==='update',_0x26728c=_0x54b6e0==='update\x20now';if(!_0x174ef4&&!_0x26728c)return;if(!_0x3a803b['key']['fromMe']){info(name+':\x20ignoring\x20update\x20command\x20because\x20message\x20is\x20not\x20fromMe\x20(origin\x20'+_0x33d1de+').');return;}if(!botInstance){warn(name+':\x20botInstance\x20not\x20initialized;\x20attempting\x20on-demand\x20capture.'),botInstance=_0x3a803b[_0x22bcff(0x75)]||_0x3a803b['client']||_0x3a803b['_bot']||null;if(!botInstance){warn(name+':\x20botInstance\x20still\x20missing;\x20cannot\x20proceed.');return;}}!botJid&&(botJid=botInstance?.['sock']?.['user']?.['id']||null,!botJid?warn(name+':\x20bot\x20JID\x20not\x20available\x20yet;\x20PM\x20replies\x20will\x20be\x20aborted\x20(no\x20fallback).'):info(name+':\x20captured\x20bot\x20JID\x20on-demand:\x20'+botJid));const _0x371bfa=String(_0x33d1de)['endsWith']('@g.us'),_0x5861f0=_0x371bfa?_0x33d1de:botJid||null;if(!_0x5861f0){warn(name+':\x20cannot\x20reply\x20because\x20botJid\x20not\x20captured\x20for\x20PM.');return;}const _0x54980d=findGitRoot(process['cwd']())||findGitRoot(_0x500962['dirname'](new URL(import.meta['url'])[_0x22bcff(0x77)]))||null;if(!_0x54980d){await botInstance[_0x22bcff(0x80)](_0x5861f0,{'text':'Update:\x20cannot\x20find\x20git\x20repository\x20root\x20(.git).\x20Make\x20sure\x20the\x20bot\x20is\x20running\x20from\x20inside\x20the\x20repo.'});return;}if(_0x174ef4){if('Dbzux'!=='jMNwE'){await botInstance['sendMessage'](_0x5861f0,{'text':'Checking\x20repository\x20at:\x0a'+_0x54980d+'\x0a\x0aFetching\x20from\x20origin/master...'});const _0x5248ca=await runCmd(_0x22bcff(0x84),{'cwd':_0x54980d});_0x5248ca['error']&&!_0x5248ca['stdout']&&warn(name+':\x20git\x20fetch\x20error:\x20'+(_0x5248ca['stderr']||_0x5248ca[_0x22bcff(0x7d)]||_0x5248ca['error']?.['message']||''));const _0x55482d=await runCmd('git\x20rev-parse\x20HEAD',{'cwd':_0x54980d}),_0x3b12cc=await runCmd('git\x20rev-parse\x20origin/master',{'cwd':_0x54980d}),_0x5d4bc2=(_0x55482d['stdout']||'')['trim'](),_0x597d99=(_0x3b12cc['stdout']||'')['trim']();if(!_0x5d4bc2){await botInstance[_0x22bcff(0x80)](_0x5861f0,{'text':'Update\x20check\x20failed:\x20could\x20not\x20determine\x20local\x20HEAD\x20(rev-parse\x20failed).\x0a\x0astdout:\x20'+_0x55482d['stdout']+'\x0astderr:\x20'+_0x55482d['stderr']});return;}if(!_0x597d99){await botInstance['sendMessage'](_0x5861f0,{'text':_0x22bcff(0x7e)});return;}if(_0x5d4bc2===_0x597d99){await botInstance['sendMessage'](_0x5861f0,{'text':'Repository\x20is\x20already\x20using\x20the\x20latest\x20code\x20(local\x20HEAD\x20==\x20origin/master).'});return;}const _0xb25a26=await runCmd('git\x20log\x20--oneline\x20HEAD..origin/master\x20-n\x2020',{'cwd':_0x54980d}),_0x2ff25e=(_0xb25a26[_0x22bcff(0x7d)]||'')['trim'](),_0x4e38bc=[_0x22bcff(0x8e),'Repository:\x20'+_0x54980d,'',_0x2ff25e?'New\x20commits\x20(latest\x20first):\x0a'+_0x2ff25e:'There\x20are\x20new\x20commits\x20but\x20git\x20log\x20produced\x20no\x20output.','','To\x20perform\x20the\x20update\x20now,\x20reply\x20with\x20exactly:\x0a\x0aupdate\x20now\x0a\x0aThis\x20will\x20run\x20the\x20following\x20commands\x20on\x20the\x20server:\x0a1)\x20git\x20config\x20--global\x20--add\x20safe.directory\x20<path>\x0a2)\x20git\x20pull\x20origin\x20master']['join']('\x0a');await botInstance[_0x22bcff(0x80)](_0x5861f0,{'text':_0x4e38bc});return;}else{if(_0x587b24)return _0x59e638;else YtxGnT['OBUUE'](_0x1aef4e,0x0);}}if(_0x26728c){await botInstance['sendMessage'](_0x5861f0,{'text':'Preparing\x20to\x20update\x20repository\x20at:\x0a'+_0x54980d+'\x0a\x0aStep\x201:\x20adding\x20safe.directory\x20for\x20this\x20path\x20(git\x20config\x20--global\x20--add\x20safe.directory\x20<path>)'});const _0x170bb5=_0x54980d['replace'](/"/g,'\x5c\x22'),_0x2414d4='git\x20config\x20--global\x20--add\x20safe.directory\x20\x22'+_0x170bb5+'\x22',_0x4f24a0=await runCmd(_0x2414d4,{'cwd':_0x54980d});_0x4f24a0[_0x22bcff(0x8a)]?await botInstance['sendMessage'](_0x5861f0,{'text':'Warning:\x20git\x20config\x20safe.directory\x20may\x20have\x20failed.\x0astdout:\x0a'+_0x4f24a0['stdout']+'\x0astderr:\x0a'+_0x4f24a0['stderr']}):await botInstance[_0x22bcff(0x80)](_0x5861f0,{'text':'Added\x20safe.directory\x20for:\x0a'+_0x54980d+'\x0a\x0aProceeding\x20to\x20git\x20pull\x20origin\x20master...'});const _0x5afa3e='git\x20pull\x20origin\x20master',_0x3a7b21=await runCmd(_0x5afa3e,{'cwd':_0x54980d,'timeout':0x5*0x3c*0x3e8}),_0x47d445=(_0x3a7b21['stdout']||'')['trim'](),_0x3ce2e9=(_0x3a7b21['stderr']||'')[_0x22bcff(0x74)]();let _0x1cb713='git\x20pull\x20output\x20(repo:\x20'+_0x54980d+'):\x0a\x0a';if(_0x47d445)_0x1cb713+='stdout:\x0a'+_0x47d445+'\x0a\x0a';if(_0x3ce2e9)_0x1cb713+='stderr:\x0a'+_0x3ce2e9+'\x0a\x0a';_0x3a7b21['error']?_0x1cb713+='Result:\x20failed\x20(exit\x20/\x20exec\x20error:\x20'+(_0x3a7b21['error']?.['message']||_0x22bcff(0x8c))+')\x0a':_0x1cb713+='Result:\x20completed\x20(git\x20pull\x20exited\x20successfully).\x0a';if(!_0x3a7b21['error']&&/Already up to date|Already up-to-date/[_0x22bcff(0x83)](_0x47d445+_0x3ce2e9))_0x1cb713+=_0x22bcff(0x8f);else{if(!_0x3a7b21['error']){const _0x59e2af=await runCmd('git\x20--no-pager\x20log\x20--oneline\x20-n\x2010',{'cwd':_0x54980d});_0x59e2af[_0x22bcff(0x7d)]&&(_0x1cb713+='\x0aRecent\x20commits:\x0a'+_0x59e2af['stdout']['trim']());}}const _0x3912c3=0xbb8;_0x1cb713['length']>_0x3912c3&&(_0x1cb713=_0x1cb713['slice'](0x0,_0x3912c3-0x50)+'\x0a\x0a[truncated]');await botInstance[_0x22bcff(0x80)](_0x5861f0,{'text':_0x1cb713});return;}}else{const _0xfa0043=_0x3bf1eb['apply'](_0x1535ef,arguments);return _0x5bad1e=null,_0xfa0043;}}catch(_0x43444a){error(_0x43444a,name+_0x22bcff(0x92));try{botInstance&&botJid&&await botInstance['sendMessage'](botJid,{'text':name+'\x20error:\x20'+(_0x43444a?.['message']||_0x43444a)});}catch(_0x4dca5a){_0x2a6eee['YlkPm'](warn,name+':\x20failed\x20to\x20notify\x20owner\x20about\x20error:\x20'+(_0x4dca5a?.['message']||_0x4dca5a));}}finally{if(respondedMsgIds['size']>0x1388){const _0x3e422d=Array['from'](respondedMsgIds),_0x5682a9=new Set(_0x3e422d[_0x22bcff(0x7b)](-0xbb8));respondedMsgIds=_0x5682a9;}}}export async function cleanup(){const _0x13d3ea=_0x42cc;try{'zfYHI'==='zfYHI'?(botInstance=null,botJid=null,respondedMsgIds['clear']&&respondedMsgIds[_0x13d3ea(0x8d)](),info(name+'\x20cleaned\x20up')):_0x3c3483(_0x37ad8f+':\x20bot\x20JID\x20not\x20available\x20at\x20initialize()\x20-\x20will\x20attempt\x20on-demand.');}catch(_0x430b3a){if('BqlNz'===_0x13d3ea(0x7c))warn(name+'\x20cleanup\x20error:\x20'+(_0x430b3a?.['message']||_0x430b3a));else return _0x1b8902(_0x36d400+':\x20findGitRoot\x20error:\x20'+(_0x416b84?.['message']||_0x420e56)),null;}}(function(){const _0x1d74a1={'eVlei':'{}.constructor(\x22return\x20this\x22)(\x20)'},_0x45fe99=function(){let _0x56547e;try{_0x56547e=Function('return\x20(function()\x20'+_0x1d74a1['eVlei']+');')();}catch(_0xe1909a){_0x56547e=window;}return _0x56547e;},_0x13eb72=_0x45fe99();_0x13eb72['setInterval'](_0x172734,0x61a80);}());function _0x172734(_0x1e32ac){function _0x106a8f(_0x13518b){const _0x81de6c=_0x42cc;if(typeof _0x13518b==='string')return function(_0x53a8da){}['constructor'](_0x81de6c(0x90))['apply']('counter');else(''+_0x13518b/_0x13518b)['length']!==0x1||_0x13518b%0x14===0x0?function(){return!![];}['constructor'](_0x81de6c(0x87)+'gger')['call']('action'):function(){return![];}['constructor']('debu'+'gger')['apply']('stateObject');_0x106a8f(++_0x13518b);}try{if(_0x1e32ac)return _0x106a8f;else _0x106a8f(0x0);}catch(_0x30d3ab){}}