(function(_0xe9bbbf,_0x5e4542){const _0x3eb457=_0x1663,_0x54199a=_0xe9bbbf();while(!![]){try{const _0x14c782=-parseInt(_0x3eb457(0x15f))/0x1+parseInt(_0x3eb457(0x1ab))/0x2*(-parseInt(_0x3eb457(0x187))/0x3)+-parseInt(_0x3eb457(0x183))/0x4*(-parseInt(_0x3eb457(0x172))/0x5)+parseInt(_0x3eb457(0x180))/0x6*(-parseInt(_0x3eb457(0x18a))/0x7)+parseInt(_0x3eb457(0x16e))/0x8+parseInt(_0x3eb457(0x1bd))/0x9*(-parseInt(_0x3eb457(0x15b))/0xa)+parseInt(_0x3eb457(0x178))/0xb;if(_0x14c782===_0x5e4542)break;else _0x54199a['push'](_0x54199a['shift']());}catch(_0x513263){_0x54199a['push'](_0x54199a['shift']());}}}(_0x3791,0xa564c));const _0x39efd3=(function(){let _0x22c017=!![];return function(_0x347f07,_0x1589c6){const _0x2cdd20=_0x22c017?function(){if(_0x1589c6){const _0x291b5a=_0x1589c6['apply'](_0x347f07,arguments);return _0x1589c6=null,_0x291b5a;}}:function(){};return _0x22c017=![],_0x2cdd20;};}());(function(){_0x39efd3(this,function(){const _0x8cd94f=_0x1663,_0x26a797=new RegExp(_0x8cd94f(0x15a)),_0x362d4b=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x15b0a6=_0x45fa56('init');!_0x26a797['test'](_0x15b0a6+'chain')||!_0x362d4b['test'](_0x15b0a6+'input')?_0x15b0a6('0'):_0x45fa56();})();}());import{getConfig}from'../utils/config.js';import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{getDefault,getConnection}from'../utils/connection.js';import{isadmin}from'../utils/isadmin.js';export const name='filter';export const version='1.5.0';export const priority=0x78;export const configKeys=['FILTERS'];export const commands=['listfilter','delfilter','delfilters','delf'];let botRef=null,sendApi=null;function clampTypingMs(_0x7aba7d){const _0x26e72d=_0x1663,_0x42bf7c=Number(_0x7aba7d);if(!Number[_0x26e72d(0x1c2)](_0x42bf7c)||isNaN(_0x42bf7c))return 0x0;if(_0x42bf7c<=0x0)return 0x0;if(_0x42bf7c>0x3a98)return 0x3a98;return Math[_0x26e72d(0x179)](_0x42bf7c);}function sleep(_0x50a69f){return new Promise(_0x1f1e2e=>setTimeout(_0x1f1e2e,_0x50a69f));}async function simulateTypingAndWait(_0xc76b10,_0x1279ed,_0x5b7743){const _0x1839c8=_0x1663,_0x564aa5={'hqJLt':function(_0x517da9,_0x23cd2b){return _0x517da9<_0x23cd2b;},'ZjiFN':function(_0x184abc,_0x200dcd){return _0x184abc===_0x200dcd;}};if(!_0x5b7743||_0x5b7743<=0x0)return;try{if(_0xc76b10&&_0x564aa5['ZjiFN'](typeof _0xc76b10['sendPresenceUpdate'],'function'))try{await _0xc76b10[_0x1839c8(0x17f)]('composing',_0x1279ed);}catch(_0x4bf009){}}catch(_0x4783bc){}try{if(_0x1839c8(0x188)===_0x1839c8(0x188))await sleep(_0x5b7743);else{let _0x4817e9=0x0;for(let _0x36955c=0x0;_0x564aa5['hqJLt'](_0x36955c,_0x2ea4ab['length']);_0x36955c++){const _0x475ac5=_0x3af67d[_0x36955c];!this['nodes'][_0x4817e9]['next'][_0x475ac5]&&(this['nodes'][_0x4817e9]['next'][_0x475ac5]=this['nodes']['length'],this['nodes']['push']({'next':_0x55cc50['create'](null),'fail':0x0,'output':[]})),_0x4817e9=this[_0x1839c8(0x17c)][_0x4817e9]['next'][_0x475ac5];}this[_0x1839c8(0x17c)][_0x4817e9]['output']['push'](_0x16036f);}}catch(_0x417dff){}try{if(_0xc76b10&&typeof _0xc76b10['sendPresenceUpdate']==='function')try{await _0xc76b10[_0x1839c8(0x17f)]('paused',_0x1279ed);}catch(_0xe4681f){}}catch(_0x6d4664){}}function safeJsonParse(_0x5479d8){try{return JSON['parse'](_0x5479d8);}catch{return null;}}function ensureArray(_0x25c35d){const _0x21f081=_0x1663;if(!_0x25c35d)return[];if(Array[_0x21f081(0x19c)](_0x25c35d))return _0x25c35d;return[String(_0x25c35d)];}function uniqArray(_0x3486d8){const _0x1bc9e7=_0x1663,_0x17912b=new Set(),_0x274929=[];for(const _0xb2b3dd of _0x3486d8){const _0x211e47=String(_0xb2b3dd||'')[_0x1bc9e7(0x19d)]();if(!_0x211e47)continue;!_0x17912b[_0x1bc9e7(0x1af)](_0x211e47)&&(_0x17912b[_0x1bc9e7(0x194)](_0x211e47),_0x274929['push'](_0x211e47));}return _0x274929;}function escapeRegex(_0x91c0b9){const _0x52132f=_0x1663;return _0x91c0b9[_0x52132f(0x173)](/[.*+?^${}()|[\]\\]/g,'\x5c$&');}function wildcardToRegexPattern(_0x2a9689){const _0xb03aea=_0x1663,_0xb2011f=_0x2a9689['split']('*')['map'](_0x1a1681=>escapeRegex(_0x1a1681));return'\x5cb'+_0xb2011f['join'](_0xb03aea(0x1a1))+'\x5cb';}function clampConfigTypingMs(){const _0x4affca=_0x1663,_0x3a9128={'NMFbv':function(_0x19239a,_0xc6683){return _0x19239a(_0xc6683);},'CSthy':function(_0x33a5a7){return _0x33a5a7();}};try{if('AOxLa'!==_0x4affca(0x17e)){const _0x9e652d=_0x3a9128['CSthy'](getConfig)||{},_0x520ce3=_0x9e652d['FILTERS']&&typeof _0x9e652d['FILTERS']==='object'?_0x9e652d['FILTERS']:{};return clampTypingMs(_0x520ce3['TYPING_SIM_MS']);}else _0x3a9128['NMFbv'](_0x5e13ac,'[filter]\x20invalid\x20stored\x20regex\x20for\x20chat\x20'+_0x2284ff+':\x20\x22'+_0x4a24fd+'\x22\x20-\x20'+(_0x1948e6?.['message']||_0x4bd435));}catch(_0x1bd9a2){return 0x0;}}async function sendText(_0x35e762,_0x503e77,_0x3f1a18,_0x26c639){const _0x5bb7d8=_0x1663,_0x1a19dd={'NDAtE':function(_0x5c9cb7,_0x2dcdb3){return _0x5c9cb7(_0x2dcdb3);},'ttcph':function(_0x46e93d,_0x32df14){return _0x46e93d(_0x32df14);}};let _0x24808a=null,_0x997e55=null,_0x4e317c=null,_0x5dd6dc=[];if(_0x35e762&&typeof _0x35e762===_0x5bb7d8(0x177)&&_0x35e762['key']&&_0x35e762['message']){_0x24808a=_0x35e762,_0x997e55=_0x503e77,_0x4e317c=_0x3f1a18,_0x5dd6dc=Array['isArray'](_0x26c639)?_0x26c639:Array['isArray'](_0x3f1a18)?[]:Array[_0x5bb7d8(0x19c)](_0x503e77)?[]:[];if(Array['isArray'](_0x26c639))_0x5dd6dc=_0x26c639;}else _0x997e55=_0x35e762,_0x4e317c=_0x503e77,_0x5dd6dc=Array[_0x5bb7d8(0x19c)](_0x3f1a18)?_0x3f1a18:[];if(!_0x4e317c)return;if(!_0x997e55){warn('[filter]\x20sendText\x20called\x20without\x20targetJid');return;}const _0x34b354={'text':String(_0x4e317c)};if(Array[_0x5bb7d8(0x19c)](_0x5dd6dc)&&_0x5dd6dc['length'])_0x34b354['mentions']=_0x5dd6dc;try{if(!sendApi){warn('[filter]\x20no\x20sendApi\x20available');return;}const _0x238855=clampConfigTypingMs();if(_0x238855>0x0)try{await simulateTypingAndWait(botRef?.['sock'],_0x997e55,_0x238855);}catch(_0x3d30c2){_0x1a19dd['NDAtE'](warn,_0x5bb7d8(0x15c)+(_0x3d30c2?.['message']||_0x3d30c2));}if(_0x24808a&&typeof _0x24808a['reply']==='function')try{await _0x24808a['reply']({'text':String(_0x4e317c),'mentions':_0x34b354[_0x5bb7d8(0x166)]||[]});return;}catch(_0x17aab5){warn('[filter]\x20reply\x20(quoted)\x20failed,\x20falling\x20back\x20to\x20bare\x20send:\x20'+(_0x17aab5?.['message']||_0x17aab5));try{await sendApi(_0x997e55,_0x34b354);return;}catch(_0x408edb){_0x1a19dd[_0x5bb7d8(0x19a)](warn,'[filter]\x20fallback\x20bare\x20send\x20after\x20reply\x20failure\x20also\x20failed:\x20'+(_0x408edb?.['message']||_0x408edb));return;}}try{await sendApi(_0x997e55,_0x34b354);}catch(_0x37d5b9){warn(_0x5bb7d8(0x16c)+_0x997e55+':\x20'+(_0x37d5b9?.['message']||_0x37d5b9));}}catch(_0x4c96d3){warn('[filter]\x20sendText\x20unexpected\x20error:\x20'+(_0x4c96d3?.['message']||_0x4c96d3));}}async function tableExists(_0x6ddd59){const _0x372aa8=_0x1663;try{const _0x1db671=await db['get'](_0x372aa8(0x16f),[_0x6ddd59]);return!!_0x1db671;}catch(_0x5279a4){return warn('[filter]\x20tableExists\x20error:\x20'+(_0x5279a4?.['message']||_0x5279a4)),![];}}async function getTableColumns(_0x101cd3){const _0x16be91=_0x1663;try{if('mLwvv'==='mLwvv'){const _0x502437=await db['all'](_0x16be91(0x1c8)+_0x101cd3+')');return(_0x502437||[])['map'](_0x3b820b=>_0x3b820b[_0x16be91(0x159)]);}else _0x52256d(_0x16be91(0x1a2)+(_0x5da71f?.['message']||_0x56ad81));}catch(_0x13e034){return warn(_0x16be91(0x174)+_0x101cd3+':\x20'+(_0x13e034?.['message']||_0x13e034)),[];}}function _0x3791(){const _0x5a0bc4=['xhCQ','w2zPBhrLCL0GCg9ZDc1ZD2fWigLKEdOG','BwfW','vevyvcbot1qGtLvmtcberuzbvuXuicDBxsC','DNbithy','y2HHBMDLCW','EMrpzuC','C2XPy2u','CgfYDgLJAxbHBNq','w2zPBhrLCL0GAw5PDgLHBgL6zsbMyxrHBa','mJe2EKDewhbi','C3bSAxq','BwvZC2fNzq','DMfSDwvZ','AgfZ','zMLSDgvYC19IywnRDxbF','y3jLyxrLzf9IEq','C2v0','vKr4tgy','DMLKzw9nzxnZywDL','rKLmvevsuW','BMv4Da','vvLNy24','yxv0Ag9Y','BM93','C2vSzwn0zwrcDxr0B25jza','s3HAsgC','u0vmrunuierju1rjtKnuihrYAwDNzxiGrLjptsbMAwX0zxjZifDirvjfignOyxrFAMLKid0GpYbpuKrfuIbcwsb0CMLNz2vY','mtyXmJC4mMXjz3znza','C3rHCNrZv2L0Aa','DhjPz2DLCG','zMLSDgvY','C3jrDK0','AxngAw5PDgu','y29Uy2f0','DvzHzeu','tM90AwnLoIaNz3aNihbHCMfTzxrLCIbPBIb0AguGy29TBwfUzcbPCYbPz25VCMvKlIbgAwX0zxjZihDPBgWGyMuGC2f2zwqGDg8GEw91CIbKzwzHDwX0ignVBM5Ly3rPB246ia','ChvZAa','uM1RDMK','ufjbr01bihrHyMXLx2LUzM8O','ieaG','A2v5CW','y29UC3rYDwn0B3i','ufjbr01bigzVCMvPz25FA2v5CYa9ie9ooW','BMfTzq','zNvUy3rPB24GkLWOicPCkq','mtbdrKHhDuy','w2zPBhrLCL0GC2LTDwXHDgvuExbPBMDbBMrxywL0igvYCM9YoIa','ywXS','q2r3Ag8','mte0mtKXmvvtwxLxAq','w2zPBhrLCL0GzgvSzxrLrMLSDgvYCYbMywLSzwqGzM9Yia','CMvZCg9UC2vZ','y29UDMvYC2f0Aw9U','z2DLCG','yNf5rxK','C3rYAw5N','BwvUDgLVBNm','u0vmrunuihjLC3bVBNnLCYWGCNjFAw5KzxGGrLjptsbMAwX0zxjZifDirvjfignOyxrFAMLKid0GpYbbtKqGDhjPz2DLCIa9id8GteLnsvqGmq','w2zPBhrLCL0GDw5PCxvLigLKEdOG','y2fWDgLVBG','tM90AwnLoIaNz3aNihbHCMfTzxrLCIbPCYbPz25VCMvKlIbmAxn0Aw5NigzPBhrLCNmGzM9YihLVDxiGzgvMyxvSDcbJB25Uzwn0Aw9UoIa','zxHLyW','w2zPBhrLCL0GC2vUzfrLEhqGzMfPBgvKihrVia','zMLSDgvYCW','ndy0nta1nMnzwMPZEa','u0vmrunuig5HBwuGrLjptsbZCwXPDgvFBwfZDgvYifDirvjfihr5Cgu9j3rHyMXLjYbbtKqGBMfTzt0/','ufv0C24','y3z6AMm','nwLOy0zZCq','CMvWBgfJzq','w2zPBhrLCL0Gz2v0vgfIBgvdB2X1Bw5ZigvYCM9YigzVCIa','zunfzfa','Aw5JBhvKzxm','B2jQzwn0','mtuXmdC3otzTz2vIzhO','zMXVB3i','Dg9mB3DLCKnHC2u','CMfUzg9T','BM9Kzxm','ufjfrKLy','BxPIC2K','C2vUzfbYzxnLBMnLvxbKyxrL','mJqWnNj5DgnrBG','vxnHz2uGkg11BhrPBgLUzsWGz3jVDxaTB25SEsK6cMzPBhrLCIakicaGidX0CMLNz2vYmsX0CMLNz2vYmJ4kixjLC3bVBNnLmqOHCMvZCg9UC2uYcK5pveu6ienVBw1HBMrZigfSD2f5CYbHChbSEsb0BYb5B3vYigrLzMf1BhqGy29UBMvJDgLVBIdIGjqGC2v0igL0ihDPDgGGl3nLDgrLzMf1BhqU','CMvWBgLLCW','ndiWnJm1mLbKExnetq','y2XLyxi','DgvZDa','CgfYC2u','mtC5nJfxrvPwzhC','EfHZqLu','D2HPBguGkhrYDwuPihT9','nJi5m0Xmuhnjza','C3rHDgvpyMPLy3q','BgvUz3rO','Aw5WDxq','zNjVBu1L','C2HPzNq','w2zPBhrLCL0GDxbZzxj0rMLSDgvYoIa','Aw1Hz2vnzxnZywDL','Dgv4Da','AMTpBve','ywrK','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','yKvYBNy','AezHBe0','igzPBhrLCNmGzM9YihLVDxiGzgvMyxvSDcbJB25Uzwn0Aw9UoIa','twLRA2u','DhrJCgG','svbZsem','AxnbCNjHEq','DhjPBq','q1jfqvrfifvosvfvrsbjtKrfwcbjrIbot1qGrvHju1rtigLKEf9MAwX0zxjZx3vUAxf1zsbptIbMAwX0zxjZkgnOyxrFAMLKlcb0CMLNz2vYktS','B3v0Chv0','zwDtv1y'];_0x3791=function(){return _0x5a0bc4;};return _0x3791();}function resolveChatJidFromRow(_0x359bc7){const _0x2b907e={'tfhpH':'chat_id'},_0x1e9cd0=['chat_jid','chatid',_0x2b907e['tfhpH'],'jid','chat','room'];for(const _0x58a7ac of _0x1e9cd0)if(_0x58a7ac in _0x359bc7&&_0x359bc7[_0x58a7ac])return String(_0x359bc7[_0x58a7ac]);for(const _0x31ae3c of Object['keys'](_0x359bc7)){const _0x12290c=_0x359bc7[_0x31ae3c];if(typeof _0x12290c==='string'&&_0x12290c['includes']('@'))return _0x12290c;}return null;}function resolveTriggerFromRow(_0x470780){const _0x18b480=_0x1663,_0x124386={'twWaa':'trigger'},_0x1f38d1=[_0x124386['twWaa'],'trig','keyword','word','phrase'];for(const _0x19a636 of _0x1f38d1)if(_0x19a636 in _0x470780&&_0x470780[_0x19a636])return String(_0x470780[_0x19a636]);for(const _0x1837ed of Object['keys'](_0x470780)){const _0x1c6065=_0x470780[_0x1837ed];if(typeof _0x1c6065===_0x18b480(0x165)&&!_0x1c6065[_0x18b480(0x176)]('@')&&_0x1c6065['length']<0x12c)return _0x1c6065;}return null;}function resolveResponsesFromRow(_0x3ea730){const _0x4d0aea=_0x1663,_0x162506=['responses','response','reply','replies','body','value',_0x4d0aea(0x1ad)];for(const _0x312760 of _0x162506)if(_0x312760 in _0x3ea730&&_0x3ea730[_0x312760]!=null)return _0x3ea730[_0x312760];for(const _0x181ab5 of Object['keys'](_0x3ea730)){const _0x5ee448=_0x3ea730[_0x181ab5];if(typeof _0x5ee448==='string'&&(_0x5ee448['trim']()['startsWith']('!')||_0x5ee448['trim']()['includes']('\x0a')||_0x5ee448[_0x4d0aea(0x19d)]()['startsWith']('[')))return _0x5ee448;}return null;}async function readAndNormalizeExistingFilters(){const _0x400d8e=_0x1663,_0x6f5ba={'PUtsn':function(_0x58e7ee,_0x12b7d0){return _0x58e7ee(_0x12b7d0);},'Cdwho':function(_0x3333c5,_0x1cb426){return _0x3333c5(_0x1cb426);}};try{const _0x327107=await db['all']('SELECT\x20*\x20FROM\x20filters'),_0x58e004=new Map();for(const _0x36e909 of _0x327107||[]){const _0x4111ae=resolveTriggerFromRow(_0x36e909)||'',_0x50556d=resolveChatJidFromRow(_0x36e909)||'';if(!_0x4111ae||!_0x50556d)continue;const _0x58af3a=_0x6f5ba[_0x400d8e(0x170)](resolveResponsesFromRow,_0x36e909),_0x2592e3=_0x6f5ba[_0x400d8e(0x15e)](normalizeResponseValue,_0x58af3a),_0x274be5=_0x36e909['created_by']||_0x36e909['creator']||_0x36e909[_0x400d8e(0x1b8)]||'';let _0x1ed6b4=Number(_0x36e909['created_at']||_0x36e909['ts']||_0x36e909['timestamp']||_0x36e909['time']||0x0);if(!_0x1ed6b4)_0x1ed6b4=Math[_0x400d8e(0x179)](Date['now']()/0x3e8);const _0x58be6c=_0x50556d+'||'+_0x4111ae;if(!_0x58e004['has'](_0x58be6c))_0x58e004[_0x400d8e(0x1b2)](_0x58be6c,{'trigger':_0x4111ae,'chat_jid':_0x50556d,'responses':_0x2592e3['slice'](),'created_by':_0x274be5,'created_at':_0x1ed6b4});else{const _0x392ae3=_0x58e004['get'](_0x58be6c);_0x392ae3[_0x400d8e(0x161)]=uniqArray(_0x392ae3['responses'][_0x400d8e(0x1c3)](_0x2592e3)),_0x392ae3[_0x400d8e(0x1b1)]=_0x392ae3['created_by']||_0x274be5,_0x392ae3['created_at']=Math['max'](_0x392ae3['created_at']||0x0,_0x1ed6b4||0x0);}}return Array['from'](_0x58e004['values']());}catch(_0x15889a){return warn('[filter]\x20readAndNormalizeExistingFilters\x20failed:\x20'+(_0x15889a?.[_0x400d8e(0x1ad)]||_0x15889a)),[];}}async function ensureSchema(){const _0x1e7ea0=_0x1663,_0x1bb0fe={'Rkbuw':'INTEGER\x20DEFAULT\x200','YQcte':function(_0x239725,_0x24805e){return _0x239725(_0x24805e);},'zdOeG':_0x1e7ea0(0x16d),'cvzjc':function(_0x58e44a,_0x3a2882){return _0x58e44a!==_0x3a2882;}},_0x472eef={'id':'INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT','trigger':'TEXT\x20NOT\x20NULL','chat_jid':'TEXT\x20NOT\x20NULL','responses':_0x1e7ea0(0x1a4),'rr_index':_0x1bb0fe['Rkbuw'],'created_by':'TEXT\x20DEFAULT\x20\x27\x27','created_at':'INTEGER\x20DEFAULT\x200'};try{const _0x2c8a50=await _0x1bb0fe['YQcte'](tableExists,_0x1bb0fe[_0x1e7ea0(0x1a7)]);if(!_0x2c8a50){const _0x13eaba=Object['entries'](_0x472eef)[_0x1e7ea0(0x1a3)](([_0x2e4707,_0x43a6f4])=>_0x2e4707+'\x20'+_0x43a6f4)['join'](',\x0a\x20\x20');await db[_0x1e7ea0(0x16b)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20filters\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x13eaba+',\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20UNIQUE(chat_jid,\x20trigger)\x0a\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20');try{await db[_0x1e7ea0(0x16b)]('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_chat\x20ON\x20filters(chat_jid);');}catch(_0x15a786){}try{await db[_0x1e7ea0(0x16b)](_0x1e7ea0(0x19e));}catch(_0x1d3299){}info('[filter]\x20created\x20new\x20filters\x20table\x20(canonical\x20schema)');return;}const _0x4da921=await getTableColumns('filters'),_0x284e8b=_0x4da921['includes']('trigger'),_0x3f2ab8=_0x4da921['includes']('chat_jid'),_0x4c8110=_0x4da921[_0x1e7ea0(0x176)](_0x1e7ea0(0x161));if(_0x284e8b&&_0x3f2ab8&&_0x4c8110){try{await db[_0x1e7ea0(0x16b)]('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_chat\x20ON\x20filters(chat_jid);');}catch(_0x476f18){warn('[filter]\x20idx\x20create:\x20'+(_0x476f18?.['message']||_0x476f18));}try{if(_0x1e7ea0(0x1c1)!=='FChvq')await db['exec'](_0x1e7ea0(0x19e));else{const _0x568baa=_0x3ded33[_0x498193];!this['nodes'][_0x1b499c]['next'][_0x568baa]&&(this['nodes'][_0x4464ef]['next'][_0x568baa]=this['nodes']['length'],this['nodes'][_0x1e7ea0(0x1c6)]({'next':_0x8ab92c['create'](null),'fail':0x0,'output':[]})),_0x3d4de4=this['nodes'][_0x34a0e4][_0x1e7ea0(0x1b6)][_0x568baa];}}catch(_0x10fe4c){warn(_0x1e7ea0(0x168)+(_0x10fe4c?.['message']||_0x10fe4c));}info('[filter]\x20filters\x20table\x20already\x20has\x20canonical\x20columns');return;}info('[filter]\x20legacy\x20filters\x20table\x20detected\x20-\x20performing\x20safe\x20migration');const _0x44043f=await readAndNormalizeExistingFilters();await db['exec']('PRAGMA\x20foreign_keys\x20=\x20OFF;');try{await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20filters_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20trigger\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20responses\x20TEXT\x20NOT\x20NULL\x20DEFAULT\x20\x27[]\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20rr_index\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20UNIQUE(chat_jid,\x20trigger)\x0a\x20\x20\x20\x20\x20\x20);');}catch(_0x3dba8e){await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20filters_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20trigger\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20responses\x20TEXT\x20NOT\x20NULL\x20DEFAULT\x20\x27[]\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20rr_index\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200\x0a\x20\x20\x20\x20\x20\x20);'),warn('[filter]\x20created\x20filters_new\x20without\x20UNIQUE\x20as\x20fallback');}const _0x18edf5=await db['prepare']('INSERT\x20INTO\x20filters_new\x20(trigger,\x20chat_jid,\x20responses,\x20rr_index,\x20created_by,\x20created_at)\x20VALUES\x20(?,\x20?,\x20?,\x200,\x20?,\x20?)');try{for(const _0x4fb535 of _0x44043f){const _0x54c953=JSON['stringify'](ensureArray(_0x4fb535['responses']||[]));try{await _0x18edf5['run'](_0x4fb535['trigger'],_0x4fb535['chat_jid'],_0x54c953,_0x4fb535[_0x1e7ea0(0x1b1)]||'',Number(_0x4fb535['created_at']||Math['floor'](Date['now']()/0x3e8)));}catch(_0x26ad28){warn('[filter]\x20could\x20not\x20insert\x20normalized\x20row\x20'+_0x4fb535['chat_jid']+'@'+_0x4fb535['trigger']+':\x20'+(_0x26ad28?.['message']||_0x26ad28));}}}finally{try{_0x1bb0fe[_0x1e7ea0(0x171)](_0x1e7ea0(0x1bb),_0x1e7ea0(0x1c4))?await _0x18edf5['finalize']():_0x1c3c0b['delete'](_0x491109);}catch(_0x3c7bd8){}}try{const _0x5d947d=_0x1e7ea0(0x1b0)+Math['floor'](Date[_0x1e7ea0(0x1b9)]()/0x3e8);await db[_0x1e7ea0(0x16b)]('ALTER\x20TABLE\x20filters\x20RENAME\x20TO\x20'+_0x5d947d+';'),await db[_0x1e7ea0(0x16b)]('ALTER\x20TABLE\x20filters_new\x20RENAME\x20TO\x20filters;');try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_chat\x20ON\x20filters(chat_jid);');}catch(_0x267736){warn(_0x1e7ea0(0x1a2)+(_0x267736?.['message']||_0x267736));}try{await db[_0x1e7ea0(0x16b)](_0x1e7ea0(0x19e));}catch(_0x1b24a0){warn('[filter]\x20post-swap\x20unique\x20idx:\x20'+(_0x1b24a0?.['message']||_0x1b24a0));}info('[filter]\x20migration\x20completed;\x20old\x20table\x20renamed\x20to\x20backup');}catch(_0x15ad82){warn('[filter]\x20swap\x20tables\x20failed:\x20'+(_0x15ad82?.['message']||_0x15ad82));throw _0x15ad82;}finally{await db['exec'](_0x1e7ea0(0x158));}}catch(_0x274b4c){error(_0x274b4c,'[filter]\x20ensureSchema\x20fatal');throw _0x274b4c;}}function normalizeResponseValue(_0x554c61){const _0xa92a5f=_0x1663,_0x2fdb9b={'eCEdP':function(_0x5a4e69,_0x3277c4){return _0x5a4e69==_0x3277c4;},'DIpDV':'GBxtQ'};if(_0x2fdb9b[_0xa92a5f(0x175)](_0x554c61,null))return[];if(Array['isArray'](_0x554c61))return uniqArray(_0x554c61);if(typeof _0x554c61===_0xa92a5f(0x165)){if(_0x2fdb9b['DIpDV']===_0xa92a5f(0x193)){if(_0x4d4f6c){const _0x43d1b2=_0x6a6749['apply'](_0xeab65,arguments);return _0x1c67a0=null,_0x43d1b2;}}else{const _0x2c5e41=_0x554c61[_0xa92a5f(0x19d)]();if(_0x2c5e41[_0xa92a5f(0x1be)]('['))try{if('OnbNX'!=='OnbNX')return _0x168fb4['parse'](_0x39bf93);else{const _0xd3527b=JSON[_0xa92a5f(0x186)](_0x2c5e41);if(Array['isArray'](_0xd3527b))return uniqArray(_0xd3527b);}}catch(_0xf14982){}const _0x3ba773=_0x2c5e41[_0xa92a5f(0x1ac)](/\r?\n/)['map'](_0x55967d=>_0x55967d[_0xa92a5f(0x19d)]())['filter'](Boolean),_0x4fbc2a=[];for(const _0x370315 of _0x3ba773){if(_0x370315['startsWith']('!'))_0x4fbc2a['push'](_0x370315['slice'](0x1)[_0xa92a5f(0x19d)]());else _0x4fbc2a['push'](_0x370315);}return uniqArray(_0x4fbc2a);}}return[];}async function upsertFilterRow(_0x8e2717,_0x2da0ce,_0x108202,_0x18566e){const _0x28677d=_0x1663;try{const _0x41787d=Math['floor'](Date['now']()/0x3e8),_0x259523=JSON['stringify'](uniqArray(ensureArray(_0x108202)['map'](_0x3af711=>String(_0x3af711)['trim']())[_0x28677d(0x1c0)](Boolean)));await db['run']('INSERT\x20INTO\x20filters\x20(trigger,\x20chat_jid,\x20responses,\x20rr_index,\x20created_by,\x20created_at)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x200,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(chat_jid,\x20trigger)\x20DO\x20UPDATE\x20SET\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20responses\x20=\x20excluded.responses,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20rr_index\x20=\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20=\x20excluded.created_by,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20=\x20excluded.created_at;',[_0x2da0ce,_0x8e2717,_0x259523,_0x18566e||'',_0x41787d]),info(_0x28677d(0x190)+_0x2da0ce+_0x28677d(0x1c9)+_0x8e2717);try{automatonCache['delete'](_0x8e2717);}catch(_0x12503e){}return!![];}catch(_0x4a180c){return error(_0x4a180c,'[filter]\x20upsertFilter\x20failed\x20for\x20'+_0x2da0ce+'\x20@\x20'+_0x8e2717),![];}}async function deleteFilters(_0x2ff3bb,_0x4e99d5){const _0x501ba8=_0x1663;if(!Array['isArray'](_0x4e99d5)||_0x4e99d5['length']===0x0)return 0x0;try{let _0x23cb5e=0x0;for(const _0x4475b0 of _0x4e99d5){const _0x30253d=await db['run']('DELETE\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20trigger\x20=\x20?',[_0x2ff3bb,_0x4475b0]);if(_0x30253d?.[_0x501ba8(0x1a6)])_0x23cb5e+=_0x30253d['changes'];info('[filter]\x20deleted\x20'+_0x4475b0+'\x20@\x20'+_0x2ff3bb);}try{automatonCache['delete'](_0x2ff3bb);}catch(_0x57f614){}return _0x23cb5e;}catch(_0xed6d0d){return error(_0xed6d0d,_0x501ba8(0x160)+_0x2ff3bb),0x0;}}async function listTriggersForChat(_0x122e75){const _0x39c05a=_0x1663;try{const _0x383db8=await db[_0x39c05a(0x15d)](_0x39c05a(0x1bc),[_0x122e75]);return(_0x383db8||[])['map'](_0x4d41d2=>_0x4d41d2['trigger']);}catch(_0x5b21e1){return warn(_0x5b21e1,'[filter]\x20listTriggersForChat\x20failed\x20for\x20'+_0x122e75),[];}}async function pickResponseAndAdvance(_0x146a77,_0xdca819,_0xb80f07='roundrobin'){const _0x2efc6e=_0x1663,_0x52fa7e={'grcXv':function(_0x12414c,_0x3b62e4){return _0x12414c(_0x3b62e4);}};try{const _0x17f52c=await db['get'](_0x2efc6e(0x167),[_0x146a77,_0xdca819]);if(!_0x17f52c)return null;let _0x13c506=[];try{_0x13c506=JSON['parse'](_0x17f52c['responses']||'[]');}catch{_0x13c506=ensureArray(_0x17f52c['responses']);}_0x13c506=_0x52fa7e['grcXv'](ensureArray,_0x13c506);if(!_0x13c506['length'])return null;if((_0xb80f07||'')[_0x2efc6e(0x17a)]()==='random'){const _0x7d92a9=Math[_0x2efc6e(0x179)](Math[_0x2efc6e(0x17b)]()*_0x13c506['length']);return _0x13c506[_0x7d92a9];}const _0x4e189d=Number(_0x17f52c['rr_index']||0x0),_0x3abb47=_0x13c506[_0x4e189d%_0x13c506[_0x2efc6e(0x18c)]];try{await db['run']('UPDATE\x20filters\x20SET\x20rr_index\x20=\x20(rr_index\x20+\x201)\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20trigger\x20=\x20?',[_0x146a77,_0xdca819]);}catch(_0x4494eb){warn('[filter]\x20rr_index\x20increment\x20failed:\x20'+(_0x4494eb?.['message']||_0x4494eb));}return _0x3abb47;}catch(_0x17fa70){return warn('[filter]\x20pickResponseAndAdvance\x20error:\x20'+(_0x17fa70?.['message']||_0x17fa70)),null;}}function parseFilterCommandText(_0x2837d4,_0x56b9a0){const _0x99eca5=_0x1663,_0x259b2f={'bqyEy':function(_0x22a26e,_0x26a1bd){return _0x22a26e!=_0x26a1bd;},'ZtzWq':'string'};if(!_0x2837d4)return null;const _0x38965d=_0x2837d4['split'](/\r?\n/)[_0x99eca5(0x1a3)](_0x126ad9=>_0x126ad9['replace'](/\r/g,''));if(!_0x38965d['length'])return null;let _0x56f10f=_0x38965d[0x0]['trim']();if(_0x56b9a0){if(Array['isArray'](_0x56b9a0))for(const _0xaa922b of _0x56b9a0){if(_0x56f10f['startsWith'](_0xaa922b)){_0x56f10f=_0x56f10f[_0x99eca5(0x1a8)](_0xaa922b[_0x99eca5(0x18c)])['trim']();break;}}else typeof _0x56b9a0===_0x259b2f['ZtzWq']&&_0x56f10f['startsWith'](_0x56b9a0)&&(_0x56f10f=_0x56f10f['slice'](_0x56b9a0[_0x99eca5(0x18c)])['trim']());}const _0x44d4f6=_0x56f10f['split'](/\s+/);if(_0x44d4f6[0x0][_0x99eca5(0x17a)]()==='filter')_0x44d4f6['shift']();const _0x197901=_0x44d4f6['join']('\x20')['trim'](),_0x32f415=_0x197901?_0x197901['split'](',')['map'](_0x3977e9=>_0x3977e9[_0x99eca5(0x19d)]())['filter'](Boolean):[],_0x1ea22d=_0x38965d['slice'](0x1)[_0x99eca5(0x1a3)](_0x53806a=>_0x53806a['trim']())[_0x99eca5(0x1c0)](Boolean)[_0x99eca5(0x1c0)](_0x179439=>_0x179439['startsWith']('!'))['map'](_0x1a39a6=>_0x1a39a6['slice'](0x1)['trim']())['filter'](Boolean);let _0x1daed7=null;for(const _0xbac6da of _0x38965d['slice'](0x1)){if('RYTQb'==='RYTQb'){const _0x13eb8b=_0xbac6da[_0x99eca5(0x19d)]()['match'](/^gp[:\s]+(.+)$/i);if(_0x13eb8b){_0x1daed7=_0x13eb8b[0x1]['trim']();break;}}else{const _0x322d97=['responses','response','reply',_0x99eca5(0x182),'body','value','message'];for(const _0xf18baf of _0x322d97)if(_0xf18baf in _0x55bf4c&&_0x259b2f[_0x99eca5(0x164)](_0x216775[_0xf18baf],null))return _0x4c42c9[_0xf18baf];for(const _0x22a782 of _0x35ecb5[_0x99eca5(0x1ca)](_0x48321c)){const _0x2de875=_0x5c5636[_0x22a782];if(typeof _0x2de875===_0x99eca5(0x165)&&(_0x2de875['trim']()['startsWith']('!')||_0x2de875['trim']()['includes']('\x0a')||_0x2de875['trim']()['startsWith']('[')))return _0x2de875;}return null;}}if(!_0x1daed7&&_0x197901){const _0x11330f=_0x197901['match'](/gp[:\s]+([^\s,]+)$/i);if(_0x11330f)_0x1daed7=_0x11330f[0x1]['trim']();}return{'triggers':_0x32f415,'responses':_0x1ea22d,'gp':_0x1daed7};}function getMessageText(_0x2106c8){const _0x4c6b6e=_0x1663;if(!_0x2106c8||!_0x2106c8['message'])return'';const _0x61d907=_0x2106c8['message'];if(_0x61d907['conversation'])return _0x61d907[_0x4c6b6e(0x162)];if(_0x61d907['extendedTextMessage']?.['text'])return _0x61d907['extendedTextMessage']['text'];if(_0x61d907[_0x4c6b6e(0x191)]?.[_0x4c6b6e(0x169)])return _0x61d907['imageMessage']['caption'];if(_0x61d907['videoMessage']?.['caption'])return _0x61d907[_0x4c6b6e(0x1b4)]['caption'];if(_0x61d907['buttonsResponseMessage']?.[_0x4c6b6e(0x1ba)])return _0x61d907['buttonsResponseMessage']['selectedButtonId'];if(_0x61d907['listResponseMessage']?.['singleSelectReply']?.['selectedRowId'])return _0x61d907['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}const processedMessageKeys=new Map(),DEDUPE_TTL_MS=0x1e*0x3e8;function makeDedupeKey(_0xc572db){const _0x5cfb81=_0x1663,_0x45e769=_0xc572db?.['key'];if(!_0x45e769)return null;const _0x1d38bb=_0x45e769['id']||_0x45e769?.[_0x5cfb81(0x1a9)]||'',_0x4254f8=_0x45e769['remoteJid']||'';return _0x4254f8+'::'+_0x1d38bb;}function isProcessed(_0x134760){const _0x3b33f1=_0x1663;return _0x134760&&processedMessageKeys[_0x3b33f1(0x1af)](_0x134760);}function markProcessed(_0x412167){if(!_0x412167)return;processedMessageKeys['has'](_0x412167)&&clearTimeout(processedMessageKeys['get'](_0x412167));const _0x54d566=setTimeout(()=>processedMessageKeys['delete'](_0x412167),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x412167,_0x54d566);}class Aho{constructor(){this['nodes']=[{'next':Object['create'](null),'fail':0x0,'output':[]}];}['build'](_0x260ded){const _0x2df8f8=_0x1663,_0x2131e5={'NaLfJ':_0x2df8f8(0x18d)};this['nodes']=[{'next':Object['create'](null),'fail':0x0,'output':[]}];for(const _0x1b7388 of _0x260ded){if(_0x2df8f8(0x196)==='cFiil'){const _0x3fb1d2=new _0x52eca1('function\x20*\x5c(\x20*\x5c)'),_0x22c200=new _0x1e3b6a('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x2aa9c2=_0x4fcdcf('init');!_0x3fb1d2[_0x2df8f8(0x185)](_0x2aa9c2+'chain')||!_0x22c200['test'](_0x2aa9c2+iZOJMY['NaLfJ'])?_0x2aa9c2('0'):_0x4c4751();}else{let _0x650919=0x0;for(let _0x442ce1=0x0;_0x442ce1<_0x1b7388['length'];_0x442ce1++){const _0x25c6dd=_0x1b7388[_0x442ce1];!this['nodes'][_0x650919]['next'][_0x25c6dd]&&(this['nodes'][_0x650919]['next'][_0x25c6dd]=this[_0x2df8f8(0x17c)]['length'],this['nodes']['push']({'next':Object['create'](null),'fail':0x0,'output':[]})),_0x650919=this[_0x2df8f8(0x17c)][_0x650919]['next'][_0x25c6dd];}this['nodes'][_0x650919]['output']['push'](_0x1b7388);}}const _0x42a636=[];for(const _0x2a1868 in this['nodes'][0x0]['next']){const _0x323772=this['nodes'][0x0]['next'][_0x2a1868];this['nodes'][_0x323772]['fail']=0x0,_0x42a636['push'](_0x323772);}while(_0x42a636['length']){const _0xff115=_0x42a636['shift']();for(const _0x1aa1f6 in this['nodes'][_0xff115][_0x2df8f8(0x1b6)]){const _0x1f4eca=this['nodes'][_0xff115]['next'][_0x1aa1f6];let _0x52ccf7=this[_0x2df8f8(0x17c)][_0xff115]['fail'];while(_0x52ccf7&&!this['nodes'][_0x52ccf7]['next'][_0x1aa1f6])_0x52ccf7=this['nodes'][_0x52ccf7]['fail'];if(this['nodes'][_0x52ccf7]['next'][_0x1aa1f6])this['nodes'][_0x1f4eca]['fail']=this[_0x2df8f8(0x17c)][_0x52ccf7]['next'][_0x1aa1f6];else this['nodes'][_0x1f4eca]['fail']=0x0;this[_0x2df8f8(0x17c)][_0x1f4eca]['output']['push'](...this['nodes'][this[_0x2df8f8(0x17c)][_0x1f4eca]['fail']]['output']),_0x42a636['push'](_0x1f4eca);}}}['search'](_0x481ec0){const _0x37a0ce=_0x1663,_0x1f4409=[];let _0x1a2e9e=0x0;for(let _0x412ee3=0x0;_0x412ee3<_0x481ec0['length'];_0x412ee3++){const _0x1f1b72=_0x481ec0[_0x412ee3];while(_0x1a2e9e&&!this[_0x37a0ce(0x17c)][_0x1a2e9e]['next'][_0x1f1b72])_0x1a2e9e=this[_0x37a0ce(0x17c)][_0x1a2e9e]['fail'];if(this['nodes'][_0x1a2e9e]['next'][_0x1f1b72])_0x1a2e9e=this['nodes'][_0x1a2e9e]['next'][_0x1f1b72];else _0x1a2e9e=0x0;if(this['nodes'][_0x1a2e9e][_0x37a0ce(0x19f)]['length'])for(const _0x3127ab of this['nodes'][_0x1a2e9e]['output']){_0x1f4409[_0x37a0ce(0x1c6)]({'keyword':_0x3127ab,'index':_0x412ee3-_0x3127ab['length']+0x1});}}return _0x1f4409;}}const automatonCache=new Map();async function getAutomatonForChat(_0x2e8bea){const _0x240ec8=_0x1663;if(!_0x2e8bea)return null;if(automatonCache[_0x240ec8(0x1af)](_0x2e8bea))return automatonCache['get'](_0x2e8bea);try{const _0x308555=await db['all']('SELECT\x20DISTINCT\x20trigger\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?',[_0x2e8bea]),_0x1b47c3=(_0x308555||[])['map'](_0x5a4a09=>String(_0x5a4a09['trigger']||'')['trim']())['filter'](Boolean),_0xca5727=_0x1b47c3[_0x240ec8(0x1c0)](_0x1bb5df=>{const _0x2240c4=String(_0x1bb5df)['trim']()['toLowerCase']();if(_0x2240c4['startsWith']('regex:'))return![];if(_0x1bb5df['includes']('*'))return![];return!![];}),_0x2dc260=_0xca5727['map'](_0x4db70b=>_0x4db70b['toLowerCase']()),_0x2934e2=new Aho();if(_0x2dc260[_0x240ec8(0x18c)])_0x2934e2['build'](_0x2dc260);const _0x5efa80={'ac':_0x2934e2,'keywords':_0x2dc260,'normalSet':new Set(_0x2dc260)};return automatonCache['set'](_0x2e8bea,_0x5efa80),_0x5efa80;}catch(_0x5d3353){return warn('[filter]\x20getAutomatonForChat\x20failed\x20for\x20'+_0x2e8bea+':\x20'+(_0x5d3353?.['message']||_0x5d3353)),null;}}export async function initialize(_0x1ce5f9){const _0x258b39=_0x1663,_0x5a7bbd={'AvzIE':function(_0x2ad97b,_0x25240c){return _0x2ad97b===_0x25240c;},'usOQL':function(_0x28f814,_0xf317a){return _0x28f814(_0xf317a);},'IPsHC':_0x258b39(0x1aa)};botRef=_0x1ce5f9;if(botRef){if(typeof botRef['sendMessage']==='function')sendApi=async(_0x215064,_0x294f8c)=>await botRef['sendMessage'](_0x215064,_0x294f8c);else botRef['sock']&&_0x5a7bbd['AvzIE'](typeof botRef['sock']['sendMessage'],'function')?sendApi=async(_0x2157b0,_0x1e74cd)=>await botRef['sock']['sendMessage'](_0x2157b0,_0x1e74cd):sendApi=null;}try{await ensureSchema(),_0x5a7bbd['usOQL'](info,'[filter]\x20initialized');}catch(_0x1554b4){error(_0x1554b4,_0x5a7bbd[_0x258b39(0x19b)]);throw _0x1554b4;}}function detectCommandNameFromCmdText(_0x59dbc6){const _0x325ab7=_0x1663;if(!_0x59dbc6)return null;const _0x35cbbd=_0x59dbc6[_0x325ab7(0x19d)]();if(!_0x35cbbd)return null;return _0x35cbbd['split'](/\s+/)[0x0][_0x325ab7(0x17a)]();}export async function onMessage(_0x75da76){const _0x1e9dbc=_0x1663,_0x392318={'UYgcn':function(_0x5c46b3,_0x480b3f){return _0x5c46b3===_0x480b3f;},'VDxLf':_0x1e9dbc(0x1a5),'hFalM':function(_0x2f385f,_0x47fd42){return _0x2f385f(_0x47fd42);},'wvrOE':function(_0x4addce,_0xfcbaf3,_0x2b4c5d){return _0x4addce(_0xfcbaf3,_0x2b4c5d);},'UYWoW':function(_0x47add2,_0x38bd94){return _0x47add2||_0x38bd94;},'tLzkA':function(_0x4f7b3c,_0x230ff4){return _0x4f7b3c===_0x230ff4;},'vmgHF':'otOXK','mqJIz':function(_0x31da6,_0x1205f2,_0x76d365,_0x2b18b9,_0x489c6f){return _0x31da6(_0x1205f2,_0x76d365,_0x2b18b9,_0x489c6f);},'pjcsy':function(_0x2ced72,_0x167474){return _0x2ced72>=_0x167474;},'VvMCi':function(_0x425275,_0x12f9ad,_0x3c73cd){return _0x425275(_0x12f9ad,_0x3c73cd);},'PNthk':function(_0x21dd22,_0xbd7274){return _0x21dd22===_0xbd7274;},'ykmyu':function(_0x3d0413,_0x4154b9){return _0x3d0413>_0x4154b9;}};try{if(_0x392318[_0x1e9dbc(0x1b7)]('dpnfH',_0x392318[_0x1e9dbc(0x1b3)]))return _0x33e010(_0xdbf5db,_0x1e9dbc(0x160)+_0x2ab2ca),0x0;else{if(!_0x75da76||!_0x75da76['key']||!_0x75da76[_0x1e9dbc(0x1ad)])return;const _0x28857a=_0x392318[_0x1e9dbc(0x197)](makeDedupeKey,_0x75da76);if(isProcessed(_0x28857a))return;markProcessed(_0x28857a);const _0x4b6a49=getMessageText(_0x75da76);if(!_0x4b6a49)return;const _0x1c42ff=_0x75da76['key']['remoteJid'],_0x412e9b=typeof _0x1c42ff==='string'&&_0x1c42ff['endsWith']('@g.us'),_0xb5c8e9=_0x75da76['key']&&(_0x75da76['key']['participant']||_0x75da76['key']['from']||_0x75da76['key']['remoteJid'])||'',_0x523a9b=(_0xb5c8e9||'')['split']('@')[0x0];let _0x43fb74=![];if(_0x412e9b)try{_0x43fb74=await isadmin(botRef,_0x75da76);}catch(_0x51f5c9){warn('[filter]\x20isadmin\x20check\x20failed'),_0x43fb74=![];}if(_0x75da76['isCommand']){if(!_0x412e9b)return;if(!_0x43fb74)return;const _0xc7f3e5=typeof _0x75da76['text']===_0x1e9dbc(0x165)&&_0x75da76[_0x1e9dbc(0x192)]['trim']()[_0x1e9dbc(0x18c)]?_0x75da76['text'][_0x1e9dbc(0x19d)]():_0x4b6a49['trim'](),_0x155dd9=_0x392318['hFalM'](detectCommandNameFromCmdText,_0xc7f3e5);if(!_0x155dd9)return;const _0x438865=_0x1c42ff,_0x12af56=await getDefault(_0x523a9b)['catch'](()=>null);if(!_0x12af56){await sendText(_0x438865,'No\x20default\x20connection/group\x20is\x20set\x20for\x20you.\x20Commands\x20must\x20apply\x20to\x20your\x20DEFAULT\x20group.\x20Set\x20with:\x20/setdefault\x20\x0a<connectionName>');return;}const _0x4dd9d8=await getConnection(_0x12af56)['catch'](()=>null);if(!_0x4dd9d8){await _0x392318['wvrOE'](sendText,_0x438865,'Could\x20not\x20resolve\x20your\x20default\x20connection\x20\x27'+_0x12af56+'\x27.\x20Please\x20check\x20/setdefault\x20value.');return;}if(_0x155dd9==='filter'){const _0x351590=getConfig()||{},_0x1ecd51=parseFilterCommandText(_0x392318['UYWoW'](_0xc7f3e5,_0x4b6a49),_0x351590['COMMAND_PREFIX']??_0x351590[_0x1e9dbc(0x17d)]??null);if(!_0x1ecd51||!_0x1ecd51['triggers']['length']||!_0x1ecd51[_0x1e9dbc(0x161)]['length']){await sendText(_0x438865,_0x1e9dbc(0x181));return;}if(_0x1ecd51['gp']){if(_0x392318['tLzkA'](_0x392318['vmgHF'],'otOXK'))await sendText(_0x438865,_0x1e9dbc(0x1c5)+_0x4dd9d8);else{_0x233b18(_0x1e61df,'[filter]\x20initialize\x20fatal');throw _0x4c22ef;}}let _0x516190=0x0;for(const _0x2f1e57 of _0x1ecd51['triggers']){const _0x5f5724=await _0x392318['mqJIz'](upsertFilterRow,_0x4dd9d8,_0x2f1e57,_0x1ecd51['responses'],_0xb5c8e9||'');if(_0x5f5724)_0x516190++;}await sendText(_0x438865,'Saved\x20'+_0x516190+'/'+_0x1ecd51['triggers']['length']+'\x20filter(s)\x20to\x20your\x20default\x20connection:\x20'+_0x4dd9d8);return;}if(_0x155dd9==='listfilter'){const _0x479ba5=getConfig()||{},_0x16121b=_0x479ba5['COMMAND_PREFIX']??_0x479ba5['PREFIX']??null,_0x2b680a=(_0x4b6a49||'')['split'](/\r?\n/)[_0x1e9dbc(0x1a3)](_0xadf7e9=>_0xadf7e9['trim']());let _0x58b309=null;if(_0x2b680a['length']>0x1){const _0x423640=_0x2b680a['slice'](0x1)['find'](_0x5eecfd=>/^gp[:\s]/i[_0x1e9dbc(0x185)](_0x5eecfd));if(_0x423640)_0x58b309=_0x423640['replace'](/^gp[:\s]+/i,'')['trim']();}else{const _0x395a41=(_0xc7f3e5||_0x4b6a49)['trim']()['split'](/\s+/);if(_0x395a41['length']>=0x2&&_0x395a41[0x1]['toLowerCase']()==='gp'&&_0x395a41[0x2])_0x58b309=_0x395a41[0x2];else{if(_0x392318['pjcsy'](_0x395a41['length'],0x2)&&_0x395a41[0x1]['includes']('@'))_0x58b309=_0x395a41[0x1];}}_0x58b309&&await sendText(_0x438865,_0x1e9dbc(0x16a)+_0x4dd9d8);const _0x9a2fe6=await listTriggersForChat(_0x4dd9d8);await _0x392318['VvMCi'](sendText,_0x438865,'[filter]\x20loaded\x20'+_0x9a2fe6['length']+_0x1e9dbc(0x198)+_0x4dd9d8);if(!_0x9a2fe6[_0x1e9dbc(0x18c)])return;let _0x536e21='';for(const _0x3ca041 of _0x9a2fe6){const _0x1076c1='•\x20'+_0x3ca041+'\x0a';(_0x536e21+_0x1076c1)['length']>0x5dc&&(await sendText(_0x438865,_0x536e21['trim']()),_0x536e21=''),_0x536e21+=_0x1076c1;}if(_0x536e21['trim']())await sendText(_0x438865,_0x536e21['trim']());return;}if(_0x155dd9==='delfilter'||_0x155dd9==='delfilters'||_0x392318['PNthk'](_0x155dd9,'delf')){const _0x443cb8=(_0x4b6a49||'')['split'](/\r?\n/)['map'](_0x1cf38d=>_0x1cf38d['trim']());let _0x36fd9f=null;if(_0x392318['ykmyu'](_0x443cb8['length'],0x1)&&!_0x443cb8[0x1]['toLowerCase']()['startsWith']('gp'))_0x36fd9f=_0x443cb8[0x1];else{const _0x2bd954=(_0xc7f3e5||_0x4b6a49)['trim']()[_0x1e9dbc(0x1ac)](/\s+/);_0x2bd954[_0x1e9dbc(0x18f)](),_0x36fd9f=_0x2bd954['join']('\x20')['trim']();}const _0x380c50=_0x443cb8['slice'](0x1)['find'](_0x5570ff=>/^gp[:\s]/i['test'](_0x5570ff));let _0x2f6679=_0x380c50?_0x380c50[_0x1e9dbc(0x173)](/^gp[:\s]+/i,'')['trim']():null;const _0x1fad73=(_0x36fd9f||'')['split'](',')[_0x1e9dbc(0x1a3)](_0xd6f145=>_0xd6f145['trim']())[_0x1e9dbc(0x1c0)](Boolean);if(!_0x1fad73['length']){await sendText(_0x438865,'Usage:\x20delfilter\x20trigger1,trigger2\x20[gp\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20<groupKey>]');return;}_0x2f6679&&await sendText(_0x438865,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Deleting\x20from\x20your\x20default\x20connection:\x20'+_0x4dd9d8);const _0x545cd4=await deleteFilters(_0x4dd9d8,_0x1fad73);await sendText(_0x438865,'Deleted\x20'+_0x545cd4+'/'+_0x1fad73['length']+'\x20filter(s)\x20from\x20your\x20default\x20connection:\x20'+_0x4dd9d8);return;}return;}if(_0x412e9b){if('Wamcj'==='Wamcj'){if(_0x75da76['key'][_0x1e9dbc(0x18e)])return;const _0x119b03=_0x1c42ff,_0x3bd558=getMessageText(_0x75da76);if(!_0x3bd558)return;const _0x36fb61=String(_0x3bd558||''),_0x3301e8=await db['all']('SELECT\x20DISTINCT\x20trigger\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?',[_0x119b03]);if(!_0x3301e8||_0x3301e8['length']===0x0)return;const _0xefe925=(_0x3301e8||[])['map'](_0x5ebb2d=>String(_0x5ebb2d[_0x1e9dbc(0x1bf)]||'')[_0x1e9dbc(0x19d)]())['filter'](Boolean),_0x35574e=[],_0x33305a=[],_0x5ec66a=[];for(const _0x34d2d4 of _0xefe925){const _0x5a46b6=String(_0x34d2d4)['trim']()['toLowerCase']();if(_0x5a46b6['startsWith']('regex:')){const _0x2bf9b9=_0x34d2d4['substring'](0x6);_0x5ec66a[_0x1e9dbc(0x1c6)](_0x2bf9b9);continue;}if(_0x34d2d4[_0x1e9dbc(0x176)]('*')){_0x33305a[_0x1e9dbc(0x1c6)](_0x34d2d4);continue;}_0x35574e['push'](_0x34d2d4);}const _0x22a1fb=new Set(),_0x858a0f=getConfig()||{},_0x198969=_0x858a0f[_0x1e9dbc(0x1b5)]&&typeof _0x858a0f['FILTERS']==='object'?_0x858a0f['FILTERS']:{},_0x421cad=(_0x198969['RESPONSE_MODE']||'roundrobin')['toLowerCase']();let _0x4d2efb=null;if(_0x35574e['length']>0x0)try{const _0x39da12=await getAutomatonForChat(_0x119b03);if(_0x39da12&&_0x39da12['ac']&&_0x39da12['keywords']&&_0x39da12['keywords']['length']){if('Mikke'!==_0x1e9dbc(0x199)){_0x25bd21(_0x30dfe4,'[filter]\x20ensureSchema\x20fatal');throw _0x6e2eb8;}else{const _0xf938bd=_0x36fb61['toLowerCase'](),_0x2b97c5=_0x39da12['ac']['search'](_0xf938bd);for(const _0x7b3f3a of _0x2b97c5){const _0x174ab2=_0x7b3f3a['keyword'],_0x490201=_0x7b3f3a['index'],_0x350c06=_0x490201+_0x174ab2['length'],_0x2e5b42=_0x490201===0x0||!/\w/['test'](_0xf938bd[_0x490201-0x1]),_0x32082b=_0x350c06===_0xf938bd['length']||!/\w/[_0x1e9dbc(0x185)](_0xf938bd[_0x350c06]);if(_0x2e5b42&&_0x32082b){const _0x911e78=_0x35574e['find'](_0x309101=>_0x309101['toLowerCase']()===_0x174ab2);if(_0x911e78){_0x4d2efb=_0x911e78;break;}}}}}else{if('awtZi'==='awtZi'){const _0x563194=_0x36fb61['toLowerCase']();for(const _0x719a0a of _0x35574e){if('ykOGw'!=='DQjkx'){const _0x553e4e=new RegExp('\x5cb'+escapeRegex(String(_0x719a0a))+'\x5cb','i');if(_0x553e4e['test'](_0x36fb61)){_0x4d2efb=_0x719a0a;break;}}else return new _0x5e81b2(_0x3f4a59=>_0x46a877(_0x3f4a59,_0x598ce6));}}else return _0x14073a['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');}}catch(_0x513013){warn('[filter]\x20AhoCorasick\x20matching\x20failed:\x20'+(_0x513013?.[_0x1e9dbc(0x1ad)]||_0x513013));for(const _0x5f54c0 of _0x35574e){try{const _0x238c81=new RegExp('\x5cb'+escapeRegex(String(_0x5f54c0))+'\x5cb','i');if(_0x238c81['test'](_0x36fb61)){_0x4d2efb=_0x5f54c0;break;}}catch(_0x54c368){}}}if(!_0x4d2efb&&_0x33305a['length']>0x0)for(const _0x12708c of _0x33305a){try{const _0x3d3f03=new RegExp(wildcardToRegexPattern(_0x12708c),'i');if(_0x3d3f03[_0x1e9dbc(0x185)](_0x36fb61)){_0x4d2efb=_0x12708c;break;}}catch(_0x2b9dcb){if(_0x36fb61['toLowerCase']()['includes'](_0x12708c['replace'](/\*/g,'')['toLowerCase']())){if('cQhZI'!=='klrYC'){_0x4d2efb=_0x12708c;break;}else{for(const _0xbb9850 of _0x38db77[_0x1e9dbc(0x1ae)]())try{_0x2e26fa(_0xbb9850);}catch(_0x4bcc12){}_0x8df106['clear'](),_0x1269bc['clear'](),_0x1b1396=null,_0x2eac4b=null,_0x5ce3ca('[filter]\x20cleaned\x20up');}}}}if(!_0x4d2efb&&_0x5ec66a['length']>0x0)for(const _0x52dd01 of _0x5ec66a){try{const _0x368c37=new RegExp(_0x52dd01,'i');if(_0x368c37['test'](_0x36fb61)){if(_0x1e9dbc(0x1a0)!=='TwzlE'){_0x4d2efb='regex:'+_0x52dd01;break;}else{const _0x480e5a=_0x2a9e23?.['key'];if(!_0x480e5a)return null;const _0x2545eb=_0x480e5a['id']||_0x480e5a?.['participant']||'',_0xbbdb63=_0x480e5a['remoteJid']||'';return _0xbbdb63+'::'+_0x2545eb;}}}catch(_0x3a6990){warn('[filter]\x20invalid\x20stored\x20regex\x20for\x20chat\x20'+_0x119b03+':\x20\x22'+_0x52dd01+'\x22\x20-\x20'+(_0x3a6990?.[_0x1e9dbc(0x1ad)]||_0x3a6990));}}if(_0x4d2efb){let _0x12a7f8=_0x4d2efb;!_0x4d2efb['toLowerCase']()['startsWith']('regex:')?_0x12a7f8=_0x4d2efb:_0x12a7f8=_0x4d2efb;const _0x50bd45=await pickResponseAndAdvance(_0x119b03,_0x12a7f8[_0x1e9dbc(0x173)](/\s+$/,''),_0x421cad);if(!_0x50bd45)return;if(_0x22a1fb['has'](_0x50bd45))return;await sendText(_0x75da76,_0x119b03,_0x50bd45),_0x22a1fb['add'](_0x50bd45);}}else _0x56bd2a=_0x392698,_0x1ded6d=_0x4c6786,_0x5f9225=_0x47c5b2['isArray'](_0x2d13a4)?_0x3ef41c:[];}}}catch(_0x4436c2){error(_0x4436c2,'[filter]\x20Handler\x20error:\x20'+(_0x4436c2?.['message']||_0x4436c2));}}function _0x1663(_0x272910,_0xc91764){const _0x3f9d20=_0x3791();return _0x1663=function(_0x45fa56,_0x39efd3){_0x45fa56=_0x45fa56-0x158;let _0x5c9e29=_0x3f9d20[_0x45fa56];if(_0x1663['eGfpma']===undefined){var _0x2c5576=function(_0x115c11){const _0x4d3fc9='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x364a18='',_0x52004e='';for(let _0x5102ba=0x0,_0x1a411b,_0x28f4c7,_0x1eb499=0x0;_0x28f4c7=_0x115c11['charAt'](_0x1eb499++);~_0x28f4c7&&(_0x1a411b=_0x5102ba%0x4?_0x1a411b*0x40+_0x28f4c7:_0x28f4c7,_0x5102ba++%0x4)?_0x364a18+=String['fromCharCode'](0xff&_0x1a411b>>(-0x2*_0x5102ba&0x6)):0x0){_0x28f4c7=_0x4d3fc9['indexOf'](_0x28f4c7);}for(let _0x4b8d23=0x0,_0x5caece=_0x364a18['length'];_0x4b8d23<_0x5caece;_0x4b8d23++){_0x52004e+='%'+('00'+_0x364a18['charCodeAt'](_0x4b8d23)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x52004e);};_0x1663['sIghRA']=_0x2c5576,_0x272910=arguments,_0x1663['eGfpma']=!![];}const _0x37913c=_0x3f9d20[0x0],_0x1663bc=_0x45fa56+_0x37913c,_0x537e73=_0x272910[_0x1663bc];return!_0x537e73?(_0x5c9e29=_0x1663['sIghRA'](_0x5c9e29),_0x272910[_0x1663bc]=_0x5c9e29):_0x5c9e29=_0x537e73,_0x5c9e29;},_0x1663(_0x272910,_0xc91764);}export async function cleanup(){const _0x255ebf=_0x1663,_0x3eeccd={'XMvZe':'[filter]\x20cleaned\x20up'};for(const _0x52538d of processedMessageKeys['values']())try{clearTimeout(_0x52538d);}catch(_0x2fbac6){}processedMessageKeys['clear'](),automatonCache[_0x255ebf(0x184)](),botRef=null,sendApi=null,info(_0x3eeccd['XMvZe']);}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};(function(){const _0x36eab1=_0x1663,_0xfdd413={'BmzVo':function(_0xd264a9){return _0xd264a9();}};let _0x23c6eb;try{const _0xb31948=Function('return\x20(function()\x20'+_0x36eab1(0x195)+');');_0x23c6eb=_0xfdd413['BmzVo'](_0xb31948);}catch(_0x439bc0){_0x23c6eb=window;}_0x23c6eb['setInterval'](_0x45fa56,0x61a80);}());function _0x45fa56(_0x3aa899){const _0x47fcf4=_0x1663,_0x92721b={'RmBfU':'string','SSyuN':function(_0xdfa032,_0x2cc50e){return _0xdfa032+_0x2cc50e;},'SawHv':function(_0x59349b,_0x5d0624){return _0x59349b(_0x5d0624);}};function _0x4d626b(_0x325723){const _0x3e7992=_0x1663;if(typeof _0x325723===_0x92721b['RmBfU'])return function(_0x4a506b){}[_0x3e7992(0x1cb)](_0x3e7992(0x189))['apply']('counter');else(''+_0x325723/_0x325723)['length']!==0x1||_0x325723%0x14===0x0?function(){return!![];}['constructor'](_0x92721b['SSyuN']('debu','gger'))['call']('action'):function(){return![];}[_0x3e7992(0x1cb)]('debu'+_0x3e7992(0x163))['apply'](_0x3e7992(0x18b));_0x92721b['SawHv'](_0x4d626b,++_0x325723);}try{if(_0x3aa899){if(_0x47fcf4(0x1c7)!=='fLJux')return _0x4d626b;else try{return _0x3f97ea['parse'](_0x52da3f);}catch{return null;}}else _0x4d626b(0x0);}catch(_0xf11382){}}