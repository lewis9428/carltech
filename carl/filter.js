const _0x4bbff1=_0x16d5;(function(_0x4cfe6a,_0x356913){const _0x2e2059=_0x16d5,_0x3b6cf7=_0x4cfe6a();while(!![]){try{const _0x29dc15=-parseInt(_0x2e2059(0xd3))/0x1+-parseInt(_0x2e2059(0xf2))/0x2*(parseInt(_0x2e2059(0xff))/0x3)+-parseInt(_0x2e2059(0x104))/0x4*(parseInt(_0x2e2059(0x11a))/0x5)+parseInt(_0x2e2059(0xf7))/0x6+parseInt(_0x2e2059(0xd9))/0x7+-parseInt(_0x2e2059(0xed))/0x8+-parseInt(_0x2e2059(0xcc))/0x9*(-parseInt(_0x2e2059(0x11d))/0xa);if(_0x29dc15===_0x356913)break;else _0x3b6cf7['push'](_0x3b6cf7['shift']());}catch(_0x5cc157){_0x3b6cf7['push'](_0x3b6cf7['shift']());}}}(_0x3632,0x3168f));const _0x331ef8=(function(){let _0xdc974d=!![];return function(_0x2dbe75,_0x4e0487){const _0x4156b5=_0xdc974d?function(){const _0x435431=_0x16d5;if(_0x4e0487){const _0x1a4062=_0x4e0487[_0x435431(0x109)](_0x2dbe75,arguments);return _0x4e0487=null,_0x1a4062;}}:function(){};return _0xdc974d=![],_0x4156b5;};}());(function(){const _0x2f4078={'WstcR':function(_0x3f1289){return _0x3f1289();},'hGNtD':function(_0x49d617,_0x300fae,_0x1a4f7c){return _0x49d617(_0x300fae,_0x1a4f7c);}};_0x2f4078['hGNtD'](_0x331ef8,this,function(){const _0x1f4716=_0x16d5,_0x2a32b0=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x5e7522=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x4a7ae7=_0xe5b6f0('init');!_0x2a32b0['test'](_0x4a7ae7+'chain')||!_0x5e7522['test'](_0x4a7ae7+_0x1f4716(0xfb))?_0x4a7ae7('0'):_0x2f4078['WstcR'](_0xe5b6f0);})();}());import{getConfig}from'../utils/config.js';import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{getDefault,getConnection}from'../utils/connection.js';import{isadmin}from'../utils/isadmin.js';export const name='filter';export const version=_0x4bbff1(0xd7);export const priority=0x78;export const configKeys=['FILTERS'];export const commands=['listfilter','delfilter','delfilters','delf'];let botRef=null,sendApi=null;function clampTypingMs(_0x2b59f5){const _0x12438c=Number(_0x2b59f5);if(!Number['isFinite'](_0x12438c)||isNaN(_0x12438c))return 0x0;if(_0x12438c<=0x0)return 0x0;if(_0x12438c>0x3a98)return 0x3a98;return Math['floor'](_0x12438c);}function sleep(_0x53c441){return new Promise(_0x4a4f07=>setTimeout(_0x4a4f07,_0x53c441));}async function simulateTypingAndWait(_0x594596,_0x443d0a,_0x38302f){const _0x18c69a=_0x4bbff1;if(!_0x38302f||_0x38302f<=0x0)return;try{if('cJgdE'==='cJgdE'){if(_0x594596&&typeof _0x594596['sendPresenceUpdate']===_0x18c69a(0x114))try{await _0x594596['sendPresenceUpdate'](_0x18c69a(0xcf),_0x443d0a);}catch(_0x11d27e){}}else{const _0x1f47ec=_0x321ed9['floor'](_0x53066d['random']()*_0x1b45c6['length']);return _0x876622[_0x1f47ec];}}catch(_0x236f10){}try{if(_0x18c69a(0xc6)==='ujAgV'){const _0x57874a=_0x5934b2[_0x43b18f];if(typeof _0x57874a==='string'&&_0x57874a[_0x18c69a(0xc9)]('@'))return _0x57874a;}else await sleep(_0x38302f);}catch(_0x153096){}try{if(_0x594596&&typeof _0x594596['sendPresenceUpdate']==='function')try{await _0x594596['sendPresenceUpdate']('paused',_0x443d0a);}catch(_0x2148c1){}}catch(_0x4b988e){}}function safeJsonParse(_0x558f78){try{return JSON['parse'](_0x558f78);}catch{return null;}}function ensureArray(_0x4bd84f){const _0x53ea24=_0x4bbff1;if(!_0x4bd84f)return[];if(Array[_0x53ea24(0xda)](_0x4bd84f))return _0x4bd84f;return[String(_0x4bd84f)];}function uniqArray(_0x1bc047){const _0x1842fd={'vUNxB':function(_0x1acd56,_0x41567e){return _0x1acd56||_0x41567e;}},_0x3224b3=new Set(),_0x1cd42b=[];for(const _0x5ab96c of _0x1bc047){const _0x2fe5f2=String(_0x1842fd['vUNxB'](_0x5ab96c,''))['trim']();if(!_0x2fe5f2)continue;!_0x3224b3['has'](_0x2fe5f2)&&(_0x3224b3['add'](_0x2fe5f2),_0x1cd42b['push'](_0x2fe5f2));}return _0x1cd42b;}function escapeRegex(_0x4ba1ef){return _0x4ba1ef['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');}function _0x16d5(_0x309dc9,_0x285c72){const _0x1a150a=_0x3632();return _0x16d5=function(_0xe5b6f0,_0x331ef8){_0xe5b6f0=_0xe5b6f0-0xc4;let _0x2bab95=_0x1a150a[_0xe5b6f0];if(_0x16d5['uwFZBl']===undefined){var _0x13d7ef=function(_0x2e1d00){const _0x4dbf6c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1b4bca='',_0x2b3ee0='';for(let _0x1428b7=0x0,_0x2851ea,_0x3ea862,_0x424e57=0x0;_0x3ea862=_0x2e1d00['charAt'](_0x424e57++);~_0x3ea862&&(_0x2851ea=_0x1428b7%0x4?_0x2851ea*0x40+_0x3ea862:_0x3ea862,_0x1428b7++%0x4)?_0x1b4bca+=String['fromCharCode'](0xff&_0x2851ea>>(-0x2*_0x1428b7&0x6)):0x0){_0x3ea862=_0x4dbf6c['indexOf'](_0x3ea862);}for(let _0x30c5e2=0x0,_0x230230=_0x1b4bca['length'];_0x30c5e2<_0x230230;_0x30c5e2++){_0x2b3ee0+='%'+('00'+_0x1b4bca['charCodeAt'](_0x30c5e2)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2b3ee0);};_0x16d5['jROVCE']=_0x13d7ef,_0x309dc9=arguments,_0x16d5['uwFZBl']=!![];}const _0x363205=_0x1a150a[0x0],_0x16d520=_0xe5b6f0+_0x363205,_0x1d46da=_0x309dc9[_0x16d520];return!_0x1d46da?(_0x2bab95=_0x16d5['jROVCE'](_0x2bab95),_0x309dc9[_0x16d520]=_0x2bab95):_0x2bab95=_0x1d46da,_0x2bab95;},_0x16d5(_0x309dc9,_0x285c72);}function wildcardToRegexPattern(_0xeabd9a){const _0x15c1be=_0xeabd9a['split']('*')['map'](_0x1d4f82=>escapeRegex(_0x1d4f82));return'\x5cb'+_0x15c1be['join']('\x5cw*')+'\x5cb';}function clampConfigTypingMs(){const _0x17de6f=_0x4bbff1;try{const _0x21ad6b=getConfig()||{},_0x139512=_0x21ad6b['FILTERS']&&typeof _0x21ad6b[_0x17de6f(0xd2)]==='object'?_0x21ad6b['FILTERS']:{};return clampTypingMs(_0x139512['TYPING_SIM_MS']);}catch(_0x5a673f){return 0x0;}}async function sendText(_0x2b3450,_0x4cef88,_0x38bd14,_0x5222ad){const _0x5f46a4=_0x4bbff1,_0xbe5943={'gagLo':'[filter]\x20sendText\x20called\x20without\x20targetJid','Vgapl':function(_0x1b81d3,_0x5b770b){return _0x1b81d3(_0x5b770b);},'vCHZu':function(_0x5bc4b5,_0x28b292){return _0x5bc4b5>_0x28b292;},'QyUGR':function(_0x501e45,_0x43a698,_0x1144c9,_0x27a912){return _0x501e45(_0x43a698,_0x1144c9,_0x27a912);}};let _0x2acd35=null,_0x5efd78=null,_0x118232=null,_0x45733b=[];if(_0x2b3450&&typeof _0x2b3450==='object'&&_0x2b3450[_0x5f46a4(0xc8)]&&_0x2b3450['message']){_0x2acd35=_0x2b3450,_0x5efd78=_0x4cef88,_0x118232=_0x38bd14,_0x45733b=Array['isArray'](_0x5222ad)?_0x5222ad:Array['isArray'](_0x38bd14)?[]:Array[_0x5f46a4(0xda)](_0x4cef88)?[]:[];if(Array['isArray'](_0x5222ad))_0x45733b=_0x5222ad;}else _0x5efd78=_0x2b3450,_0x118232=_0x4cef88,_0x45733b=Array['isArray'](_0x38bd14)?_0x38bd14:[];if(!_0x118232)return;if(!_0x5efd78){warn(_0xbe5943['gagLo']);return;}const _0x12a1ef={'text':String(_0x118232)};if(Array[_0x5f46a4(0xda)](_0x45733b)&&_0x45733b['length'])_0x12a1ef['mentions']=_0x45733b;try{if(!sendApi){_0xbe5943['Vgapl'](warn,_0x5f46a4(0x101));return;}const _0x2b0ea5=clampConfigTypingMs();if(_0xbe5943['vCHZu'](_0x2b0ea5,0x0))try{await _0xbe5943['QyUGR'](simulateTypingAndWait,botRef?.['sock'],_0x5efd78,_0x2b0ea5);}catch(_0xb2d9cf){warn(_0x5f46a4(0x129)+(_0xb2d9cf?.['message']||_0xb2d9cf));}if(_0x2acd35&&typeof _0x2acd35['reply']==='function')try{await _0x2acd35[_0x5f46a4(0xd5)]({'text':String(_0x118232),'mentions':_0x12a1ef['mentions']||[]});return;}catch(_0x2a27b6){warn('[filter]\x20reply\x20(quoted)\x20failed,\x20falling\x20back\x20to\x20bare\x20send:\x20'+(_0x2a27b6?.['message']||_0x2a27b6));try{await sendApi(_0x5efd78,_0x12a1ef);return;}catch(_0x567ee7){warn('[filter]\x20fallback\x20bare\x20send\x20after\x20reply\x20failure\x20also\x20failed:\x20'+(_0x567ee7?.['message']||_0x567ee7));return;}}try{await sendApi(_0x5efd78,_0x12a1ef);}catch(_0x3d6a06){warn('[filter]\x20sendText\x20failed\x20to\x20'+_0x5efd78+':\x20'+(_0x3d6a06?.[_0x5f46a4(0x123)]||_0x3d6a06));}}catch(_0x5967d3){warn('[filter]\x20sendText\x20unexpected\x20error:\x20'+(_0x5967d3?.['message']||_0x5967d3));}}(function(){let _0x267abd;try{const _0x7236a7=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x267abd=_0x7236a7();}catch(_0x2f9333){_0x267abd=window;}_0x267abd['setInterval'](_0xe5b6f0,0x61a80);}());async function tableExists(_0x2c371e){const _0x10e72d=_0x4bbff1;try{const _0x406008=await db['get']('SELECT\x20name\x20FROM\x20sqlite_master\x20WHERE\x20type=\x27table\x27\x20AND\x20name=?',[_0x2c371e]);return!!_0x406008;}catch(_0x1d9766){return warn(_0x10e72d(0xef)+(_0x1d9766?.['message']||_0x1d9766)),![];}}async function getTableColumns(_0x138aca){try{const _0x6a7657=await db['all']('PRAGMA\x20table_info('+_0x138aca+')');return(_0x6a7657||[])['map'](_0x2c1397=>_0x2c1397['name']);}catch(_0x4157ed){return warn('[filter]\x20getTableColumns\x20error\x20for\x20'+_0x138aca+':\x20'+(_0x4157ed?.['message']||_0x4157ed)),[];}}function resolveChatJidFromRow(_0x1c8a65){const _0x52b6bc=_0x4bbff1,_0x57e101=[_0x52b6bc(0x121),'chatid','chat_id',_0x52b6bc(0xeb),'chat','room'];for(const _0x1e55a9 of _0x57e101)if(_0x1e55a9 in _0x1c8a65&&_0x1c8a65[_0x1e55a9])return String(_0x1c8a65[_0x1e55a9]);for(const _0x105e1c of Object['keys'](_0x1c8a65)){const _0x2ffb28=_0x1c8a65[_0x105e1c];if(typeof _0x2ffb28==='string'&&_0x2ffb28['includes']('@'))return _0x2ffb28;}return null;}function resolveTriggerFromRow(_0x4371ea){const _0x6c594c=_0x4bbff1,_0x145ddf={'fKTFR':function(_0x34eeaf,_0x3bcdce){return _0x34eeaf<_0x3bcdce;}},_0x1c5784=['trigger',_0x6c594c(0xdd),'keyword','word','phrase'];for(const _0x1e0b80 of _0x1c5784)if(_0x1e0b80 in _0x4371ea&&_0x4371ea[_0x1e0b80])return String(_0x4371ea[_0x1e0b80]);for(const _0x3088ab of Object['keys'](_0x4371ea)){const _0x3dc19e=_0x4371ea[_0x3088ab];if(typeof _0x3dc19e==='string'&&!_0x3dc19e['includes']('@')&&_0x145ddf['fKTFR'](_0x3dc19e['length'],0x12c))return _0x3dc19e;}return null;}function resolveResponsesFromRow(_0x478932){const _0x414e4c=_0x4bbff1,_0xfaafcc=['responses','response','reply','replies','body','value','message'];for(const _0x3e5d63 of _0xfaafcc)if(_0x3e5d63 in _0x478932&&_0x478932[_0x3e5d63]!=null)return _0x478932[_0x3e5d63];for(const _0xf5cdc9 of Object['keys'](_0x478932)){const _0x32ad39=_0x478932[_0xf5cdc9];if(typeof _0x32ad39==='string'&&(_0x32ad39['trim']()['startsWith']('!')||_0x32ad39['trim']()['includes']('\x0a')||_0x32ad39['trim']()[_0x414e4c(0xd4)]('[')))return _0x32ad39;}return null;}async function readAndNormalizeExistingFilters(){const _0x30a0e8=_0x4bbff1,_0x3c5846={'FXnYA':'SELECT\x20*\x20FROM\x20filters'};try{const _0x2e7eb0=await db[_0x30a0e8(0xea)](_0x3c5846['FXnYA']),_0x4fb45f=new Map();for(const _0x5b579b of _0x2e7eb0||[]){if(_0x30a0e8(0x11f)!==_0x30a0e8(0x11f))_0x3f1489('[filter]\x20idx\x20create:\x20'+(_0x8ce9ab?.['message']||_0x376a3a));else{const _0x23ed73=resolveTriggerFromRow(_0x5b579b)||'',_0xd03b98=resolveChatJidFromRow(_0x5b579b)||'';if(!_0x23ed73||!_0xd03b98)continue;const _0x25d29d=resolveResponsesFromRow(_0x5b579b),_0x39f34b=normalizeResponseValue(_0x25d29d),_0x3d6d48=_0x5b579b['created_by']||_0x5b579b[_0x30a0e8(0x116)]||_0x5b579b['author']||'';let _0x1928cb=Number(_0x5b579b['created_at']||_0x5b579b['ts']||_0x5b579b['timestamp']||_0x5b579b['time']||0x0);if(!_0x1928cb)_0x1928cb=Math['floor'](Date[_0x30a0e8(0x120)]()/0x3e8);const _0x367557=_0xd03b98+'||'+_0x23ed73;if(!_0x4fb45f[_0x30a0e8(0x112)](_0x367557))_0x4fb45f['set'](_0x367557,{'trigger':_0x23ed73,'chat_jid':_0xd03b98,'responses':_0x39f34b['slice'](),'created_by':_0x3d6d48,'created_at':_0x1928cb});else{const _0x1e5077=_0x4fb45f[_0x30a0e8(0xf8)](_0x367557);_0x1e5077['responses']=uniqArray(_0x1e5077['responses']['concat'](_0x39f34b)),_0x1e5077['created_by']=_0x1e5077['created_by']||_0x3d6d48,_0x1e5077['created_at']=Math['max'](_0x1e5077['created_at']||0x0,_0x1928cb||0x0);}}}return Array['from'](_0x4fb45f['values']());}catch(_0x35cde7){return warn('[filter]\x20readAndNormalizeExistingFilters\x20failed:\x20'+(_0x35cde7?.['message']||_0x35cde7)),[];}}async function ensureSchema(){const _0x7debaa=_0x4bbff1,_0x46923a={'TqeHN':function(_0x1d55b2,_0x4c5c8c){return _0x1d55b2+_0x4c5c8c;},'rBkjR':'INTEGER\x20DEFAULT\x200','GPpWL':'wkFis','cvcWU':function(_0x283f2e,_0x14ade2){return _0x283f2e(_0x14ade2);},'oPOTj':'filters_backup_'},_0x1f39e4={'id':'INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT','trigger':'TEXT\x20NOT\x20NULL','chat_jid':'TEXT\x20NOT\x20NULL','responses':'TEXT\x20NOT\x20NULL\x20DEFAULT\x20\x27[]\x27','rr_index':'INTEGER\x20DEFAULT\x200','created_by':'TEXT\x20DEFAULT\x20\x27\x27','created_at':_0x46923a['rBkjR']};try{const _0x5d1e2e=await tableExists('filters');if(!_0x5d1e2e){const _0x17a0fb=Object['entries'](_0x1f39e4)['map'](([_0x3006f8,_0x42fc7d])=>_0x3006f8+'\x20'+_0x42fc7d)['join'](_0x7debaa(0xfa));await db['exec'](_0x7debaa(0xe2)+_0x17a0fb+',\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20UNIQUE(chat_jid,\x20trigger)\x0a\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20');try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_chat\x20ON\x20filters(chat_jid);');}catch(_0x5489a1){}try{await db['exec']('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_unique\x20ON\x20filters(chat_jid,\x20trigger);');}catch(_0x319ca7){}info('[filter]\x20created\x20new\x20filters\x20table\x20(canonical\x20schema)');return;}const _0x477b8f=await getTableColumns(_0x7debaa(0xf6)),_0x6e0366=_0x477b8f['includes']('trigger'),_0x325d68=_0x477b8f['includes']('chat_jid'),_0x446c77=_0x477b8f[_0x7debaa(0xc9)]('responses');if(_0x6e0366&&_0x325d68&&_0x446c77){try{if('JRBUc'!==_0x7debaa(0x108))return _0x171f48&&_0x6579c7['has'](_0xcce911);else await db[_0x7debaa(0x10a)]('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_chat\x20ON\x20filters(chat_jid);');}catch(_0x24ba0a){warn('[filter]\x20idx\x20create:\x20'+(_0x24ba0a?.['message']||_0x24ba0a));}try{await db[_0x7debaa(0x10a)]('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_unique\x20ON\x20filters(chat_jid,\x20trigger);');}catch(_0x244dc6){warn('[filter]\x20unique\x20idx:\x20'+(_0x244dc6?.[_0x7debaa(0x123)]||_0x244dc6));}info('[filter]\x20filters\x20table\x20already\x20has\x20canonical\x20columns');return;}info('[filter]\x20legacy\x20filters\x20table\x20detected\x20-\x20performing\x20safe\x20migration');const _0x564778=await readAndNormalizeExistingFilters();await db['exec']('PRAGMA\x20foreign_keys\x20=\x20OFF;');try{await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20filters_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20trigger\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20responses\x20TEXT\x20NOT\x20NULL\x20DEFAULT\x20\x27[]\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20rr_index\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20UNIQUE(chat_jid,\x20trigger)\x0a\x20\x20\x20\x20\x20\x20);');}catch(_0x343a56){await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20filters_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20trigger\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20responses\x20TEXT\x20NOT\x20NULL\x20DEFAULT\x20\x27[]\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20rr_index\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200\x0a\x20\x20\x20\x20\x20\x20);'),warn(_0x7debaa(0x10e));}const _0x1e0b26=await db['prepare'](_0x7debaa(0x10f));try{if(_0x46923a['GPpWL']===_0x7debaa(0x100))for(const _0xa9940c of _0x564778){const _0x43b49e=JSON['stringify'](ensureArray(_0xa9940c[_0x7debaa(0x106)]||[]));try{if('bGplU'==='bGplU')await _0x1e0b26[_0x7debaa(0x102)](_0xa9940c['trigger'],_0xa9940c['chat_jid'],_0x43b49e,_0xa9940c['created_by']||'',Number(_0xa9940c['created_at']||Math['floor'](Date['now']()/0x3e8)));else return _0x2edbcc('[filter]\x20getTableColumns\x20error\x20for\x20'+_0x290e65+':\x20'+(_0x1aa903?.['message']||_0xb0244c)),[];}catch(_0x4ecc2c){if(_0x7debaa(0x124)!==_0x7debaa(0x12a))_0x46923a['cvcWU'](warn,'[filter]\x20could\x20not\x20insert\x20normalized\x20row\x20'+_0xa9940c['chat_jid']+'@'+_0xa9940c['trigger']+':\x20'+(_0x4ecc2c?.['message']||_0x4ecc2c));else{const _0x2daca0=_0x5aa969['split']('*')['map'](_0x69c4ba=>_0x4a9579(_0x69c4ba));return'\x5cb'+_0x2daca0['join'](_0x7debaa(0xce))+'\x5cb';}}}else{_0x11b8ed=_0x31d35c,_0x3dafa1=_0x5520f0,_0x2ea85d=_0x355269,_0x4ff0ad=_0x11ea85['isArray'](_0x551125)?_0x18b1fb:_0x7cfa42['isArray'](_0x1245ff)?[]:_0x5e1ff3['isArray'](_0x20b0bd)?[]:[];if(_0x35d9b5['isArray'](_0x2bcc46))_0x2c247a=_0x4654c4;}}finally{try{await _0x1e0b26['finalize']();}catch(_0x57ad3b){}}try{const _0x3430db=_0x46923a[_0x7debaa(0x10c)]+Math['floor'](Date[_0x7debaa(0x120)]()/0x3e8);await db['exec'](_0x7debaa(0xdf)+_0x3430db+';'),await db[_0x7debaa(0x10a)]('ALTER\x20TABLE\x20filters_new\x20RENAME\x20TO\x20filters;');try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_chat\x20ON\x20filters(chat_jid);');}catch(_0x1f9edd){if('cmRUT'===_0x7debaa(0xe3))for(const _0x4a5e79 of this[_0x7debaa(0x128)][_0x4e6673][_0x7debaa(0x110)]){_0x13a25e[_0x7debaa(0xf9)]({'keyword':_0x4a5e79,'index':_0x46923a['TqeHN'](_0x37d1f3-_0x4a5e79['length'],0x1)});}else warn('[filter]\x20post-swap\x20idx:\x20'+(_0x1f9edd?.['message']||_0x1f9edd));}try{await db['exec']('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_unique\x20ON\x20filters(chat_jid,\x20trigger);');}catch(_0x44d9bd){warn(_0x7debaa(0x115)+(_0x44d9bd?.['message']||_0x44d9bd));}info('[filter]\x20migration\x20completed;\x20old\x20table\x20renamed\x20to\x20backup');}catch(_0xcd68e7){warn(_0x7debaa(0x122)+(_0xcd68e7?.['message']||_0xcd68e7));throw _0xcd68e7;}finally{'ECpSs'===_0x7debaa(0x107)?await db['exec']('PRAGMA\x20foreign_keys\x20=\x20ON;'):_0x3a1739(this,function(){const _0x4b6e8b=_0x7debaa,_0x2aa05d=new _0x10ed10('function\x20*\x5c(\x20*\x5c)'),_0x39bb66=new _0x47d83a('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x2bee07=_0x2fa1a4('init');!_0x2aa05d[_0x4b6e8b(0x105)](_0x2bee07+'chain')||!_0x39bb66['test'](_0x2bee07+_0x4b6e8b(0xfb))?_0x2bee07('0'):_0x354154();})();}}catch(_0xa41bf8){error(_0xa41bf8,'[filter]\x20ensureSchema\x20fatal');throw _0xa41bf8;}}function normalizeResponseValue(_0x8a66ee){const _0x576361=_0x4bbff1,_0xcf323={'ywGzs':function(_0xf3c08d,_0x1b5119){return _0xf3c08d(_0x1b5119);}};if(_0x8a66ee==null)return[];if(Array['isArray'](_0x8a66ee))return uniqArray(_0x8a66ee);if(typeof _0x8a66ee===_0x576361(0xe7)){const _0x4f6e7c=_0x8a66ee['trim']();if(_0x4f6e7c['startsWith']('['))try{const _0x2f3c82=JSON['parse'](_0x4f6e7c);if(Array[_0x576361(0xda)](_0x2f3c82))return _0xcf323['ywGzs'](uniqArray,_0x2f3c82);}catch(_0x2a28ab){}const _0x160212=_0x4f6e7c[_0x576361(0x119)](/\r?\n/)['map'](_0x59622e=>_0x59622e['trim']())['filter'](Boolean),_0x3ab60f=[];for(const _0x4e5195 of _0x160212){if(_0x4e5195[_0x576361(0xd4)]('!'))_0x3ab60f['push'](_0x4e5195['slice'](0x1)['trim']());else _0x3ab60f['push'](_0x4e5195);}return _0xcf323['ywGzs'](uniqArray,_0x3ab60f);}return[];}async function upsertFilterRow(_0x112918,_0x15359f,_0x4e4eca,_0x38b0e8){const _0x584629=_0x4bbff1,_0x36e766={'kqdno':function(_0x33f8a4,_0x1d8c14,_0x162c38){return _0x33f8a4(_0x1d8c14,_0x162c38);}};try{const _0x340575=Math['floor'](Date[_0x584629(0x120)]()/0x3e8),_0x3e38b5=JSON['stringify'](uniqArray(ensureArray(_0x4e4eca)['map'](_0x48e141=>String(_0x48e141)[_0x584629(0x111)]())[_0x584629(0x117)](Boolean)));await db['run'](_0x584629(0xcd),[_0x15359f,_0x112918,_0x3e38b5,_0x38b0e8||'',_0x340575]),info('[filter]\x20upsertFilter:\x20'+_0x15359f+'\x20@\x20'+_0x112918);try{automatonCache[_0x584629(0xf5)](_0x112918);}catch(_0x56d9a3){}return!![];}catch(_0x29921e){return _0x36e766['kqdno'](error,_0x29921e,'[filter]\x20upsertFilter\x20failed\x20for\x20'+_0x15359f+'\x20@\x20'+_0x112918),![];}}async function deleteFilters(_0x517a82,_0x4a9344){const _0x4791df=_0x4bbff1,_0x153691={'DsBxf':function(_0x338b22,_0xc1a9ee){return _0x338b22(_0xc1a9ee);},'ZSRbm':function(_0x151eee,_0x1d090a){return _0x151eee(_0x1d090a);}};if(!Array['isArray'](_0x4a9344)||_0x4a9344['length']===0x0)return 0x0;try{let _0x2761ed=0x0;for(const _0x52d725 of _0x4a9344){if('ylCrd'==='hCDpo')_0x153691[_0x4791df(0xdb)](_0x3c3545,'[filter]\x20rr_index\x20increment\x20failed:\x20'+(_0x577852?.['message']||_0x408111));else{const _0x120568=await db[_0x4791df(0x102)]('DELETE\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20trigger\x20=\x20?',[_0x517a82,_0x52d725]);if(_0x120568?.['changes'])_0x2761ed+=_0x120568['changes'];_0x153691['ZSRbm'](info,_0x4791df(0xd6)+_0x52d725+'\x20@\x20'+_0x517a82);}}try{automatonCache[_0x4791df(0xf5)](_0x517a82);}catch(_0x5b36f3){}return _0x2761ed;}catch(_0x322f51){return'xOHZj'!=='xOHZj'?(_0x53e650('[filter]\x20tableExists\x20error:\x20'+(_0x2b69a8?.['message']||_0x33e344)),![]):(error(_0x322f51,'[filter]\x20deleteFilters\x20failed\x20for\x20'+_0x517a82),0x0);}}async function listTriggersForChat(_0x2e28a6){const _0x44a787=_0x4bbff1,_0x1d6fe8={'BqTAg':function(_0x1a3f93,_0x8d1347,_0x433dca){return _0x1a3f93(_0x8d1347,_0x433dca);}};try{const _0x160b6e=await db['all']('SELECT\x20DISTINCT\x20trigger\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?\x20ORDER\x20BY\x20trigger',[_0x2e28a6]);return(_0x160b6e||[])['map'](_0x4da642=>_0x4da642['trigger']);}catch(_0x190e14){return _0x1d6fe8['BqTAg'](warn,_0x190e14,_0x44a787(0xd8)+_0x2e28a6),[];}}async function pickResponseAndAdvance(_0x4f359e,_0x13f79f,_0xaefc03='roundrobin'){const _0x1d881b=_0x4bbff1,_0xd75f95={'LmOcT':function(_0x324bfa,_0x59a1a3){return _0x324bfa(_0x59a1a3);},'ZrbVI':'BraoA','UTgaQ':'random'};try{const _0x1c45b8=await db['get']('SELECT\x20responses,\x20rr_index\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20trigger\x20=\x20?\x20LIMIT\x201',[_0x4f359e,_0x13f79f]);if(!_0x1c45b8)return null;let _0x2e2e0f=[];try{if(_0xd75f95['ZrbVI']==='BraoA')_0x2e2e0f=JSON['parse'](_0x1c45b8[_0x1d881b(0x106)]||'[]');else{const _0x1535ae=['chat_jid','chatid','chat_id','jid','chat','room'];for(const _0x33201c of _0x1535ae)if(_0x33201c in _0x11ecef&&_0x5b3b8d[_0x33201c])return _0xd75f95['LmOcT'](_0x1e36df,_0x5740bc[_0x33201c]);for(const _0x3e73c8 of _0x4d7baa['keys'](_0x187a79)){const _0x3dff8e=_0x40e5a1[_0x3e73c8];if(typeof _0x3dff8e==='string'&&_0x3dff8e['includes']('@'))return _0x3dff8e;}return null;}}catch{_0x2e2e0f=ensureArray(_0x1c45b8[_0x1d881b(0x106)]);}_0x2e2e0f=ensureArray(_0x2e2e0f);if(!_0x2e2e0f['length'])return null;if((_0xaefc03||'')[_0x1d881b(0xe5)]()===_0xd75f95['UTgaQ']){const _0xee868a=Math[_0x1d881b(0xcb)](Math['random']()*_0x2e2e0f['length']);return _0x2e2e0f[_0xee868a];}const _0x16ece3=Number(_0x1c45b8['rr_index']||0x0),_0x3694c4=_0x2e2e0f[_0x16ece3%_0x2e2e0f['length']];try{await db['run']('UPDATE\x20filters\x20SET\x20rr_index\x20=\x20(rr_index\x20+\x201)\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20trigger\x20=\x20?',[_0x4f359e,_0x13f79f]);}catch(_0x3037f0){warn('[filter]\x20rr_index\x20increment\x20failed:\x20'+(_0x3037f0?.['message']||_0x3037f0));}return _0x3694c4;}catch(_0x10cb7f){return warn('[filter]\x20pickResponseAndAdvance\x20error:\x20'+(_0x10cb7f?.['message']||_0x10cb7f)),null;}}function parseFilterCommandText(_0x1640a0,_0x34dce5){const _0xd80e83=_0x4bbff1;if(!_0x1640a0)return null;const _0x371cd6=_0x1640a0['split'](/\r?\n/)['map'](_0x3aa8da=>_0x3aa8da['replace'](/\r/g,''));if(!_0x371cd6['length'])return null;let _0x4b0378=_0x371cd6[0x0]['trim']();if(_0x34dce5){if(Array['isArray'](_0x34dce5))for(const _0xbe1ea4 of _0x34dce5){if(_0x4b0378['startsWith'](_0xbe1ea4)){_0x4b0378=_0x4b0378[_0xd80e83(0x118)](_0xbe1ea4['length'])['trim']();break;}}else typeof _0x34dce5===_0xd80e83(0xe7)&&_0x4b0378['startsWith'](_0x34dce5)&&(_0x4b0378=_0x4b0378['slice'](_0x34dce5['length'])['trim']());}const _0x4ec36e=_0x4b0378['split'](/\s+/);if(_0x4ec36e[0x0]['toLowerCase']()==='filter')_0x4ec36e['shift']();const _0x49b5b9=_0x4ec36e['join']('\x20')['trim'](),_0x535baa=_0x49b5b9?_0x49b5b9['split'](',')['map'](_0xa4edc7=>_0xa4edc7['trim']())['filter'](Boolean):[],_0x38bf91=_0x371cd6['slice'](0x1)['map'](_0x21e59c=>_0x21e59c['trim']())[_0xd80e83(0x117)](Boolean)['filter'](_0x4a0fa2=>_0x4a0fa2['startsWith']('!'))['map'](_0x3f4686=>_0x3f4686['slice'](0x1)[_0xd80e83(0x111)]())['filter'](Boolean);let _0x1a2abc=null;for(const _0x52a1f9 of _0x371cd6['slice'](0x1)){const _0x23d0ca=_0x52a1f9['trim']()['match'](/^gp[:\s]+(.+)$/i);if(_0x23d0ca){_0x1a2abc=_0x23d0ca[0x1]['trim']();break;}}if(!_0x1a2abc&&_0x49b5b9){const _0x3268b2=_0x49b5b9['match'](/gp[:\s]+([^\s,]+)$/i);if(_0x3268b2)_0x1a2abc=_0x3268b2[0x1][_0xd80e83(0x111)]();}return{'triggers':_0x535baa,'responses':_0x38bf91,'gp':_0x1a2abc};}function getMessageText(_0x1b2ade){const _0x2ce2a7=_0x4bbff1;if(!_0x1b2ade||!_0x1b2ade['message'])return'';const _0x22b080=_0x1b2ade['message'];if(_0x22b080['conversation'])return _0x22b080['conversation'];if(_0x22b080['extendedTextMessage']?.[_0x2ce2a7(0x12c)])return _0x22b080['extendedTextMessage'][_0x2ce2a7(0x12c)];if(_0x22b080['imageMessage']?.[_0x2ce2a7(0xe6)])return _0x22b080[_0x2ce2a7(0xf1)][_0x2ce2a7(0xe6)];if(_0x22b080['videoMessage']?.['caption'])return _0x22b080['videoMessage']['caption'];if(_0x22b080[_0x2ce2a7(0x10b)]?.[_0x2ce2a7(0x113)])return _0x22b080['buttonsResponseMessage'][_0x2ce2a7(0x113)];if(_0x22b080['listResponseMessage']?.['singleSelectReply']?.[_0x2ce2a7(0xd0)])return _0x22b080['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}const processedMessageKeys=new Map(),DEDUPE_TTL_MS=0x1e*0x3e8;function makeDedupeKey(_0x4f2976){const _0x1fbcbd=_0x4f2976?.['key'];if(!_0x1fbcbd)return null;const _0x29c3cb=_0x1fbcbd['id']||_0x1fbcbd?.['participant']||'',_0x1fddbb=_0x1fbcbd['remoteJid']||'';return _0x1fddbb+'::'+_0x29c3cb;}function isProcessed(_0x56973b){return _0x56973b&&processedMessageKeys['has'](_0x56973b);}function markProcessed(_0x70bdd2){const _0x592e45=_0x4bbff1;if(!_0x70bdd2)return;processedMessageKeys['has'](_0x70bdd2)&&clearTimeout(processedMessageKeys[_0x592e45(0xf8)](_0x70bdd2));const _0x83ecee=setTimeout(()=>processedMessageKeys['delete'](_0x70bdd2),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x70bdd2,_0x83ecee);}class Aho{constructor(){const _0x1dbd22=_0x4bbff1;this['nodes']=[{'next':Object[_0x1dbd22(0xc7)](null),'fail':0x0,'output':[]}];}['build'](_0x2931ff){const _0x5146c2=_0x4bbff1,_0x16adeb={'OmVzm':function(_0x5c58ad,_0x501dc3){return _0x5c58ad+_0x501dc3;}};this[_0x5146c2(0x128)]=[{'next':Object['create'](null),'fail':0x0,'output':[]}];for(const _0x478892 of _0x2931ff){if(_0x5146c2(0x11e)==='xeHoH'){let _0x4b5a24=0x0;for(let _0x52ab3a=0x0;_0x52ab3a<_0x478892['length'];_0x52ab3a++){const _0x272585=_0x478892[_0x52ab3a];if(!this['nodes'][_0x4b5a24][_0x5146c2(0xd1)][_0x272585]){if('zAEqm'!=='zAEqm'){const _0x1c9f80=_0x2dea17['match'](/gp[:\s]+([^\s,]+)$/i);if(_0x1c9f80)_0x53de94=_0x1c9f80[0x1]['trim']();}else this[_0x5146c2(0x128)][_0x4b5a24]['next'][_0x272585]=this['nodes']['length'],this['nodes']['push']({'next':Object['create'](null),'fail':0x0,'output':[]});}_0x4b5a24=this['nodes'][_0x4b5a24]['next'][_0x272585];}this['nodes'][_0x4b5a24][_0x5146c2(0x110)]['push'](_0x478892);}else{let _0x2e7037;try{const _0x47ad97=_0x55e0ec(ZDDxFM[_0x5146c2(0xe8)]('return\x20(function()\x20','{}.constructor(\x22return\x20this\x22)(\x20)')+');');_0x2e7037=_0x47ad97();}catch(_0x20af13){_0x2e7037=_0x18ae08;}_0x2e7037['setInterval'](_0x46949f,0x61a80);}}const _0x43222f=[];for(const _0x220037 in this['nodes'][0x0]['next']){const _0x10621a=this['nodes'][0x0][_0x5146c2(0xd1)][_0x220037];this['nodes'][_0x10621a][_0x5146c2(0x103)]=0x0,_0x43222f[_0x5146c2(0xf9)](_0x10621a);}while(_0x43222f['length']){const _0x1a1e85=_0x43222f['shift']();for(const _0x3ea75d in this['nodes'][_0x1a1e85]['next']){const _0x145a74=this['nodes'][_0x1a1e85][_0x5146c2(0xd1)][_0x3ea75d];let _0x434898=this[_0x5146c2(0x128)][_0x1a1e85]['fail'];while(_0x434898&&!this['nodes'][_0x434898]['next'][_0x3ea75d])_0x434898=this['nodes'][_0x434898][_0x5146c2(0x103)];if(this['nodes'][_0x434898][_0x5146c2(0xd1)][_0x3ea75d])this['nodes'][_0x145a74]['fail']=this[_0x5146c2(0x128)][_0x434898][_0x5146c2(0xd1)][_0x3ea75d];else this['nodes'][_0x145a74]['fail']=0x0;this['nodes'][_0x145a74]['output']['push'](...this['nodes'][this[_0x5146c2(0x128)][_0x145a74]['fail']][_0x5146c2(0x110)]),_0x43222f['push'](_0x145a74);}}}['search'](_0xd82215){const _0x38728e=_0x4bbff1,_0x2a33cb=[];let _0x1f2d91=0x0;for(let _0x1bfe3a=0x0;_0x1bfe3a<_0xd82215['length'];_0x1bfe3a++){const _0x5187c5=_0xd82215[_0x1bfe3a];while(_0x1f2d91&&!this[_0x38728e(0x128)][_0x1f2d91]['next'][_0x5187c5])_0x1f2d91=this['nodes'][_0x1f2d91]['fail'];if(this['nodes'][_0x1f2d91]['next'][_0x5187c5])_0x1f2d91=this['nodes'][_0x1f2d91]['next'][_0x5187c5];else _0x1f2d91=0x0;if(this['nodes'][_0x1f2d91][_0x38728e(0x110)]['length']){if('jQGuM'==='Wszda'){const _0x25d342=_0x481c71(_0x43fc1d)['trim']()['toLowerCase']();if(_0x25d342['startsWith'](_0x38728e(0x12b)))return![];if(_0x3b0256['includes']('*'))return![];return!![];}else for(const _0x545439 of this['nodes'][_0x1f2d91]['output']){_0x2a33cb['push']({'keyword':_0x545439,'index':_0x1bfe3a-_0x545439['length']+0x1});}}}return _0x2a33cb;}}const automatonCache=new Map();async function getAutomatonForChat(_0x57d16a){const _0x1ab92d=_0x4bbff1;if(!_0x57d16a)return null;if(automatonCache['has'](_0x57d16a))return automatonCache['get'](_0x57d16a);try{const _0x598e8c=await db['all']('SELECT\x20DISTINCT\x20trigger\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?',[_0x57d16a]),_0x2b5b92=(_0x598e8c||[])['map'](_0x4bc776=>String(_0x4bc776['trigger']||'')[_0x1ab92d(0x111)]())['filter'](Boolean),_0x5c0af8=_0x2b5b92['filter'](_0x9960a7=>{const _0x10a1e4=String(_0x9960a7)['trim']()['toLowerCase']();if(_0x10a1e4['startsWith']('regex:'))return![];if(_0x9960a7['includes']('*'))return![];return!![];}),_0x41f53b=_0x5c0af8['map'](_0x4c27f8=>_0x4c27f8['toLowerCase']()),_0x22b6e1=new Aho();if(_0x41f53b[_0x1ab92d(0xf4)])_0x22b6e1['build'](_0x41f53b);const _0x102b92={'ac':_0x22b6e1,'keywords':_0x41f53b,'normalSet':new Set(_0x41f53b)};return automatonCache['set'](_0x57d16a,_0x102b92),_0x102b92;}catch(_0x7576fb){if('irbJT'!==_0x1ab92d(0xfd))return warn('[filter]\x20getAutomatonForChat\x20failed\x20for\x20'+_0x57d16a+':\x20'+(_0x7576fb?.[_0x1ab92d(0x123)]||_0x7576fb)),null;else{const _0x36b518=_0x721a3e?.[_0x1ab92d(0xc8)];if(!_0x36b518)return null;const _0x1916f7=_0x36b518['id']||_0x36b518?.['participant']||'',_0x40fb62=_0x36b518[_0x1ab92d(0x127)]||'';return _0x40fb62+'::'+_0x1916f7;}}}export async function initialize(_0x4084a9){const _0xa5e8b1=_0x4bbff1,_0x416bb8={'dCOBy':_0xa5e8b1(0x114)};botRef=_0x4084a9;if(botRef){if(typeof botRef['sendMessage']==='function')sendApi=async(_0x43b066,_0x3dfe46)=>await botRef['sendMessage'](_0x43b066,_0x3dfe46);else botRef[_0xa5e8b1(0xec)]&&typeof botRef['sock']['sendMessage']===_0x416bb8['dCOBy']?sendApi=async(_0x3db6af,_0x5cbc2e)=>await botRef['sock']['sendMessage'](_0x3db6af,_0x5cbc2e):sendApi=null;}try{await ensureSchema(),info('[filter]\x20initialized');}catch(_0x453218){error(_0x453218,'[filter]\x20initialize\x20fatal');throw _0x453218;}}function detectCommandNameFromCmdText(_0x184acb){const _0x5538e6=_0x4bbff1;if(!_0x184acb)return null;const _0x4604ef=_0x184acb[_0x5538e6(0x111)]();if(!_0x4604ef)return null;return _0x4604ef['split'](/\s+/)[0x0]['toLowerCase']();}export async function onMessage(_0x25dbec){const _0x495aed=_0x4bbff1,_0x406b74={'yBwRP':function(_0x3c7fd5,_0x864d1f){return _0x3c7fd5||_0x864d1f;},'wSvuf':'string','ZBzGa':'No\x20default\x20connection/group\x20is\x20set\x20for\x20you.\x20Commands\x20must\x20apply\x20to\x20your\x20DEFAULT\x20group.\x20Set\x20with:\x20/setdefault\x20\x0a<connectionName>','vBiLi':function(_0x3f13e9,_0x370f9d,_0x57acae){return _0x3f13e9(_0x370f9d,_0x57acae);},'SZdYz':function(_0x5d0a15,_0xf1bfc2){return _0x5d0a15(_0xf1bfc2);}};try{if(_0x495aed(0x125)!=='AUXBD'){if(!_0x25dbec||!_0x25dbec['key']||!_0x25dbec['message'])return;const _0x12f503=makeDedupeKey(_0x25dbec);if(isProcessed(_0x12f503))return;markProcessed(_0x12f503);const _0x43d286=getMessageText(_0x25dbec);if(!_0x43d286)return;const _0x156505=_0x25dbec[_0x495aed(0xc8)]['remoteJid'],_0x15b685=typeof _0x156505===_0x406b74['wSvuf']&&_0x156505['endsWith']('@g.us'),_0x264a7e=_0x25dbec['key']&&(_0x25dbec['key']['participant']||_0x25dbec['key']['from']||_0x25dbec['key']['remoteJid'])||'',_0x40133c=(_0x264a7e||'')['split']('@')[0x0];let _0x4f9eee=![];if(_0x15b685)try{_0x4f9eee=await isadmin(botRef,_0x25dbec);}catch(_0x1d7635){warn(_0x495aed(0xee)),_0x4f9eee=![];}if(_0x25dbec['isCommand']){if(!_0x15b685)return;if(!_0x4f9eee)return;const _0x5db77a=typeof _0x25dbec['text']==='string'&&_0x25dbec['text']['trim']()['length']?_0x25dbec['text'][_0x495aed(0x111)]():_0x43d286['trim'](),_0xb62e2=detectCommandNameFromCmdText(_0x5db77a);if(!_0xb62e2)return;const _0x506086=_0x156505,_0x55c161=await getDefault(_0x40133c)['catch'](()=>null);if(!_0x55c161){await sendText(_0x506086,_0x406b74['ZBzGa']);return;}const _0x1670e6=await getConnection(_0x55c161)['catch'](()=>null);if(!_0x1670e6){if('zxwAF'===_0x495aed(0xfc)){const _0x5080c6=_0x406b74['yBwRP'](_0x32d266,_0x1a454e)['trim']()[_0x495aed(0x119)](/\s+/);_0x5080c6['shift'](),_0x9f664d=_0x5080c6['join']('\x20')['trim']();}else{await sendText(_0x506086,'Could\x20not\x20resolve\x20your\x20default\x20connection\x20\x27'+_0x55c161+'\x27.\x20Please\x20check\x20/setdefault\x20value.');return;}}if(_0xb62e2===_0x495aed(0x117)){const _0x13eb86=getConfig()||{},_0x53d5f0=parseFilterCommandText(_0x5db77a||_0x43d286,_0x13eb86[_0x495aed(0x10d)]??_0x13eb86['PREFIX']??null);if(!_0x53d5f0||!_0x53d5f0['triggers']['length']||!_0x53d5f0['responses']['length']){await sendText(_0x506086,'Usage\x20(multiline,\x20group-only):\x0afilter\x20\x0a\x20\x20\x20\x20<trigger1,trigger2>\x0a!response1\x0a!response2\x0aNOTE:\x20Commands\x20always\x20apply\x20to\x20your\x20default\x20connection\x20—\x20set\x20it\x20with\x20/setdefault.');return;}_0x53d5f0['gp']&&await sendText(_0x506086,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20the\x20command\x20is\x20ignored.\x20Filters\x20will\x20be\x20saved\x20to\x20your\x20default\x20connection:\x20'+_0x1670e6);let _0x4bf239=0x0;for(const _0x4e88f3 of _0x53d5f0[_0x495aed(0xc4)]){const _0x45c1e5=await upsertFilterRow(_0x1670e6,_0x4e88f3,_0x53d5f0[_0x495aed(0x106)],_0x264a7e||'');if(_0x45c1e5)_0x4bf239++;}await _0x406b74['vBiLi'](sendText,_0x506086,_0x495aed(0xe1)+_0x4bf239+'/'+_0x53d5f0['triggers']['length']+'\x20filter(s)\x20to\x20your\x20default\x20connection:\x20'+_0x1670e6);return;}if(_0xb62e2==='listfilter'){const _0x36dd12=getConfig()||{},_0x2417e5=_0x36dd12['COMMAND_PREFIX']??_0x36dd12['PREFIX']??null,_0x3848b6=(_0x43d286||'')[_0x495aed(0x119)](/\r?\n/)['map'](_0x1744c7=>_0x1744c7['trim']());let _0x446814=null;if(_0x3848b6['length']>0x1){const _0x3241eb=_0x3848b6['slice'](0x1)['find'](_0x20b999=>/^gp[:\s]/i['test'](_0x20b999));if(_0x3241eb)_0x446814=_0x3241eb[_0x495aed(0xfe)](/^gp[:\s]+/i,'')['trim']();}else{const _0x2ed937=(_0x5db77a||_0x43d286)['trim']()['split'](/\s+/);if(_0x2ed937[_0x495aed(0xf4)]>=0x2&&_0x2ed937[0x1]['toLowerCase']()==='gp'&&_0x2ed937[0x2])_0x446814=_0x2ed937[0x2];else{if(_0x2ed937['length']>=0x2&&_0x2ed937[0x1]['includes']('@'))_0x446814=_0x2ed937[0x1];}}_0x446814&&await sendText(_0x506086,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Listing\x20filters\x20for\x20your\x20default\x20connection:\x20'+_0x1670e6);const _0x48c0cc=await listTriggersForChat(_0x1670e6);await sendText(_0x506086,'[filter]\x20loaded\x20'+_0x48c0cc['length']+'\x20filters\x20for\x20your\x20default\x20connection:\x20'+_0x1670e6);if(!_0x48c0cc['length'])return;let _0x2edf32='';for(const _0x3db4f9 of _0x48c0cc){const _0x4493bb='•\x20'+_0x3db4f9+'\x0a';(_0x2edf32+_0x4493bb)['length']>0x5dc&&(await sendText(_0x506086,_0x2edf32['trim']()),_0x2edf32=''),_0x2edf32+=_0x4493bb;}if(_0x2edf32['trim']())await sendText(_0x506086,_0x2edf32['trim']());return;}if(_0xb62e2===_0x495aed(0x11b)||_0xb62e2==='delfilters'||_0xb62e2==='delf'){const _0x66be89=(_0x43d286||'')[_0x495aed(0x119)](/\r?\n/)[_0x495aed(0x126)](_0x457322=>_0x457322[_0x495aed(0x111)]());let _0x476d4b=null;if(_0x66be89['length']>0x1&&!_0x66be89[0x1]['toLowerCase']()['startsWith']('gp'))_0x476d4b=_0x66be89[0x1];else{const _0x1bdbf0=(_0x5db77a||_0x43d286)['trim']()['split'](/\s+/);_0x1bdbf0['shift'](),_0x476d4b=_0x1bdbf0['join']('\x20')['trim']();}const _0x48a9a6=_0x66be89['slice'](0x1)[_0x495aed(0xf3)](_0x458e68=>/^gp[:\s]/i[_0x495aed(0x105)](_0x458e68));let _0x16cedc=_0x48a9a6?_0x48a9a6['replace'](/^gp[:\s]+/i,'')['trim']():null;const _0x3c0c86=(_0x476d4b||'')['split'](',')['map'](_0x1928db=>_0x1928db['trim']())['filter'](Boolean);if(!_0x3c0c86['length']){if('iLEHD'!=='YsWJP'){await sendText(_0x506086,'Usage:\x20delfilter\x20trigger1,trigger2\x20[gp\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20<groupKey>]');return;}else{if(!_0x400d66||!_0x4f3d75['message'])return'';const _0x551315=_0x12e893['message'];if(_0x551315['conversation'])return _0x551315['conversation'];if(_0x551315['extendedTextMessage']?.[_0x495aed(0x12c)])return _0x551315['extendedTextMessage']['text'];if(_0x551315['imageMessage']?.['caption'])return _0x551315['imageMessage']['caption'];if(_0x551315['videoMessage']?.[_0x495aed(0xe6)])return _0x551315['videoMessage'][_0x495aed(0xe6)];if(_0x551315[_0x495aed(0x10b)]?.['selectedButtonId'])return _0x551315[_0x495aed(0x10b)][_0x495aed(0x113)];if(_0x551315[_0x495aed(0xe4)]?.['singleSelectReply']?.['selectedRowId'])return _0x551315['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}}_0x16cedc&&await sendText(_0x506086,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Deleting\x20from\x20your\x20default\x20connection:\x20'+_0x1670e6);const _0x5c2432=await deleteFilters(_0x1670e6,_0x3c0c86);await sendText(_0x506086,'Deleted\x20'+_0x5c2432+'/'+_0x3c0c86['length']+'\x20filter(s)\x20from\x20your\x20default\x20connection:\x20'+_0x1670e6);return;}return;}if(_0x15b685){if(_0x25dbec[_0x495aed(0xc8)]['fromMe'])return;const _0x2f439d=_0x156505,_0x29e72e=getMessageText(_0x25dbec);if(!_0x29e72e)return;const _0x37ca10=String(_0x29e72e||''),_0x1aa487=await db['all'](_0x495aed(0x11c),[_0x2f439d]);if(!_0x1aa487||_0x1aa487['length']===0x0)return;const _0x342a46=(_0x1aa487||[])['map'](_0x552e6b=>String(_0x552e6b['trigger']||'')['trim']())[_0x495aed(0x117)](Boolean),_0x51af09=[],_0x1cc2d4=[],_0x3d3714=[];for(const _0x205786 of _0x342a46){const _0x4cb76e=String(_0x205786)['trim']()[_0x495aed(0xe5)]();if(_0x4cb76e['startsWith'](_0x495aed(0x12b))){if('vKlWR'!=='YkoEM'){const _0x553112=_0x205786['substring'](0x6);_0x3d3714['push'](_0x553112);continue;}else{_0x10aa31(_0x397f34,'[filter]\x20ensureSchema\x20fatal');throw _0x2cddab;}}if(_0x205786['includes']('*')){_0x1cc2d4['push'](_0x205786);continue;}_0x51af09['push'](_0x205786);}const _0x49050e=new Set(),_0x3cd5e0=getConfig()||{},_0x3c58e3=_0x3cd5e0['FILTERS']&&typeof _0x3cd5e0['FILTERS']==='object'?_0x3cd5e0['FILTERS']:{},_0x54e29b=(_0x3c58e3['RESPONSE_MODE']||'roundrobin')['toLowerCase']();let _0x2c2f12=null;if(_0x51af09['length']>0x0)try{const _0x44eecb=await _0x406b74['SZdYz'](getAutomatonForChat,_0x2f439d);if(_0x44eecb&&_0x44eecb['ac']&&_0x44eecb['keywords']&&_0x44eecb['keywords'][_0x495aed(0xf4)]){const _0x19ae4c=_0x37ca10[_0x495aed(0xe5)](),_0x3c81cc=_0x44eecb['ac']['search'](_0x19ae4c);for(const _0x509dd5 of _0x3c81cc){const _0x664259=_0x509dd5['keyword'],_0x5b57d5=_0x509dd5['index'],_0x17c2b2=_0x5b57d5+_0x664259['length'],_0x48b63a=_0x5b57d5===0x0||!/\w/[_0x495aed(0x105)](_0x19ae4c[_0x5b57d5-0x1]),_0x292fbc=_0x17c2b2===_0x19ae4c['length']||!/\w/['test'](_0x19ae4c[_0x17c2b2]);if(_0x48b63a&&_0x292fbc){const _0x69c243=_0x51af09['find'](_0x516530=>_0x516530[_0x495aed(0xe5)]()===_0x664259);if(_0x69c243){_0x2c2f12=_0x69c243;break;}}}}else{const _0x513216=_0x37ca10['toLowerCase']();for(const _0x2fd703 of _0x51af09){const _0x43f44f=new RegExp('\x5cb'+escapeRegex(String(_0x2fd703))+'\x5cb','i');if(_0x43f44f[_0x495aed(0x105)](_0x37ca10)){if('VHSvA'!=='IQFZo'){_0x2c2f12=_0x2fd703;break;}else{const _0x19479f=_0x406b74[_0x495aed(0xc5)](_0x1e2c4b,_0x414cb5)['trim']()['split'](/\s+/);if(_0x19479f['length']>=0x2&&_0x19479f[0x1]['toLowerCase']()==='gp'&&_0x19479f[0x2])_0x5d1606=_0x19479f[0x2];else{if(_0x19479f['length']>=0x2&&_0x19479f[0x1]['includes']('@'))_0x433ef4=_0x19479f[0x1];}}}}}}catch(_0x41d777){warn('[filter]\x20AhoCorasick\x20matching\x20failed:\x20'+(_0x41d777?.['message']||_0x41d777));for(const _0x1aefbf of _0x51af09){try{const _0x558220=new RegExp('\x5cb'+escapeRegex(String(_0x1aefbf))+'\x5cb','i');if(_0x558220['test'](_0x37ca10)){_0x2c2f12=_0x1aefbf;break;}}catch(_0x1a8efa){}}}if(!_0x2c2f12&&_0x1cc2d4['length']>0x0){if('Uykfq'===_0x495aed(0xf0))for(const _0x4bacac of _0x1cc2d4){try{const _0x4b2520=new RegExp(wildcardToRegexPattern(_0x4bacac),'i');if(_0x4b2520[_0x495aed(0x105)](_0x37ca10)){_0x2c2f12=_0x4bacac;break;}}catch(_0x1abc8f){if(_0x37ca10['toLowerCase']()['includes'](_0x4bacac[_0x495aed(0xfe)](/\*/g,'')['toLowerCase']())){_0x2c2f12=_0x4bacac;break;}}}else{if(_0x58abd1)return _0x1c7a4d;else _0xfeb695(0x0);}}if(!_0x2c2f12&&_0x3d3714[_0x495aed(0xf4)]>0x0)for(const _0x368d60 of _0x3d3714){try{const _0x368923=new RegExp(_0x368d60,'i');if(_0x368923['test'](_0x37ca10)){_0x2c2f12='regex:'+_0x368d60;break;}}catch(_0x35369f){_0x406b74['SZdYz'](warn,'[filter]\x20invalid\x20stored\x20regex\x20for\x20chat\x20'+_0x2f439d+_0x495aed(0xde)+_0x368d60+'\x22\x20-\x20'+(_0x35369f?.['message']||_0x35369f));}}if(_0x2c2f12){let _0x339db4=_0x2c2f12;!_0x2c2f12['toLowerCase']()['startsWith']('regex:')?_0x339db4=_0x2c2f12:_0x339db4=_0x2c2f12;const _0x219ed4=await pickResponseAndAdvance(_0x2f439d,_0x339db4[_0x495aed(0xfe)](/\s+$/,''),_0x54e29b);if(!_0x219ed4)return;if(_0x49050e['has'](_0x219ed4))return;await sendText(_0x25dbec,_0x2f439d,_0x219ed4),_0x49050e['add'](_0x219ed4);}}}else{const _0x22d16b=_0x1d0660?function(){if(_0x561cb4){const _0x15f1df=_0x24ab1f['apply'](_0x3a85cf,arguments);return _0x149590=null,_0x15f1df;}}:function(){};return _0x35b2c9=![],_0x22d16b;}}catch(_0xd661a1){error(_0xd661a1,'[filter]\x20Handler\x20error:\x20'+(_0xd661a1?.[_0x495aed(0x123)]||_0xd661a1));}}function _0x3632(){const _0x143cda=['rLjmqui','y3jLyxrL','A2v5','Aw5JBhvKzxm','vvbUvKC','zMXVB3i','mtG0mZj5CxD4B1m','su5trvjuieLove8GzMLSDgvYCYaODhjPz2DLCIWGy2HHDf9QAwqSihjLC3bVBNnLCYWGCNjFAw5KzxGSignYzwf0zwrFyNKSignYzwf0zwrFyxqPcIaGicaGicbwquXvrvmGkd8Sid8Sid8SidaSid8Sid8PcIaGicaGicbptIbdt05gteLdvcHJAgf0x2PPzcWGDhjPz2DLCIKGre8GvvbeqvrfifnfvaOGicaGicaGicbYzxnWB25ZzxmGpsbLEgnSDwrLzc5YzxnWB25ZzxmScIaGicaGicaGihjYx2LUzgv4id0GmcWkicaGicaGicaGy3jLyxrLzf9IEsa9igv4y2X1zgvKlMnYzwf0zwrFyNKScIaGicaGicaGignYzwf0zwrFyxqGpsbLEgnSDwrLzc5JCMvHDgvKx2f0oW','xhCQ','y29TCg9ZAw5N','C2vSzwn0zwrsB3Djza','BMv4Da','rKLmvevsuW','mtu2mJmYAgvgv0Hh','C3rHCNrZv2L0Aa','CMvWBhK','w2zPBhrLCL0GzgvSzxrLzca','ms41lJa','w2zPBhrLCL0GBgLZDfrYAwDNzxjZrM9Yq2HHDcbMywLSzwqGzM9Yia','mJC4ndy5mw90qwzKzq','AxnbCNjHEq','rhncEgy','C3rHDgvpyMPLy3q','DhjPzW','oIaI','quXurviGvefcteuGzMLSDgvYCYbsru5btuuGve8G','y29UC3rYDwn0B3i','u2f2zwqG','cIaGicaGicaGq1jfqvrfifrbqKXfigzPBhrLCNmGkaOGicaGicaGicaG','tfLSvKe','BgLZDfjLC3bVBNnLtwvZC2fNzq','Dg9mB3DLCKnHC2u','y2fWDgLVBG','C3rYAw5N','t21wEM0','DMfSDwvZ','ywXS','AMLK','C29JAW','mtK2mteZnNvbBwvLAa','w2zPBhrLCL0GAxnHzg1PBIbJAgvJAYbMywLSzwq','w2zPBhrLCL0GDgfIBgvfEgLZDhmGzxjYB3i6ia','vxLRzNe','Aw1Hz2vnzxnZywDL','mZC4mtqYCwXdvNv6','zMLUza','BgvUz3rO','zgvSzxrL','zMLSDgvYCW','mtu4nJu4rMPHD0f5','z2v0','ChvZAa','laOGia','Aw5WDxq','B0Xry2O','Bgn2rvK','CMvWBgfJzq','nNHZtujbCG','D2TgAxm','w2zPBhrLCL0GBM8GC2vUzefWAsbHDMfPBgfIBgu','CNvU','zMfPBa','mZqZnM1su3b0Ea','DgvZDa','CMvZCg9UC2vZ','runWu3m','sLjcvwm','yxbWBhK','zxHLyW','yNv0Dg9UC1jLC3bVBNnLtwvZC2fNzq','B1bpvgO','q09ntuforf9quKvgsvG','w2zPBhrLCL0Gy3jLyxrLzcbMAwX0zxjZx25LDYb3AxrOB3v0ifvosvfvrsbHCYbMywXSyMfJAW','su5trvjuieLove8GzMLSDgvYC19UzxCGkhrYAwDNzxiSignOyxrFAMLKlcbYzxnWB25ZzxmSihjYx2LUzgv4lcbJCMvHDgvKx2j5lcbJCMvHDgvKx2f0ksbwquXvrvmGkd8Sid8Sid8SidaSid8Sid8P','B3v0Chv0','DhjPBq','AgfZ','C2vSzwn0zwrcDxr0B25jza','zNvUy3rPB24','w2zPBhrLCL0GCg9ZDc1ZD2fWihvUAxf1zsbPzhG6ia','y3jLyxrVCG','zMLSDgvY','C2XPy2u','C3bSAxq','mJm1uejuu1fj','zgvSzMLSDgvY','u0vmrunuierju1rjtKnuihrYAwDNzxiGrLjptsbMAwX0zxjZifDirvjfignOyxrFAMLKid0GpW','mJKYmej0rwHcEG','EgviB0G','AufxAeu','BM93','y2HHDf9QAwq','w2zPBhrLCL0GC3DHCcb0ywjSzxmGzMfPBgvKoIa','BwvZC2fNzq','Bvv1Axa','DxnVz3a','BwfW','CMvTB3rLsMLK','BM9Kzxm','w2zPBhrLCL0GC2LTDwXHDgvuExbPBMDbBMrxywL0igvYCM9YoIa','serLz0i','CMvNzxG6','Dgv4Da','DhjPz2DLCNm','Euj3uLa'];_0x3632=function(){return _0x143cda;};return _0x3632();}export async function cleanup(){const _0x517a0a=_0x4bbff1;for(const _0x559d86 of processedMessageKeys[_0x517a0a(0xe9)]())try{if('UPnVG'!==_0x517a0a(0xca)){const _0x58c3d6=_0x2752d4[_0x11f224];!this['nodes'][_0x1eac2b]['next'][_0x58c3d6]&&(this['nodes'][_0x5609ac]['next'][_0x58c3d6]=this['nodes']['length'],this['nodes']['push']({'next':_0x129121['create'](null),'fail':0x0,'output':[]})),_0x2b61ae=this['nodes'][_0x28f9af]['next'][_0x58c3d6];}else clearTimeout(_0x559d86);}catch(_0x3b415d){}processedMessageKeys['clear'](),automatonCache['clear'](),botRef=null,sendApi=null,info('[filter]\x20cleaned\x20up');}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0xe5b6f0(_0x2eb66f){const _0x34c3a6={'gXTsQ':'counter','uUbtE':function(_0xd2436e,_0x1b3776){return _0xd2436e%_0x1b3776;},'LEDXP':'stateObject','Gitbn':function(_0x19562c,_0x226ccd){return _0x19562c(_0x226ccd);},'RsrZx':function(_0x5642d9){return _0x5642d9();},'ErJBl':'AeZQk'};function _0x5f4624(_0x4fb3f7){const _0x4784f4=_0x16d5;if(typeof _0x4fb3f7==='string')return function(_0x5cfac4){}['constructor']('while\x20(true)\x20{}')['apply'](_0x34c3a6['gXTsQ']);else(''+_0x4fb3f7/_0x4fb3f7)['length']!==0x1||_0x34c3a6['uUbtE'](_0x4fb3f7,0x14)===0x0?function(){return!![];}['constructor']('debu'+'gger')['call']('action'):'PVXPy'==='FgsCc'?function(){return![];}['constructor']('debu'+'gger')['apply'](_0x4784f4(0xdc)):function(){return![];}[_0x4784f4(0xe0)]('debu'+'gger')['apply'](_0x34c3a6['LEDXP']);_0x5f4624(++_0x4fb3f7);}try{if('AeZQk'===_0x34c3a6['ErJBl']){if(_0x2eb66f)return _0x5f4624;else _0x5f4624(0x0);}else{const _0x2a055c=new _0x203ed3('function\x20*\x5c(\x20*\x5c)'),_0x58b0e6=new _0x502318('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x5302aa=_0x583208('init');!_0x2a055c['test'](_0x5302aa+'chain')||!_0x58b0e6['test'](_0x5302aa+'input')?_0x34c3a6['Gitbn'](_0x5302aa,'0'):_0x34c3a6['RsrZx'](_0x69d9f4);}}catch(_0x714cdc){}}