const _0x564910=_0x5ce6;(function(_0xd1b54b,_0x154eeb){const _0xa0fbad=_0x5ce6,_0x43915f=_0xd1b54b();while(!![]){try{const _0xa72b53=-parseInt(_0xa0fbad(0x8c))/0x1*(parseInt(_0xa0fbad(0xa7))/0x2)+parseInt(_0xa0fbad(0xa3))/0x3*(parseInt(_0xa0fbad(0x95))/0x4)+parseInt(_0xa0fbad(0xa1))/0x5+parseInt(_0xa0fbad(0x81))/0x6+-parseInt(_0xa0fbad(0xb7))/0x7*(-parseInt(_0xa0fbad(0x94))/0x8)+parseInt(_0xa0fbad(0x7b))/0x9+-parseInt(_0xa0fbad(0xc2))/0xa;if(_0xa72b53===_0x154eeb)break;else _0x43915f['push'](_0x43915f['shift']());}catch(_0x36c288){_0x43915f['push'](_0x43915f['shift']());}}}(_0x1048,0x308c0));const _0x3c7fb0=(function(){let _0x25f844=!![];return function(_0x3f0fc4,_0x45323d){const _0x232c67=_0x25f844?function(){const _0x306edd=_0x5ce6;if(_0x45323d){const _0x1ad72a=_0x45323d[_0x306edd(0x74)](_0x3f0fc4,arguments);return _0x45323d=null,_0x1ad72a;}}:function(){};return _0x25f844=![],_0x232c67;};}());function _0x5ce6(_0xa85e88,_0x14f048){const _0x2731a6=_0x1048();return _0x5ce6=function(_0x15b38c,_0x3c7fb0){_0x15b38c=_0x15b38c-0x66;let _0x3055fd=_0x2731a6[_0x15b38c];if(_0x5ce6['Yogkph']===undefined){var _0x1db825=function(_0x4dfed7){const _0x1a1e24='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x156137='',_0x34d08e='';for(let _0x2d4f61=0x0,_0x3ae76d,_0x2b1b59,_0x4a2e1b=0x0;_0x2b1b59=_0x4dfed7['charAt'](_0x4a2e1b++);~_0x2b1b59&&(_0x3ae76d=_0x2d4f61%0x4?_0x3ae76d*0x40+_0x2b1b59:_0x2b1b59,_0x2d4f61++%0x4)?_0x156137+=String['fromCharCode'](0xff&_0x3ae76d>>(-0x2*_0x2d4f61&0x6)):0x0){_0x2b1b59=_0x1a1e24['indexOf'](_0x2b1b59);}for(let _0x5ce1c8=0x0,_0x10ed24=_0x156137['length'];_0x5ce1c8<_0x10ed24;_0x5ce1c8++){_0x34d08e+='%'+('00'+_0x156137['charCodeAt'](_0x5ce1c8)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x34d08e);};_0x5ce6['ZvSnZx']=_0x1db825,_0xa85e88=arguments,_0x5ce6['Yogkph']=!![];}const _0x1048f1=_0x2731a6[0x0],_0x5ce63c=_0x15b38c+_0x1048f1,_0x20dcda=_0xa85e88[_0x5ce63c];return!_0x20dcda?(_0x3055fd=_0x5ce6['ZvSnZx'](_0x3055fd),_0xa85e88[_0x5ce63c]=_0x3055fd):_0x3055fd=_0x20dcda,_0x3055fd;},_0x5ce6(_0xa85e88,_0x14f048);}(function(){_0x3c7fb0(this,function(){const _0x49c280=_0x5ce6,_0x30f7dc=new RegExp(_0x49c280(0x75)),_0x484abe=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x1498a4=_0x15b38c('init');!_0x30f7dc['test'](_0x1498a4+'chain')||!_0x484abe['test'](_0x1498a4+'input')?_0x1498a4('0'):_0x15b38c();})();}());import{getConfig}from'../utils/config.js';import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{getDefault,getConnection}from'../utils/connection.js';import{isadmin}from'../utils/isadmin.js';export const name='filter';export const version=_0x564910(0x9f);export const priority=0x78;export const configKeys=['FILTERS'];export const commands=['listfilter','delfilter','delfilters','delf'];let botRef=null,sendApi=null;function clampTypingMs(_0x237268){const _0x4249a0=Number(_0x237268);if(!Number['isFinite'](_0x4249a0)||isNaN(_0x4249a0))return 0x0;if(_0x4249a0<=0x0)return 0x0;if(_0x4249a0>0x3a98)return 0x3a98;return Math['floor'](_0x4249a0);}function sleep(_0x634751){return new Promise(_0x51c3da=>setTimeout(_0x51c3da,_0x634751));}async function simulateTypingAndWait(_0x491041,_0x3d2451,_0x4484db){const _0x901a93=_0x564910,_0xc3fdd={'GJIEX':_0x901a93(0x6a)};if(!_0x4484db||_0x4484db<=0x0)return;try{if(_0x491041&&typeof _0x491041['sendPresenceUpdate']==='function'){if('wvJXa'!=='wvJXa')return![];else try{await _0x491041['sendPresenceUpdate']('composing',_0x3d2451);}catch(_0x5295bf){}}}catch(_0x23fb31){}try{await sleep(_0x4484db);}catch(_0x169b39){}try{if(_0x491041&&typeof _0x491041['sendPresenceUpdate']==='function')try{await _0x491041[_0x901a93(0xb3)](_0xc3fdd['GJIEX'],_0x3d2451);}catch(_0x3b8b90){}}catch(_0x38dcc2){}}function safeJsonParse(_0x3acd20){try{return JSON['parse'](_0x3acd20);}catch{return null;}}function ensureArray(_0x5e5094){if(!_0x5e5094)return[];if(Array['isArray'](_0x5e5094))return _0x5e5094;return[String(_0x5e5094)];}function uniqArray(_0x5297e7){const _0xc3740e=_0x564910,_0x4713d7=new Set(),_0x55d593=[];for(const _0x2a3098 of _0x5297e7){const _0x2c0f98=String(_0x2a3098||'')[_0xc3740e(0xae)]();if(!_0x2c0f98)continue;!_0x4713d7['has'](_0x2c0f98)&&(_0x4713d7['add'](_0x2c0f98),_0x55d593['push'](_0x2c0f98));}return _0x55d593;}function escapeRegex(_0x4970de){return _0x4970de['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');}function wildcardToRegexPattern(_0x172d1b){const _0x4b4f94=_0x564910,_0x3267b2=_0x172d1b['split']('*')['map'](_0x3a3945=>escapeRegex(_0x3a3945));return'\x5cb'+_0x3267b2['join'](_0x4b4f94(0x79))+'\x5cb';}function clampConfigTypingMs(){const _0xbdea2d=_0x564910;try{const _0x560708=getConfig()||{},_0x1934bc=_0x560708['FILTERS']&&typeof _0x560708['FILTERS']==='object'?_0x560708['FILTERS']:{};return clampTypingMs(_0x1934bc[_0xbdea2d(0x6c)]);}catch(_0x382c6b){return 0x0;}}async function sendText(_0x31fe92,_0x146ed1,_0x3fbfc4,_0x2ac2d3){const _0x2eddba=_0x564910,_0x53717b={'vLFcj':function(_0x55a9fc,_0x3f52c6){return _0x55a9fc(_0x3f52c6);}};let _0x1309e6=null,_0x5aaf5f=null,_0x934041=null,_0x556212=[];if(_0x31fe92&&typeof _0x31fe92==='object'&&_0x31fe92[_0x2eddba(0xbd)]&&_0x31fe92['message']){if('eawJa'!=='eawJa')try{const _0x164430=_0x2ddb48['parse'](_0x4127b7);if(_0x57b1ba[_0x2eddba(0x76)](_0x164430))return _0x4b805d(_0x164430);}catch(_0x10849a){}else{_0x1309e6=_0x31fe92,_0x5aaf5f=_0x146ed1,_0x934041=_0x3fbfc4,_0x556212=Array['isArray'](_0x2ac2d3)?_0x2ac2d3:Array['isArray'](_0x3fbfc4)?[]:Array[_0x2eddba(0x76)](_0x146ed1)?[]:[];if(Array['isArray'](_0x2ac2d3))_0x556212=_0x2ac2d3;}}else _0x5aaf5f=_0x31fe92,_0x934041=_0x146ed1,_0x556212=Array['isArray'](_0x3fbfc4)?_0x3fbfc4:[];if(!_0x934041)return;if(!_0x5aaf5f){warn('[filter]\x20sendText\x20called\x20without\x20targetJid');return;}const _0x20c199={'text':String(_0x934041)};if(Array['isArray'](_0x556212)&&_0x556212[_0x2eddba(0xc6)])_0x20c199[_0x2eddba(0xca)]=_0x556212;try{if(!sendApi){warn('[filter]\x20no\x20sendApi\x20available');return;}const _0x290c4a=clampConfigTypingMs();if(_0x290c4a>0x0)try{await simulateTypingAndWait(botRef?.['sock'],_0x5aaf5f,_0x290c4a);}catch(_0x33a935){_0x53717b['vLFcj'](warn,'[filter]\x20simulateTypingAndWait\x20error:\x20'+(_0x33a935?.['message']||_0x33a935));}if(_0x1309e6&&typeof _0x1309e6['reply']==='function')try{await _0x1309e6['reply']({'text':String(_0x934041),'mentions':_0x20c199['mentions']||[]});return;}catch(_0x257a52){warn('[filter]\x20reply\x20(quoted)\x20failed,\x20falling\x20back\x20to\x20bare\x20send:\x20'+(_0x257a52?.['message']||_0x257a52));try{await sendApi(_0x5aaf5f,_0x20c199);return;}catch(_0x34d9fc){warn('[filter]\x20fallback\x20bare\x20send\x20after\x20reply\x20failure\x20also\x20failed:\x20'+(_0x34d9fc?.['message']||_0x34d9fc));return;}}try{await sendApi(_0x5aaf5f,_0x20c199);}catch(_0x57e5c6){warn(_0x2eddba(0xb6)+_0x5aaf5f+':\x20'+(_0x57e5c6?.[_0x2eddba(0xd2)]||_0x57e5c6));}}catch(_0x5c74ff){warn('[filter]\x20sendText\x20unexpected\x20error:\x20'+(_0x5c74ff?.['message']||_0x5c74ff));}}async function tableExists(_0x180958){const _0x3086c2=_0x564910;try{const _0x39c8dd=await db['get'](_0x3086c2(0x6e),[_0x180958]);return!!_0x39c8dd;}catch(_0x2bb153){return warn('[filter]\x20tableExists\x20error:\x20'+(_0x2bb153?.['message']||_0x2bb153)),![];}}async function getTableColumns(_0x228563){try{const _0x298bf0=await db['all']('PRAGMA\x20table_info('+_0x228563+')');return(_0x298bf0||[])['map'](_0x441739=>_0x441739['name']);}catch(_0x1c7c7a){return warn('[filter]\x20getTableColumns\x20error\x20for\x20'+_0x228563+':\x20'+(_0x1c7c7a?.['message']||_0x1c7c7a)),[];}}(function(){let _0xeb524f;try{const _0x3e96bd=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xeb524f=_0x3e96bd();}catch(_0x6b293a){_0xeb524f=window;}_0xeb524f['setInterval'](_0x15b38c,0x61a80);}());function resolveChatJidFromRow(_0x3ed941){const _0xe8cff1=_0x564910,_0x254a95=['chat_jid',_0xe8cff1(0x85),'chat_id','jid','chat','room'];for(const _0x21eed5 of _0x254a95)if(_0x21eed5 in _0x3ed941&&_0x3ed941[_0x21eed5])return String(_0x3ed941[_0x21eed5]);for(const _0x2cd409 of Object[_0xe8cff1(0xd7)](_0x3ed941)){const _0x1ca478=_0x3ed941[_0x2cd409];if(typeof _0x1ca478==='string'&&_0x1ca478['includes']('@'))return _0x1ca478;}return null;}function resolveTriggerFromRow(_0x1c4941){const _0x535317=_0x564910,_0x1c7aa9={'OAFcQ':function(_0x563db3,_0x1a86cc){return _0x563db3 in _0x1a86cc;}},_0x4cdfec=['trigger','trig','keyword','word','phrase'];for(const _0x490d6d of _0x4cdfec)if(_0x1c7aa9['OAFcQ'](_0x490d6d,_0x1c4941)&&_0x1c4941[_0x490d6d])return String(_0x1c4941[_0x490d6d]);for(const _0x25c9ca of Object[_0x535317(0xd7)](_0x1c4941)){const _0x39e8d9=_0x1c4941[_0x25c9ca];if(typeof _0x39e8d9===_0x535317(0x7e)&&!_0x39e8d9['includes']('@')&&_0x39e8d9['length']<0x12c)return _0x39e8d9;}return null;}function resolveResponsesFromRow(_0x4935dc){const _0x2421da=_0x564910,_0x275df9={'GzfJo':'message','aOzDR':function(_0x24807c,_0x4fa139){return _0x24807c!=_0x4fa139;}},_0x4a2f3d=['responses',_0x2421da(0xac),_0x2421da(0xb4),'replies',_0x2421da(0x8e),_0x2421da(0x80),_0x275df9['GzfJo']];for(const _0x2aaeae of _0x4a2f3d)if(_0x2aaeae in _0x4935dc&&_0x275df9[_0x2421da(0x7f)](_0x4935dc[_0x2aaeae],null))return _0x4935dc[_0x2aaeae];for(const _0x260e79 of Object['keys'](_0x4935dc)){const _0x349dd1=_0x4935dc[_0x260e79];if(typeof _0x349dd1==='string'&&(_0x349dd1[_0x2421da(0xae)]()['startsWith']('!')||_0x349dd1['trim']()['includes']('\x0a')||_0x349dd1[_0x2421da(0xae)]()['startsWith']('[')))return _0x349dd1;}return null;}async function readAndNormalizeExistingFilters(){const _0x232164=_0x564910;try{const _0x1ac6e9=await db['all']('SELECT\x20*\x20FROM\x20filters'),_0x16bcf5=new Map();for(const _0x217aed of _0x1ac6e9||[]){const _0x547c85=resolveTriggerFromRow(_0x217aed)||'',_0x46c323=resolveChatJidFromRow(_0x217aed)||'';if(!_0x547c85||!_0x46c323)continue;const _0x16bd4c=resolveResponsesFromRow(_0x217aed),_0x55ab51=normalizeResponseValue(_0x16bd4c),_0x7f5d72=_0x217aed[_0x232164(0x9c)]||_0x217aed[_0x232164(0x70)]||_0x217aed['author']||'';let _0xe30035=Number(_0x217aed['created_at']||_0x217aed['ts']||_0x217aed[_0x232164(0xab)]||_0x217aed[_0x232164(0xce)]||0x0);if(!_0xe30035)_0xe30035=Math['floor'](Date['now']()/0x3e8);const _0x42a4a1=_0x46c323+'||'+_0x547c85;if(!_0x16bcf5['has'](_0x42a4a1))_0x16bcf5['set'](_0x42a4a1,{'trigger':_0x547c85,'chat_jid':_0x46c323,'responses':_0x55ab51['slice'](),'created_by':_0x7f5d72,'created_at':_0xe30035});else{if(_0x232164(0x8b)!=='zBKQF'){const _0x35f390=_0x16bcf5[_0x232164(0x68)](_0x42a4a1);_0x35f390['responses']=uniqArray(_0x35f390['responses']['concat'](_0x55ab51)),_0x35f390[_0x232164(0x9c)]=_0x35f390['created_by']||_0x7f5d72,_0x35f390['created_at']=Math[_0x232164(0xb5)](_0x35f390[_0x232164(0x7c)]||0x0,_0xe30035||0x0);}else return _0x1c1926;}}return Array[_0x232164(0x92)](_0x16bcf5[_0x232164(0xd4)]());}catch(_0xc3545c){return warn('[filter]\x20readAndNormalizeExistingFilters\x20failed:\x20'+(_0xc3545c?.['message']||_0xc3545c)),[];}}async function ensureSchema(){const _0x28382d=_0x564910,_0x1705e2={'pfuRR':function(_0x2132d5,_0x284336){return _0x2132d5<_0x284336;},'MyYBa':'TEXT\x20NOT\x20NULL','jEhWp':function(_0x632424,_0xeb1eba){return _0x632424!==_0xeb1eba;},'IMkWl':function(_0x47e85f,_0x801014){return _0x47e85f!==_0x801014;},'ilLPy':function(_0x108cbb,_0x13b2f5){return _0x108cbb(_0x13b2f5);},'hrJAf':'responses'},_0x39adb8={'id':_0x28382d(0xa6),'trigger':_0x28382d(0x83),'chat_jid':_0x1705e2['MyYBa'],'responses':'TEXT\x20NOT\x20NULL\x20DEFAULT\x20\x27[]\x27','rr_index':'INTEGER\x20DEFAULT\x200','created_by':'TEXT\x20DEFAULT\x20\x27\x27','created_at':_0x28382d(0xd0)};try{const _0x42bf2e=await tableExists('filters');if(!_0x42bf2e){if(_0x1705e2['jEhWp']('NElck','NElck'))_0x1ce584(_0x28382d(0xbb)+_0x2c3d71['chat_jid']+'@'+_0x4c6e26['trigger']+':\x20'+(_0x5b8921?.['message']||_0x1042e6));else{const _0x175d15=Object['entries'](_0x39adb8)['map'](([_0x1547fa,_0x1f029e])=>_0x1547fa+'\x20'+_0x1f029e)['join'](',\x0a\x20\x20');await db['exec'](_0x28382d(0xbf)+_0x175d15+_0x28382d(0xa8));try{await db[_0x28382d(0x73)](_0x28382d(0xb9));}catch(_0x4af9ae){}try{if(_0x1705e2['IMkWl']('bcfBz','bcfBz')){const _0x178fd1=[];let _0x385f03=0x0;for(let _0x514df5=0x0;_0x1705e2[_0x28382d(0xd8)](_0x514df5,_0x48d672['length']);_0x514df5++){const _0x43c6d5=_0x3880f2[_0x514df5];while(_0x385f03&&!this['nodes'][_0x385f03]['next'][_0x43c6d5])_0x385f03=this['nodes'][_0x385f03]['fail'];if(this['nodes'][_0x385f03]['next'][_0x43c6d5])_0x385f03=this['nodes'][_0x385f03][_0x28382d(0x6b)][_0x43c6d5];else _0x385f03=0x0;if(this[_0x28382d(0xbe)][_0x385f03][_0x28382d(0xc7)]['length'])for(const _0x6908 of this[_0x28382d(0xbe)][_0x385f03][_0x28382d(0xc7)]){_0x178fd1['push']({'keyword':_0x6908,'index':_0x514df5-_0x6908['length']+0x1});}}return _0x178fd1;}else await db['exec'](_0x28382d(0xcc));}catch(_0x2a0aeb){}_0x1705e2['ilLPy'](info,'[filter]\x20created\x20new\x20filters\x20table\x20(canonical\x20schema)');return;}}const _0x1aabea=await getTableColumns(_0x28382d(0x71)),_0x490fa3=_0x1aabea['includes']('trigger'),_0x3c46ea=_0x1aabea['includes']('chat_jid'),_0x7e407e=_0x1aabea['includes'](_0x1705e2['hrJAf']);if(_0x490fa3&&_0x3c46ea&&_0x7e407e){try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_chat\x20ON\x20filters(chat_jid);');}catch(_0x267592){warn('[filter]\x20idx\x20create:\x20'+(_0x267592?.['message']||_0x267592));}try{await db['exec']('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_unique\x20ON\x20filters(chat_jid,\x20trigger);');}catch(_0xa719c7){warn('[filter]\x20unique\x20idx:\x20'+(_0xa719c7?.[_0x28382d(0xd2)]||_0xa719c7));}info('[filter]\x20filters\x20table\x20already\x20has\x20canonical\x20columns');return;}info('[filter]\x20legacy\x20filters\x20table\x20detected\x20-\x20performing\x20safe\x20migration');const _0x1801dd=await readAndNormalizeExistingFilters();await db['exec']('PRAGMA\x20foreign_keys\x20=\x20OFF;');try{await db['exec'](_0x28382d(0x99));}catch(_0x1c1211){await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20filters_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20trigger\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20responses\x20TEXT\x20NOT\x20NULL\x20DEFAULT\x20\x27[]\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20rr_index\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200\x0a\x20\x20\x20\x20\x20\x20);'),warn('[filter]\x20created\x20filters_new\x20without\x20UNIQUE\x20as\x20fallback');}const _0xf24f3=await db['prepare'](_0x28382d(0x8a));try{for(const _0x287731 of _0x1801dd){const _0x433e87=JSON['stringify'](ensureArray(_0x287731['responses']||[]));try{await _0xf24f3['run'](_0x287731['trigger'],_0x287731[_0x28382d(0xad)],_0x433e87,_0x287731['created_by']||'',Number(_0x287731['created_at']||Math[_0x28382d(0x7d)](Date['now']()/0x3e8)));}catch(_0x1d2660){if('ImSHh'==='ImSHh')warn('[filter]\x20could\x20not\x20insert\x20normalized\x20row\x20'+_0x287731['chat_jid']+'@'+_0x287731['trigger']+':\x20'+(_0x1d2660?.['message']||_0x1d2660));else return _0x14eecf['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');}}}finally{try{await _0xf24f3['finalize']();}catch(_0xe7ecfd){}}try{const _0x2b788b=_0x28382d(0x66)+Math['floor'](Date[_0x28382d(0x6d)]()/0x3e8);await db['exec']('ALTER\x20TABLE\x20filters\x20RENAME\x20TO\x20'+_0x2b788b+';'),await db['exec'](_0x28382d(0xc9));try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_chat\x20ON\x20filters(chat_jid);');}catch(_0x42367a){warn('[filter]\x20post-swap\x20idx:\x20'+(_0x42367a?.['message']||_0x42367a));}try{await db['exec']('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_filters_unique\x20ON\x20filters(chat_jid,\x20trigger);');}catch(_0x47f7b0){warn('[filter]\x20post-swap\x20unique\x20idx:\x20'+(_0x47f7b0?.['message']||_0x47f7b0));}info('[filter]\x20migration\x20completed;\x20old\x20table\x20renamed\x20to\x20backup');}catch(_0x390c9d){warn('[filter]\x20swap\x20tables\x20failed:\x20'+(_0x390c9d?.['message']||_0x390c9d));throw _0x390c9d;}finally{await db['exec']('PRAGMA\x20foreign_keys\x20=\x20ON;');}}catch(_0x561370){if('TQlEx'==='sovNz')_0x1f74c5=_0x4e61da,_0x1aa6a4=_0xc6583f,_0x53fc36=_0x5b4a42['isArray'](_0x10a2f7)?_0x375c0b:[];else{error(_0x561370,'[filter]\x20ensureSchema\x20fatal');throw _0x561370;}}}function normalizeResponseValue(_0x34176d){const _0x2a2962=_0x564910;if(_0x34176d==null)return[];if(Array['isArray'](_0x34176d))return uniqArray(_0x34176d);if(typeof _0x34176d==='string'){const _0x7eaf9f=_0x34176d[_0x2a2962(0xae)]();if(_0x7eaf9f['startsWith']('['))try{if('hmaVC'===_0x2a2962(0x72)){const _0x2460d8=JSON['parse'](_0x7eaf9f);if(Array[_0x2a2962(0x76)](_0x2460d8))return uniqArray(_0x2460d8);}else _0x660dd6(_0x2a74a4['get'](_0x30e90e));}catch(_0x169fb8){}const _0x2b6ba3=_0x7eaf9f['split'](/\r?\n/)['map'](_0x59824f=>_0x59824f['trim']())[_0x2a2962(0xba)](Boolean),_0x399b6e=[];for(const _0x1eb686 of _0x2b6ba3){if('saBIR'!=='saBIR'){if(!_0x17af67)return;_0x574bea['has'](_0x1d0ee7)&&_0x1f4f82(_0x4cbd7e['get'](_0x150bdd));const _0x10029c=_0x18ae7e(()=>_0x83c29c['delete'](_0x27eb04),_0x7aaa5a);_0x38ddaf['set'](_0x569f93,_0x10029c);}else{if(_0x1eb686['startsWith']('!'))_0x399b6e['push'](_0x1eb686['slice'](0x1)[_0x2a2962(0xae)]());else _0x399b6e['push'](_0x1eb686);}}return uniqArray(_0x399b6e);}return[];}async function upsertFilterRow(_0x5da418,_0x23a243,_0x44eb9f,_0x1bd2f4){const _0x2e07d8=_0x564910,_0x465047={'tTBPD':function(_0x414e91,_0x416fa7){return _0x414e91||_0x416fa7;}};try{if('tlIav'!=='beGXy'){const _0x8f1ca4=Math[_0x2e07d8(0x7d)](Date['now']()/0x3e8),_0x56746b=JSON['stringify'](uniqArray(ensureArray(_0x44eb9f)['map'](_0x272e9b=>String(_0x272e9b)[_0x2e07d8(0xae)]())['filter'](Boolean)));await db['run']('INSERT\x20INTO\x20filters\x20(trigger,\x20chat_jid,\x20responses,\x20rr_index,\x20created_by,\x20created_at)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x200,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(chat_jid,\x20trigger)\x20DO\x20UPDATE\x20SET\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20responses\x20=\x20excluded.responses,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20rr_index\x20=\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20=\x20excluded.created_by,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20=\x20excluded.created_at;',[_0x23a243,_0x5da418,_0x56746b,_0x465047['tTBPD'](_0x1bd2f4,''),_0x8f1ca4]),info(_0x2e07d8(0xcd)+_0x23a243+'\x20@\x20'+_0x5da418);try{automatonCache['delete'](_0x5da418);}catch(_0x162c8e){}return!![];}else _0x130f88=_0x2d35b7;}catch(_0x54b4da){return error(_0x54b4da,_0x2e07d8(0x84)+_0x23a243+'\x20@\x20'+_0x5da418),![];}}async function deleteFilters(_0x2b814e,_0x485647){const _0x2b5acd=_0x564910,_0x63133e={'YmjHD':function(_0x2ed7eb,_0x10167d,_0x10d199){return _0x2ed7eb(_0x10167d,_0x10d199);},'jGCrp':function(_0x310164,_0x57de7f,_0x13686c){return _0x310164(_0x57de7f,_0x13686c);}};if(!Array[_0x2b5acd(0x76)](_0x485647)||_0x485647['length']===0x0)return 0x0;try{let _0x5be745=0x0;for(const _0xbd4a75 of _0x485647){if('Gzeum'!==_0x2b5acd(0xcb)){const _0x429b1c=await db['run']('DELETE\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20trigger\x20=\x20?',[_0x2b814e,_0xbd4a75]);if(_0x429b1c?.['changes'])_0x5be745+=_0x429b1c['changes'];info('[filter]\x20deleted\x20'+_0xbd4a75+'\x20@\x20'+_0x2b814e);}else return _0x63133e['YmjHD'](_0x9710b2,_0x1f8e44,'[filter]\x20upsertFilter\x20failed\x20for\x20'+_0x1bfa80+'\x20@\x20'+_0x91d576),![];}try{automatonCache['delete'](_0x2b814e);}catch(_0x2622f3){}return _0x5be745;}catch(_0x30753f){return _0x63133e['jGCrp'](error,_0x30753f,'[filter]\x20deleteFilters\x20failed\x20for\x20'+_0x2b814e),0x0;}}async function listTriggersForChat(_0x244cdc){try{const _0x14df61=await db['all']('SELECT\x20DISTINCT\x20trigger\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?\x20ORDER\x20BY\x20trigger',[_0x244cdc]);return(_0x14df61||[])['map'](_0x54453f=>_0x54453f['trigger']);}catch(_0x3143d4){return warn(_0x3143d4,'[filter]\x20listTriggersForChat\x20failed\x20for\x20'+_0x244cdc),[];}}async function pickResponseAndAdvance(_0x3ce4b3,_0x70b94e,_0x187a39=_0x564910(0x7a)){const _0x34ba25=_0x564910;try{const _0x1421fb=await db[_0x34ba25(0x68)](_0x34ba25(0x87),[_0x3ce4b3,_0x70b94e]);if(!_0x1421fb)return null;let _0x57cc25=[];try{_0x57cc25=JSON['parse'](_0x1421fb[_0x34ba25(0x78)]||'[]');}catch{_0x57cc25=ensureArray(_0x1421fb[_0x34ba25(0x78)]);}_0x57cc25=ensureArray(_0x57cc25);if(!_0x57cc25['length'])return null;if((_0x187a39||'')['toLowerCase']()==='random'){const _0x262657=Math[_0x34ba25(0x7d)](Math['random']()*_0x57cc25['length']);return _0x57cc25[_0x262657];}const _0x4f103d=Number(_0x1421fb['rr_index']||0x0),_0x172d78=_0x57cc25[_0x4f103d%_0x57cc25['length']];try{await db['run']('UPDATE\x20filters\x20SET\x20rr_index\x20=\x20(rr_index\x20+\x201)\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20trigger\x20=\x20?',[_0x3ce4b3,_0x70b94e]);}catch(_0x26be8e){warn(_0x34ba25(0xc5)+(_0x26be8e?.['message']||_0x26be8e));}return _0x172d78;}catch(_0x5a74c2){return warn('[filter]\x20pickResponseAndAdvance\x20error:\x20'+(_0x5a74c2?.['message']||_0x5a74c2)),null;}}function parseFilterCommandText(_0x2e3b58,_0x3a914c){const _0x82416f=_0x564910,_0x3c4f61={'dEnYQ':'DkCow'};if(!_0x2e3b58)return null;const _0xb5ea79=_0x2e3b58['split'](/\r?\n/)[_0x82416f(0x88)](_0x4c837c=>_0x4c837c[_0x82416f(0xa9)](/\r/g,''));if(!_0xb5ea79['length'])return null;let _0x51c2b7=_0xb5ea79[0x0]['trim']();if(_0x3a914c){if(Array['isArray'](_0x3a914c))for(const _0x34b602 of _0x3a914c){if('fWDLB'==='fWDLB'){if(_0x51c2b7['startsWith'](_0x34b602)){if(_0x3c4f61['dEnYQ']!=='qneZz'){_0x51c2b7=_0x51c2b7[_0x82416f(0x98)](_0x34b602['length'])['trim']();break;}else _0x4dfc24=null;}}else{if(!_0x1bc7f1)return[];if(_0x41c752['isArray'](_0x1e5b93))return _0x31cc97;return[_0x57d003(_0x1ea2ad)];}}else typeof _0x3a914c==='string'&&_0x51c2b7['startsWith'](_0x3a914c)&&(_0x51c2b7=_0x51c2b7['slice'](_0x3a914c['length'])['trim']());}const _0x1146d7=_0x51c2b7['split'](/\s+/);if(_0x1146d7[0x0][_0x82416f(0xc4)]()==='filter')_0x1146d7['shift']();const _0x216750=_0x1146d7['join']('\x20')['trim'](),_0x407b62=_0x216750?_0x216750['split'](',')['map'](_0x515b3e=>_0x515b3e[_0x82416f(0xae)]())['filter'](Boolean):[],_0x245de5=_0xb5ea79['slice'](0x1)['map'](_0x22bc86=>_0x22bc86['trim']())[_0x82416f(0xba)](Boolean)['filter'](_0x313918=>_0x313918['startsWith']('!'))[_0x82416f(0x88)](_0x43a663=>_0x43a663['slice'](0x1)['trim']())['filter'](Boolean);let _0x4b8a57=null;for(const _0x3a09f2 of _0xb5ea79['slice'](0x1)){const _0x2074c9=_0x3a09f2['trim']()['match'](/^gp[:\s]+(.+)$/i);if(_0x2074c9){_0x4b8a57=_0x2074c9[0x1]['trim']();break;}}if(!_0x4b8a57&&_0x216750){const _0x1dcd61=_0x216750['match'](/gp[:\s]+([^\s,]+)$/i);if(_0x1dcd61)_0x4b8a57=_0x1dcd61[0x1]['trim']();}return{'triggers':_0x407b62,'responses':_0x245de5,'gp':_0x4b8a57};}function getMessageText(_0x3d41f0){const _0xdb7518=_0x564910;if(!_0x3d41f0||!_0x3d41f0['message'])return'';const _0x1073e5=_0x3d41f0['message'];if(_0x1073e5['conversation'])return _0x1073e5['conversation'];if(_0x1073e5['extendedTextMessage']?.['text'])return _0x1073e5['extendedTextMessage']['text'];if(_0x1073e5[_0xdb7518(0xc3)]?.['caption'])return _0x1073e5[_0xdb7518(0xc3)][_0xdb7518(0xb2)];if(_0x1073e5['videoMessage']?.['caption'])return _0x1073e5['videoMessage']['caption'];if(_0x1073e5['buttonsResponseMessage']?.['selectedButtonId'])return _0x1073e5['buttonsResponseMessage']['selectedButtonId'];if(_0x1073e5['listResponseMessage']?.['singleSelectReply']?.['selectedRowId'])return _0x1073e5['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}const processedMessageKeys=new Map(),DEDUPE_TTL_MS=0x1e*0x3e8;function makeDedupeKey(_0x147db0){const _0x5983e3=_0x564910,_0x3e63e4=_0x147db0?.['key'];if(!_0x3e63e4)return null;const _0x5ae9ac=_0x3e63e4['id']||_0x3e63e4?.[_0x5983e3(0xb8)]||'',_0x1ad019=_0x3e63e4['remoteJid']||'';return _0x1ad019+'::'+_0x5ae9ac;}function isProcessed(_0x42f0dd){const _0x5d5c2c=_0x564910;return _0x42f0dd&&processedMessageKeys[_0x5d5c2c(0xa0)](_0x42f0dd);}function _0x1048(){const _0x10fdf9=['u0vmrunuihjLC3bVBNnLCYWGCNjFAw5KzxGGrLjptsbMAwX0zxjZifDirvjfignOyxrFAMLKid0GpYbbtKqGDhjPz2DLCIa9id8GteLnsvqGmq','BwfW','zMLUza','su5trvjuieLove8GzMLSDgvYC19UzxCGkhrYAwDNzxiSignOyxrFAMLKlcbYzxnWB25ZzxmSihjYx2LUzgv4lcbJCMvHDgvKx2j5lcbJCMvHDgvKx2f0ksbwquXvrvmGkd8Sid8Sid8SidaSid8Sid8P','B2fuzhq','mty3n1DhvgzdAW','ChvZAa','yM9KEq','C2vUze1LC3nHz2u','C2HPzNq','ufjfrKLy','zNjVBq','t3DJue0','mZjID0Dks0G','mti2ntu5nLnYAe1rwG','Aw5JBhvKzxm','AMLK','C2XPy2u','q1jfqvrfifrbqKXfieLgie5pvcbfweLtvfmGzMLSDgvYC19UzxCGkaOGicaGicaGigLKieLovevhrviGufjjtufswsblrvKGqvvut0Loq1jftuvovcWkicaGicaGicb0CMLNz2vYifrfwfqGtK9uie5vteWScIaGicaGicaGy2HHDf9QAwqGvevyvcbot1qGtLvmtcWkicaGicaGicbYzxnWB25ZzxmGvevyvcbot1qGtLvmtcberuzbvuXuicDBxsCScIaGicaGicaGCNjFAw5KzxGGsu5uruDfuIberuzbvuXuidaScIaGicaGicaGy3jLyxrLzf9IEsburvHuierfrKfvtfqGjYCScIaGicaGicaGy3jLyxrLzf9HDcbjtLrfr0vsierfrKfvtfqGmcWkicaGicaGicbvtKLrvuuOy2HHDf9QAwqSihrYAwDNzxiPcIaGicaGicK7','vxnHz2u6igrLBgzPBhrLCIb0CMLNz2vYmsX0CMLNz2vYmIbBz3aGcIaGicaGicaGpgDYB3vWs2v5pL0','w2zPBhrLCL0GAxnHzg1PBIbJAgvJAYbMywLSzwq','y3jLyxrLzf9IEq','CMvNzxG6','ywreB1m','ms41lJa','AgfZ','mtaYodC4nuzesvrODG','w2zPBhrLCL0GAw5PDgLHBgL6zwq','m210qLLkEG','B2jQzwn0','q09ntuforf9quKvgsvG','su5uruDfuIbquKLnqvjzieTfwsbbvvrpsu5duKvnru5u','mtaWtg1RwK5A','laOGicaGicaGicaGvu5juvvfkgnOyxrFAMLKlcb0CMLNz2vYkqOGicaGicaGicK7cIaGicaGia','CMvWBgfJzq','rKLmvevsuW','DgLTzxn0yw1W','CMvZCg9UC2u','y2HHDf9QAwq','DhjPBq','q291BgqGBM90ihjLC29SDMuGEw91CIbKzwzHDwX0ignVBM5Ly3rPB24GjW','tM90AwnLoIaNz3aNihbHCMfTzxrLCIbPCYbPz25VCMvKlIbezwXLDgLUzYbMCM9TihLVDxiGzgvMyxvSDcbJB25Uzwn0Aw9UoIa','C29JAW','y2fWDgLVBG','C2vUzfbYzxnLBMnLvxbKyxrL','CMvWBhK','Bwf4','w2zPBhrLCL0GC2vUzfrLEhqGzMfPBgvKihrVia','mJCZmtyXsLvdyw9A','CgfYDgLJAxbHBNq','q1jfqvrfieLorevyieLgie5pvcbfweLtvfmGAwr4x2zPBhrLCNnFy2HHDcbptIbMAwX0zxjZkgnOyxrFAMLKktS','zMLSDgvY','w2zPBhrLCL0Gy291BgqGBM90igLUC2vYDcbUB3jTywXPEMvKihjVDYa','r1LyBxi','A2v5','BM9Kzxm','cIaGicaGicaGq1jfqvrfifrbqKXfigzPBhrLCNmGkaOGicaGicaGicaG','C3vIC3rYAw5N','Dgv4Da','mteYmZm2nZbOAe1nwwy','Aw1Hz2vnzxnZywDL','Dg9mB3DLCKnHC2u','w2zPBhrLCL0GCNjFAw5KzxGGAw5JCMvTzw50igzHAwXLzdOG','BgvUz3rO','B3v0Chv0','zw5KC1DPDgG','quXurviGvefcteuGzMLSDgvYC19UzxCGuKvoqu1fifrpigzPBhrLCNm7','BwvUDgLVBNm','rM5qALq','q1jfqvrfifvosvfvrsbjtKrfwcbjrIbot1qGrvHju1rtigLKEf9MAwX0zxjZx3vUAxf1zsbptIbMAwX0zxjZkgnOyxrFAMLKlcb0CMLNz2vYktS','w2zPBhrLCL0GDxbZzxj0rMLSDgvYoIa','DgLTzq','ywXS','su5uruDfuIberuzbvuXuida','DgvZDa','BwvZC2fNzq','u2f2zwqG','DMfSDwvZ','yxjurvm','DhjPz2DLCNm','A2v5CW','Cgz1uLi','zMLSDgvYC19IywnRDxbF','CvvTCM4','z2v0','z2DLCG','Cgf1C2vK','BMv4Da','vfLqsu5hx1njtv9nuW','BM93','u0vmrunuig5HBwuGrLjptsbZCwXPDgvFBwfZDgvYifDirvjfihr5Cgu9j3rHyMXLjYbbtKqGBMfTzt0/','w2zPBhrLCL0Gz2v0qxv0B21HDg9UrM9Yq2HHDcbMywLSzwqGzM9Yia','y3jLyxrVCG','zMLSDgvYCW','Ag1HvKm','zxHLyW','yxbWBhK','zNvUy3rPB24GkLWOicPCkq','AxnbCNjHEq','C2vHCMnO','CMvZCg9UC2vZ','xhCQ','CM91BMrYB2jPBG','mZeYoda2n0n5re53Ba','y3jLyxrLzf9HDa','zMXVB3i','C3rYAw5N','yu96rfi','DMfSDwu','mJi4mtuYngvotNz6sG','zMfPBa','vevyvcbot1qGtLvmta','w2zPBhrLCL0GDxbZzxj0rMLSDgvYigzHAwXLzcbMB3iG','y2HHDgLK','A2v5D29Yza'];_0x1048=function(){return _0x10fdf9;};return _0x1048();}function markProcessed(_0x22fa6b){const _0x2cd40a=_0x564910;if(!_0x22fa6b)return;if(processedMessageKeys['has'](_0x22fa6b)){if('cCFSg'==='cCFSg')clearTimeout(processedMessageKeys['get'](_0x22fa6b));else{const _0x22cfd5=_0x3420fb(_0x110543)['trim']()[_0x2cd40a(0xc4)]();if(_0x22cfd5['startsWith']('regex:'))return![];if(_0x3c044e['includes']('*'))return![];return!![];}}const _0x5a8946=setTimeout(()=>processedMessageKeys['delete'](_0x22fa6b),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x22fa6b,_0x5a8946);}class Aho{constructor(){const _0x5d817b=_0x564910;this[_0x5d817b(0xbe)]=[{'next':Object['create'](null),'fail':0x0,'output':[]}];}['build'](_0x1f95cc){const _0x4ad8ca=_0x564910,_0x942329={'zrBUw':function(_0xc1c0b4,_0x8dce40){return _0xc1c0b4===_0x8dce40;}};this['nodes']=[{'next':Object['create'](null),'fail':0x0,'output':[]}];for(const _0x4ef5aa of _0x1f95cc){let _0x1599e7=0x0;for(let _0x3a1fbf=0x0;_0x3a1fbf<_0x4ef5aa[_0x4ad8ca(0xc6)];_0x3a1fbf++){const _0x1aed9c=_0x4ef5aa[_0x3a1fbf];if(!this[_0x4ad8ca(0xbe)][_0x1599e7]['next'][_0x1aed9c]){if(_0x942329['zrBUw']('dlCxv',_0x4ad8ca(0xd5))){const _0x72e520=_0x1d1970['match'](/gp[:\s]+([^\s,]+)$/i);if(_0x72e520)_0x4d7bfd=_0x72e520[0x1][_0x4ad8ca(0xae)]();}else this['nodes'][_0x1599e7]['next'][_0x1aed9c]=this[_0x4ad8ca(0xbe)]['length'],this['nodes'][_0x4ad8ca(0x8d)]({'next':Object['create'](null),'fail':0x0,'output':[]});}_0x1599e7=this['nodes'][_0x1599e7]['next'][_0x1aed9c];}this[_0x4ad8ca(0xbe)][_0x1599e7]['output']['push'](_0x4ef5aa);}const _0x5e1afc=[];for(const _0x1a91b8 in this['nodes'][0x0]['next']){const _0x58f2da=this[_0x4ad8ca(0xbe)][0x0]['next'][_0x1a91b8];this['nodes'][_0x58f2da]['fail']=0x0,_0x5e1afc['push'](_0x58f2da);}while(_0x5e1afc['length']){const _0x2eb573=_0x5e1afc['shift']();for(const _0xa6b242 in this[_0x4ad8ca(0xbe)][_0x2eb573]['next']){const _0x150f10=this['nodes'][_0x2eb573]['next'][_0xa6b242];let _0xbe2371=this[_0x4ad8ca(0xbe)][_0x2eb573]['fail'];while(_0xbe2371&&!this['nodes'][_0xbe2371]['next'][_0xa6b242])_0xbe2371=this['nodes'][_0xbe2371]['fail'];if(this['nodes'][_0xbe2371]['next'][_0xa6b242])this['nodes'][_0x150f10]['fail']=this['nodes'][_0xbe2371]['next'][_0xa6b242];else this['nodes'][_0x150f10]['fail']=0x0;this['nodes'][_0x150f10]['output']['push'](...this[_0x4ad8ca(0xbe)][this['nodes'][_0x150f10]['fail']]['output']),_0x5e1afc['push'](_0x150f10);}}}[_0x564910(0x77)](_0x382c80){const _0x20824a=_0x564910,_0x3fc65b=[];let _0x439dd8=0x0;for(let _0x3dc8c7=0x0;_0x3dc8c7<_0x382c80['length'];_0x3dc8c7++){const _0x5bb8ba=_0x382c80[_0x3dc8c7];while(_0x439dd8&&!this[_0x20824a(0xbe)][_0x439dd8]['next'][_0x5bb8ba])_0x439dd8=this['nodes'][_0x439dd8]['fail'];if(this['nodes'][_0x439dd8][_0x20824a(0x6b)][_0x5bb8ba])_0x439dd8=this['nodes'][_0x439dd8]['next'][_0x5bb8ba];else _0x439dd8=0x0;if(this['nodes'][_0x439dd8]['output']['length'])for(const _0x38d9e5 of this['nodes'][_0x439dd8]['output']){_0x3fc65b['push']({'keyword':_0x38d9e5,'index':_0x3dc8c7-_0x38d9e5['length']+0x1});}}return _0x3fc65b;}}const automatonCache=new Map();async function getAutomatonForChat(_0x34e3f5){const _0x5bb7bb=_0x564910;if(!_0x34e3f5)return null;if(automatonCache['has'](_0x34e3f5))return automatonCache['get'](_0x34e3f5);try{const _0x233ab2=await db[_0x5bb7bb(0xcf)]('SELECT\x20DISTINCT\x20trigger\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?',[_0x34e3f5]),_0x102a8a=(_0x233ab2||[])['map'](_0x249c75=>String(_0x249c75['trigger']||'')['trim']())[_0x5bb7bb(0xba)](Boolean),_0x2c5852=_0x102a8a['filter'](_0x11f7c4=>{const _0x2f3d18=String(_0x11f7c4)['trim']()['toLowerCase']();if(_0x2f3d18['startsWith']('regex:'))return![];if(_0x11f7c4['includes']('*'))return![];return!![];}),_0x18ba1d=_0x2c5852['map'](_0x8b1c27=>_0x8b1c27['toLowerCase']()),_0x76e8b1=new Aho();if(_0x18ba1d['length'])_0x76e8b1['build'](_0x18ba1d);const _0x13244e={'ac':_0x76e8b1,'keywords':_0x18ba1d,'normalSet':new Set(_0x18ba1d)};return automatonCache['set'](_0x34e3f5,_0x13244e),_0x13244e;}catch(_0x2a4bf3){return warn(_0x5bb7bb(0x6f)+_0x34e3f5+':\x20'+(_0x2a4bf3?.['message']||_0x2a4bf3)),null;}}export async function initialize(_0x1a7000){const _0x3480de=_0x564910;botRef=_0x1a7000;if(botRef){if(typeof botRef['sendMessage']==='function')sendApi=async(_0x1516c4,_0x743fe3)=>await botRef['sendMessage'](_0x1516c4,_0x743fe3);else botRef['sock']&&typeof botRef[_0x3480de(0xb1)]['sendMessage']==='function'?sendApi=async(_0x293f2c,_0x56e920)=>await botRef['sock'][_0x3480de(0x8f)](_0x293f2c,_0x56e920):sendApi=null;}try{await ensureSchema(),info(_0x3480de(0xa2));}catch(_0x16c665){error(_0x16c665,'[filter]\x20initialize\x20fatal');throw _0x16c665;}}function detectCommandNameFromCmdText(_0x2e5cdd){const _0x35bf82=_0x564910;if(!_0x2e5cdd)return null;const _0x2eb62a=_0x2e5cdd[_0x35bf82(0xae)]();if(!_0x2eb62a)return null;return _0x2eb62a['split'](/\s+/)[0x0]['toLowerCase']();}export async function onMessage(_0x4ff4d3){const _0x29b94c=_0x564910,_0x335422={'njGKg':'string','rfCQU':function(_0x48ceaf,_0x387f72){return _0x48ceaf(_0x387f72);},'gpXVc':function(_0x98292f,_0x29b8eb){return _0x98292f(_0x29b8eb);},'iqaGv':function(_0x416ed6,_0x3d6fcf,_0x7065dd){return _0x416ed6(_0x3d6fcf,_0x7065dd);},'IkVqH':function(_0x5769aa){return _0x5769aa();},'qUmrn':function(_0x2b99dd,_0x1024d8){return _0x2b99dd+_0x1024d8;},'jsFKi':'piVeU','xkLqP':'regex:','DJfgD':function(_0x2ed878,_0x4deec1){return _0x2ed878===_0x4deec1;},'kdPgg':_0x29b94c(0xa4),'OwcPM':function(_0x37f390,_0x2b0ba0){return _0x37f390===_0x2b0ba0;},'veikv':function(_0x1e7fb3,_0x49954c){return _0x1e7fb3>_0x49954c;},'mOxWM':_0x29b94c(0x9e),'ulmFA':'JXmNf','GWRdN':_0x29b94c(0xbc)};try{if(!_0x4ff4d3||!_0x4ff4d3[_0x29b94c(0xbd)]||!_0x4ff4d3['message'])return;const _0x38a250=makeDedupeKey(_0x4ff4d3);if(isProcessed(_0x38a250))return;markProcessed(_0x38a250);const _0x2ba98a=getMessageText(_0x4ff4d3);if(!_0x2ba98a)return;const _0x37ab7c=_0x4ff4d3['key']['remoteJid'],_0x3cb71b=typeof _0x37ab7c==='string'&&_0x37ab7c[_0x29b94c(0xc8)]('@g.us'),_0x4df300=_0x4ff4d3['key']&&(_0x4ff4d3['key']['participant']||_0x4ff4d3['key']['from']||_0x4ff4d3['key']['remoteJid'])||'',_0x28ae3d=(_0x4df300||'')['split']('@')[0x0];let _0xc9929f=![];if(_0x3cb71b)try{_0xc9929f=await isadmin(botRef,_0x4ff4d3);}catch(_0x72004d){warn(_0x29b94c(0x9b)),_0xc9929f=![];}if(_0x4ff4d3['isCommand']){if(!_0x3cb71b)return;if(!_0xc9929f)return;const _0x50e39c=typeof _0x4ff4d3[_0x29b94c(0xc1)]==='string'&&_0x4ff4d3['text']['trim']()['length']?_0x4ff4d3['text']['trim']():_0x2ba98a['trim'](),_0x5e1d21=_0x335422['rfCQU'](detectCommandNameFromCmdText,_0x50e39c);if(!_0x5e1d21)return;const _0x4980c3=_0x37ab7c,_0x2958e2=await getDefault(_0x28ae3d)['catch'](()=>null);if(!_0x2958e2){await sendText(_0x4980c3,'No\x20default\x20connection/group\x20is\x20set\x20for\x20you.\x20Commands\x20must\x20apply\x20to\x20your\x20DEFAULT\x20group.\x20Set\x20with:\x20/setdefault\x20\x0a<connectionName>');return;}const _0x322be4=await _0x335422['gpXVc'](getConnection,_0x2958e2)['catch'](()=>null);if(!_0x322be4){await sendText(_0x4980c3,_0x29b94c(0xaf)+_0x2958e2+'\x27.\x20Please\x20check\x20/setdefault\x20value.');return;}if(_0x5e1d21==='filter'){const _0x543a89=getConfig()||{},_0x3a3b3a=parseFilterCommandText(_0x50e39c||_0x2ba98a,_0x543a89['COMMAND_PREFIX']??_0x543a89['PREFIX']??null);if(!_0x3a3b3a||!_0x3a3b3a['triggers']['length']||!_0x3a3b3a['responses']['length']){await _0x335422['iqaGv'](sendText,_0x4980c3,'Usage\x20(multiline,\x20group-only):\x0afilter\x20\x0a\x20\x20\x20\x20<trigger1,trigger2>\x0a!response1\x0a!response2\x0aNOTE:\x20Commands\x20always\x20apply\x20to\x20your\x20default\x20connection\x20—\x20set\x20it\x20with\x20/setdefault.');return;}_0x3a3b3a['gp']&&await sendText(_0x4980c3,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20the\x20command\x20is\x20ignored.\x20Filters\x20will\x20be\x20saved\x20to\x20your\x20default\x20connection:\x20'+_0x322be4);let _0x4bb8a0=0x0;for(const _0x4a579e of _0x3a3b3a[_0x29b94c(0xd6)]){const _0x50a99d=await upsertFilterRow(_0x322be4,_0x4a579e,_0x3a3b3a[_0x29b94c(0x78)],_0x4df300||'');if(_0x50a99d)_0x4bb8a0++;}await sendText(_0x4980c3,_0x29b94c(0xd3)+_0x4bb8a0+'/'+_0x3a3b3a['triggers']['length']+'\x20filter(s)\x20to\x20your\x20default\x20connection:\x20'+_0x322be4);return;}if(_0x5e1d21==='listfilter'){const _0x577d06=_0x335422['IkVqH'](getConfig)||{},_0x2b1e95=_0x577d06[_0x29b94c(0xa5)]??_0x577d06[_0x29b94c(0x91)]??null,_0x78eda7=(_0x2ba98a||'')['split'](/\r?\n/)['map'](_0x5436f8=>_0x5436f8['trim']());let _0x501b67=null;if(_0x78eda7['length']>0x1){const _0x3626d4=_0x78eda7[_0x29b94c(0x98)](0x1)['find'](_0x269dc6=>/^gp[:\s]/i['test'](_0x269dc6));if(_0x3626d4)_0x501b67=_0x3626d4['replace'](/^gp[:\s]+/i,'')['trim']();}else{const _0x40479f=(_0x50e39c||_0x2ba98a)['trim']()['split'](/\s+/);if(_0x40479f['length']>=0x2&&_0x40479f[0x1]['toLowerCase']()==='gp'&&_0x40479f[0x2])_0x501b67=_0x40479f[0x2];else{if(_0x40479f['length']>=0x2&&_0x40479f[0x1]['includes']('@'))_0x501b67=_0x40479f[0x1];}}_0x501b67&&await sendText(_0x4980c3,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Listing\x20filters\x20for\x20your\x20default\x20connection:\x20'+_0x322be4);const _0x53c3d7=await listTriggersForChat(_0x322be4);await sendText(_0x4980c3,'[filter]\x20loaded\x20'+_0x53c3d7['length']+'\x20filters\x20for\x20your\x20default\x20connection:\x20'+_0x322be4);if(!_0x53c3d7['length'])return;let _0x46d83b='';for(const _0x40bc23 of _0x53c3d7){const _0x422649='•\x20'+_0x40bc23+'\x0a';_0x335422[_0x29b94c(0x67)](_0x46d83b,_0x422649)['length']>0x5dc&&(await sendText(_0x4980c3,_0x46d83b['trim']()),_0x46d83b=''),_0x46d83b+=_0x422649;}if(_0x46d83b['trim']())await sendText(_0x4980c3,_0x46d83b['trim']());return;}if(_0x5e1d21==='delfilter'||_0x5e1d21==='delfilters'||_0x5e1d21==='delf'){const _0x2fb515=(_0x2ba98a||'')['split'](/\r?\n/)['map'](_0x2a9818=>_0x2a9818['trim']());let _0x55072d=null;if(_0x2fb515['length']>0x1&&!_0x2fb515[0x1]['toLowerCase']()['startsWith']('gp'))_0x55072d=_0x2fb515[0x1];else{const _0x4ed29f=(_0x50e39c||_0x2ba98a)['trim']()['split'](/\s+/);_0x4ed29f[_0x29b94c(0x90)](),_0x55072d=_0x4ed29f['join']('\x20')['trim']();}const _0x1d8929=_0x2fb515['slice'](0x1)['find'](_0x55ae01=>/^gp[:\s]/i['test'](_0x55ae01));let _0xd886dd=_0x1d8929?_0x1d8929['replace'](/^gp[:\s]+/i,'')[_0x29b94c(0xae)]():null;const _0x45efc0=(_0x55072d||'')['split'](',')['map'](_0x760f9d=>_0x760f9d[_0x29b94c(0xae)]())['filter'](Boolean);if(!_0x45efc0['length']){if(_0x335422['jsFKi']==='dCXBa'){const _0x77fe13=this['nodes'][0x0]['next'][_0x41f3e7];this['nodes'][_0x77fe13][_0x29b94c(0x82)]=0x0,_0x1b6a57['push'](_0x77fe13);}else{await sendText(_0x4980c3,_0x29b94c(0x9a));return;}}_0xd886dd&&await sendText(_0x4980c3,_0x29b94c(0xb0)+_0x322be4);const _0xfa927a=await deleteFilters(_0x322be4,_0x45efc0);await sendText(_0x4980c3,'Deleted\x20'+_0xfa927a+'/'+_0x45efc0['length']+'\x20filter(s)\x20from\x20your\x20default\x20connection:\x20'+_0x322be4);return;}return;}if(_0x3cb71b){if(_0x4ff4d3['key']['fromMe'])return;const _0x3fbda0=_0x37ab7c,_0x3ceda0=getMessageText(_0x4ff4d3);if(!_0x3ceda0)return;const _0xc467a2=String(_0x3ceda0||''),_0x2c2222=await db['all']('SELECT\x20DISTINCT\x20trigger\x20FROM\x20filters\x20WHERE\x20chat_jid\x20=\x20?',[_0x3fbda0]);if(!_0x2c2222||_0x2c2222['length']===0x0)return;const _0x34656a=(_0x2c2222||[])['map'](_0x5b53e5=>String(_0x5b53e5['trigger']||'')['trim']())['filter'](Boolean),_0x564980=[],_0x546315=[],_0xeb8428=[];for(const _0x5e1009 of _0x34656a){const _0x131aa4=String(_0x5e1009)['trim']()['toLowerCase']();if(_0x131aa4['startsWith'](_0x335422['xkLqP'])){if(_0x335422['DJfgD']('pUYZI','pUYZI')){const _0x5986d1=_0x5e1009[_0x29b94c(0xc0)](0x6);_0xeb8428['push'](_0x5986d1);continue;}else{const _0x183a4f=['chat_jid','chatid','chat_id',_0x29b94c(0x97),'chat','room'];for(const _0x47d216 of _0x183a4f)if(_0x47d216 in _0x3eb79f&&_0x833c0a[_0x47d216])return _0x28ed77(_0x409080[_0x47d216]);for(const _0x2ce27d of _0x14271a['keys'](_0x1d1d4f)){const _0x23a042=_0xe0077[_0x2ce27d];if(typeof _0x23a042===_0x335422['njGKg']&&_0x23a042[_0x29b94c(0x96)]('@'))return _0x23a042;}return null;}}if(_0x5e1009['includes']('*')){_0x546315['push'](_0x5e1009);continue;}_0x564980['push'](_0x5e1009);}const _0x308a2d=new Set(),_0x5b19ca=getConfig()||{},_0x18e9db=_0x5b19ca[_0x29b94c(0xaa)]&&typeof _0x5b19ca['FILTERS']===_0x335422['kdPgg']?_0x5b19ca[_0x29b94c(0xaa)]:{},_0x3e9336=(_0x18e9db['RESPONSE_MODE']||'roundrobin')['toLowerCase']();let _0x4d2060=null;if(_0x564980['length']>0x0)try{const _0x53c954=await getAutomatonForChat(_0x3fbda0);if(_0x53c954&&_0x53c954['ac']&&_0x53c954['keywords']&&_0x53c954['keywords']['length']){const _0x59fc93=_0xc467a2[_0x29b94c(0xc4)](),_0x22ff6e=_0x53c954['ac']['search'](_0x59fc93);for(const _0x43e16c of _0x22ff6e){const _0x4a1e24=_0x43e16c[_0x29b94c(0x86)],_0x2978c5=_0x43e16c['index'],_0x54eeee=_0x2978c5+_0x4a1e24['length'],_0x59b8d7=_0x2978c5===0x0||!/\w/[_0x29b94c(0xd1)](_0x59fc93[_0x2978c5-0x1]),_0x2aa209=_0x335422[_0x29b94c(0x93)](_0x54eeee,_0x59fc93[_0x29b94c(0xc6)])||!/\w/['test'](_0x59fc93[_0x54eeee]);if(_0x59b8d7&&_0x2aa209){const _0x9cefba=_0x564980[_0x29b94c(0x89)](_0x92c2a3=>_0x92c2a3['toLowerCase']()===_0x4a1e24);if(_0x9cefba){_0x4d2060=_0x9cefba;break;}}}}else{const _0x35140b=_0xc467a2[_0x29b94c(0xc4)]();for(const _0x41aa37 of _0x564980){const _0x4ba279=new RegExp('\x5cb'+_0x335422['rfCQU'](escapeRegex,String(_0x41aa37))+'\x5cb','i');if(_0x4ba279['test'](_0xc467a2)){_0x4d2060=_0x41aa37;break;}}}}catch(_0x1ef888){if('udHeT'==='udHeT'){warn('[filter]\x20AhoCorasick\x20matching\x20failed:\x20'+(_0x1ef888?.[_0x29b94c(0xd2)]||_0x1ef888));for(const _0x497d36 of _0x564980){try{const _0x2be8f2=new RegExp('\x5cb'+escapeRegex(String(_0x497d36))+'\x5cb','i');if(_0x2be8f2['test'](_0xc467a2)){_0x4d2060=_0x497d36;break;}}catch(_0x346900){}}}else _0x339bfd('[filter]\x20unique\x20idx:\x20'+(_0x4de9c0?.[_0x29b94c(0xd2)]||_0x2eb9ff));}if(!_0x4d2060&&_0x335422['veikv'](_0x546315['length'],0x0))for(const _0x4d25b5 of _0x546315){try{const _0x208118=new RegExp(wildcardToRegexPattern(_0x4d25b5),'i');if(_0x208118['test'](_0xc467a2)){_0x4d2060=_0x4d25b5;break;}}catch(_0x80fea7){if(_0x335422['mOxWM']===_0x335422['ulmFA'])_0x4f2b27(_0x11230b);else{if(_0xc467a2[_0x29b94c(0xc4)]()['includes'](_0x4d25b5['replace'](/\*/g,'')['toLowerCase']())){_0x4d2060=_0x4d25b5;break;}}}}if(!_0x4d2060&&_0xeb8428['length']>0x0)for(const _0x48a5aa of _0xeb8428){try{const _0x45db18=new RegExp(_0x48a5aa,'i');if(_0x45db18[_0x29b94c(0xd1)](_0xc467a2)){_0x4d2060=_0x29b94c(0x9d)+_0x48a5aa;break;}}catch(_0x2e4f68){if('oxZmc'!==_0x335422['GWRdN'])warn('[filter]\x20invalid\x20stored\x20regex\x20for\x20chat\x20'+_0x3fbda0+':\x20\x22'+_0x48a5aa+'\x22\x20-\x20'+(_0x2e4f68?.['message']||_0x2e4f68));else{const _0x5f1d0d=_0x43363a(_0x146468);if(!_0x5957fd['isFinite'](_0x5f1d0d)||_0x5120af(_0x5f1d0d))return 0x0;if(_0x5f1d0d<=0x0)return 0x0;if(_0x5f1d0d>0x3a98)return 0x3a98;return _0x1fcbb7['floor'](_0x5f1d0d);}}}if(_0x4d2060){let _0x482d0c=_0x4d2060;!_0x4d2060[_0x29b94c(0xc4)]()['startsWith']('regex:')?_0x482d0c=_0x4d2060:_0x482d0c=_0x4d2060;const _0x365479=await pickResponseAndAdvance(_0x3fbda0,_0x482d0c['replace'](/\s+$/,''),_0x3e9336);if(!_0x365479)return;if(_0x308a2d['has'](_0x365479))return;await sendText(_0x4ff4d3,_0x3fbda0,_0x365479),_0x308a2d['add'](_0x365479);}}}catch(_0x1dd306){error(_0x1dd306,'[filter]\x20Handler\x20error:\x20'+(_0x1dd306?.['message']||_0x1dd306));}}export async function cleanup(){const _0x1202bc={'gozCf':function(_0x457efc,_0x4496e5){return _0x457efc(_0x4496e5);}};for(const _0x48f4d9 of processedMessageKeys['values']())try{_0x1202bc['gozCf'](clearTimeout,_0x48f4d9);}catch(_0x4f00f3){}processedMessageKeys['clear'](),automatonCache['clear'](),botRef=null,sendApi=null,info('[filter]\x20cleaned\x20up');}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x15b38c(_0x2b5a71){const _0x15b020=_0x564910,_0x2245ce={'WzePR':'gger'};function _0x4de8a0(_0x560c2b){const _0x58ab2e=_0x5ce6;if(typeof _0x560c2b==='string')return function(_0x1860e3){}['constructor']('while\x20(true)\x20{}')['apply']('counter');else(''+_0x560c2b/_0x560c2b)[_0x58ab2e(0xc6)]!==0x1||_0x560c2b%0x14===0x0?function(){return!![];}['constructor']('debu'+_0x58ab2e(0x69))['call']('action'):function(){return![];}['constructor']('debu'+_0x2245ce['WzePR'])['apply']('stateObject');_0x4de8a0(++_0x560c2b);}try{if('PzrME'!=='xUEjp'){if(_0x2b5a71)return _0x4de8a0;else _0x4de8a0(0x0);}else{let _0x5e6443=0x0;for(let _0x25ba8d=0x0;_0x25ba8d<_0x1c91b1['length'];_0x25ba8d++){const _0x317407=_0x2c4b86[_0x25ba8d];!this['nodes'][_0x5e6443]['next'][_0x317407]&&(this['nodes'][_0x5e6443]['next'][_0x317407]=this['nodes']['length'],this['nodes']['push']({'next':_0x19287f['create'](null),'fail':0x0,'output':[]})),_0x5e6443=this['nodes'][_0x5e6443]['next'][_0x317407];}this['nodes'][_0x5e6443][_0x15b020(0xc7)]['push'](_0x8cc575);}}catch(_0x1a015e){}}