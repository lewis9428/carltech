const _0xdb080c=_0xc533;(function(_0x10a875,_0x3d8c32){const _0xd1f727=_0xc533,_0xdbc394=_0x10a875();while(!![]){try{const _0x239aad=-parseInt(_0xd1f727(0x10f))/0x1*(-parseInt(_0xd1f727(0x18a))/0x2)+-parseInt(_0xd1f727(0x10e))/0x3+-parseInt(_0xd1f727(0x181))/0x4*(parseInt(_0xd1f727(0x117))/0x5)+-parseInt(_0xd1f727(0x179))/0x6*(parseInt(_0xd1f727(0x153))/0x7)+parseInt(_0xd1f727(0x123))/0x8*(-parseInt(_0xd1f727(0x168))/0x9)+parseInt(_0xd1f727(0x10b))/0xa+-parseInt(_0xd1f727(0x132))/0xb*(-parseInt(_0xd1f727(0x119))/0xc);if(_0x239aad===_0x3d8c32)break;else _0xdbc394['push'](_0xdbc394['shift']());}catch(_0x464824){_0xdbc394['push'](_0xdbc394['shift']());}}}(_0x1984,0xa5060));const _0x39243b=(function(){let _0x365048=!![];return function(_0x21f8a2,_0x4b67bf){const _0x25f63e=_0x365048?function(){if(_0x4b67bf){const _0x440d41=_0x4b67bf['apply'](_0x21f8a2,arguments);return _0x4b67bf=null,_0x440d41;}}:function(){};return _0x365048=![],_0x25f63e;};}());(function(){const _0x1c1ccb=_0xc533,_0x38cb78={'nVxad':'init','PFhGQ':'input','AgggG':_0x1c1ccb(0x14c)};_0x39243b(this,function(){const _0xbd5e63=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x29c49f=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x53e6bf=_0x3c1986(_0x38cb78['nVxad']);if(!_0xbd5e63['test'](_0x53e6bf+'chain')||!_0x29c49f['test'](_0x53e6bf+_0x38cb78['PFhGQ'])){if(_0x38cb78['AgggG']!=='IdRWT')return async(_0x273dc8,_0x317497)=>_0x565ce5['sock']['sendMessage'](_0x273dc8,_0x317497);else _0x53e6bf('0');}else _0x3c1986();})();}());import{DateTime}from'luxon';import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{getDefault,getConnection}from'../utils/connection.js';import{isadmin}from'../utils/isadmin.js';export const name='sched';export const version='2.3.3';export const priority=0x55;export const commands=['sched','schedule'];export const configKeys=[_0xdb080c(0x192),'SCHED_DEFAULT_TIMEZONE','SCHED_SEND_RETRIES','SCHED_INITIAL_BACKOFF_MS'];let botRef=null,sendApi=null,lastSockIdentity=null,attachWatcherInterval=null,sockMonitorInterval=null,connectionUpdateHandler=null,schedulerIntervalHandle=null,executorRunning=![],CHECK_INTERVAL_MS=0x3c*0x3e8,DEFAULT_TIMEZONE='Africa/Nairobi',SEND_RETRIES=0x3,INITIAL_BACKOFF_MS=0x1f4;(function(){const _0x4da177=_0xdb080c,_0x46f747={'KxTxF':_0x4da177(0x167)};let _0x5c45a9;try{const _0x742703=Function(_0x4da177(0x172)+_0x46f747['KxTxF']+');');_0x5c45a9=_0x742703();}catch(_0x5ef084){_0x5c45a9=window;}_0x5c45a9['setInterval'](_0x3c1986,0x61a80);}());async function tableExists(_0x1f6a1c){const _0x570bfa=_0xdb080c;try{const _0x122cf8=await db['get']('SELECT\x20name\x20FROM\x20sqlite_master\x20WHERE\x20type=\x27table\x27\x20AND\x20name=?',[_0x1f6a1c]);return!!_0x122cf8;}catch(_0x80061b){return warn(_0x570bfa(0x165)+(_0x80061b?.['message']||_0x80061b)),![];}}async function getTableColumns(_0x1f46f0){const _0x495bd5=_0xdb080c;try{const _0x2d51be=await db['all']('PRAGMA\x20table_info('+_0x1f46f0+')');return(_0x2d51be||[])['map'](_0x191b4b=>_0x191b4b['name']);}catch(_0x2411df){if('TJydC'===_0x495bd5(0x129))_0x4d0112();else return warn(_0x495bd5(0x169)+_0x1f46f0+':\x20'+(_0x2411df?.['message']||_0x2411df)),[];}}function resolveChatJidFromRow(_0xc8c1c0){const _0x548bc8=_0xdb080c,_0x271aa1={'DFMyt':'chat_jid'},_0x4cd8a1=[_0x271aa1['DFMyt'],'chatid','chat_id','jid','chat','room',_0x548bc8(0x141)];for(const _0x2b445d of _0x4cd8a1)if(_0x2b445d in _0xc8c1c0&&_0xc8c1c0[_0x2b445d])return String(_0xc8c1c0[_0x2b445d]);for(const _0x2f08b9 of Object['keys'](_0xc8c1c0)){const _0x314179=_0xc8c1c0[_0x2f08b9];if(typeof _0x314179==='string'&&_0x314179[_0x548bc8(0x183)]('@'))return _0x314179;}return null;}function resolveMessageFromRow(_0x4a55c2){const _0x4aed8d=_0xdb080c,_0x136825=['message',_0x4aed8d(0x14e),'text','body','value'];for(const _0x532067 of _0x136825)if(_0x532067 in _0x4a55c2&&_0x4a55c2[_0x532067]!=null)return String(_0x4a55c2[_0x532067]);for(const _0x227b18 of Object['keys'](_0x4a55c2)){if(typeof _0x4a55c2[_0x227b18]==='string'&&_0x4a55c2[_0x227b18]['length']>0x0&&!_0x4a55c2[_0x227b18]['includes']('@'))return _0x4a55c2[_0x227b18];}return'';}function resolveWhenFromRow(_0x1e2aae){const _0x5df1dd=_0xdb080c,_0x41364a=['send_at',_0x5df1dd(0x11a),'sendat','send','timestamp','ts','time_at'];for(const _0x289acd of _0x41364a){if(_0x289acd in _0x1e2aae&&_0x1e2aae[_0x289acd]){const _0x237449=Number(_0x1e2aae[_0x289acd]);if(!Number['isNaN'](_0x237449)&&_0x237449>0x3b9aca00)return{'send_at':_0x237449};}}const _0x5f15a3=['time',_0x5df1dd(0x14a),_0x5df1dd(0x126),'scheduled_time'];for(const _0x280569 of _0x5f15a3){if(_0x280569 in _0x1e2aae&&_0x1e2aae[_0x280569]){const _0x42786e=String(_0x1e2aae[_0x280569])['trim']();if(/^\d{1,2}:\d{2}$/['test'](_0x42786e))return{'time':_0x42786e};}}return{'time':null,'send_at':null};}async function readAndNormalizeExistingSchedules(){const _0x3c2d11=_0xdb080c,_0x5e9cf1={'hbXRu':'[sched]\x20attachWatcher:\x20setupSendApi\x20run','mmtZd':'Hwwpp','kRGIc':'SELECT\x20*\x20FROM\x20schedules','lxOpS':function(_0x4f764d,_0x2f2b55){return _0x4f764d||_0x2f2b55;}};try{if(_0x5e9cf1[_0x3c2d11(0x138)]==='yzmxh')_0x3d840(_0x4865f4),_0x3fa502(_0x5e9cf1[_0x3c2d11(0x11b)]);else{const _0x13c65e=await db[_0x3c2d11(0x12f)](_0x5e9cf1['kRGIc']),_0x37d1b6=[];for(const _0x3fb8da of _0x13c65e||[]){const _0x33c5ed=resolveChatJidFromRow(_0x3fb8da)||'',_0x19c7ef=resolveMessageFromRow(_0x3fb8da)||'',_0x3b9568=resolveWhenFromRow(_0x3fb8da)||{};let _0x443ee7=_0x3fb8da['frequency']||_0x3fb8da['freq']||_0x3fb8da['repeat']||_0x3fb8da['recurrence']||'daily';if(typeof _0x443ee7==='number')_0x443ee7='every_n_days:'+_0x443ee7;const _0x933e38=_0x3fb8da['timezone']||_0x3fb8da['tz']||null,_0x3dfcb1=_0x3fb8da['creator_jid']||_0x3fb8da['created_by']||_0x3fb8da[_0x3c2d11(0x154)]||_0x3fb8da['creator']||'';let _0x55ea9d=Number(_0x3fb8da[_0x3c2d11(0x144)]||_0x3fb8da['ts']||_0x3fb8da[_0x3c2d11(0x147)]||0x0);if(!_0x55ea9d)_0x55ea9d=Math[_0x3c2d11(0x173)](Date['now']()/0x3e8);_0x37d1b6['push']({'chat_jid':_0x33c5ed,'message':_0x19c7ef,'time':_0x3b9568['time']||null,'send_at':_0x3b9568['send_at']||null,'frequency':_0x443ee7||'daily','timezone':_0x933e38,'last_sent':Number(_0x3fb8da['last_sent']||_0x3fb8da[_0x3c2d11(0x187)]||0x0)||0x0,'creator_jid':_0x5e9cf1['lxOpS'](_0x3dfcb1,''),'created_at':_0x55ea9d});}return _0x37d1b6;}}catch(_0x512f0b){return warn('[sched]\x20readAndNormalizeExistingSchedules\x20failed:\x20'+(_0x512f0b?.['message']||_0x512f0b)),[];}}async function ensureSchema(){const _0x49b211=_0xdb080c,_0x24167f={'snFSh':'TEXT','pkrWG':function(_0x1f6b05,_0x31c46d){return _0x1f6b05(_0x31c46d);}},_0xd952c4={'id':'INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT','chat_jid':_0x49b211(0x171),'message':'TEXT\x20NOT\x20NULL','time':_0x24167f[_0x49b211(0x13c)],'send_at':'INTEGER','frequency':'TEXT\x20DEFAULT\x20\x27daily\x27','timezone':_0x24167f[_0x49b211(0x13c)],'last_sent':'INTEGER','creator_jid':'TEXT\x20NOT\x20NULL','enabled':'INTEGER\x20DEFAULT\x201','created_at':'INTEGER\x20DEFAULT\x20(strftime(\x27%s\x27,\x27now\x27))'};try{const _0x3c3910=await tableExists(_0x49b211(0x16d));if(!_0x3c3910){const _0x5c807e=Object['entries'](_0xd952c4)[_0x49b211(0x17c)](([_0x294eda,_0x28533e])=>_0x294eda+'\x20'+_0x28533e)['join'](',\x0a\x20\x20');await db['exec']('CREATE\x20TABLE\x20schedules\x20(\x0a\x20\x20'+_0x5c807e+_0x49b211(0x13d));try{if(_0x49b211(0x133)!=='YeJlq')await db['exec'](_0x49b211(0x13b));else{const _0x2a8c3e=_0x5c0850?function(){if(_0x2f0122){const _0x403cc5=_0x9ae9f9['apply'](_0x28a110,arguments);return _0x1a564e=null,_0x403cc5;}}:function(){};return _0x148d57=![],_0x2a8c3e;}}catch(_0x34bf36){}info('[sched]\x20created\x20canonical\x20schedules\x20table'),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20scheduler_settings\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20enabled\x20INTEGER\x20DEFAULT\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timezone\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20');return;}const _0x5d078d=await getTableColumns('schedules'),_0xe99b7e=_0x5d078d['includes'](_0x49b211(0x111)),_0xca53e7=_0x5d078d['includes']('message')||_0x5d078d['includes']('msg')||_0x5d078d[_0x49b211(0x183)](_0x49b211(0x13f))||_0x5d078d['includes']('text'),_0x2ae5fa=_0x5d078d['includes']('creator_jid')||_0x5d078d['includes']('created_by')||_0x5d078d['includes']('author');if(_0xe99b7e&&_0xca53e7&&_0x2ae5fa){try{await db['exec'](_0x49b211(0x13b));}catch(_0x40e641){}await db['exec']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20scheduler_settings\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20enabled\x20INTEGER\x20DEFAULT\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timezone\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20'),_0x24167f['pkrWG'](info,_0x49b211(0x120));return;}info('[sched]\x20Legacy\x20schedules\x20detected\x20â€”\x20migrating\x20safely');const _0x5405d9=await readAndNormalizeExistingSchedules();await db['exec']('PRAGMA\x20foreign_keys\x20=\x20OFF;');try{await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20schedules_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20time\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20send_at\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20frequency\x20TEXT\x20DEFAULT\x20\x27daily\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20timezone\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20last_sent\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20creator_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20enabled\x20INTEGER\x20DEFAULT\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x20(strftime(\x27%s\x27,\x27now\x27))\x0a\x20\x20\x20\x20\x20\x20);');}catch(_0x42b9fd){await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20schedules_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20time\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20send_at\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20frequency\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20timezone\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20last_sent\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20creator_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20enabled\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x0a\x20\x20\x20\x20\x20\x20);'),warn(_0x49b211(0x15e));}const _0x55adc9=await db['prepare']('INSERT\x20INTO\x20schedules_new\x20(chat_jid,\x20message,\x20time,\x20send_at,\x20frequency,\x20timezone,\x20last_sent,\x20creator_jid,\x20enabled,\x20created_at)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)');try{for(const _0x2c84e5 of _0x5405d9){if('RqKaR'==='RqKaR')try{'bDUpH'!=='bDUpH'?_0x436bf0('[sched]\x20connection.update\x20handler\x20error:\x20'+(_0x42d428?.['message']||_0x265bdb)):await _0x55adc9['run'](_0x2c84e5['chat_jid']||'',_0x2c84e5['message']||'',_0x2c84e5['time']||null,_0x2c84e5['send_at']||null,_0x2c84e5['frequency']||'daily',_0x2c84e5[_0x49b211(0x18b)]||null,_0x2c84e5[_0x49b211(0x182)]||0x0,_0x2c84e5['creator_jid']||'',0x1,_0x2c84e5[_0x49b211(0x144)]||Math[_0x49b211(0x173)](Date[_0x49b211(0x137)]()/0x3e8));}catch(_0xf0f66a){warn('[sched]\x20cannot\x20insert\x20normalized\x20schedule\x20for\x20'+_0x2c84e5['chat_jid']+':\x20'+(_0xf0f66a?.[_0x49b211(0x11f)]||_0xf0f66a));}else{const _0x3ef33d=_0x5519ce['replace']('\x20','T'),_0x5151f4=_0x103c17['fromISO'](_0x3ef33d,{'zone':_0x176296});if(_0x5151f4['isValid'])return{'type':'datetime','dt':_0x5151f4};}}}finally{try{await _0x55adc9['finalize']();}catch(_0xeccb8f){}}try{const _0x3db387='schedules_backup_'+Math['floor'](Date['now']()/0x3e8);await db['exec'](_0x49b211(0x131)+_0x3db387+';'),await db['exec']('ALTER\x20TABLE\x20schedules_new\x20RENAME\x20TO\x20schedules;');try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_schedules_chat\x20ON\x20schedules(chat_jid);');}catch(_0x3c5715){}info('[sched]\x20migration\x20done;\x20old\x20table\x20renamed\x20to\x20backup');}catch(_0x4dd4fe){warn('[sched]\x20swap\x20tables\x20failed:\x20'+(_0x4dd4fe?.['message']||_0x4dd4fe));throw _0x4dd4fe;}finally{await db['exec']('PRAGMA\x20foreign_keys\x20=\x20ON;');}await db['exec'](_0x49b211(0x146));}catch(_0x3a520e){if(_0x49b211(0x190)!=='NRFoY'){error(_0x3a520e,_0x49b211(0x12a));throw _0x3a520e;}else try{_0x54e607('[sched]\x20connection.update\x20observed\x20-\x20re-setup\x20sendApi'),_0x56b6d7(_0x9b47e);}catch(_0x3f8137){}}}function refreshConfig(){const _0x3a3ed8=_0xdb080c;try{const _0x3e798c=getConfig()||{};CHECK_INTERVAL_MS=Number(_0x3e798c['SCHED_CHECK_INTERVAL_MS']??CHECK_INTERVAL_MS),DEFAULT_TIMEZONE=_0x3e798c[_0x3a3ed8(0x163)]||DEFAULT_TIMEZONE,SEND_RETRIES=Number(_0x3e798c['SCHED_SEND_RETRIES']??SEND_RETRIES),INITIAL_BACKOFF_MS=Number(_0x3e798c['SCHED_INITIAL_BACKOFF_MS']??INITIAL_BACKOFF_MS),info(_0x3a3ed8(0x124)+CHECK_INTERVAL_MS+'ms\x20defaultTZ='+DEFAULT_TIMEZONE);}catch(_0x3ae264){warn('[sched]\x20refreshConfig\x20error:\x20'+(_0x3ae264?.['message']||_0x3ae264));}}try{typeof hotReloadConfig===_0xdb080c(0x127)&&hotReloadConfig((_0x49a5de=[])=>{try{refreshConfig();}catch(_0x355c4e){warn('[sched]\x20hotReload\x20handler\x20error:\x20'+(_0x355c4e?.['message']||_0x355c4e));}});}catch(_0x1d83a5){warn('[sched]\x20hotReloadConfig\x20registration\x20failed:\x20'+(_0x1d83a5?.['message']||_0x1d83a5));}refreshConfig();function tryBuildSendApiFromBot(_0x1d2b28){const _0x461ac0=_0xdb080c,_0x381466={'PNgxr':function(_0x215259,_0x566ec4){return _0x215259===_0x566ec4;}};if(!_0x1d2b28)return null;if(_0x381466['PNgxr'](typeof _0x1d2b28['sendMessage'],_0x461ac0(0x127)))return'fSrat'==='fSrat'?async(_0x1c4d13,_0x439d4c)=>_0x1d2b28['sendMessage'](_0x1c4d13,_0x439d4c):(_0x195d60(_0x461ac0(0x149)+(_0x7e7b24?.['message']||_0x436fda)),![]);else{if(_0x1d2b28['sock']&&typeof _0x1d2b28['sock']['sendMessage']==='function')return async(_0x77a69e,_0x3aefb3)=>_0x1d2b28['sock'][_0x461ac0(0x12e)](_0x77a69e,_0x3aefb3);}return null;}function setupSendApi(_0x591548){const _0x312052=_0xdb080c,_0x4c69ba={'zAXOC':'not-available'};botRef=_0x591548,sendApi=tryBuildSendApiFromBot(botRef),lastSockIdentity=botRef?.['sock']||null,info('[sched]\x20setupSendApi\x20done;\x20sendApi\x20'+(sendApi?'available':_0x4c69ba[_0x312052(0x14f)]));}function startAttachWatcher(){const _0x38db46={'broDM':'[sched]\x20attachWatcher\x20error:\x20'};stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{try{if(!botRef)return;!lastSockIdentity&&botRef['sock']&&(setupSendApi(botRef),info('[sched]\x20attachWatcher:\x20setupSendApi\x20run'));}catch(_0x44bc3b){warn(_0x38db46['broDM']+(_0x44bc3b?.['message']||_0x44bc3b));}},0xbb8);}function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){const _0x34e423={'FwHmG':function(_0x54c617,_0x5034f7){return _0x54c617(_0x5034f7);}};stopSockMonitor(),sockMonitorInterval=setInterval(()=>{const _0x22e78b=_0xc533;try{if(!botRef)return;const _0x2121b7=botRef[_0x22e78b(0x162)]||null;if(_0x2121b7&&lastSockIdentity&&_0x2121b7!==lastSockIdentity){info('[sched]\x20detected\x20botRef.sock\x20change\x20-\x20re-setup\x20sendApi');try{setupSendApi(botRef);}catch(_0x1d6a1e){}}else!lastSockIdentity&&_0x2121b7&&_0x34e423['FwHmG'](setupSendApi,botRef);}catch(_0x1bfe35){warn('[sched]\x20sock\x20monitor\x20error:\x20'+(_0x1bfe35?.['message']||_0x1bfe35));}},0x3e8);}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function startConnectionUpdateHook(){const _0x19c743=_0xdb080c,_0x24e5d0={'LQPFx':'[sched]\x20connection.update\x20observed\x20-\x20re-setup\x20sendApi','kLiCW':function(_0x2f0251,_0x262e98){return _0x2f0251(_0x262e98);},'NeEax':function(_0x143122,_0x410fa2,_0x490e5b){return _0x143122(_0x410fa2,_0x490e5b);}};if(!botRef||!botRef[_0x19c743(0x162)]||!botRef['sock']['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=_0x20081b=>{const _0x3211a1=_0x19c743;if('fJGbJ'==='fJGbJ')try{_0x24e5d0['NeEax'](setTimeout,()=>{const _0x2da8ad=_0xc533;try{info(_0x24e5d0[_0x2da8ad(0x176)]),setupSendApi(botRef);}catch(_0x4c52b6){}},0x1f4);}catch(_0x2cca70){warn('[sched]\x20connection.update\x20handler\x20error:\x20'+(_0x2cca70?.['message']||_0x2cca70));}else _0x539fe6&&(_0x24e5d0[_0x3211a1(0x17e)](_0x10b5b7,_0x1abeaa),_0x309b54=null,_0x5ecd55('[sched]\x20scheduler\x20stopped'));};try{botRef['sock']['ev']['on']?.('connection.update',connectionUpdateHandler);}catch(_0x51ed9c){warn('[sched]\x20failed\x20to\x20hook\x20connection.update:\x20'+(_0x51ed9c?.['message']||_0x51ed9c));}}function stopConnectionUpdateHook(){try{if(connectionUpdateHandler&&botRef&&botRef['sock']&&botRef['sock']['ev'])try{botRef['sock']['ev']['off']?.('connection.update',connectionUpdateHandler);}catch(_0xedc312){try{botRef['sock']['ev']['removeListener']?.('connection.update',connectionUpdateHandler);}catch(_0x366e68){}}}catch(_0x5d8a8d){}connectionUpdateHandler=null;}async function sendWithRetry(_0x997c2e,_0x26d11e){const _0x5f5778=_0xdb080c,_0x1ae49b={'sJOFd':function(_0x1e7222,_0x5b0fdb,_0xa04f82){return _0x1e7222(_0x5b0fdb,_0xa04f82);},'ukCvC':_0x5f5778(0x114),'cFPYU':'NExqG'},_0x15d9fd=Number(SEND_RETRIES||0x3);let _0x243f87=0x0,_0x373d69=Number(INITIAL_BACKOFF_MS||0x1f4);while(_0x243f87<_0x15d9fd){try{const _0x566540=_0x997c2e||botRef?.['sock']?.['user']?.['id']||null;if(!_0x566540)throw new Error(_0x5f5778(0x13e));if(typeof sendApi==='function')return await _0x1ae49b['sJOFd'](sendApi,_0x566540,_0x26d11e),!![];if(botRef&&typeof botRef['sendMessage']==='function')return await botRef['sendMessage'](_0x566540,_0x26d11e),!![];if(botRef&&botRef['sock']&&typeof botRef['sock']['sendMessage']==='function'){if('IwqcJ'===_0x5f5778(0x10c))_0x1052fa('0');else return await botRef['sock']['sendMessage'](_0x566540,_0x26d11e),!![];}throw new Error('no\x20sendApi\x20available');}catch(_0x7f40f4){_0x243f87++;const _0x4a2fb9=String(_0x7f40f4?.[_0x5f5778(0x11f)]||'')['toLowerCase']()['includes'](_0x1ae49b['ukCvC'])||_0x7f40f4?.['status']===0x1ad;warn('[sched]\x20send\x20attempt\x20'+_0x243f87+'\x20failed:\x20'+(_0x7f40f4?.[_0x5f5778(0x11f)]||_0x7f40f4));if(_0x243f87>=_0x15d9fd||!_0x4a2fb9)return![];await new Promise(_0x412804=>setTimeout(_0x412804,_0x373d69)),_0x373d69*=0x2;try{if(_0x5f5778(0x135)===_0x1ae49b['cFPYU'])setupSendApi(botRef);else return _0x45c0cf('[sched]\x20setChatTimezone\x20error:\x20'+(_0x5e0cd3?.[_0x5f5778(0x11f)]||_0x3a3e03)),![];}catch(_0x5bddca){}}}return![];}function parseTimeToken(_0x5a640,_0x325eff=DEFAULT_TIMEZONE){const _0x213596=_0xdb080c;if(!_0x5a640||typeof _0x5a640!==_0x213596(0x178))return null;const _0x3e0ec=_0x5a640['trim'](),_0xe5ef2=_0x3e0ec['match'](/^in\s+(\d+)\s*(minute|min|minutes|m|hour|hours|hr|h|day|days|d)$/i);if(_0xe5ef2){const _0x3766d4=Number(_0xe5ef2[0x1]),_0x104c8a=_0xe5ef2[0x2]['toLowerCase']();let _0x37a015=DateTime[_0x213596(0x137)]()['setZone'](_0x325eff);if(_0x104c8a[_0x213596(0x152)]('min')||_0x104c8a==='m')_0x37a015=_0x37a015['plus']({'minutes':_0x3766d4});else{if(_0x104c8a['startsWith']('h')||_0x104c8a[_0x213596(0x152)]('hr'))_0x37a015=_0x37a015['plus']({'hours':_0x3766d4});else{if(_0x104c8a[_0x213596(0x152)]('d'))_0x37a015=_0x37a015['plus']({'days':_0x3766d4});}}if(_0x37a015['isValid'])return{'type':'datetime','dt':_0x37a015};}if(/^\d{4}-\d{2}-\d{2}[ T]\d{1,2}:\d{2}$/['test'](_0x3e0ec)){const _0x415fcf=_0x3e0ec['replace']('\x20','T'),_0x482a07=DateTime['fromISO'](_0x415fcf,{'zone':_0x325eff});if(_0x482a07['isValid'])return{'type':'datetime','dt':_0x482a07};}if(/^\d{1,2}:\d{2}$/['test'](_0x3e0ec)){const [_0x24f9a9,_0x4d6e6f]=_0x3e0ec[_0x213596(0x116)](':')['map'](Number);if(Number['isInteger'](_0x24f9a9)&&Number['isInteger'](_0x4d6e6f)&&_0x24f9a9>=0x0&&_0x24f9a9<=0x17&&_0x4d6e6f>=0x0&&_0x4d6e6f<=0x3b)return{'type':_0x213596(0x14a),'hhmm':String(_0x24f9a9)[_0x213596(0x150)](0x2,'0')+':'+String(_0x4d6e6f)['padStart'](0x2,'0')};}return null;}function shouldSendSlot(_0x552af8,_0x2fa5e7){const _0x382d73=_0xdb080c,_0x6dcf88={'FKDKR':function(_0x1134e1,_0x4513c5){return _0x1134e1*_0x4513c5;},'XRzYF':function(_0x36a49b,_0x4bcde5){return _0x36a49b===_0x4bcde5;},'tsYsZ':_0x382d73(0x18d)},_0x3bb21e=_0x552af8['frequency']||_0x382d73(0x17f),_0x37944f=_0x552af8[_0x382d73(0x182)]||0x0,_0x12f17d=_0x37944f?DateTime['fromMillis'](_0x6dcf88['FKDKR'](_0x37944f,0x3e8))['setZone'](_0x2fa5e7['zone']):null;if(!_0x12f17d)return!![];if(_0x6dcf88['XRzYF'](_0x3bb21e,'daily'))return!_0x12f17d['hasSame'](_0x2fa5e7,_0x6dcf88['tsYsZ']);if(_0x3bb21e===_0x382d73(0x16a))return _0x2fa5e7['diff'](_0x12f17d,'days')['days']>=0x7;if(_0x3bb21e['startsWith'](_0x382d73(0x157))){const _0x774745=parseInt(_0x3bb21e[_0x382d73(0x116)](':')[0x1],0xa);if(isNaN(_0x774745)||_0x774745<0x1)return![];return _0x2fa5e7['diff'](_0x12f17d,'days')['days']>=_0x774745;}if(_0x3bb21e[_0x382d73(0x152)](_0x382d73(0x139))){const _0x4c31b5=_0x3bb21e['split'](':')[0x1]['split'](',')['map'](_0x269e3e=>parseInt(_0x269e3e,0xa))['filter'](Boolean);return _0x4c31b5[_0x382d73(0x183)](_0x2fa5e7['weekday'])&&!_0x12f17d['hasSame'](_0x2fa5e7,'day');}if(_0x3bb21e[_0x382d73(0x152)]('day_of_month:')){if('fdhbm'!=='fdhbm')_0x480507['sock']['ev']['off']?.('connection.update',_0x1b22f5);else{const _0x46bee8=parseInt(_0x3bb21e['split'](':')[0x1],0xa);return _0x2fa5e7['day']===_0x46bee8&&!_0x12f17d['hasSame'](_0x2fa5e7,_0x6dcf88['tsYsZ']);}}return![];}async function addScheduleRow(_0x1f5be9){const _0x208ee7=_0xdb080c,_0x11f45b={'NHyna':'daily'};try{if(_0x208ee7(0x11e)!==_0x208ee7(0x11e))return _0xfd3a57('[sched]\x20getChatTimezone\x20error:\x20'+(_0x2b1d7f?.['message']||_0x19bc79)),null;else{const _0x298f23=await db['run']('INSERT\x20INTO\x20schedules\x20(chat_jid,\x20message,\x20time,\x20send_at,\x20frequency,\x20timezone,\x20creator_jid)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)',[_0x1f5be9[_0x208ee7(0x111)],_0x1f5be9['message'],_0x1f5be9['time'],_0x1f5be9['send_at'],_0x1f5be9['frequency']||_0x11f45b['NHyna'],_0x1f5be9['timezone']||null,_0x1f5be9['creator_jid']]),_0x3dc201=_0x298f23?.['lastID']||null;return info('[sched]\x20added\x20schedule\x20id='+_0x3dc201+'\x20chat='+_0x1f5be9['chat_jid']+_0x208ee7(0x15d)+(_0x1f5be9['time']||_0x1f5be9['send_at'])),_0x3dc201;}}catch(_0x4478bb){return warn('[sched]\x20addScheduleRow\x20error:\x20'+(_0x4478bb?.['message']||_0x4478bb)),null;}}async function listSchedulesForChat(_0x2b075b){try{const _0x1847f0=await db['all']('SELECT\x20*\x20FROM\x20schedules\x20WHERE\x20chat_jid\x20=\x20?\x20ORDER\x20BY\x20id\x20ASC',[_0x2b075b]);return _0x1847f0||[];}catch(_0x198d69){return warn('[sched]\x20listSchedulesForChat\x20error:\x20'+(_0x198d69?.['message']||_0x198d69)),[];}}async function removeScheduleByDBId(_0x1993b1){const _0xc50e26=_0xdb080c;try{const _0x52d48e=await db['run'](_0xc50e26(0x16e),[_0x1993b1]);return _0x52d48e?.[_0xc50e26(0x11d)]?!![]:![];}catch(_0x458eef){return warn('[sched]\x20removeScheduleByDBId\x20error:\x20'+(_0x458eef?.['message']||_0x458eef)),![];}}async function removeAllSchedulesForChat(_0xe5b5d7){const _0x380ff2=_0xdb080c,_0x4b385f={'lavLC':'[sched]\x20removeAllSchedulesForChat\x20error:\x20'};try{const _0x2daa07=await db['run']('DELETE\x20FROM\x20schedules\x20WHERE\x20chat_jid\x20=\x20?',[_0xe5b5d7]);return _0x2daa07?.['changes']||0x0;}catch(_0xc8482d){return warn(_0x4b385f[_0x380ff2(0x110)]+(_0xc8482d?.[_0x380ff2(0x11f)]||_0xc8482d)),0x0;}}function _0xc533(_0x35cf05,_0x54ac8){const _0x1bc145=_0x1984();return _0xc533=function(_0x3c1986,_0x39243b){_0x3c1986=_0x3c1986-0x10a;let _0x225b9b=_0x1bc145[_0x3c1986];if(_0xc533['ibFpBZ']===undefined){var _0x1d41eb=function(_0x4a96c0){const _0x622d08='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1d1b2a='',_0x4484cc='';for(let _0x1a82aa=0x0,_0x57a46f,_0x30b2c5,_0x31b761=0x0;_0x30b2c5=_0x4a96c0['charAt'](_0x31b761++);~_0x30b2c5&&(_0x57a46f=_0x1a82aa%0x4?_0x57a46f*0x40+_0x30b2c5:_0x30b2c5,_0x1a82aa++%0x4)?_0x1d1b2a+=String['fromCharCode'](0xff&_0x57a46f>>(-0x2*_0x1a82aa&0x6)):0x0){_0x30b2c5=_0x622d08['indexOf'](_0x30b2c5);}for(let _0x8e0ff=0x0,_0x10c2b7=_0x1d1b2a['length'];_0x8e0ff<_0x10c2b7;_0x8e0ff++){_0x4484cc+='%'+('00'+_0x1d1b2a['charCodeAt'](_0x8e0ff)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4484cc);};_0xc533['aQundw']=_0x1d41eb,_0x35cf05=arguments,_0xc533['ibFpBZ']=!![];}const _0x19841e=_0x1bc145[0x0],_0xc533fd=_0x3c1986+_0x19841e,_0x8a3825=_0x35cf05[_0xc533fd];return!_0x8a3825?(_0x225b9b=_0xc533['aQundw'](_0x225b9b),_0x35cf05[_0xc533fd]=_0x225b9b):_0x225b9b=_0x8a3825,_0x225b9b;},_0xc533(_0x35cf05,_0x54ac8);}async function updateScheduleFields(_0x3f1447,_0x8b4ee7={}){const _0x478e1c=_0xdb080c;try{const _0x535bff=[],_0x4c4b0c=[];for(const _0x1be0dc of Object['keys'](_0x8b4ee7)){_0x535bff['push'](_0x1be0dc+'\x20=\x20?'),_0x4c4b0c['push'](_0x8b4ee7[_0x1be0dc]);}if(!_0x535bff[_0x478e1c(0x125)])return![];_0x4c4b0c['push'](_0x3f1447);const _0x4bb6d1='UPDATE\x20schedules\x20SET\x20'+_0x535bff['join'](',\x20')+'\x20WHERE\x20id\x20=\x20?',_0x5453f3=await db['run'](_0x4bb6d1,_0x4c4b0c);return _0x5453f3?.['changes']?!![]:![];}catch(_0x1d8e97){return warn(_0x478e1c(0x148)+(_0x1d8e97?.['message']||_0x1d8e97)),![];}}async function getChatTimezone(_0x46759f){try{const _0xbc85f8=await db['get']('SELECT\x20timezone\x20FROM\x20scheduler_settings\x20WHERE\x20chat_jid\x20=\x20?',[_0x46759f]);return _0xbc85f8?.['timezone']||null;}catch(_0x58ef9d){return warn('[sched]\x20getChatTimezone\x20error:\x20'+(_0x58ef9d?.['message']||_0x58ef9d)),null;}}async function setChatTimezone(_0x2071e2,_0x26998f){const _0x32845e=_0xdb080c;try{return await db['run']('INSERT\x20INTO\x20scheduler_settings\x20(chat_jid,\x20timezone)\x20VALUES\x20(?,\x20?)\x20ON\x20CONFLICT(chat_jid)\x20DO\x20UPDATE\x20SET\x20timezone=excluded.timezone',[_0x2071e2,_0x26998f]),!![];}catch(_0x1a98e3){if('ZefeF'!=='EaGmR')return warn('[sched]\x20setChatTimezone\x20error:\x20'+(_0x1a98e3?.['message']||_0x1a98e3)),![];else _0x5445cf('[sched]\x20failed\x20to\x20deliver\x20recurring\x20id='+_0x5aab9e['id']+'\x20to\x20'+_0x1566fa[_0x32845e(0x111)]+_0x32845e(0x143)+_0x3e46ea['time']);}}async function executorTick(){const _0x3c97c1=_0xdb080c,_0x209670={'eZYKr':_0x3c97c1(0x10a),'XIGNd':function(_0xdb5a9b,_0x221f84){return _0xdb5a9b(_0x221f84);},'szPnB':function(_0x21e73f,_0x11d1cd){return _0x21e73f/_0x11d1cd;}};if(executorRunning)return;executorRunning=!![];try{const _0x37a90b=await db['all']('SELECT\x20*\x20FROM\x20schedules\x20WHERE\x20enabled\x20=\x201\x20ORDER\x20BY\x20id\x20ASC');if(!_0x37a90b||_0x37a90b['length']===0x0)return;for(const _0x47774a of _0x37a90b){if('CzXsl'===_0x209670[_0x3c97c1(0x10d)])return _0x358362('[sched]\x20resolveDefaultChatForUser\x20error:\x20'+(_0x3c945d?.['message']||_0x4fd2bb)),null;else try{const _0x39b429=_0x47774a['timezone']||await getChatTimezone(_0x47774a['chat_jid'])||DEFAULT_TIMEZONE,_0x126f40=DateTime['now']()['setZone'](_0x39b429);if(_0x47774a[_0x3c97c1(0x15a)]&&Number(_0x47774a['send_at'])>0x0){const _0x5dcc54=Number(_0x47774a[_0x3c97c1(0x15a)]);if(_0x5dcc54<=Math['floor'](Date[_0x3c97c1(0x137)]()/0x3e8)){const _0x50f52d=await sendWithRetry(_0x47774a['chat_jid'],{'text':_0x47774a['message']});_0x50f52d?(await updateScheduleFields(_0x47774a['id'],{'enabled':0x0,'last_sent':Math['floor'](Date['now']()/0x3e8)}),_0x209670[_0x3c97c1(0x145)](info,'[sched]\x20delivered\x20one-off\x20id='+_0x47774a['id']+'\x20to\x20'+_0x47774a['chat_jid'])):warn('[sched]\x20failed\x20to\x20deliver\x20one-off\x20id='+_0x47774a['id']+'\x20to\x20'+_0x47774a['chat_jid']);}continue;}if(!_0x47774a[_0x3c97c1(0x17d)])continue;const _0x294575=_0x126f40[_0x3c97c1(0x185)]('HH:mm');if(_0x294575!==_0x47774a['time'])continue;const _0x3ad7a1={'id':_0x47774a['id'],'frequency':_0x47774a['frequency']||_0x3c97c1(0x17f),'last_sent':_0x47774a[_0x3c97c1(0x182)]||0x0};if(!shouldSendSlot(_0x3ad7a1,_0x126f40))continue;const _0x33a996=await sendWithRetry(_0x47774a['chat_jid'],{'text':_0x47774a['message']});_0x33a996?(await updateScheduleFields(_0x47774a['id'],{'last_sent':Math['floor'](_0x209670['szPnB'](Date['now'](),0x3e8))}),info('[sched]\x20delivered\x20recurring\x20id='+_0x47774a['id']+'\x20to\x20'+_0x47774a[_0x3c97c1(0x111)]+'\x20at\x20'+_0x47774a['time']+'\x20('+_0x39b429+')')):warn('[sched]\x20failed\x20to\x20deliver\x20recurring\x20id='+_0x47774a['id']+'\x20to\x20'+_0x47774a['chat_jid']+'\x20at\x20'+_0x47774a['time']);}catch(_0x5cb35d){warn('[sched]\x20executor\x20item\x20error:\x20'+(_0x5cb35d?.['message']||_0x5cb35d));}}}catch(_0x83f6d7){error('[sched]\x20executorTick\x20error:\x20'+(_0x83f6d7?.['message']||_0x83f6d7));}finally{executorRunning=![];}}function startSchedulerAligned(){const _0x17d740={'DvNzY':function(_0x46ac96,_0x166d89){return _0x46ac96%_0x166d89;}};stopScheduler();const _0x4bc51f=0xea60-_0x17d740['DvNzY'](Date['now'](),0xea60);setTimeout(()=>{const _0x2de0c2=_0xc533;executorTick()['catch'](_0x473396=>warn('[sched]\x20initial\x20executor\x20error:\x20'+(_0x473396?.[_0x2de0c2(0x11f)]||_0x473396))),schedulerIntervalHandle=setInterval(()=>{const _0x3b19b1=_0x2de0c2;executorTick()[_0x3b19b1(0x14b)](_0x408a31=>warn('[sched]\x20executorTick\x20error:\x20'+(_0x408a31?.['message']||_0x408a31)));},CHECK_INTERVAL_MS),info('[sched]\x20scheduler\x20started\x20(aligned\x20to\x20minutes)');},_0x4bc51f);}function stopScheduler(){schedulerIntervalHandle&&(clearInterval(schedulerIntervalHandle),schedulerIntervalHandle=null,info('[sched]\x20scheduler\x20stopped'));}function extractTextFromMessage(_0x299b77){const _0x786112=_0xdb080c;if(!_0x299b77||!_0x299b77['message'])return'';const _0x373b83=_0x299b77['message'];if(_0x373b83['conversation'])return _0x373b83['conversation'];if(_0x373b83['extendedTextMessage']?.['text'])return _0x373b83['extendedTextMessage']['text'];if(_0x373b83['imageMessage']?.[_0x786112(0x113)])return _0x373b83['imageMessage']['caption'];if(_0x373b83['videoMessage']?.['caption'])return _0x373b83['videoMessage']['caption'];if(_0x373b83['buttonsResponseMessage']?.['selectedButtonId'])return _0x373b83['buttonsResponseMessage']['selectedButtonId'];if(_0x373b83['listResponseMessage']?.['singleSelectReply']?.[_0x786112(0x159)])return _0x373b83['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}const USAGE='Usage:\x0asched\x20help\x0asched\x20add\x20<HH:mm|YYYY-MM-DDTHH:mm|in\x20N\x20hours/days/minutes>\x20<message...>\x0a\x20\x20(message\x20may\x20be\x20on\x20same\x20line\x20after\x20time\x20or\x20on\x20following\x20lines;\x20original\x20newlines\x20preserved)\x0asched\x20once\x20<HH:mm>\x20[Ndays]\x20<message...>\x20\x20\x20->\x20one-off;\x20if\x20Ndays\x20provided\x20schedule\x20for\x20today+Ndays\x20at\x20HH:mm\x20(N\x20>=\x201)\x0asched\x20list\x0asched\x20delete\x20<number|number,number,...|all>\x0asched\x20edit\x20<number>\x20<HH:mm|in\x20N\x20hours|YYYY-MM-DDTHH:mm>\x0asched\x20frequency\x20<number>\x20<n>\x20\x20\x20(n=1\x20daily,\x20n=2\x20every\x202\x20days,\x20etc.)\x0asched\x20disable\x20<number>\x0asched\x20enable\x20<number>\x0a',processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=0x14*0x3e8;function markCmdProcessed(_0x27f541){const _0x9dfa82=_0xdb080c,_0x26f207={'WBBxB':function(_0x955adb,_0x140a19){return _0x955adb+_0x140a19;},'ACimJ':_0x9dfa82(0x189)};if(!_0x27f541)return;if(processedCmdKeys['has'](_0x27f541))try{if(_0x26f207['ACimJ']==='HmpFm')clearTimeout(processedCmdKeys[_0x9dfa82(0x115)](_0x27f541));else{const _0x3a2f9c=new _0xbb3c49('function\x20*\x5c(\x20*\x5c)'),_0x2d78df=new _0x37ed62('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0xe45020=_0xe29834('init');!_0x3a2f9c['test'](IKPqnr['WBBxB'](_0xe45020,'chain'))||!_0x2d78df[_0x9dfa82(0x130)](_0xe45020+'input')?_0xe45020('0'):_0x29cfd4();}}catch(_0x234e56){}const _0x4d1706=setTimeout(()=>processedCmdKeys[_0x9dfa82(0x161)](_0x27f541),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x9dfa82(0x13a)](_0x27f541,_0x4d1706);}function isCmdProcessed(_0x43461d){return _0x43461d&&processedCmdKeys['has'](_0x43461d);}async function resolveDefaultChatForUser(_0x476681){const _0x11f017=_0xdb080c,_0x55c163={'wqDYc':function(_0x194fe3,_0x30d0f4){return _0x194fe3+_0x30d0f4;}};try{const _0x214f65=await getDefault(_0x476681)['catch'](()=>null);if(!_0x214f65)return null;if(String(_0x214f65)[_0x11f017(0x183)]('@'))return _0x214f65;const _0x311480=await getConnection(_0x214f65)['catch'](()=>null);return _0x311480||null;}catch(_0x1c1bf0){return warn(_0x55c163['wqDYc']('[sched]\x20resolveDefaultChatForUser\x20error:\x20',_0x1c1bf0?.[_0x11f017(0x11f)]||_0x1c1bf0)),null;}}async function resolveNumberToDbId(_0xacb454,_0x5e2a1e){if(!_0xacb454||!Number['isInteger'](_0xacb454)||_0xacb454<0x1)return null;const _0x5a3fd8=await resolveDefaultChatForUser(_0x5e2a1e);if(!_0x5a3fd8)return null;const _0x421008=await listSchedulesForChat(_0x5a3fd8);if(!_0x421008||_0x421008['length']<_0xacb454)return null;return _0x421008[_0xacb454-0x1]['id'];}function _0x1984(){const _0x3da09e=['C2vUzef0','AgjyuNu','rMfPBgvKihrVignYzwf0zsbVBMuTB2zMihnJAgvKDwXLlG','y2HHBMDLCW','B1LyDM0','BwvZC2fNzq','w3nJAgvKxsbZy2HLzhvSzxmGDgfIBguGyxbWzwfYCYbJyw5VBMLJywWVywrLCxvHDgu','rMfPBgvKihrVigrLBgv0ztOG','BM90igzVDw5K','mte5nZuZnK9vz2LoBG','w3nJAgvKxsbJB25MAwCGCMvMCMvZAgvKoIbPBNrLCNzHBd0','BgvUz3rO','C2nOzwr1BgvFDgLTzq','zNvUy3rPB24','AM9PBG','thHnzKW','w3nJAgvKxsbLBNn1CMvty2HLBweGzMf0ywW','yxbWBhK','rMfPBgvKihrVihvWzgf0zsbMCMvXDwvUy3KU','EM9Uzu5HBwu','C2vUze1LC3nHz2u','ywXS','DgvZDa','quXurviGvefcteuGC2nOzwr1BgvZifjftKfnrsbutYa','nde4uMv0wMXc','uvHMtuu','cM1ZzZOk','tKv4CuC','z2DLCG','BM93','Bw10wMq','zgf5C19VzL93zwvRoG','C2v0','q1jfqvrfieLorevyieLgie5pvcbfweLtvfmGAwr4x3nJAgvKDwXLC19JAgf0ie9oihnJAgvKDwXLCYHJAgf0x2PPzcK7','C25gu2G','cIK7','BM8GC2vUzcb0yxjNzxqGyxzHAwXHyMXL','yM9KEq','DhLWzq','DgfYz2v0x2PPza','w3nJAgvKxsbeqIbLBNn1CMuGzMfPBgvKoIa','igf0ia','y3jLyxrLzf9HDa','weLhtMq','cIaGicaGiensrufursbuqujmrsbjrIbot1qGrvHju1rtihnJAgvKDwXLCL9Zzxr0Aw5NCYaOcIaGicaGicaGy2HHDf9QAwqGvevyvcbquKLnqvjzieTfwsWkicaGicaGicbLBMfIBgvKieLovevhrviGrevgqvvmvcaXlaOGicaGicaGihrPBwv6B25LifrfwfqkicaGicaGktSkicaGia','DgLTzxn0yw1W','w3nJAgvKxsb1CgrHDgvty2HLzhvSzuzPzwXKCYbLCNjVCJOG','w3nJAgvKxsbYzw1VDMvty2HLzhvSzuj5rejjzcbLCNjVCJOG','AgHTBq','y2f0y2G','swrsv1q','ywn0Aw9U','BxnN','EKfyt0m','CgfKu3rHCNq','AxnjBNrLz2vY','C3rHCNrZv2L0Aa','mtrtqNf0u24','yxv0Ag9Y','C2v0wM9Uzq','ksbPBIbKzwzHDwX0ia','zxzLCNLFBL9KyxLZoG','txzmDeS','C2vSzwn0zwrsB3Djza','C2vUzf9HDa','rgvSzxrLzca','A2v5','ihrPBwu9','w3nJAgvKxsbJCMvHDgvKihnJAgvKDwXLC19UzxCGD2L0Ag91DcbKzwzHDwX0CYbHCYbMywXSyMfJAW','ksbPzdO','tM8GC2nOzwr1BguGiW','zgvSzxrL','C29JAW','u0nirurFrevgqvvmvf9usu1fwK9orq','CgX1CW','w3nJAgvKxsb0ywjSzuv4Axn0CYbLCNjVCJOG','ugXLyxnLihbYB3zPzguGBwvZC2fNzsb0zxH0icHZyw1LigXPBMuGywz0zxiGDgLTzsbVCIbVBIbMB2XSB3DPBMCGBgLUzxmPlG','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','ndvnz2zrwLG','w3nJAgvKxsbNzxruywjSzunVBhvTBNmGzxjYB3iGzM9Yia','D2vLA2X5','igvUywjSzwq6','y2fSBa','C2nOzwr1BgvZ','revmrvrfiezst00GC2nOzwr1BgvZifDirvjfigLKid0GpW','CMvWBgfJzq','vw5ZDxbWB3j0zwqGDgLTzsbMB3jTyxqGzM9Yig9Uy2uGC2nOzwr1BgLUzY4','vevyvcbot1qGtLvmta','CMv0DxjUicHMDw5JDgLVBIGPia','zMXVB3i','Dw5RBM93BG','u2nOzwr1BguGiW','tffqrNG','kgLKoG','C3rYAw5N','mtG1ote2mhzjEgj4AW','rMfPBgvKihrVignYzwf0zsbYzwn1CNjPBMCGC2nOzwr1BguU','zw5HyMXLza','BwfW','DgLTzq','A0XPq1C','zgfPBhK','w3nJAgvKxsbJBgvHBNvWigvYCM9YoIa','mta3otu4ngHpu2zoEG','BgfZDf9Zzw50','Aw5JBhvKzxm','igzYzxf1zw5JEsbZzxqGDg8G','Dg9gB3jTyxq','xcqM','C2vUDf9HDa','zMLSDgvY','sg1WrM0','nhrWA3HKuW','DgLTzxPVBMu','C2XPy2u','zgf5','rvrAz0K','y29UC3rYDwn0B3i','yLDJz2e','Dg9nAwXSAxm','u0nirurFq0Hfq0TFsu5urvjwquXFtvm','r2XQvue','ndy4nZuWmg9Ku1jWsG','CxPotxa','zvPzs3i','mZi3mdy2mhnhtujiza','ntK0odKYwM15qNnJ','Bgf2tem','y2HHDf9QAwq','vxnHz2u6ihnJAgvKigvKAxqGpg51BwjLCJ4GpeHioM1TFgLUie4GAg91CNn8wvLzws1nts1erfrisdPTBt4','y2fWDgLVBG','CMf0zq','z2v0','C3bSAxq','mJbOuNHtv2G','Dgv4Da','oda2oty0ALHXBhPL'];_0x1984=function(){return _0x3da09e;};return _0x1984();}function splitFirstLinePreserveRest(_0x1574fd){const _0x53dab7=_0x1574fd['split'](/\r?\n/),_0x3dee3b=_0x53dab7['length']>0x0?_0x53dab7['shift']():'',_0x31b547=_0x53dab7['join']('\x0a'),_0x179b06=_0x3dee3b['trim']()['split'](/\s+/)['filter'](Boolean);return{'firstLine':_0x3dee3b,'restText':_0x31b547,'firstTokens':_0x179b06};}export async function onMessage(_0x4fbcea){const _0x5a2b61=_0xdb080c,_0xa45c74={'Ffjya':'kgfEW','EdFxR':'string','MxGAh':function(_0x2c1f6e,_0x222e00){return _0x2c1f6e||_0x222e00;},'tKgKL':function(_0x122b08,_0x9a0ea9){return _0x122b08===_0x9a0ea9;},'envzT':function(_0x261af5,_0x4eb5b6){return _0x261af5!==_0x4eb5b6;},'tJPyy':'Usage:\x20sched\x20once\x20<HH:mm>\x20[Ndays]\x20<message...>','sUtGm':function(_0x570edc,_0x11d6f9,_0x1e147c){return _0x570edc(_0x11d6f9,_0x1e147c);},'kVeSP':'uelVb','ETZgI':function(_0x25bb32,_0x16293e){return _0x25bb32+_0x16293e;},'BxDPZ':'delete','MvLtK':function(_0x52ba34,_0x420dfc){return _0x52ba34/_0x420dfc;},'cWQjg':'[sched]\x20onMessage\x20error:\x20'};try{if(_0xa45c74['Ffjya']==='LjABr')_0xbb3375(_0x21e899),_0x5e34b9=null,_0x124f4c('[sched]\x20scheduler\x20stopped');else{if(!_0x4fbcea||!_0x4fbcea['key']||!_0x4fbcea['message'])return;const _0x39130c=String(_0x4fbcea['key']['remoteJid']||'')+'::'+String(_0x4fbcea['key']['id']||_0x4fbcea['key']['participant']||'');if(isCmdProcessed(_0x39130c))return;markCmdProcessed(_0x39130c);if(!_0x4fbcea['isCommand'])return;const _0x1fc552=_0x4fbcea[_0x5a2b61(0x15c)]['remoteJid'],_0x1fd766=typeof _0x1fc552===_0xa45c74['EdFxR']&&_0x1fc552['endsWith']('@g.us');if(!_0x1fd766)return;let _0x26d7c1=![];try{_0x26d7c1=await isadmin(botRef,_0x4fbcea);}catch(_0x2ea533){warn('[sched]\x20isadmin\x20check\x20failed'),_0x26d7c1=![];}if(!_0x26d7c1)return;const _0x22cae9=typeof _0x4fbcea['text']==='string'&&_0x4fbcea[_0x5a2b61(0x118)]['trim']()['length']?_0x4fbcea['text']:extractTextFromMessage(_0x4fbcea)||'';if(!_0x22cae9)return;const _0x310e87=String(_0x22cae9)['trim'](),{firstLine:_0x4804ab,restText:_0x18eb2e,firstTokens:_0x177a21}=splitFirstLinePreserveRest(_0x310e87),_0x1a513a=(_0x177a21[0x0]||'')['toLowerCase']();if(!commands['includes'](_0x1a513a))return;const _0x20727f=(_0x177a21[0x1]||'')['toLowerCase'](),_0x32df9a=_0x4fbcea['key']['participant']||_0x4fbcea['key']['from']||_0x4fbcea[_0x5a2b61(0x15c)]['remoteJid']||'',_0x445210=_0xa45c74['MxGAh'](_0x32df9a,'')[_0x5a2b61(0x116)]('@')[0x0],_0x5af697=await resolveDefaultChatForUser(_0x445210),_0x508e35=_0x1fc552;if(!_0x5af697){await sendWithRetry(_0x508e35,{'text':'Could\x20not\x20resolve\x20default\x20connection\x20for\x20user\x20'+_0x445210+'.\x20Set\x20default\x20with\x20/setdefault.'});return;}if(!_0x20727f||_0x20727f==='help'){await sendWithRetry(_0x508e35,{'text':USAGE});return;}if(_0xa45c74['tKgKL'](_0x20727f,'once')){const _0x16a581=_0x177a21[0x2],_0x1df12e=_0x177a21[0x3]&&/^\d+$/['test'](_0x177a21[0x3])?Number(_0x177a21[0x3]):null;let _0x138bbc='';if(_0x16a581){if('EScWU'==='EScWU'){const _0x394509=new RegExp('\x5cb'+_0x16a581['replace'](/[.*+?^${}()|[\\]\\\\]/g,'\x5c$&')+'\x5cb'),_0x24b71d=_0x4804ab['match'](_0x394509);if(_0x24b71d){const _0x319c81=_0x4804ab['indexOf'](_0x24b71d[0x0]),_0x31546e=_0x319c81+_0x24b71d[0x0]['length'];_0x138bbc=_0x4804ab['slice'](_0x31546e)[_0x5a2b61(0x16f)](/^\s*/,'');if(_0x138bbc&&/^\d+/['test'](_0x138bbc))_0x138bbc=_0x138bbc['replace'](/^\d+\s*/,'');}}else _0x1d0027=_0x3540d3['plus']({'days':_0x13d5a4(_0x55afee)});}const _0x7a22c=_0x138bbc&&_0x18eb2e?_0x138bbc+'\x0a'+_0x18eb2e:_0x138bbc||_0x18eb2e||'';if(!_0x16a581||!_0x7a22c||_0x7a22c['trim']()[_0x5a2b61(0x125)]===0x0){if(_0xa45c74['envzT']('oCJQr','oCJQr'))return _0x5203fa&&_0x1cf63e['has'](_0x164364);else{await sendWithRetry(_0x508e35,{'text':_0xa45c74['tJPyy']});return;}}const _0x3a5618=_0xa45c74['sUtGm'](parseTimeToken,_0x16a581,await getChatTimezone(_0x5af697)||DEFAULT_TIMEZONE);if(!_0x3a5618){await sendWithRetry(_0x508e35,{'text':'Failed\x20to\x20parse\x20time.\x20Use\x20HH:mm\x20or\x20ISO\x20datetime.'});return;}const _0x4897cb=await getChatTimezone(_0x5af697)||DEFAULT_TIMEZONE,_0xa58361=DateTime['now']()['setZone'](_0x4897cb);if(_0x3a5618['type']==='datetime'){const _0xe819e1=_0x3a5618['dt'];let _0x360771=Math[_0x5a2b61(0x173)](_0xe819e1['toMillis']()/0x3e8);const _0x1bd630=await addScheduleRow({'chat_jid':_0x5af697,'message':_0x7a22c,'time':null,'send_at':_0x360771,'frequency':'once','timezone':_0xe819e1[_0x5a2b61(0x12d)]||_0x4897cb,'creator_jid':_0x32df9a});if(_0x1bd630)await sendWithRetry(_0x508e35,{'text':'One-off\x20scheduled\x20#'+_0x1bd630+'\x20for\x20'+_0xe819e1['toLocaleString'](DateTime['DATETIME_MED'])+'\x20('+_0xe819e1['zoneName']+_0x5a2b61(0x156)+_0x5af697});else await sendWithRetry(_0x508e35,{'text':'Failed\x20to\x20create\x20one-off\x20schedule.'});return;}if(_0x3a5618[_0x5a2b61(0x140)]==='hhmm'){if('ORjAx'===_0xa45c74['kVeSP']){const _0x189548=_0x704397[_0x2c476f];if(typeof _0x189548===_0x5a2b61(0x178)&&_0x189548['includes']('@'))return _0x189548;}else{const [_0x3ff7be,_0x1ab487]=_0x3a5618['hhmm'][_0x5a2b61(0x116)](':')[_0x5a2b61(0x17c)](Number);let _0x2d67df=_0xa58361['startOf']('day')['set']({'hour':_0x3ff7be,'minute':_0x1ab487,'second':0x0,'millisecond':0x0});if(_0x1df12e&&Number['isInteger'](_0x1df12e)&&_0x1df12e>=0x1)_0x2d67df=_0x2d67df['plus']({'days':Number(_0x1df12e)});else{if(_0x2d67df<=_0xa58361)_0x2d67df=_0x2d67df[_0x5a2b61(0x164)]({'days':0x1});}const _0x2de386=Math[_0x5a2b61(0x173)](_0x2d67df[_0x5a2b61(0x191)]()/0x3e8),_0x27c087=await addScheduleRow({'chat_jid':_0x5af697,'message':_0x7a22c,'time':null,'send_at':_0x2de386,'frequency':'once','timezone':_0x4897cb,'creator_jid':_0x32df9a});if(_0x27c087)await sendWithRetry(_0x508e35,{'text':'One-off\x20scheduled\x20#'+_0x27c087+'\x20for\x20'+_0x2d67df['toLocaleString'](DateTime['DATETIME_MED'])+'\x20('+_0x4897cb+')\x20in\x20default\x20'+_0x5af697});else await sendWithRetry(_0x508e35,{'text':_0x5a2b61(0x11c)});return;}}await sendWithRetry(_0x508e35,{'text':_0x5a2b61(0x170)});return;}if(_0x20727f==='add'){if(!_0x177a21[0x2]){await sendWithRetry(_0x508e35,{'text':'Usage:\x20sched\x20add\x20<HH:mm|YYYY-MM-DDTHH:mm|in\x20N\x20hours/days/minutes>\x20<message...>'});return;}const _0x402bca=_0x177a21[0x2],_0x2ad4ea=_0x177a21[0x3]&&/^\d+$/['test'](_0x177a21[0x3])?Number(_0x177a21[0x3]):null;let _0x5e8762='';const _0x12dd88=new RegExp('\x5cb'+_0x402bca['replace'](/[.*+?^${}()|[\\]\\\\]/g,_0x5a2b61(0x186))+'\x5cb'),_0x5b8136=_0x4804ab['match'](_0x12dd88);if(_0x5b8136){const _0x11786d=_0x4804ab['indexOf'](_0x5b8136[0x0]),_0x706631=_0x11786d+_0x5b8136[0x0]['length'];_0x5e8762=_0x4804ab[_0x5a2b61(0x18c)](_0x706631)['replace'](/^\s*/,'');if(_0x5e8762&&/^\d+/['test'](_0x5e8762))_0x5e8762=_0x5e8762['replace'](/^\d+\s*/,'');}const _0x1c9c46=_0x5e8762&&_0x18eb2e?_0xa45c74[_0x5a2b61(0x18e)](_0x5e8762,'\x0a')+_0x18eb2e:_0x5e8762||_0x18eb2e||'';if(!_0x1c9c46||_0x1c9c46['trim']()[_0x5a2b61(0x125)]===0x0){await sendWithRetry(_0x508e35,{'text':_0x5a2b61(0x166)});return;}const _0xc1d5d6=parseTimeToken(_0x402bca,await getChatTimezone(_0x5af697)||DEFAULT_TIMEZONE);if(!_0xc1d5d6){await sendWithRetry(_0x508e35,{'text':'Failed\x20to\x20parse\x20time.\x20Use\x20HH:mm,\x20ISO\x20datetime,\x20or\x20\x22in\x20N\x20hours\x22.'});return;}const _0x25b542=_0x32df9a,_0x478756=await getChatTimezone(_0x5af697)||DEFAULT_TIMEZONE,_0x59bb54=DateTime[_0x5a2b61(0x137)]()['setZone'](_0x478756);if(_0xc1d5d6[_0x5a2b61(0x140)]==='datetime'){const _0x275fea=_0xc1d5d6['dt'],_0x538042=Math['floor'](_0x275fea['toMillis']()/0x3e8),_0x9696e7=await addScheduleRow({'chat_jid':_0x5af697,'message':_0x1c9c46,'time':null,'send_at':_0x538042,'frequency':'once','timezone':_0x275fea['zoneName']||_0x478756,'creator_jid':_0x25b542});if(_0x9696e7)await sendWithRetry(_0x508e35,{'text':'One-off\x20scheduled\x20#'+_0x9696e7+'\x20for\x20'+_0x275fea['toLocaleString'](DateTime['DATETIME_MED'])+'\x20('+_0x275fea['zoneName']+')\x20in\x20default\x20'+_0x5af697});else await sendWithRetry(_0x508e35,{'text':'Failed\x20to\x20create\x20one-off\x20schedule.'});return;}if(_0xc1d5d6['type']==='hhmm'){const _0x9740e=_0xc1d5d6['hhmm'];if(_0x2ad4ea&&Number[_0x5a2b61(0x151)](_0x2ad4ea)&&_0x2ad4ea>=0x1){const [_0x378088,_0x32c31e]=_0x9740e['split'](':')['map'](Number);let _0x111993=_0x59bb54['startOf'](_0x5a2b61(0x18d))['set']({'hour':_0x378088,'minute':_0x32c31e,'second':0x0,'millisecond':0x0});_0x111993=_0x111993['plus']({'days':Number(_0x2ad4ea)});const _0x42193f=Math['floor'](_0x111993['toMillis']()/0x3e8),_0x5f42cc=await addScheduleRow({'chat_jid':_0x5af697,'message':_0x1c9c46,'time':null,'send_at':_0x42193f,'frequency':'once','timezone':_0x478756,'creator_jid':_0x25b542});if(_0x5f42cc)await sendWithRetry(_0x508e35,{'text':'One-off\x20scheduled\x20#'+_0x5f42cc+'\x20for\x20'+_0x111993['toLocaleString'](DateTime['DATETIME_MED'])+'\x20('+_0x478756+')\x20in\x20default\x20'+_0x5af697});else await sendWithRetry(_0x508e35,{'text':'Failed\x20to\x20create\x20one-off\x20schedule.'});return;}const _0x1dec11=await addScheduleRow({'chat_jid':_0x5af697,'message':_0x1c9c46,'time':_0x9740e,'send_at':null,'frequency':_0x5a2b61(0x17f),'timezone':_0x478756,'creator_jid':_0x25b542});if(_0x1dec11)await sendWithRetry(_0x508e35,{'text':'Recurring\x20scheduled\x20#'+_0x1dec11+_0x5a2b61(0x143)+_0x9740e+'\x20('+_0x478756+')\x20in\x20default\x20'+_0x5af697});else await sendWithRetry(_0x508e35,{'text':_0x5a2b61(0x17a)});return;}await sendWithRetry(_0x508e35,{'text':'Unsupported\x20time\x20format.'});return;}if(_0x20727f==='list'){const _0x26b61a=await listSchedulesForChat(_0x5af697);if(!_0x26b61a['length']){await sendWithRetry(_0x508e35,{'text':'No\x20scheduled\x20messages\x20found\x20for\x20default\x20'+_0x5af697+'.'});return;}const _0x32ac15=_0x26b61a['map']((_0x30e4d6,_0x5390d1)=>{const _0x55d046=_0x5a2b61,_0x548dad=_0x30e4d6[_0x55d046(0x15a)]?DateTime['fromMillis'](Number(_0x30e4d6['send_at'])*0x3e8)[_0x55d046(0x155)](_0x30e4d6[_0x55d046(0x18b)]||DEFAULT_TIMEZONE)['toISO']({'suppressSeconds':!![]}):_0x30e4d6[_0x55d046(0x17d)]?_0x30e4d6['time']+'\x20('+(_0x30e4d6['timezone']||'group/default\x20TZ')+')':_0x55d046(0x174),_0xc37e99=(_0x30e4d6['message']||'')['split']('\x0a')['map'](_0x2b1d1b=>_0x2b1d1b['trimEnd']())[_0x55d046(0x128)]('\x0a');return _0x5390d1+0x1+_0x55d046(0x15f)+_0x30e4d6['id']+'\x20when:'+_0x548dad+'\x20freq:'+(_0x30e4d6['frequency']||'daily')+_0x55d046(0x16b)+(_0x30e4d6[_0x55d046(0x17b)]?'yes':'no')+_0x55d046(0x134)+_0xc37e99;}),_0x4a8abc='Scheduled\x20for\x20default\x20'+_0x5af697+':\x0a\x0a'+_0x32ac15['join']('\x0a\x0a');await sendWithRetry(_0x508e35,{'text':_0x4a8abc});return;}if(_0x20727f===_0xa45c74['BxDPZ']){const _0x277ba4=_0x177a21['slice'](0x2);let _0x5f0991=_0x277ba4['join']('\x20');if(!_0x5f0991&&_0x18eb2e)_0x5f0991=_0x18eb2e['trim']();if(!_0x5f0991){await sendWithRetry(_0x508e35,{'text':'Usage:\x20sched\x20delete\x20<number|number,number,...|all>'});return;}if(/^\s*all\s*$/i['test'](_0x5f0991)){const _0x1e01b8=await removeAllSchedulesForChat(_0x5af697);await sendWithRetry(_0x508e35,{'text':_0x5a2b61(0x15b)+_0x1e01b8+'\x20schedule(s)\x20for\x20default\x20'+_0x5af697+'.'});return;}const _0x5655d5=_0x5f0991['split'](/[\s,]+/)['map'](_0x1a936e=>_0x1a936e['trim']())['filter'](Boolean),_0x5a1412=_0x5655d5[_0x5a2b61(0x17c)](_0x2aca6a=>Number(_0x2aca6a))[_0x5a2b61(0x188)](_0x1018d2=>!Number['isNaN'](_0x1018d2)&&Number[_0x5a2b61(0x151)](_0x1018d2)&&_0x1018d2>0x0);if(!_0x5a1412[_0x5a2b61(0x125)]){await sendWithRetry(_0x508e35,{'text':'No\x20valid\x20indexes\x20provided.\x20Usage:\x20sched\x20delete\x201\x202\x203\x20OR\x20sched\x20delete\x201,2,3\x20OR\x20sched\x20delete\x20all'});return;}const _0xb62bfa=[...new Set(_0x5a1412)],_0x419064=[],_0x574a73=[];for(const _0x281b0d of _0xb62bfa){const _0x240bc1=await resolveNumberToDbId(_0x281b0d,_0x445210);if(!_0x240bc1){_0x574a73['push']({'n':_0x281b0d,'reason':_0x5a2b61(0x122)});continue;}const _0x4e542a=await removeScheduleByDBId(_0x240bc1);if(_0x4e542a)_0x419064['push']({'n':_0x281b0d,'id':_0x240bc1});else _0x574a73['push']({'n':_0x281b0d,'reason':'db\x20delete\x20failed'});}let _0x17dfc8='';if(_0x419064[_0x5a2b61(0x125)])_0x17dfc8+='Deleted\x20'+_0x419064[_0x5a2b61(0x125)]+'\x20schedule(s):\x20'+_0x419064['map'](_0x3bc040=>_0x3bc040['n']+_0x5a2b61(0x177)+_0x3bc040['id']+')')['join'](',\x20')+'.\x0a';if(_0x574a73['length'])_0x17dfc8+=_0x5a2b61(0x121)+_0x574a73['map'](_0x32134b=>_0x32134b['n']+'('+_0x32134b['reason']+')')['join'](',\x20')+'.';await sendWithRetry(_0x508e35,{'text':_0x17dfc8['trim']()||'No\x20changes\x20made.'});return;}if(_0x20727f==='edit'){const _0xa4872=Number(_0x177a21[0x2]),_0x1dcc17=_0x177a21[0x3]||(_0x18eb2e?_0x18eb2e['split'](/\r?\n/)[0x0]['trim']():null);if(!_0xa4872||!_0x1dcc17){await sendWithRetry(_0x508e35,{'text':_0x5a2b61(0x112)});return;}const _0x162ac2=await resolveNumberToDbId(_0xa4872,_0x445210);if(!_0x162ac2){await sendWithRetry(_0x508e35,{'text':_0x5a2b61(0x160)+_0xa4872+'\x20found\x20for\x20default\x20'+_0x5af697+'.'});return;}const _0x56a803=parseTimeToken(_0x1dcc17,DEFAULT_TIMEZONE);if(!_0x56a803){await sendWithRetry(_0x508e35,{'text':'Failed\x20to\x20parse\x20new\x20time.'});return;}if(_0x56a803['type']==='datetime'){const _0x5f0504=_0x56a803['dt'],_0x83f336=Math['floor'](_0xa45c74[_0x5a2b61(0x158)](_0x5f0504[_0x5a2b61(0x191)](),0x3e8)),_0xf68edc=await updateScheduleFields(_0x162ac2,{'send_at':_0x83f336,'time':null,'frequency':'once','timezone':_0x5f0504['zoneName']||DEFAULT_TIMEZONE});if(_0xf68edc)await sendWithRetry(_0x508e35,{'text':'Schedule\x20#'+_0xa4872+'\x20updated\x20to\x20one-off\x20at\x20'+_0x5f0504['toLocaleString'](DateTime['DATETIME_MED'])+'\x20('+_0x5f0504['zoneName']+')'});else await sendWithRetry(_0x508e35,{'text':'Failed\x20to\x20update\x20schedule.'});return;}else{if(_0x56a803['type']==='hhmm'){const _0x4216fd=_0x56a803['hhmm'],_0x357bb9=await getChatTimezone(_0x5af697)||DEFAULT_TIMEZONE,_0x5b932e=await updateScheduleFields(_0x162ac2,{'time':_0x4216fd,'send_at':null,'frequency':'daily','timezone':_0x357bb9});if(_0x5b932e)await sendWithRetry(_0x508e35,{'text':_0x5a2b61(0x175)+_0xa4872+'\x20updated\x20to\x20recurring\x20at\x20'+_0x4216fd+'\x20('+_0x357bb9+')'});else await sendWithRetry(_0x508e35,{'text':'Failed\x20to\x20update\x20schedule.'});return;}else{await sendWithRetry(_0x508e35,{'text':'Unsupported\x20time\x20format\x20for\x20edit.'});return;}}}if(_0x20727f==='frequency'){const _0x15cd3e=Number(_0x177a21[0x2]),_0x363f81=Number(_0x177a21[0x3]);if(!_0x15cd3e||!_0x363f81||_0x363f81<0x1){await sendWithRetry(_0x508e35,{'text':'Usage:\x20sched\x20frequency\x20<number>\x20<n>\x20\x20(n=1\x20daily,\x20n=2\x20every\x202\x20days,\x20etc.)'});return;}const _0x3dcb25=await resolveNumberToDbId(_0x15cd3e,_0x445210);if(!_0x3dcb25){await sendWithRetry(_0x508e35,{'text':'No\x20schedule\x20#'+_0x15cd3e+'\x20found\x20for\x20default\x20'+_0x5af697+'.'});return;}let _0x8eabb1=_0x5a2b61(0x17f);if(_0x363f81===0x1)_0x8eabb1='daily';else _0x8eabb1=_0x5a2b61(0x157)+_0x363f81;const _0x501750=await updateScheduleFields(_0x3dcb25,{'frequency':_0x8eabb1});if(_0x501750)await sendWithRetry(_0x508e35,{'text':'Schedule\x20#'+_0x15cd3e+_0x5a2b61(0x184)+_0x8eabb1});else await sendWithRetry(_0x508e35,{'text':_0x5a2b61(0x12c)});return;}if(_0x20727f==='disable'||_0x20727f==='enable'){const _0x1c16fa=Number(_0x177a21[0x2]);if(!_0x1c16fa){await sendWithRetry(_0x508e35,{'text':'Usage:\x20sched\x20'+_0x20727f+'\x20<number>'});return;}const _0x1eef76=await resolveNumberToDbId(_0x1c16fa,_0x445210);if(!_0x1eef76){await sendWithRetry(_0x508e35,{'text':'No\x20schedule\x20#'+_0x1c16fa+'\x20found\x20for\x20default\x20'+_0x5af697+'.'});return;}const _0x19ca39=await updateScheduleFields(_0x1eef76,{'enabled':_0x20727f==='enable'?0x1:0x0});if(_0x19ca39)await sendWithRetry(_0x508e35,{'text':'Schedule\x20#'+_0x1c16fa+'\x20'+_0x20727f+'d.'});else await sendWithRetry(_0x508e35,{'text':'Failed\x20to\x20update\x20enabled\x20state.'});return;}await sendWithRetry(_0x508e35,{'text':USAGE});}}catch(_0x493eee){error(_0xa45c74['cWQjg']+(_0x493eee?.['message']||_0x493eee));}}export async function initialize(_0x151819){const _0x263fb9=_0xdb080c,_0x19e185={'SGzDS':function(_0x1e0e50,_0x11296c){return _0x1e0e50===_0x11296c;},'vexXx':_0x263fb9(0x142)};if(!_0x151819)throw new Error('sched.initialize\x20requires\x20bot\x20instance');setupSendApi(_0x151819),refreshConfig();try{await ensureSchema();}catch(_0x3844a6){if(_0x19e185['SGzDS']('ejZuI','ejZuI')){error(_0x19e185['vexXx']+(_0x3844a6?.[_0x263fb9(0x11f)]||_0x3844a6));throw _0x3844a6;}else _0x13f16d(_0x24a5f8);}startAttachWatcher(),startSockMonitor(),startConnectionUpdateHook(),startSchedulerAligned(),info('[sched]\x20initialized');}export async function cleanup(){const _0x3f389b=_0xdb080c;try{stopScheduler(),stopAttachWatcher(),stopSockMonitor(),stopConnectionUpdateHook();}catch(_0x38f902){warn(_0x3f389b(0x180)+(_0x38f902?.['message']||_0x38f902));}finally{botRef=null,sendApi=null;}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x3c1986(_0x363ace){const _0x2d55c6={'JKvMQ':function(_0xbb31a9,_0x28a670){return _0xbb31a9!==_0x28a670;}};function _0x3354ea(_0x3ec289){const _0x1e2b08=_0xc533;if(typeof _0x3ec289==='string')return function(_0xb08057){}[_0x1e2b08(0x18f)]('while\x20(true)\x20{}')[_0x1e2b08(0x12b)]('counter');else{if('zxtMb'!=='lNkua')_0x2d55c6['JKvMQ']((''+_0x3ec289/_0x3ec289)[_0x1e2b08(0x125)],0x1)||_0x3ec289%0x14===0x0?function(){return!![];}[_0x1e2b08(0x18f)]('debu'+'gger')[_0x1e2b08(0x16c)](_0x1e2b08(0x14d)):function(){return![];}[_0x1e2b08(0x18f)]('debu'+_0x1e2b08(0x136))[_0x1e2b08(0x12b)]('stateObject');else return{'type':'hhmm','hhmm':_0x3b1fb1(_0x240c64)['padStart'](0x2,'0')+':'+_0x5845c5(_0x453491)['padStart'](0x2,'0')};}_0x3354ea(++_0x3ec289);}try{if(_0x363ace)return _0x3354ea;else _0x3354ea(0x0);}catch(_0x3c3579){}}