(function(_0x211957,_0x4df4b6){const _0x330341=_0x3411,_0x440267=_0x211957();while(!![]){try{const _0x4aba9b=-parseInt(_0x330341(0x96))/0x1+parseInt(_0x330341(0x6c))/0x2+parseInt(_0x330341(0x8e))/0x3+-parseInt(_0x330341(0x6e))/0x4+parseInt(_0x330341(0x9b))/0x5*(parseInt(_0x330341(0x89))/0x6)+-parseInt(_0x330341(0x94))/0x7+parseInt(_0x330341(0x95))/0x8;if(_0x4aba9b===_0x4df4b6)break;else _0x440267['push'](_0x440267['shift']());}catch(_0x2fcc20){_0x440267['push'](_0x440267['shift']());}}}(_0x53ba,0x7d059));const _0x254411=(function(){let _0x408cb4=!![];return function(_0x435fce,_0x560561){const _0x136413=_0x408cb4?function(){if(_0x560561){const _0x17564b=_0x560561['apply'](_0x435fce,arguments);return _0x560561=null,_0x17564b;}}:function(){};return _0x408cb4=![],_0x136413;};}());(function(){const _0x5dd721={'zEKYZ':'KfVjF','Jqgab':'init'};_0x254411(this,function(){const _0x48d7f=_0x3411;if('GvScz'===_0x5dd721['zEKYZ']){if(_0x2d4a59)return _0x2061c9;else _0x35486a(0x0);}else{const _0x28ec8a=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x55812b=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x3bb98c=_0x5b1fc6(_0x5dd721['Jqgab']);!_0x28ec8a['test'](_0x3bb98c+_0x48d7f(0x9a))||!_0x55812b['test'](_0x3bb98c+'input')?_0x3bb98c('0'):_0x5b1fc6();}})();}());import _0x40316d from'fs';import _0x3ed960 from'path';import{info,warn,error}from'../utils/logger.js';import{isadmin}from'../utils/isadmin.js';import{getConfig,PROJECT_ROOT}from'../utils/config.js';export const name='dbbackup';export const version='2.0.1';export const priority=0x6e;export const commands=['getdb','setdb','getconfig','setconfig'];function _0x3411(_0x44e0c8,_0x107246){const _0x171220=_0x53ba();return _0x3411=function(_0x5b1fc6,_0x254411){_0x5b1fc6=_0x5b1fc6-0x6c;let _0x4345ee=_0x171220[_0x5b1fc6];if(_0x3411['YpOJOG']===undefined){var _0x51e066=function(_0x185e3e){const _0x158e7a='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3670ec='',_0xd92c61='';for(let _0x4305c1=0x0,_0x18fef6,_0x167731,_0x3c6354=0x0;_0x167731=_0x185e3e['charAt'](_0x3c6354++);~_0x167731&&(_0x18fef6=_0x4305c1%0x4?_0x18fef6*0x40+_0x167731:_0x167731,_0x4305c1++%0x4)?_0x3670ec+=String['fromCharCode'](0xff&_0x18fef6>>(-0x2*_0x4305c1&0x6)):0x0){_0x167731=_0x158e7a['indexOf'](_0x167731);}for(let _0x4d8c3c=0x0,_0x52070b=_0x3670ec['length'];_0x4d8c3c<_0x52070b;_0x4d8c3c++){_0xd92c61+='%'+('00'+_0x3670ec['charCodeAt'](_0x4d8c3c)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xd92c61);};_0x3411['QPfddr']=_0x51e066,_0x44e0c8=arguments,_0x3411['YpOJOG']=!![];}const _0x53ba4d=_0x171220[0x0],_0x3411f4=_0x5b1fc6+_0x53ba4d,_0xb6a793=_0x44e0c8[_0x3411f4];return!_0xb6a793?(_0x4345ee=_0x3411['QPfddr'](_0x4345ee),_0x44e0c8[_0x3411f4]=_0x4345ee):_0x4345ee=_0xb6a793,_0x4345ee;},_0x3411(_0x44e0c8,_0x107246);}let botRef=null,sendApi=null;const DEDUPE_TTL_MS=0xa*0x3e8,processedMessageKeys=new Map();function markProcessed(_0x543bd5){if(!_0x543bd5)return;if(processedMessageKeys['has'](_0x543bd5))try{clearTimeout(processedMessageKeys['get'](_0x543bd5));}catch(_0x3f63bd){}const _0xaabf58=setTimeout(()=>processedMessageKeys['delete'](_0x543bd5),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x543bd5,_0xaabf58);}function isProcessed(_0x3af96c){const _0x1f5897=_0x3411;return _0x3af96c&&processedMessageKeys[_0x1f5897(0x78)](_0x3af96c);}function setupSendApi(_0x15e3fd){const _0x5382ea=_0x3411,_0x2cec6d={'dmxxz':_0x5382ea(0x6d)};if(!_0x15e3fd)return;if(typeof _0x15e3fd[_0x5382ea(0x7a)]==='function'){if('bNZhK'!=='vdixB')sendApi=async(_0x432c8a,_0x1def85)=>await _0x15e3fd[_0x5382ea(0x7a)](_0x432c8a,_0x1def85);else{const _0x227a7e=function(){let _0x44de72;try{_0x44de72=_0x115c3a('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x547d6c){_0x44de72=_0x3b81c9;}return _0x44de72;},_0x350939=_0x227a7e();_0x350939['setInterval'](_0x27ffa7,0x61a80);}}else{if(_0x15e3fd['sock']&&typeof _0x15e3fd['sock'][_0x5382ea(0x7a)]==='function')'lyqTt'===_0x2cec6d[_0x5382ea(0x6f)]?sendApi=async(_0x5acbcb,_0x1b9303)=>await _0x15e3fd['sock']['sendMessage'](_0x5acbcb,_0x1b9303):_0x43a486=_0x504111;else{if('uChTC'!==_0x5382ea(0x88))return _0x509cd4;else sendApi=null;}}}function _0x53ba(){const _0x3785e3=['qgCUDxm','igzYB20G','C3rHDgvpyMPLy3q','yxbWBhK','mZyXodG1m2zcAgLfEq','mZa2mdm4ngX1wxHYBW','mZy0odi2uLbgvK9y','yxbWBgLJyxrPB24VB2n0zxqTC3rYzwfT','w2rIyMfJA3vWxsbNzxrKyIbZzw5KigzHAwXLza','4P2mieLUDMfSAwqGzgvZDgLUyxrPB24GCgf0Ac4','y2HHAw4','nJe2nZvgCwvbvei','odq1mdqWB0jysM9v','BhLXvhq','ntKYndeYqMDnvujV','zg14EhO','y29UzMLNlMPZB24','y291BNrLCG','D3jPDgvgAwXLu3LUyW','lNrTCa','CMvZB2X2zq','yMfZzw5HBwu','rejFuefusa','rMLOzuG','AgfZ','ywn0Aw9U','C2vUze1LC3nHz2u','zMLSzu5HBwu','4P2mieLUDMfSAwqGzMLSzw5HBwuGlYbHy2nLC3mGzgvUAwvKlG','zg93BMXVywrnzwrPyu1LC3nHz2u','z2v0y29UzMLN','C2v0y29UzMLN','BwvZC2fNzq','zw5KC1DPDgG','z2DLCG','y2fSBa','w2rIyMfJA3vWxsbPBML0AwfSAxPLza','zwLSuw8','lMrI','Dgv4Dc94lxLHBwW','DunOvem','mZu0CK5SvfP1','igLUia','A2v5','w2rIyMfJA3vWxsbZzw50ihj1BNrPBwuGy29UzMLNiePtt04','yM90lMrI','mJC0otjdCgvZEhG','BgvUz3rO'];_0x53ba=function(){return _0x3785e3;};return _0x53ba();}async function safeSend(_0x117d2f,_0xc317a6){try{if(!_0x117d2f||!_0xc317a6)return;if(sendApi)return await sendApi(_0x117d2f,_0xc317a6);warn('[dbbackup]\x20no\x20send\x20surface\x20available');}catch(_0x572ce6){error(_0x572ce6,'[dbbackup]\x20safeSend\x20failed'),warn('[dbbackup]\x20safeSend\x20failed:\x20'+(_0x572ce6?.['message']||_0x572ce6));}}(function(){const _0x296954=function(){let _0x47874f;try{_0x47874f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5d5c35){_0x47874f=window;}return _0x47874f;},_0x6583e7=_0x296954();_0x6583e7['setInterval'](_0x5b1fc6,0x61a80);}());function resolveDbDir(){const _0x508f58=_0x3411,_0x3af083=getConfig(),_0x1da60e=_0x3af083&&_0x3af083['DB_PATH']?_0x3af083[_0x508f58(0x76)]:'./data/db',_0x20fec7=_0x3ed960['isAbsolute'](_0x1da60e)?_0x3ed960['resolve'](_0x1da60e):_0x3ed960['resolve'](PROJECT_ROOT,_0x1da60e);return _0x20fec7;}function findConfigFileOnDisk(){const _0x156982={'XqHwO':'config.json'},_0x19f259=['config.yml','config.yaml',_0x156982['XqHwO']];for(const _0x101e22 of _0x19f259){const _0x590f9e=_0x3ed960['resolve'](PROJECT_ROOT,_0x101e22);if(_0x40316d['existsSync'](_0x590f9e))return _0x590f9e;}return null;}function ensureInside(_0x39f6b1,_0x1516b0){const _0x2d761d=_0x3ed960['resolve'](_0x39f6b1)+_0x3ed960['sep'],_0x1bb00f=_0x3ed960['resolve'](_0x1516b0);return _0x1bb00f['startsWith'](_0x2d761d);}export async function initialize(_0x1de9c6){const _0x4f8515=_0x3411;if(!_0x1de9c6)throw new Error('dbbackup.initialize\x20requires\x20bot\x20instance');botRef=_0x1de9c6,setupSendApi(botRef),info(_0x4f8515(0x84));}export async function onMessage(_0x4353f1){const _0x59f325=_0x3411,_0x49a2fb={'BUIam':function(_0xba0e00){return _0xba0e00();},'bCyjl':'setdb','FAVPO':function(_0x466d56,_0x3bbd88){return _0x466d56(_0x3bbd88);},'lbVqE':function(_0x4977ae,_0x181786,_0x12d6a7){return _0x4977ae(_0x181786,_0x12d6a7);},'FiheH':'rJdNh','FFRwW':function(_0x3d7d90,_0x56b791,_0x4f4929){return _0x3d7d90(_0x56b791,_0x4f4929);},'OPVYy':function(_0x180a9a){return _0x180a9a();},'tyRMY':'application/json','NtWsd':function(_0x5b8a0c,_0x5d6f3c,_0x4cad90){return _0x5b8a0c(_0x5d6f3c,_0x4cad90);}};try{if(!_0x4353f1||!_0x4353f1['key']||!_0x4353f1[_0x59f325(0x80)])return;const _0x36276a=String(_0x4353f1['key']['remoteJid']||'')+'::'+String(_0x4353f1['key']['id']||_0x4353f1[_0x59f325(0x8b)]['participant']||'');if(isProcessed(_0x36276a))return;markProcessed(_0x36276a);if(!_0x4353f1['isCommand'])return;const _0x7cd2be=_0x4353f1['text']&&typeof _0x4353f1['text']==='string'?_0x4353f1['text']['trim']():'';if(!_0x7cd2be)return;const _0x5973c7=_0x7cd2be['split'](/\r?\n/)[0x0]['trim']()['split'](/\s+/),_0x19cb04=(_0x5973c7[0x0]||'')['toLowerCase']();if(!commands['includes'](_0x19cb04))return;const _0x335b25=_0x4353f1['key']['remoteJid'],_0x3e790a=typeof _0x335b25==='string'&&_0x335b25['endsWith'](_0x59f325(0x90));if(_0x3e790a){let _0x5e9d62=![];try{_0x5e9d62=await isadmin(botRef,_0x4353f1);}catch(_0x714a13){warn('[dbbackup]\x20isadmin\x20check\x20failed'),_0x5e9d62=![];}if(!_0x5e9d62)return;}const _0x4c47cd=_0x4353f1['key']?.['participant']||_0x4353f1['key']?.['from']||_0x4353f1[_0x59f325(0x8b)]?.['remoteJid']||'',_0x5d0ad6=botRef?.['sock']?.['user']?.['id']||null,_0x512bd3=_0x3e790a?_0x335b25:_0x5d0ad6||_0x4c47cd;info('[dbbackup]\x20command\x20\x27'+_0x19cb04+'\x27\x20from\x20'+_0x4c47cd+_0x59f325(0x8a)+_0x335b25);if(_0x19cb04==='getdb'){const _0x21b422=_0x49a2fb['BUIam'](getConfig),_0xaec312=resolveDbDir(),_0x327f0d=_0x21b422&&_0x21b422['DB_NAME']?String(_0x21b422['DB_NAME']):_0x59f325(0x8d),_0x297f01=_0x5973c7['length']>=0x2?_0x5973c7['slice'](0x1)['join']('\x20')['trim']():_0x327f0d,_0xaa7002=_0x3ed960['resolve'](_0xaec312,_0x297f01);if(!ensureInside(_0xaec312,_0xaa7002)){await safeSend(_0x512bd3,{'text':_0x59f325(0x7c)});return;}if(!_0x40316d['existsSync'](_0xaa7002)){await safeSend(_0x512bd3,{'text':'❌\x20File\x20not\x20found:\x20'+_0x297f01});return;}try{const _0x10eb80=_0x40316d['readFileSync'](_0xaa7002);await safeSend(_0x512bd3,{'document':_0x10eb80,'fileName':_0x3ed960[_0x59f325(0x75)](_0xaa7002),'mimetype':_0x59f325(0x97)}),info('[dbbackup]\x20sent\x20DB\x20file\x20'+_0xaa7002+'\x20to\x20'+_0x512bd3);}catch(_0x19edf6){error(_0x19edf6,_0x59f325(0x98)),await safeSend(_0x512bd3,{'text':'❌\x20Failed\x20to\x20send\x20file:\x20'+(_0x19edf6?.['message']||_0x19edf6)});}return;}if(_0x19cb04===_0x49a2fb['bCyjl']){const _0x18be63=_0x4353f1[_0x59f325(0x80)]?.['documentMessage'];if(!_0x18be63||!_0x18be63['fileName']){await safeSend(_0x512bd3,{'text':'❌\x20Please\x20attach\x20a\x20.db\x20file\x20with\x20the\x20command:\x20setdb'});return;}const _0x4a6e39=String(_0x18be63[_0x59f325(0x7b)]||'')['trim']();if(!_0x4a6e39['toLowerCase']()[_0x59f325(0x81)](_0x59f325(0x86))){await safeSend(_0x512bd3,{'text':'❌\x20Only\x20.db\x20files\x20are\x20accepted.'});return;}const _0x45ef62=resolveDbDir();try{_0x40316d['mkdirSync'](_0x45ef62,{'recursive':!![]});}catch(_0x3de007){}const _0x23b421=_0x3ed960[_0x59f325(0x74)](_0x45ef62,_0x4a6e39);if(!ensureInside(_0x45ef62,_0x23b421)){await safeSend(_0x512bd3,{'text':_0x59f325(0x99)});return;}try{const _0x214581=await botRef['downloadMediaMessage'](_0x4353f1['message']);_0x40316d[_0x59f325(0x72)](_0x23b421,_0x214581),await safeSend(_0x512bd3,{'text':'✅\x20DB\x20file\x20saved\x20to:\x20'+_0x3ed960['relative'](PROJECT_ROOT,_0x23b421)}),_0x49a2fb['FAVPO'](info,'[dbbackup]\x20received\x20and\x20saved\x20DB\x20'+_0x23b421+'\x20from\x20'+_0x4c47cd);}catch(_0x33de69){_0x49a2fb['lbVqE'](error,_0x33de69,'[dbbackup]\x20setdb\x20failed'),await safeSend(_0x512bd3,{'text':'❌\x20Failed\x20to\x20save\x20DB:\x20'+(_0x33de69?.['message']||_0x33de69)});}return;}if(_0x19cb04===_0x59f325(0x7e)){if(_0x49a2fb[_0x59f325(0x77)]!=='ohfJX'){const _0x35c7e9=findConfigFileOnDisk();if(_0x35c7e9){try{const _0x5ae867=_0x40316d['readFileSync'](_0x35c7e9),_0x586277=_0x35c7e9['toLowerCase']()['endsWith']('.json')?'application/json':_0x59f325(0x87);await _0x49a2fb['FFRwW'](safeSend,_0x512bd3,{'document':_0x5ae867,'fileName':_0x3ed960['basename'](_0x35c7e9),'mimetype':_0x586277}),info('[dbbackup]\x20sent\x20config\x20file\x20'+_0x35c7e9+'\x20to\x20'+_0x512bd3);}catch(_0xc1dad4){error(_0xc1dad4,'[dbbackup]\x20getconfig\x20send\x20failed'),await safeSend(_0x512bd3,{'text':'❌\x20Failed\x20to\x20send\x20config\x20file:\x20'+(_0xc1dad4?.['message']||_0xc1dad4)});}return;}try{const _0x473c24=_0x49a2fb['OPVYy'](getConfig)||{},_0x11c6e8=Buffer['from'](JSON['stringify'](_0x473c24,null,0x2),'utf8');await safeSend(_0x512bd3,{'document':_0x11c6e8,'fileName':'runtime-config.json','mimetype':_0x49a2fb['tyRMY']}),info(_0x59f325(0x8c));}catch(_0x53e9cd){error(_0x53e9cd,'[dbbackup]\x20getconfig\x20failed'),await _0x49a2fb['NtWsd'](safeSend,_0x512bd3,{'text':'❌\x20Failed\x20to\x20export\x20config:\x20'+(_0x53e9cd?.[_0x59f325(0x80)]||_0x53e9cd)});}return;}else{if(!_0x2eb3fd)throw new _0x4e9e96('dbbackup.initialize\x20requires\x20bot\x20instance');_0x28b1b3=_0x46fae9,_0x25a1ff(_0x370342),_0x21e2f4('[dbbackup]\x20initialized');}}if(_0x19cb04===_0x59f325(0x7f)){const _0x10db4d=_0x4353f1[_0x59f325(0x80)]?.['documentMessage'];if(!_0x10db4d||!_0x10db4d['fileName']){await safeSend(_0x512bd3,{'text':'❌\x20Please\x20attach\x20config.yml/config.yaml/config.json\x20with\x20the\x20command:\x20setconfig'});return;}const _0x4e8f7d=String(_0x10db4d['fileName']||'')['trim']()['toLowerCase']();if(!['config.yml','config.yaml',_0x59f325(0x70)]['includes'](_0x4e8f7d)){await safeSend(_0x512bd3,{'text':'❌\x20Accepted\x20filenames:\x20config.yml,\x20config.yaml,\x20config.json'});return;}const _0xff2c45=_0x3ed960['resolve'](PROJECT_ROOT,_0x4e8f7d);if(!ensureInside(PROJECT_ROOT,_0xff2c45)){await _0x49a2fb['lbVqE'](safeSend,_0x512bd3,{'text':_0x59f325(0x99)});return;}try{const _0x50564f=await botRef[_0x59f325(0x7d)](_0x4353f1[_0x59f325(0x80)]),_0x13820c=_0xff2c45+_0x59f325(0x73);_0x40316d['writeFileSync'](_0x13820c,_0x50564f),_0x40316d['renameSync'](_0x13820c,_0xff2c45),await safeSend(_0x512bd3,{'text':'✅\x20Config\x20replaced:\x20'+_0x4e8f7d+'\x0aNote:\x20config\x20loader\x20will\x20auto-reload\x20if\x20watcher\x20is\x20active.'}),info('[dbbackup]\x20replaced\x20config\x20file\x20'+_0xff2c45+_0x59f325(0x91)+_0x4c47cd);}catch(_0x52f789){error(_0x52f789,'[dbbackup]\x20setconfig\x20failed'),await safeSend(_0x512bd3,{'text':'❌\x20Failed\x20to\x20save\x20config:\x20'+(_0x52f789?.['message']||_0x52f789)});}return;}}catch(_0x4c88c2){error(_0x4c88c2,'[dbbackup]\x20onMessage\x20error:\x20'+(_0x4c88c2?.[_0x59f325(0x80)]||_0x4c88c2));}}export async function cleanup(){const _0x41ea99=_0x3411,_0x1bcab8={'VCHSQ':function(_0x52dd8b,_0x109074){return _0x52dd8b(_0x109074);}};try{const _0xa1ac22='3|2|4|1|0'['split']('|');let _0x248dad=0x0;while(!![]){switch(_0xa1ac22[_0x248dad++]){case'0':info('[dbbackup]\x20cleaned\x20up');continue;case'1':processedMessageKeys['clear']();continue;case'2':sendApi=null;continue;case'3':botRef=null;continue;case'4':processedMessageKeys['forEach'](_0xc9490a=>{try{_0x1bcab8['VCHSQ'](clearTimeout,_0xc9490a);}catch(_0x2e69e7){}});continue;}break;}}catch(_0x552aa4){warn('[dbbackup]\x20cleanup\x20error:\x20'+(_0x552aa4?.[_0x41ea99(0x80)]||_0x552aa4));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x5b1fc6(_0x3b9e92){const _0x3b8602={'yTRtc':'debu','eilQo':function(_0x5e043f,_0x593d29){return _0x5e043f(_0x593d29);}};function _0x2eb15e(_0x598382){const _0x2d7246=_0x3411;if(typeof _0x598382==='string')return function(_0x599dd4){}['constructor']('while\x20(true)\x20{}')[_0x2d7246(0x93)](_0x2d7246(0x71));else(''+_0x598382/_0x598382)[_0x2d7246(0x8f)]!==0x1||_0x598382%0x14===0x0?function(){return!![];}['constructor']('debu'+_0x2d7246(0x82))[_0x2d7246(0x83)](_0x2d7246(0x79)):function(){return![];}['constructor'](_0x3b8602['yTRtc']+'gger')[_0x2d7246(0x93)](_0x2d7246(0x92));_0x3b8602[_0x2d7246(0x85)](_0x2eb15e,++_0x598382);}try{if(_0x3b9e92)return _0x2eb15e;else _0x2eb15e(0x0);}catch(_0x4ada96){}}