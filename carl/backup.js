const _0x230fa5=_0x38a2;(function(_0xc91c5c,_0x519281){const _0x2b44d3=_0x38a2,_0x484659=_0xc91c5c();while(!![]){try{const _0x52216e=-parseInt(_0x2b44d3(0xaa))/0x1+-parseInt(_0x2b44d3(0xaf))/0x2+parseInt(_0x2b44d3(0xcf))/0x3*(-parseInt(_0x2b44d3(0xce))/0x4)+-parseInt(_0x2b44d3(0xad))/0x5*(parseInt(_0x2b44d3(0xa6))/0x6)+-parseInt(_0x2b44d3(0xcd))/0x7*(parseInt(_0x2b44d3(0xb5))/0x8)+-parseInt(_0x2b44d3(0xc4))/0x9*(-parseInt(_0x2b44d3(0x9f))/0xa)+parseInt(_0x2b44d3(0xc3))/0xb;if(_0x52216e===_0x519281)break;else _0x484659['push'](_0x484659['shift']());}catch(_0x381d49){_0x484659['push'](_0x484659['shift']());}}}(_0x49d1,0x9a629));const _0x59d206=(function(){let _0x5f4f21=!![];return function(_0x562613,_0x1a9800){const _0x47c8f2=_0x38a2;if(_0x47c8f2(0xa9)!=='FNJlW'){const _0x5061b5=_0x5f4f21?function(){if(_0x1a9800){const _0x49b11b=_0x1a9800['apply'](_0x562613,arguments);return _0x1a9800=null,_0x49b11b;}}:function(){};return _0x5f4f21=![],_0x5061b5;}else{const _0x460a63=_0x53a9e4['resolve'](_0xc88c10,_0x56bfde);if(_0x4fdd41['existsSync'](_0x460a63))return _0x460a63;}};}());(function(){const _0x2adc95={'CoTaJ':function(_0x31ccc7,_0x3ef494){return _0x31ccc7(_0x3ef494);},'FRAtf':function(_0x93a9ab,_0x2e4f64){return _0x93a9ab(_0x2e4f64);}};_0x59d206(this,function(){const _0x4874e7=_0x38a2,_0x35fe83=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x2323de=new RegExp(_0x4874e7(0xbb),'i'),_0x3a833d=_0x2adc95['FRAtf'](_0x2859e1,_0x4874e7(0xac));!_0x35fe83['test'](_0x3a833d+'chain')||!_0x2323de['test'](_0x3a833d+'input')?_0x3a833d('0'):_0x4874e7(0xb6)!=='nUVdx'?_0x2adc95['CoTaJ'](_0x4dd597,0x0):_0x2859e1();})();}());import _0x1180be from'fs';import _0x568260 from'path';import{info,warn,error}from'../utils/logger.js';import{isadmin}from'../utils/isadmin.js';import{getConfig,PROJECT_ROOT}from'../utils/config.js';export const name='dbbackup';export const version='2.0.1';export const priority=0x6e;export const commands=['getdb','setdb','getconfig',_0x230fa5(0xc5)];let botRef=null,sendApi=null;function _0x49d1(){const _0x3fb4d2=['AM9PBG','4P2mieLUDMfSAwqGzgvZDgLUyxrPB24GCgf0Ac4','BgvUz3rO','zNvUy3rPB24','zMLSzu5HBwu','lMPZB24','igzYB20G','nda1mtC5mdzKDwzsBwS','ovH3AM5XvG','C2v0y29UzMLN','4P2miefJy2vWDgvKigzPBgvUyw1LCZOGy29UzMLNlNLTBcWGy29UzMLNlNLHBwWSignVBMzPzY5QC29U','Aw5JBhvKzxm','y29UzMLNlNLHBwW','w2rIyMfJA3vWxsbJBgvHBMvKihvW','Dgv4Da','ChjJEfO','yxbWBgLJyxrPB24VANnVBG','nZDQuxfxuw8','ndKXndy1mLnos0HYvW','m3nOqKLXqG','odi4mZuYmgLvwNL5sG','4P2miezHAwXLzcb0BYbLEhbVCNqGy29UzMLNoIa','z2v0','w2rIyMfJA3vWxsbPBML0AwfSAxPLza','CfjctKK','BwvZC2fNzq','A2v5','nKLcCMHSDW','w2rIyMfJA3vWxsbYzxbSywnLzcbJB25MAwCGzMLSzsa','4P2mifbSzwfZzsbHDhrHy2GGysaUzgiGzMLSzsb3AxrOihrOzsbJB21Tyw5KoIbZzxrKyG','DePAu3m','ntC2mJe5BLDpANnO','rejFtKfnrq','Aw5PDa','ntK2ntG2nwXwCvLfvW','zg9JDw1LBNrnzxnZywDL','mtCWmdy1ofzTu1fhvG','q2TYzLu','DhjPBq','C29JAW','Bvj6A0S','C2v0','mJi1odrRqMLkAhy','BLvwzhG','CMvZB2X2zq','4P2mieLUDMfSAwqGzMLSzw5HBwuGlYbHy2nLC3mGzgvUAwvKlG','w2rIyMfJA3vWxsbZzxrJB25MAwCGzMfPBgvK','w2rIyMfJA3vWxsbZywzLu2vUzcbMywLSzwq','xcTCkYaQkd86w2eTEKeTwL8KxvSWltLHlxPblvPFjf0Qkq'];_0x49d1=function(){return _0x3fb4d2;};return _0x49d1();}(function(){let _0x508152;try{const _0x356744=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x508152=_0x356744();}catch(_0x3f09d3){_0x508152=window;}_0x508152['setInterval'](_0x2859e1,0x61a80);}());const DEDUPE_TTL_MS=0xa*0x3e8,processedMessageKeys=new Map();function markProcessed(_0x44b096){const _0x30373c=_0x230fa5,_0x2657b8={'mRzkK':function(_0xa7cb6c,_0x58d855){return _0xa7cb6c(_0x58d855);}};if(!_0x44b096)return;if(processedMessageKeys['has'](_0x44b096))try{'JaJRH'==='FJrmj'?(_0x2657b8[_0x30373c(0xb3)](_0x342b66,'[dbbackup]\x20isadmin\x20check\x20failed'),_0x4f34e6=![]):clearTimeout(processedMessageKeys[_0x30373c(0xa1)](_0x44b096));}catch(_0x486989){}const _0x16e24f=setTimeout(()=>processedMessageKeys['delete'](_0x44b096),DEDUPE_TTL_MS);processedMessageKeys[_0x30373c(0xb4)](_0x44b096,_0x16e24f);}function isProcessed(_0x71f918){return _0x71f918&&processedMessageKeys['has'](_0x71f918);}function _0x38a2(_0x494e36,_0x5a5063){const _0x48824c=_0x49d1();return _0x38a2=function(_0x2859e1,_0x59d206){_0x2859e1=_0x2859e1-0x9f;let _0x2eea9c=_0x48824c[_0x2859e1];if(_0x38a2['eFKRxD']===undefined){var _0xcd8804=function(_0x424d3d){const _0x45a20e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3d45a9='',_0x5100ed='';for(let _0x489955=0x0,_0x490555,_0x567b4e,_0x29821a=0x0;_0x567b4e=_0x424d3d['charAt'](_0x29821a++);~_0x567b4e&&(_0x490555=_0x489955%0x4?_0x490555*0x40+_0x567b4e:_0x567b4e,_0x489955++%0x4)?_0x3d45a9+=String['fromCharCode'](0xff&_0x490555>>(-0x2*_0x489955&0x6)):0x0){_0x567b4e=_0x45a20e['indexOf'](_0x567b4e);}for(let _0xd0b72c=0x0,_0x44172e=_0x3d45a9['length'];_0xd0b72c<_0x44172e;_0xd0b72c++){_0x5100ed+='%'+('00'+_0x3d45a9['charCodeAt'](_0xd0b72c)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x5100ed);};_0x38a2['QwnLQl']=_0xcd8804,_0x494e36=arguments,_0x38a2['eFKRxD']=!![];}const _0x49d17e=_0x48824c[0x0],_0x38a24=_0x2859e1+_0x49d17e,_0xb08dd=_0x494e36[_0x38a24];return!_0xb08dd?(_0x2eea9c=_0x38a2['QwnLQl'](_0x2eea9c),_0x494e36[_0x38a24]=_0x2eea9c):_0x2eea9c=_0xb08dd,_0x2eea9c;},_0x38a2(_0x494e36,_0x5a5063);}function setupSendApi(_0x259d10){const _0x5d07f8=_0x230fa5,_0x5b75c6={'JGQJS':function(_0x132056,_0x35dced){return _0x132056===_0x35dced;}};if(!_0x259d10)return;if(_0x5b75c6['JGQJS'](typeof _0x259d10['sendMessage'],_0x5d07f8(0xbf)))sendApi=async(_0x1879f9,_0x590c50)=>await _0x259d10['sendMessage'](_0x1879f9,_0x590c50);else _0x259d10['sock']&&typeof _0x259d10['sock']['sendMessage']==='function'?sendApi=async(_0x55507e,_0xa41abc)=>await _0x259d10[_0x5d07f8(0xb2)]['sendMessage'](_0x55507e,_0xa41abc):sendApi=null;}async function safeSend(_0x3e2488,_0x3a437e){const _0x2288c7=_0x230fa5,_0x35396b={'IclvC':function(_0x173541,_0x550f5e){return _0x173541(_0x550f5e);},'tanjX':function(_0x30419a,_0x36f32f){return _0x30419a(_0x36f32f);}};try{if(!_0x3e2488||!_0x3a437e)return;if(sendApi)return await sendApi(_0x3e2488,_0x3a437e);_0x35396b['IclvC'](warn,'[dbbackup]\x20no\x20send\x20surface\x20available');}catch(_0x414dcf){error(_0x414dcf,_0x2288c7(0xba)),_0x35396b['tanjX'](warn,'[dbbackup]\x20safeSend\x20failed:\x20'+(_0x414dcf?.['message']||_0x414dcf));}}function resolveDbDir(){const _0x51be61=_0x230fa5,_0x207b51=getConfig(),_0x5380f=_0x207b51&&_0x207b51['DB_PATH']?_0x207b51['DB_PATH']:'./data/db',_0x51f729=_0x568260['isAbsolute'](_0x5380f)?_0x568260['resolve'](_0x5380f):_0x568260[_0x51be61(0xb7)](PROJECT_ROOT,_0x5380f);return _0x51f729;}function findConfigFileOnDisk(){const _0x4cffda=_0x230fa5,_0x5d1cda=['config.yml',_0x4cffda(0xc8),'config.json'];for(const _0x5f7d60 of _0x5d1cda){const _0x296486=_0x568260[_0x4cffda(0xb7)](PROJECT_ROOT,_0x5f7d60);if(_0x1180be['existsSync'](_0x296486))return _0x296486;}return null;}function ensureInside(_0x544899,_0x1f84b7){const _0x1aaacb=_0x230fa5,_0x550e53=_0x568260['resolve'](_0x544899)+_0x568260['sep'],_0x21826f=_0x568260[_0x1aaacb(0xb7)](_0x1f84b7);return _0x21826f['startsWith'](_0x550e53);}export async function initialize(_0x49cc36){const _0x54b1a4=_0x230fa5;if(!_0x49cc36)throw new Error('dbbackup.initialize\x20requires\x20bot\x20instance');botRef=_0x49cc36,setupSendApi(botRef),info(_0x54b1a4(0xa2));}export async function onMessage(_0x1bdd1c){const _0x2bc108=_0x230fa5,_0x106947={'cbKyZ':function(_0x3cddf4,_0x2c3996){return _0x3cddf4(_0x2c3996);},'esVOw':function(_0xbfb193,_0x46188b,_0x4786a7){return _0xbfb193(_0x46188b,_0x4786a7);},'pRBNI':_0x2bc108(0xa8),'CmnKQ':'application/json','BNEIZ':function(_0x2339a0,_0x2cba5e,_0xc64874){return _0x2339a0(_0x2cba5e,_0xc64874);},'wexOC':'utf8','prcxZ':'[dbbackup]\x20sent\x20runtime\x20config\x20JSON','CkrfU':_0x2bc108(0xb9)};try{if(!_0x1bdd1c||!_0x1bdd1c['key']||!_0x1bdd1c['message'])return;const _0x34d497=String(_0x1bdd1c['key']['remoteJid']||'')+'::'+String(_0x1bdd1c['key']['id']||_0x1bdd1c['key']['participant']||'');if(isProcessed(_0x34d497))return;markProcessed(_0x34d497);if(!_0x1bdd1c['isCommand'])return;const _0x22fe5f=_0x1bdd1c[_0x2bc108(0xca)]&&typeof _0x1bdd1c['text']==='string'?_0x1bdd1c['text']['trim']():'';if(!_0x22fe5f)return;const _0x2cf58e=_0x22fe5f['split'](/\r?\n/)[0x0]['trim']()['split'](/\s+/),_0x1e90f3=(_0x2cf58e[0x0]||'')['toLowerCase']();if(!commands['includes'](_0x1e90f3))return;const _0x2889ed=_0x1bdd1c['key']['remoteJid'],_0xf1ff92=typeof _0x2889ed==='string'&&_0x2889ed['endsWith']('@g.us');if(_0xf1ff92){let _0x57c5b8=![];try{_0x57c5b8=await isadmin(botRef,_0x1bdd1c);}catch(_0xfbec6b){warn('[dbbackup]\x20isadmin\x20check\x20failed'),_0x57c5b8=![];}if(!_0x57c5b8)return;}const _0x5e1d1d=_0x1bdd1c['key']?.['participant']||_0x1bdd1c[_0x2bc108(0xa5)]?.['from']||_0x1bdd1c['key']?.['remoteJid']||'',_0x1c1f16=botRef?.['sock']?.['user']?.['id']||null,_0x30e59a=_0xf1ff92?_0x2889ed:_0x1c1f16||_0x5e1d1d;info('[dbbackup]\x20command\x20\x27'+_0x1e90f3+'\x27\x20from\x20'+_0x5e1d1d+'\x20in\x20'+_0x2889ed);if(_0x1e90f3==='getdb'){const _0xaead46=getConfig(),_0x680c59=resolveDbDir(),_0x33ddf2=_0xaead46&&_0xaead46['DB_NAME']?String(_0xaead46[_0x2bc108(0xab)]):'bot.db',_0x140da5=_0x2cf58e['length']>=0x2?_0x2cf58e['slice'](0x1)[_0x2bc108(0xbc)]('\x20')['trim']():_0x33ddf2,_0xd381f0=_0x568260['resolve'](_0x680c59,_0x140da5);if(!ensureInside(_0x680c59,_0xd381f0)){if('nuAQn'!=='YHpzl'){await _0x106947['esVOw'](safeSend,_0x30e59a,{'text':_0x2bc108(0xb8)});return;}else{let _0x1f7a5f;try{const _0x4d2626=QbMJwS['cbKyZ'](_0x5bdc88,'return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1f7a5f=_0x4d2626();}catch(_0x44b9df){_0x1f7a5f=_0x255a1f;}_0x1f7a5f['setInterval'](_0xe557f7,0x61a80);}}if(!_0x1180be['existsSync'](_0xd381f0)){await safeSend(_0x30e59a,{'text':'‚ùå\x20File\x20not\x20found:\x20'+_0x140da5});return;}try{const _0x232934=_0x1180be['readFileSync'](_0xd381f0);await safeSend(_0x30e59a,{'document':_0x232934,'fileName':_0x568260['basename'](_0xd381f0),'mimetype':'application/octet-stream'}),info('[dbbackup]\x20sent\x20DB\x20file\x20'+_0xd381f0+'\x20to\x20'+_0x30e59a);}catch(_0x21b5cd){error(_0x21b5cd,'[dbbackup]\x20getdb\x20send\x20failed'),await safeSend(_0x30e59a,{'text':'‚ùå\x20Failed\x20to\x20send\x20file:\x20'+(_0x21b5cd?.['message']||_0x21b5cd)});}return;}if(_0x1e90f3==='setdb'){const _0x7dc3c8=_0x1bdd1c['message']?.['documentMessage'];if(!_0x7dc3c8||!_0x7dc3c8[_0x2bc108(0xc0)]){await safeSend(_0x30e59a,{'text':_0x106947[_0x2bc108(0xa3)]});return;}const _0x9ad900=String(_0x7dc3c8['fileName']||'')['trim']();if(!_0x9ad900['toLowerCase']()['endsWith']('.db')){await safeSend(_0x30e59a,{'text':'‚ùå\x20Only\x20.db\x20files\x20are\x20accepted.'});return;}const _0x5043fa=resolveDbDir();try{_0x1180be['mkdirSync'](_0x5043fa,{'recursive':!![]});}catch(_0x47905c){}const _0xc5394d=_0x568260[_0x2bc108(0xb7)](_0x5043fa,_0x9ad900);if(!ensureInside(_0x5043fa,_0xc5394d)){await safeSend(_0x30e59a,{'text':'‚ùå\x20Invalid\x20destination\x20path.'});return;}try{const _0x311f3c=await botRef['downloadMediaMessage'](_0x1bdd1c['message']);_0x1180be['writeFileSync'](_0xc5394d,_0x311f3c),await safeSend(_0x30e59a,{'text':'‚úÖ\x20DB\x20file\x20saved\x20to:\x20'+_0x568260['relative'](PROJECT_ROOT,_0xc5394d)}),_0x106947['cbKyZ'](info,'[dbbackup]\x20received\x20and\x20saved\x20DB\x20'+_0xc5394d+'\x20from\x20'+_0x5e1d1d);}catch(_0x33e9b0){error(_0x33e9b0,'[dbbackup]\x20setdb\x20failed'),await safeSend(_0x30e59a,{'text':'‚ùå\x20Failed\x20to\x20save\x20DB:\x20'+(_0x33e9b0?.['message']||_0x33e9b0)});}return;}if(_0x1e90f3==='getconfig'){const _0x4e0758=findConfigFileOnDisk();if(_0x4e0758){try{const _0x26f18b=_0x1180be['readFileSync'](_0x4e0758),_0x407826=_0x4e0758['toLowerCase']()['endsWith'](_0x2bc108(0xc1))?_0x106947['CmnKQ']:'text/x-yaml';await _0x106947['BNEIZ'](safeSend,_0x30e59a,{'document':_0x26f18b,'fileName':_0x568260['basename'](_0x4e0758),'mimetype':_0x407826}),info('[dbbackup]\x20sent\x20config\x20file\x20'+_0x4e0758+'\x20to\x20'+_0x30e59a);}catch(_0x1553b7){error(_0x1553b7,'[dbbackup]\x20getconfig\x20send\x20failed'),await _0x106947['esVOw'](safeSend,_0x30e59a,{'text':'‚ùå\x20Failed\x20to\x20send\x20config\x20file:\x20'+(_0x1553b7?.['message']||_0x1553b7)});}return;}try{const _0x14d03a=getConfig()||{},_0x1391a=Buffer['from'](JSON['stringify'](_0x14d03a,null,0x2),_0x106947['wexOC']);await safeSend(_0x30e59a,{'document':_0x1391a,'fileName':'runtime-config.json','mimetype':_0x2bc108(0xcc)}),_0x106947['cbKyZ'](info,_0x106947[_0x2bc108(0xcb)]);}catch(_0x3e163b){error(_0x3e163b,'[dbbackup]\x20getconfig\x20failed'),await safeSend(_0x30e59a,{'text':_0x2bc108(0xa0)+(_0x3e163b?.['message']||_0x3e163b)});}return;}if(_0x1e90f3==='setconfig'){const _0x46d1c2=_0x1bdd1c['message']?.[_0x2bc108(0xae)];if(!_0x46d1c2||!_0x46d1c2['fileName']){if('YmFvi'!=='YmFvi'){const _0x19be41=_0x33f2d9('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x116367=_0x19be41();}else{await safeSend(_0x30e59a,{'text':'‚ùå\x20Please\x20attach\x20config.yml/config.yaml/config.json\x20with\x20the\x20command:\x20setconfig'});return;}}const _0x23470d=String(_0x46d1c2['fileName']||'')[_0x2bc108(0xb1)]()['toLowerCase']();if(!['config.yml','config.yaml','config.json'][_0x2bc108(0xc7)](_0x23470d)){await safeSend(_0x30e59a,{'text':_0x2bc108(0xc6)});return;}const _0x2d6cc8=_0x568260[_0x2bc108(0xb7)](PROJECT_ROOT,_0x23470d);if(!ensureInside(PROJECT_ROOT,_0x2d6cc8)){await safeSend(_0x30e59a,{'text':_0x2bc108(0xbd)});return;}try{const _0xee95da=await botRef['downloadMediaMessage'](_0x1bdd1c[_0x2bc108(0xa4)]),_0x87b421=_0x2d6cc8+'.tmp';_0x1180be['writeFileSync'](_0x87b421,_0xee95da),_0x1180be['renameSync'](_0x87b421,_0x2d6cc8),await safeSend(_0x30e59a,{'text':'‚úÖ\x20Config\x20replaced:\x20'+_0x23470d+'\x0aNote:\x20config\x20loader\x20will\x20auto-reload\x20if\x20watcher\x20is\x20active.'}),info(_0x2bc108(0xa7)+_0x2d6cc8+_0x2bc108(0xc2)+_0x5e1d1d);}catch(_0x71eeee){error(_0x71eeee,_0x106947[_0x2bc108(0xb0)]),await safeSend(_0x30e59a,{'text':'‚ùå\x20Failed\x20to\x20save\x20config:\x20'+(_0x71eeee?.['message']||_0x71eeee)});}return;}}catch(_0x1f3447){error(_0x1f3447,'[dbbackup]\x20onMessage\x20error:\x20'+(_0x1f3447?.['message']||_0x1f3447));}}export async function cleanup(){const _0x1f626b=_0x230fa5;try{botRef=null,sendApi=null,processedMessageKeys['forEach'](_0x9b8ca3=>{try{clearTimeout(_0x9b8ca3);}catch(_0x3213e1){}}),processedMessageKeys['clear'](),info(_0x1f626b(0xc9));}catch(_0x34c6f2){warn('[dbbackup]\x20cleanup\x20error:\x20'+(_0x34c6f2?.['message']||_0x34c6f2));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x2859e1(_0x16ed7f){const _0x447528={'uxktA':function(_0x3c877b,_0x498a96){return _0x3c877b===_0x498a96;},'YcLfR':function(_0x3e470d,_0x1dfa8c){return _0x3e470d+_0x1dfa8c;},'DqWIl':'gger'};function _0x4accb6(_0x5f30d7){const _0x13f2fe=_0x38a2;if(typeof _0x5f30d7==='string')return function(_0x267c00){}['constructor']('while\x20(true)\x20{}')['apply']('counter');else(''+_0x5f30d7/_0x5f30d7)[_0x13f2fe(0xbe)]!==0x1||_0x447528['uxktA'](_0x5f30d7%0x14,0x0)?function(){return!![];}['constructor'](_0x447528['YcLfR']('debu','gger'))['call']('action'):function(){return![];}['constructor']('debu'+_0x447528['DqWIl'])['apply']('stateObject');_0x4accb6(++_0x5f30d7);}try{if(_0x16ed7f)return _0x4accb6;else _0x4accb6(0x0);}catch(_0xa17114){}}