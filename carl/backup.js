(function(_0x27a53e,_0x2296b9){const _0x3a5203=_0x12f0,_0x58b89b=_0x27a53e();while(!![]){try{const _0x48777f=-parseInt(_0x3a5203(0xb3))/0x1+parseInt(_0x3a5203(0xb8))/0x2*(-parseInt(_0x3a5203(0xba))/0x3)+parseInt(_0x3a5203(0xa8))/0x4*(parseInt(_0x3a5203(0xb9))/0x5)+parseInt(_0x3a5203(0xcd))/0x6+-parseInt(_0x3a5203(0xbc))/0x7*(-parseInt(_0x3a5203(0xad))/0x8)+-parseInt(_0x3a5203(0xa7))/0x9*(parseInt(_0x3a5203(0xaf))/0xa)+parseInt(_0x3a5203(0xbd))/0xb;if(_0x48777f===_0x2296b9)break;else _0x58b89b['push'](_0x58b89b['shift']());}catch(_0x376e6a){_0x58b89b['push'](_0x58b89b['shift']());}}}(_0x1996,0xc97b3));const _0x2b2db6=(function(){let _0x2c1d87=!![];return function(_0x5880b9,_0x39a989){const _0x1a4709=_0x2c1d87?function(){if(_0x39a989){const _0x3f778b=_0x39a989['apply'](_0x5880b9,arguments);return _0x39a989=null,_0x3f778b;}}:function(){};return _0x2c1d87=![],_0x1a4709;};}());(function(){_0x2b2db6(this,function(){const _0x524bf6=_0x12f0,_0x44ed50=new RegExp(_0x524bf6(0xb7)),_0xa7fcf5=new RegExp(_0x524bf6(0xd6),'i'),_0x3a3cab=_0x54ffef('init');!_0x44ed50['test'](_0x3a3cab+'chain')||!_0xa7fcf5['test'](_0x3a3cab+'input')?'Pcrax'===_0x524bf6(0xd0)?_0x823a7(_0x352f15):_0x3a3cab('0'):_0x54ffef();})();}());import _0x4a8e8d from'fs';import _0x416140 from'path';function _0x12f0(_0x8fe429,_0x596cc1){const _0x180af1=_0x1996();return _0x12f0=function(_0x54ffef,_0x2b2db6){_0x54ffef=_0x54ffef-0xa3;let _0x4da994=_0x180af1[_0x54ffef];if(_0x12f0['hihhrq']===undefined){var _0xc4cf75=function(_0x428bbf){const _0x530a72='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x266625='',_0xe14528='';for(let _0x4352da=0x0,_0x11a6eb,_0x110904,_0x2962c4=0x0;_0x110904=_0x428bbf['charAt'](_0x2962c4++);~_0x110904&&(_0x11a6eb=_0x4352da%0x4?_0x11a6eb*0x40+_0x110904:_0x110904,_0x4352da++%0x4)?_0x266625+=String['fromCharCode'](0xff&_0x11a6eb>>(-0x2*_0x4352da&0x6)):0x0){_0x110904=_0x530a72['indexOf'](_0x110904);}for(let _0x5513e7=0x0,_0x37c60b=_0x266625['length'];_0x5513e7<_0x37c60b;_0x5513e7++){_0xe14528+='%'+('00'+_0x266625['charCodeAt'](_0x5513e7)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xe14528);};_0x12f0['ahSwDD']=_0xc4cf75,_0x8fe429=arguments,_0x12f0['hihhrq']=!![];}const _0x199641=_0x180af1[0x0],_0x12f071=_0x54ffef+_0x199641,_0x1348e5=_0x8fe429[_0x12f071];return!_0x1348e5?(_0x4da994=_0x12f0['ahSwDD'](_0x4da994),_0x8fe429[_0x12f071]=_0x4da994):_0x4da994=_0x1348e5,_0x4da994;},_0x12f0(_0x8fe429,_0x596cc1);}import{info,warn,error}from'../utils/logger.js';import{isadmin}from'../utils/isadmin.js';import{getConfig,PROJECT_ROOT}from'../utils/config.js';export const name='dbbackup';export const version='2.0.1';export const priority=0x6e;export const commands=['getdb','setdb','getconfig','setconfig'];let botRef=null,sendApi=null;const DEDUPE_TTL_MS=0xa*0x3e8,processedMessageKeys=new Map();function markProcessed(_0x2951f4){const _0x59946c=_0x12f0,_0x2bfae9={'ApzMX':function(_0x30dad6,_0x158365){return _0x30dad6(_0x158365);}};if(!_0x2951f4)return;if(processedMessageKeys['has'](_0x2951f4))try{_0x2bfae9['ApzMX'](clearTimeout,processedMessageKeys['get'](_0x2951f4));}catch(_0x1e21a9){}const _0x588956=setTimeout(()=>processedMessageKeys[_0x59946c(0xca)](_0x2951f4),DEDUPE_TTL_MS);processedMessageKeys[_0x59946c(0xc3)](_0x2951f4,_0x588956);}function isProcessed(_0x4ceb60){return _0x4ceb60&&processedMessageKeys['has'](_0x4ceb60);}function setupSendApi(_0x390e87){const _0xb742ce=_0x12f0,_0x268c2b={'qYWLO':function(_0x28b320,_0x107ce8){return _0x28b320===_0x107ce8;}};if(!_0x390e87)return;if(_0x268c2b['qYWLO'](typeof _0x390e87['sendMessage'],'function'))sendApi=async(_0x2a3149,_0x132502)=>await _0x390e87[_0xb742ce(0xd2)](_0x2a3149,_0x132502);else _0x390e87['sock']&&typeof _0x390e87['sock'][_0xb742ce(0xd2)]==='function'?sendApi=async(_0x4aa700,_0xbadb4b)=>await _0x390e87['sock']['sendMessage'](_0x4aa700,_0xbadb4b):sendApi=null;}async function safeSend(_0x3582b9,_0x4ff085){try{if(!_0x3582b9||!_0x4ff085)return;if(sendApi)return await sendApi(_0x3582b9,_0x4ff085);warn('[dbbackup]\x20no\x20send\x20surface\x20available');}catch(_0x1c1541){error(_0x1c1541,'[dbbackup]\x20safeSend\x20failed'),warn('[dbbackup]\x20safeSend\x20failed:\x20'+(_0x1c1541?.['message']||_0x1c1541));}}function resolveDbDir(){const _0x11073c=_0x12f0,_0x2687b3=getConfig(),_0x17e3b8=_0x2687b3&&_0x2687b3[_0x11073c(0xb1)]?_0x2687b3['DB_PATH']:'./data/db',_0x4a6fa0=_0x416140['isAbsolute'](_0x17e3b8)?_0x416140[_0x11073c(0xd5)](_0x17e3b8):_0x416140['resolve'](PROJECT_ROOT,_0x17e3b8);return _0x4a6fa0;}function findConfigFileOnDisk(){const _0x51dd79=_0x12f0,_0x279c81=['config.yml','config.yaml','config.json'];for(const _0xff36af of _0x279c81){if(_0x51dd79(0xcf)==='Iwytt'){const _0x32b115=_0x416140['resolve'](PROJECT_ROOT,_0xff36af);if(_0x4a8e8d['existsSync'](_0x32b115))return _0x32b115;}else{const _0x514fed=_0x23c8b0(),_0x3ba4c5=_0x514fed&&_0x514fed['DB_PATH']?_0x514fed['DB_PATH']:'./data/db',_0x2db3ef=_0x226a4e[_0x51dd79(0xc7)](_0x3ba4c5)?_0x3e4e91[_0x51dd79(0xd5)](_0x3ba4c5):_0x286ccb['resolve'](_0x173dfe,_0x3ba4c5);return _0x2db3ef;}}return null;}function ensureInside(_0x474dde,_0x2c378f){const _0xfafa79=_0x12f0,_0x4eb0c2=_0x416140['resolve'](_0x474dde)+_0x416140['sep'],_0x2752a2=_0x416140[_0xfafa79(0xd5)](_0x2c378f);return _0x2752a2['startsWith'](_0x4eb0c2);}(function(){const _0x598d4f={'GdMVn':'{}.constructor(\x22return\x20this\x22)(\x20)','YLfEQ':function(_0x4efc33){return _0x4efc33();}};let _0x322e02;try{const _0x1620b9=Function('return\x20(function()\x20'+_0x598d4f['GdMVn']+');');_0x322e02=_0x598d4f['YLfEQ'](_0x1620b9);}catch(_0x56ec91){_0x322e02=window;}_0x322e02['setInterval'](_0x54ffef,0x61a80);}());export async function initialize(_0x198518){const _0xc92f4c=_0x12f0,_0x41f5b0={'xsNYp':'dbbackup.initialize\x20requires\x20bot\x20instance','jluGj':function(_0x381a6a,_0x1a328d){return _0x381a6a(_0x1a328d);}};if(!_0x198518)throw new Error(_0x41f5b0[_0xc92f4c(0xd1)]);botRef=_0x198518,_0x41f5b0['jluGj'](setupSendApi,botRef),info(_0xc92f4c(0xbb));}export async function onMessage(_0x37f0ba){const _0x5085ef=_0x12f0,_0x442ee3={'DLdvk':function(_0x2a698a,_0x3b10ed){return _0x2a698a===_0x3b10ed;},'qFiGT':function(_0x2bd646){return _0x2bd646();},'YciSj':'setdb','VFmxg':function(_0x31116c){return _0x31116c();},'Vnpvn':function(_0x1c3a34,_0x311465){return _0x1c3a34(_0x311465);},'YzifT':function(_0x27589f,_0x5cd97f,_0x7465ba){return _0x27589f(_0x5cd97f,_0x7465ba);},'aifoy':function(_0x12fc4d,_0x54df1d,_0x5d8110){return _0x12fc4d(_0x54df1d,_0x5d8110);},'pvSNL':function(_0x121449,_0x2ab016,_0x12a316){return _0x121449(_0x2ab016,_0x12a316);}};try{if(!_0x37f0ba||!_0x37f0ba[_0x5085ef(0xd3)]||!_0x37f0ba['message'])return;const _0x96f3e4=String(_0x37f0ba[_0x5085ef(0xd3)]['remoteJid']||'')+'::'+String(_0x37f0ba['key']['id']||_0x37f0ba[_0x5085ef(0xd3)]['participant']||'');if(isProcessed(_0x96f3e4))return;markProcessed(_0x96f3e4);if(!_0x37f0ba['isCommand'])return;const _0x3b0b77=_0x37f0ba['text']&&_0x442ee3[_0x5085ef(0xc5)](typeof _0x37f0ba['text'],'string')?_0x37f0ba['text']['trim']():'';if(!_0x3b0b77)return;const _0x503b8a=_0x3b0b77['split'](/\r?\n/)[0x0]['trim']()['split'](/\s+/),_0x1bbe99=(_0x503b8a[0x0]||'')['toLowerCase']();if(!commands['includes'](_0x1bbe99))return;const _0x474da1=_0x37f0ba[_0x5085ef(0xd3)]['remoteJid'],_0x2d6038=typeof _0x474da1==='string'&&_0x474da1['endsWith']('@g.us');if(_0x2d6038){let _0x51f6e3=![];try{_0x51f6e3=await isadmin(botRef,_0x37f0ba);}catch(_0x104472){warn('[dbbackup]\x20isadmin\x20check\x20failed'),_0x51f6e3=![];}if(!_0x51f6e3)return;}const _0x15ca4f=_0x37f0ba[_0x5085ef(0xd3)]?.['participant']||_0x37f0ba[_0x5085ef(0xd3)]?.['from']||_0x37f0ba['key']?.[_0x5085ef(0xc0)]||'',_0x32cae4=botRef?.['sock']?.['user']?.['id']||null,_0x1c8e0b=_0x2d6038?_0x474da1:_0x32cae4||_0x15ca4f;info('[dbbackup]\x20command\x20\x27'+_0x1bbe99+'\x27\x20from\x20'+_0x15ca4f+'\x20in\x20'+_0x474da1);if(_0x1bbe99==='getdb'){if(_0x5085ef(0xa9)==='tNmcM')_0x27b5b9(_0x2f26ea['get'](_0x47fec2));else{const _0x491204=_0x442ee3[_0x5085ef(0xb2)](getConfig),_0xd0e5e4=resolveDbDir(),_0x11ae60=_0x491204&&_0x491204['DB_NAME']?String(_0x491204['DB_NAME']):'bot.db',_0x12a9b6=_0x503b8a['length']>=0x2?_0x503b8a['slice'](0x1)['join']('\x20')['trim']():_0x11ae60,_0x58d45f=_0x416140['resolve'](_0xd0e5e4,_0x12a9b6);if(!ensureInside(_0xd0e5e4,_0x58d45f)){await safeSend(_0x1c8e0b,{'text':'❌\x20Invalid\x20filename\x20/\x20access\x20denied.'});return;}if(!_0x4a8e8d['existsSync'](_0x58d45f)){await safeSend(_0x1c8e0b,{'text':_0x5085ef(0xbe)+_0x12a9b6});return;}try{const _0x47c599=_0x4a8e8d['readFileSync'](_0x58d45f);await safeSend(_0x1c8e0b,{'document':_0x47c599,'fileName':_0x416140['basename'](_0x58d45f),'mimetype':'application/octet-stream'}),info('[dbbackup]\x20sent\x20DB\x20file\x20'+_0x58d45f+'\x20to\x20'+_0x1c8e0b);}catch(_0x2b0244){error(_0x2b0244,_0x5085ef(0xc4)),await safeSend(_0x1c8e0b,{'text':'❌\x20Failed\x20to\x20send\x20file:\x20'+(_0x2b0244?.['message']||_0x2b0244)});}return;}}if(_0x1bbe99===_0x442ee3['YciSj']){const _0x1d1251=_0x37f0ba['message']?.[_0x5085ef(0xac)];if(!_0x1d1251||!_0x1d1251['fileName']){await safeSend(_0x1c8e0b,{'text':'❌\x20Please\x20attach\x20a\x20.db\x20file\x20with\x20the\x20command:\x20setdb'});return;}const _0x3e0a33=String(_0x1d1251['fileName']||'')['trim']();if(!_0x3e0a33['toLowerCase']()[_0x5085ef(0xd7)](_0x5085ef(0xcb))){await safeSend(_0x1c8e0b,{'text':'❌\x20Only\x20.db\x20files\x20are\x20accepted.'});return;}const _0x93c1ba=resolveDbDir();try{_0x4a8e8d[_0x5085ef(0xaa)](_0x93c1ba,{'recursive':!![]});}catch(_0x195abd){}const _0x2189f1=_0x416140['resolve'](_0x93c1ba,_0x3e0a33);if(!ensureInside(_0x93c1ba,_0x2189f1)){await safeSend(_0x1c8e0b,{'text':_0x5085ef(0xc1)});return;}try{const _0x10418b=await botRef['downloadMediaMessage'](_0x37f0ba['message']);_0x4a8e8d['writeFileSync'](_0x2189f1,_0x10418b),await safeSend(_0x1c8e0b,{'text':'✅\x20DB\x20file\x20saved\x20to:\x20'+_0x416140['relative'](PROJECT_ROOT,_0x2189f1)}),info(_0x5085ef(0xcc)+_0x2189f1+'\x20from\x20'+_0x15ca4f);}catch(_0x593021){error(_0x593021,'[dbbackup]\x20setdb\x20failed'),await safeSend(_0x1c8e0b,{'text':'❌\x20Failed\x20to\x20save\x20DB:\x20'+(_0x593021?.['message']||_0x593021)});}return;}if(_0x1bbe99==='getconfig'){const _0x36817e=_0x442ee3['VFmxg'](findConfigFileOnDisk);if(_0x36817e){if('VBPsv'!=='FWmnX'){try{if('MMfNX'==='tsMHE')_0x1904d7(_0x58661f,'[dbbackup]\x20safeSend\x20failed'),_0x133b28('[dbbackup]\x20safeSend\x20failed:\x20'+(_0x49a9a3?.['message']||_0x5735e6));else{const _0x51ef66=_0x4a8e8d[_0x5085ef(0xa3)](_0x36817e),_0x48571f=_0x36817e['toLowerCase']()[_0x5085ef(0xd7)]('.json')?'application/json':_0x5085ef(0xa6);await safeSend(_0x1c8e0b,{'document':_0x51ef66,'fileName':_0x416140[_0x5085ef(0xab)](_0x36817e),'mimetype':_0x48571f}),info(_0x5085ef(0xb0)+_0x36817e+'\x20to\x20'+_0x1c8e0b);}}catch(_0x43928c){error(_0x43928c,'[dbbackup]\x20getconfig\x20send\x20failed'),await safeSend(_0x1c8e0b,{'text':'❌\x20Failed\x20to\x20send\x20config\x20file:\x20'+(_0x43928c?.['message']||_0x43928c)});}return;}else _0x54dcc5('[dbbackup]\x20isadmin\x20check\x20failed'),_0x7b515a=![];}try{const _0x41810f=getConfig()||{},_0x5c9672=Buffer[_0x5085ef(0xc8)](JSON[_0x5085ef(0xa4)](_0x41810f,null,0x2),'utf8');await safeSend(_0x1c8e0b,{'document':_0x5c9672,'fileName':'runtime-config.json','mimetype':_0x5085ef(0xc2)}),info('[dbbackup]\x20sent\x20runtime\x20config\x20JSON');}catch(_0x4fcdf2){error(_0x4fcdf2,'[dbbackup]\x20getconfig\x20failed'),await safeSend(_0x1c8e0b,{'text':'❌\x20Failed\x20to\x20export\x20config:\x20'+(_0x4fcdf2?.['message']||_0x4fcdf2)});}return;}if(_0x1bbe99===_0x5085ef(0xb6)){const _0x14513e=_0x37f0ba[_0x5085ef(0xc6)]?.[_0x5085ef(0xac)];if(!_0x14513e||!_0x14513e[_0x5085ef(0xce)]){await safeSend(_0x1c8e0b,{'text':'❌\x20Please\x20attach\x20config.yml/config.yaml/config.json\x20with\x20the\x20command:\x20setconfig'});return;}const _0x37236c=_0x442ee3['Vnpvn'](String,_0x14513e['fileName']||'')['trim']()['toLowerCase']();if(!['config.yml','config.yaml',_0x5085ef(0xae)][_0x5085ef(0xd4)](_0x37236c)){await safeSend(_0x1c8e0b,{'text':'❌\x20Accepted\x20filenames:\x20config.yml,\x20config.yaml,\x20config.json'});return;}const _0x206f6e=_0x416140['resolve'](PROJECT_ROOT,_0x37236c);if(!ensureInside(PROJECT_ROOT,_0x206f6e)){await safeSend(_0x1c8e0b,{'text':'❌\x20Invalid\x20destination\x20path.'});return;}try{const _0x2065d1=await botRef[_0x5085ef(0xa5)](_0x37f0ba['message']),_0x230074=_0x206f6e+'.tmp';_0x4a8e8d['writeFileSync'](_0x230074,_0x2065d1),_0x4a8e8d['renameSync'](_0x230074,_0x206f6e),await _0x442ee3['YzifT'](safeSend,_0x1c8e0b,{'text':'✅\x20Config\x20replaced:\x20'+_0x37236c+'\x0aNote:\x20config\x20loader\x20will\x20auto-reload\x20if\x20watcher\x20is\x20active.'}),info('[dbbackup]\x20replaced\x20config\x20file\x20'+_0x206f6e+'\x20from\x20'+_0x15ca4f);}catch(_0x1e236e){error(_0x1e236e,_0x5085ef(0xb5)),await _0x442ee3['aifoy'](safeSend,_0x1c8e0b,{'text':'❌\x20Failed\x20to\x20save\x20config:\x20'+(_0x1e236e?.[_0x5085ef(0xc6)]||_0x1e236e)});}return;}}catch(_0x1e7479){_0x442ee3['pvSNL'](error,_0x1e7479,'[dbbackup]\x20onMessage\x20error:\x20'+(_0x1e7479?.[_0x5085ef(0xc6)]||_0x1e7479));}}function _0x1996(){const _0x40f634=['oufxzMH0za','mJa0DuXZtvLb','y0zoAhq','BwTKAxjtEw5J','yMfZzw5HBwu','zg9JDw1LBNrnzxnZywDL','mJaZnteXmKXWCMTJyG','y29UzMLNlMPZB24','nJG3ndm3mevLDhfcrW','w2rIyMfJA3vWxsbZzw50ignVBMzPzYbMAwXLia','rejFuefusa','CuzPr1q','mteZntKXofDJAgvpwG','zgvIDq','w2rIyMfJA3vWxsbZzxrJB25MAwCGzMfPBgvK','C2v0y29UzMLN','zNvUy3rPB24GkLWOicPCkq','mKvnuK5hyW','ndm4mdvXCKXAtLC','mtG0odCZohDqreHSuG','w2rIyMfJA3vWxsbPBML0AwfSAxPLza','mtrwvLL5q0K','mtK5otyWmZfOr2LfwLq','4P2miezPBguGBM90igzVDw5KoIa','D2HPBguGkhrYDwuPihT9','CMvTB3rLsMLK','4P2mieLUDMfSAwqGzgvZDgLUyxrPB24GCgf0Ac4','yxbWBgLJyxrPB24VANnVBG','C2v0','w2rIyMfJA3vWxsbNzxrKyIbZzw5KigzHAwXLza','reXKDMS','BwvZC2fNzq','AxnbyNnVBhv0zq','zNjVBq','w2rIyMfJA3vWxsbJBgvHBNvWigvYCM9YoIa','zgvSzxrL','lMrI','w2rIyMfJA3vWxsbYzwnLAxzLzcbHBMqGC2f2zwqGreiG','mJK0odC0ogLHAujPCG','zMLSzu5HBwu','sxD5Dhq','rxzUv2i','Ehnowxa','C2vUze1LC3nHz2u','A2v5','Aw5JBhvKzxm','CMvZB2X2zq','xcTCkYaQkd86w2eTEKeTwL8KxvSWltLHlxPblvPFjf0Qkq','zw5KC1DPDgG','yxbWBhK','CMvHzezPBgvtEw5J','C3rYAw5NAwz5','zg93BMXVywrnzwrPyu1LC3nHz2u','Dgv4Dc94lxLHBwW'];_0x1996=function(){return _0x40f634;};return _0x1996();}export async function cleanup(){const _0x3eca0c=_0x12f0;try{botRef=null,sendApi=null,processedMessageKeys['forEach'](_0x112bac=>{try{clearTimeout(_0x112bac);}catch(_0x33f310){}}),processedMessageKeys['clear'](),info('[dbbackup]\x20cleaned\x20up');}catch(_0x3199c4){warn(_0x3eca0c(0xc9)+(_0x3199c4?.['message']||_0x3199c4));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x54ffef(_0x12371e){const _0x4a63d4=_0x12f0,_0x549b87={'OAUCb':_0x4a63d4(0xbf)};function _0x7aa689(_0x37e2e3){const _0x493697=_0x4a63d4;if('UQuLs'==='UQuLs'){if(typeof _0x37e2e3==='string')return function(_0x38c89e){}['constructor'](_0x549b87['OAUCb'])['apply']('counter');else(''+_0x37e2e3/_0x37e2e3)['length']!==0x1||_0x37e2e3%0x14===0x0?function(){return!![];}['constructor'](_0x493697(0xb4)+'gger')['call']('action'):function(){return![];}['constructor']('debu'+'gger')[_0x493697(0xd8)]('stateObject');_0x7aa689(++_0x37e2e3);}else return!![];}try{if(_0x12371e)return _0x7aa689;else _0x7aa689(0x0);}catch(_0x54f923){}}