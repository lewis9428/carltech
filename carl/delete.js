const _0x10f94c=_0x676b;(function(_0x43088a,_0x4be78a){const _0x5a5caf=_0x676b,_0x33b202=_0x43088a();while(!![]){try{const _0x499a80=-parseInt(_0x5a5caf(0x18d))/0x1*(-parseInt(_0x5a5caf(0x16b))/0x2)+parseInt(_0x5a5caf(0x180))/0x3*(-parseInt(_0x5a5caf(0x196))/0x4)+-parseInt(_0x5a5caf(0x158))/0x5+parseInt(_0x5a5caf(0x185))/0x6+parseInt(_0x5a5caf(0x170))/0x7*(parseInt(_0x5a5caf(0x162))/0x8)+parseInt(_0x5a5caf(0x178))/0x9*(parseInt(_0x5a5caf(0x161))/0xa)+-parseInt(_0x5a5caf(0x145))/0xb;if(_0x499a80===_0x4be78a)break;else _0x33b202['push'](_0x33b202['shift']());}catch(_0x5c1068){_0x33b202['push'](_0x33b202['shift']());}}}(_0x3e9a,0x37757));const _0x3f9aee=(function(){let _0x212376=!![];return function(_0x3059ee,_0x294b20){const _0x408162=_0x212376?function(){if(_0x294b20){const _0x4d2eb4=_0x294b20['apply'](_0x3059ee,arguments);return _0x294b20=null,_0x4d2eb4;}}:function(){};return _0x212376=![],_0x408162;};}());(function(){const _0x50e407={'tKUsg':'init'};_0x3f9aee(this,function(){const _0x36eb17=_0x676b,_0x1efcdd=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0xe7862f=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x45871d=_0xbaa25a(_0x50e407['tKUsg']);!_0x1efcdd['test'](_0x45871d+_0x36eb17(0x16a))||!_0xe7862f['test'](_0x45871d+'input')?_0x45871d('0'):_0xbaa25a();})();}());import _0x2e8caf from'path';import _0x456f15 from'fs';import{mkdirSync}from'fs';import{rm as _0x23e128}from'fs/promises';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';function _0x3e9a(){const _0x12f34a=['BwT2','y2fWDgLVBG','revgqvvmvf9tru5ex0rftevurq','w0rLBgv0zv0GAg90uMvSB2fKq29UzMLNigHHBMrSzxiGzxjYB3i6ia','Cg9SBa','CurQqw0','BgvUz3rO','yM9VBgvHBG','mJy2ntyWvNHkvKPO','CMf0zq','w0rLBgv0zv0Gzgv0zwn0zwqGyM90uMvMlNnVy2SGy2HHBMDLic0GCMuTyxr0ywnOAw5NigXPC3rLBMvY','su5trvjuieLove8GzgvSzxrLx3bYzwzZicHRzxKSihzHBhvLlcb1CgrHDgvKx2f0ksbwquXvrvmGkcDTB2rLjYWNCcCSid8P','r1jpvvaGka','w0rLBgv0zv0GC29JAYbTB25PDg9YigvYCM9YoIa','BwvKAwfFCgf0Aa','DMLKzw9nzxnZywDL','Aw1Hz2vnzxnZywDL','mtbMyLnvtM8','mJK2DgnivNnj','B3jPz2LUywXnzxnZywDL','w0f1zgLVxq','BKrqDeu','C3vIAMvJDa','z3DiCe0','tufyx1nftKrFuKvuuKLfuW','v0P3EeW','y2HHAw4','mLfHt2Ldzq','zejXv1i','rMnnzuy','DMLKzw8','sfDwwvC','nty3n2vbyMPOEG','Aw1Hz2u','y29UDgvUDa','q0Xfqu5vuf9jtLrfuLzbtf9nuW','uxjNCKu','zxHPC3rZu3LUyW','qNHLCuG','C2LUz2XLu2vSzwn0uMvWBhK','mtC5mZm0ouPftKTlrq','yNv0Dg9UC1jLC3bVBNnLtwvZC2fNzq','BwvZC2fNzq','AgfZ','AM9PBG','tvvkChG','AxnbCNjHEq','C2v0','mti5rezmDNPc','8j+tNsbdB250zw50oIa','revct1voq0vFtvm','C29JAW','y29ItKO','ndeWodjMs2zVyKy','zg9JDw1LBNrnzxnZywDL','w1bVBgW6ia','z2v0','BxaZ','y291BNrLCG','u0vmrunuihzHBhvLiezst00GzgvSzxrLx3bYzwzZifDirvjfigTLEt0NBw9KzsC','Dg9mB3DLCKnHC2u','mZm4mZiXDxfoy1DV','Cg9W','w0rLBgv0zv0Gzgv0ywnOzwqGBgLZDgvUzxiGAwyGChjLC2vUDa','Aw5WDxq','revmrvrfx0fuvefdsf9xqvrdsevsx01t','BwvZC2fNzvrPBwvZDgfTCa','zg1XC1a','DNbsyKK','C3bSAxq','otuYnhDvBvLXEq','xcTCkYaQkd86w2eTEKeTwL8KxvSWltLHlxPblvPFjf0Qkq','yxngwKm','w0rLBgv0zv0GzM9YD2fYzcbHDhrLBxb0igzHAwXLzcdIGjqGzMfSBgLUzYbIywnRihrVigzPBguGC2vUzdOG','y2fSBa','w1zPzgvVxq','A2v5','C2vUzgvY','w05VignVBNrLBNrD','ohWXFdb8mtb8n3W0Fdn8nNW5Fdv8mG','BwvKAwfqyxrO','tfLQz3i','Dgv4Da','w0rVy3vTzw50xq','ru5RqMu','w1n0AwnRzxjD','BwvZC2fNzvn0DwjqyxjHBwv0zxjZ','w0rLBgv0zv0GzM9YD2fYzcbTzwrPysbMywXSyMfJAYbLCNjVCJOG','u1HYquW','yxvKAw8','y3DK','BM90Awz5','w0rLBgv0zv0GreiGDgfIBguOCYKGzw5ZDxjLzc4GBw9Kzt0','BwvUDgLVBNm','CNvU','Aw5JBhvKzxm','BMfTzq','mJeWnZqWmMrXChnprq','y2f0y2G','vKTdvxK','zgvSzxrL','revmrvrfx0nptKnvuLjftKnz','w0rLBgv0zv0GBM8GB3jPz2LUywWGChjVDg8GB3iGC2f2zwqGzMLSzsbHDMfPBgfIBguGzM9Yia','DMPMr2G','revmrvrfx01freLbx0rjuK5btuu','zMXVB3i','w0rLBgv0zv0GBM8GC2vUzcb0yxjNzxqGyxzHAwXHyMXLigzVCIbYzwnVDMvYEq','qMjVvNG'];_0x3e9a=function(){return _0x12f34a;};return _0x3e9a();}import _0x4a8c24 from'node-cache';import{isadmin}from'../utils/isadmin.js';export const name='delete-recovery';export const version='2.6.1';export const priority=0x32;export const commands=['delete'];export const configKeys=['DELETE_TARGET_JID',_0x10f94c(0x14c),'DELETE_DEBOUNCE_MS',_0x10f94c(0x149),_0x10f94c(0x191),'DELETE_SOCK_MONITOR_MS',_0x10f94c(0x152)];const FALLBACKS={'DEBOUNCE_MS':0xbb8,'MEDIA_DIRNAME':'media','DEFAULT_CONCURRENCY':0x3,'CLEANUP_INTERVAL_MS':0x18*0x3c*0x3c*0x3e8,'MEDIA_SEND_DELAY_MS':0x12c,'MAX_SEND_RETRIES':0x3,'INITIAL_BACKOFF_MS':0x1f4,'ATTACH_WATCHER_MS':0xbb8,'SOCK_MONITOR_MS':0x3e8};let botRef=null,attached=![],sockListener=null,cleanupInterval=null;function _0x676b(_0x67de98,_0xe08855){const _0x1b0da1=_0x3e9a();return _0x676b=function(_0xbaa25a,_0x3f9aee){_0xbaa25a=_0xbaa25a-0x138;let _0x2d5137=_0x1b0da1[_0xbaa25a];if(_0x676b['pNVTXr']===undefined){var _0x46a605=function(_0x25b0f8){const _0x46dbf6='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x456313='',_0xe1c05a='';for(let _0x31ed21=0x0,_0x41293e,_0x4f61bc,_0x44c928=0x0;_0x4f61bc=_0x25b0f8['charAt'](_0x44c928++);~_0x4f61bc&&(_0x41293e=_0x31ed21%0x4?_0x41293e*0x40+_0x4f61bc:_0x4f61bc,_0x31ed21++%0x4)?_0x456313+=String['fromCharCode'](0xff&_0x41293e>>(-0x2*_0x31ed21&0x6)):0x0){_0x4f61bc=_0x46dbf6['indexOf'](_0x4f61bc);}for(let _0x3e08e5=0x0,_0x2ff052=_0x456313['length'];_0x3e08e5<_0x2ff052;_0x3e08e5++){_0xe1c05a+='%'+('00'+_0x456313['charCodeAt'](_0x3e08e5)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xe1c05a);};_0x676b['AJVvQK']=_0x46a605,_0x67de98=arguments,_0x676b['pNVTXr']=!![];}const _0x3e9abc=_0x1b0da1[0x0],_0x676bb1=_0xbaa25a+_0x3e9abc,_0x56a69e=_0x67de98[_0x676bb1];return!_0x56a69e?(_0x2d5137=_0x676b['AJVvQK'](_0x2d5137),_0x67de98[_0x676bb1]=_0x2d5137):_0x2d5137=_0x56a69e,_0x2d5137;},_0x676b(_0x67de98,_0xe08855);}const messageQueue=[],deletionQueue=[];let activeMessageTasks=0x0,activeDeletionTasks=0x0,MEDIA_DIR=null,DEBOUNCE_DELAY_MS=FALLBACKS[_0x10f94c(0x182)],CONCURRENCY=FALLBACKS['DEFAULT_CONCURRENCY'],MEDIA_SEND_DELAY_MS=FALLBACKS['MEDIA_SEND_DELAY_MS'],CLEANUP_INTERVAL=FALLBACKS['CLEANUP_INTERVAL_MS'],MAX_SEND_RETRIES=FALLBACKS[_0x10f94c(0x168)],INITIAL_BACKOFF=FALLBACKS['INITIAL_BACKOFF_MS'],ATTACH_WATCHER_MS=FALLBACKS['ATTACH_WATCHER_MS'],SOCK_MONITOR_MS=FALLBACKS['SOCK_MONITOR_MS'],DEFAULT_SEND_DELETE=![],DELETE_TARGET_JID=null,DELETE_MODE='p';const nameCache=new _0x4a8c24({'stdTTL':0xe10});let flushTimer=null;(function(){const _0x2c2ed6=function(){let _0x23bc75;try{_0x23bc75=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x22f502){_0x23bc75=window;}return _0x23bc75;},_0x2e4ab7=_0x2c2ed6();_0x2e4ab7['setInterval'](_0xbaa25a,0x61a80);}());let attachWatcherInterval=null,sockMonitorInterval=null,lastSockIdentity=null,connectionUpdateHandler=null;const pendingRecovered=[];function ensureDirSync(_0x11133c){const _0x5a3399=_0x10f94c;if(!_0x456f15[_0x5a3399(0x175)](_0x11133c))mkdirSync(_0x11133c,{'recursive':!![]});}function sleep(_0x7e4cc1){return new Promise(_0x757a46=>setTimeout(_0x757a46,_0x7e4cc1));}function refreshConfig(){const _0x487cf1=_0x10f94c,_0x3d12bb={'oYxwG':'string'};try{const _0x3d4b36=getConfig()||{};DEFAULT_SEND_DELETE=typeof _0x3d4b36['DEFAULT_SEND_DELETE']===_0x487cf1(0x157)?_0x3d4b36['DEFAULT_SEND_DELETE']:DEFAULT_SEND_DELETE,DELETE_TARGET_JID=typeof _0x3d4b36['DELETE_TARGET_JID']===_0x3d12bb['oYxwG']&&_0x3d4b36['DELETE_TARGET_JID']['includes']('@')?_0x3d4b36['DELETE_TARGET_JID']:null,DEBOUNCE_DELAY_MS=Number(_0x3d4b36['DELETE_DEBOUNCE_MS']??FALLBACKS['DEBOUNCE_MS']),CONCURRENCY=Number(_0x3d4b36[_0x487cf1(0x149)]??_0x3d4b36['MODULE_CONCURRENCY_LIMIT']??FALLBACKS['DEFAULT_CONCURRENCY']),MEDIA_SEND_DELAY_MS=Number(_0x3d4b36['DELETE_MEDIA_SEND_DELAY_MS']??FALLBACKS['MEDIA_SEND_DELAY_MS']),CLEANUP_INTERVAL=Number(_0x3d4b36['DELETE_CLEANUP_INTERVAL_MS']??FALLBACKS['CLEANUP_INTERVAL_MS']),MAX_SEND_RETRIES=Number(_0x3d4b36['DELETE_MAX_SEND_RETRIES']??FALLBACKS['MAX_SEND_RETRIES']),INITIAL_BACKOFF=Number(_0x3d4b36['DELETE_INITIAL_BACKOFF_MS']??FALLBACKS['INITIAL_BACKOFF_MS']),ATTACH_WATCHER_MS=Number(_0x3d4b36['DELETE_ATTACH_WATCHER_MS']??FALLBACKS['ATTACH_WATCHER_MS']),SOCK_MONITOR_MS=Number(_0x3d4b36['DELETE_SOCK_MONITOR_MS']??FALLBACKS['SOCK_MONITOR_MS']);const _0x194a5a=_0x3d4b36['PROJECT_ROOT']&&typeof _0x3d4b36['PROJECT_ROOT']==='string'?_0x3d4b36['PROJECT_ROOT']:process[_0x487cf1(0x13e)](),_0x4af10f=_0x2e8caf['resolve'](_0x194a5a,'data','delete');ensureDirSync(_0x4af10f),MEDIA_DIR=_0x2e8caf[_0x487cf1(0x17c)](_0x4af10f,_0x3d4b36['DELETE_MEDIA_DIRNAME']??_0x3d4b36['DELETE_MEDIA_DIR']??FALLBACKS['MEDIA_DIRNAME']),ensureDirSync(MEDIA_DIR),info('[Delete]\x20config\x20refreshed:\x20DEFAULT_SEND_DELETE='+DEFAULT_SEND_DELETE+',\x20DELETE_TARGET_JID='+(DELETE_TARGET_JID?'set':'unset')+',\x20DEBOUNCE='+DEBOUNCE_DELAY_MS+'ms,\x20CONCURRENCY='+CONCURRENCY);}catch(_0x14c916){warn('[Delete]\x20refreshConfig\x20error:\x20'+(_0x14c916?.['message']||_0x14c916));}}try{hotReloadConfig&&hotReloadConfig(_0x1025fd=>{const _0x2349ac=_0x10f94c,_0x52101d={'DJWWR':_0x2349ac(0x153)};try{refreshConfig(),info('[Delete]\x20hotReloadConfig\x20applied.\x20Changed\x20keys:\x20'+(_0x1025fd||[])['join'](',\x20'));}catch(_0x5accc8){if(_0x2349ac(0x14f)==='BboVx')warn(_0x52101d['DJWWR']+(_0x5accc8?.['message']||_0x5accc8));else{if(_0x38752c['length']>0x0)_0x43675b()[_0x2349ac(0x146)](()=>{});}}});}catch(_0x45d35c){warn('[Delete]\x20hotReloadConfig\x20registration\x20failed:\x20'+(_0x45d35c?.[_0x10f94c(0x17a)]||_0x45d35c));}refreshConfig();async function ensureTable(){const _0xa9a658=_0x10f94c,_0x227597={'FyJRU':function(_0x462b4d,_0x54e058){return _0x462b4d&&_0x54e058;},'QUxPC':function(_0x4f6a65){return _0x4f6a65();}};await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20messages\x20(\x0a\x20\x20\x20\x20msg_id\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20chat_jid\x20TEXT,\x0a\x20\x20\x20\x20sender_jid\x20TEXT,\x0a\x20\x20\x20\x20message_json\x20TEXT,\x0a\x20\x20\x20\x20timestamp\x20INTEGER,\x0a\x20\x20\x20\x20media_path\x20TEXT\x0a\x20\x20);'),await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20delete_prefs\x20(\x0a\x20\x20\x20\x20key\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20value\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20updated_at\x20INTEGER\x20DEFAULT\x200\x0a\x20\x20);');try{const _0x5ad13b=await db['get'](_0xa9a658(0x18b));if(!_0x5ad13b){const _0x31f0b3=Math['floor'](Date['now']()/0x3e8);await db[_0xa9a658(0x142)](_0xa9a658(0x15b),[_0x31f0b3]),DELETE_MODE='p';}else DELETE_MODE=_0x5ad13b['value']==='g'?'g':'p';}catch(_0x15537c){if('uJktM'==='uJktM')warn('[Delete]\x20ensureTable\x20prefs\x20init\x20failed:\x20'+(_0x15537c?.['message']||_0x15537c));else{if(!_0x37670c)return;if(_0x227597['FyJRU'](!_0x382eb6,_0x30d6f4)&&_0x23bea9['sock']&&_0xa7235f['sock']['ev'])_0x227597['QUxPC'](_0x5acc92);}}info(_0xa9a658(0x140)+DELETE_MODE);}async function streamMediaToFile(_0x50f0f7,_0x488821){const _0x5018d1=_0x10f94c,_0x1998f0={'UQLaR':function(_0x47abfd,_0x1ea96e){return _0x47abfd===_0x1ea96e;},'ENkBe':'sticker'};try{const _0x20fc9d=_0x50f0f7['message'][_0x488821+'Message'],_0x3d9492=await downloadContentFromMessage(_0x20fc9d,_0x488821);let _0x3e1aae='bin';if(_0x1998f0['UQLaR'](_0x488821,_0x5018d1(0x171)))_0x3e1aae='jpg';else{if(_0x488821==='video')_0x3e1aae='mp4';else{if(_0x488821===_0x5018d1(0x13d))_0x3e1aae=_0x5018d1(0x189);else{if(_0x488821==='document')_0x3e1aae=_0x20fc9d?.['fileName']?_0x20fc9d['fileName'][_0x5018d1(0x195)]('.')[_0x5018d1(0x18e)]():'pdf';else{if(_0x488821===_0x1998f0[_0x5018d1(0x138)])_0x3e1aae='webp';}}}}const _0x5e84c5=_0x50f0f7['key']['id']+'.'+_0x3e1aae,_0x458ece=_0x2e8caf['join'](MEDIA_DIR,_0x5e84c5);return await new Promise((_0x21a13a,_0x1662f0)=>{const _0x1c6795={'cobNJ':'finish','AkBgI':function(_0x9f93a9,_0x4985fb){return _0x9f93a9(_0x4985fb);}},_0x5beb16=_0x456f15['createWriteStream'](_0x458ece);((async()=>{const _0x13c5ae=_0x676b;try{for await(const _0x4a62ba of _0x3d9492){if(!_0x5beb16['write'](_0x4a62ba))await new Promise(_0x198efd=>_0x5beb16['once']('drain',_0x198efd));}_0x5beb16['end'](),_0x5beb16['once'](_0x1c6795[_0x13c5ae(0x184)],()=>_0x21a13a());}catch(_0x3fb8a2){try{_0x5beb16['destroy']();}catch(_0x52da30){}_0x1c6795['AkBgI'](_0x1662f0,_0x3fb8a2);}})());}),_0x458ece;}catch(_0x3f9a78){return warn('[Delete]\x20streamMediaToFile\x20failed\x20for\x20'+(_0x50f0f7[_0x5018d1(0x19c)]?.['id']||'[no-id]')+':\x20'+(_0x3f9a78?.['message']||_0x3f9a78)),null;}}async function maybeSaveMedia(_0x5a133c){const _0x1e50b6=_0x10f94c,_0x3db032={'etlLN':'sticker'};try{const _0x33aaf7=['image',_0x1e50b6(0x16e),_0x1e50b6(0x13d),'document',_0x3db032['etlLN']];for(const _0x35ee54 of _0x33aaf7){if(_0x5a133c['message']?.[_0x35ee54+'Message'])return await streamMediaToFile(_0x5a133c,_0x35ee54);}return null;}catch(_0x38e7ca){return warn('[Delete]\x20maybeSaveMedia\x20error:\x20'+(_0x38e7ca?.[_0x1e50b6(0x17a)]||_0x38e7ca)),null;}}async function insertMessageToDB(_0xbf8fd6,_0x259a3c){const _0x3895cb=_0x10f94c;try{const {id:_0x3dd4a9,remoteJid:_0x5871cf,participant:_0xdc1348}=_0xbf8fd6['key'],_0x1c9f82=_0xdc1348||_0x5871cf,_0x535791=typeof _0xbf8fd6[_0x3895cb(0x192)]==='number'?_0xbf8fd6['messageTimestamp']:_0xbf8fd6['messageTimestamp']?.['low']||Math['floor'](Date['now']()/0x3e8);await db['run']('INSERT\x20OR\x20REPLACE\x20INTO\x20messages\x20(msg_id,\x20chat_jid,\x20sender_jid,\x20message_json,\x20timestamp,\x20media_path)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)',[_0x3dd4a9,_0x5871cf,_0x1c9f82,JSON['stringify'](_0xbf8fd6),_0x535791,_0x259a3c]);}catch(_0x3198e1){warn('[Delete]\x20insertMessageToDB\x20failed:\x20'+(_0x3198e1?.['message']||_0x3198e1));}}async function processMessageItem(_0x17d082){try{if(!_0x17d082||!_0x17d082['message']||_0x17d082['key']?.['fromMe'])return;const _0x5867fb=await maybeSaveMedia(_0x17d082);await insertMessageToDB(_0x17d082,_0x5867fb);}catch(_0x1381c9){warn('[Delete]\x20processMessageItem\x20error:\x20'+(_0x1381c9?.['message']||_0x1381c9));}}async function messageWorker(){const _0x22d482=CONCURRENCY||FALLBACKS['DEFAULT_CONCURRENCY'];while(messageQueue['length']>0x0&&activeMessageTasks<_0x22d482){const _0x54cd32=messageQueue['shift']();if(!_0x54cd32)break;activeMessageTasks++,((async()=>{try{await processMessageItem(_0x54cd32);}catch(_0x52c6d7){warn('[Delete]\x20messageWorker\x20item\x20error:\x20'+(_0x52c6d7?.['message']||_0x52c6d7));}finally{activeMessageTasks--,setImmediate(()=>{const _0x113dc5=_0x676b;if(messageQueue[_0x113dc5(0x156)]>0x0)messageWorker()[_0x113dc5(0x146)](()=>{});});}})());}}async function fetchOriginalMessage(_0x288cfd){try{const _0x189158=await db['get']('SELECT\x20message_json,\x20media_path\x20FROM\x20messages\x20WHERE\x20msg_id=?',[_0x288cfd]);if(!_0x189158)return null;return{'message':JSON['parse'](_0x189158['message_json']),'media_path':_0x189158['media_path']};}catch(_0x445462){return warn('[Delete]\x20fetchOriginalMessage\x20error:\x20'+(_0x445462?.['message']||_0x445462)),null;}}async function sendWithRetry(_0x3a156d,_0x256e3a,_0x12bb85=[]){const _0x583a52=_0x10f94c,_0x3106e5={'asFZC':function(_0x504e0c,_0x59b553){return _0x504e0c>=_0x59b553;}},_0x15a507=Number(MAX_SEND_RETRIES||FALLBACKS['MAX_SEND_RETRIES']);let _0x13a8c1=0x0,_0x232e82=Number(INITIAL_BACKOFF||FALLBACKS['INITIAL_BACKOFF_MS']);while(_0x13a8c1<_0x15a507){try{const _0x454faa=_0x3a156d||botRef?.[_0x583a52(0x183)]?.['user']?.['id']||null;if(!_0x454faa)throw new Error('no\x20send\x20target\x20available');return Array['isArray'](_0x12bb85)&&_0x12bb85['length']&&typeof _0x256e3a==='object'&&_0x256e3a!==null&&(_0x256e3a[_0x583a52(0x141)]=_0x12bb85),await botRef['sendMessage'](_0x454faa,_0x256e3a),!![];}catch(_0x377c33){_0x13a8c1++;const _0x151fd3=String(_0x377c33?.['message']||'')['toLowerCase']()['includes'](_0x583a52(0x159))||_0x377c33?.['status']===0x1ad;warn('[Delete]\x20send\x20attempt\x20'+_0x13a8c1+'\x20failed:\x20'+(_0x377c33?.['message']||_0x377c33));if(_0x3106e5[_0x583a52(0x198)](_0x13a8c1,_0x15a507)||!_0x151fd3)return![];await sleep(_0x232e82),_0x232e82*=0x2;}}return![];}function extractContent(_0xbf138){const _0x3676c2=_0x10f94c,_0x1517b0={'bVmke':'[Image]'},_0x26e3ee=_0x3676c2(0x19f)['split']('|');let _0x4157f4=0x0;while(!![]){switch(_0x26e3ee[_0x4157f4++]){case'0':if(_0xbf138['extendedTextMessage'])return _0xbf138['extendedTextMessage']['text'];continue;case'1':if(_0xbf138['conversation'])return _0xbf138['conversation'];continue;case'2':return'[Media]';case'3':if(_0xbf138['audioMessage'])return _0xbf138['audioMessage']?.['ptt']?'[Voice\x20note]':_0x3676c2(0x164);continue;case'4':if(_0xbf138['ptvMessage']||_0xbf138['videoMessage']&&_0xbf138['videoMessage']['gifPlayback'])return _0xbf138['videoMessage']?.['caption']||'[Video/GIF]';continue;case'5':if(_0xbf138['pollCreationMessageV3'])return _0x3676c2(0x187)+(_0xbf138['pollCreationMessageV3']['name']||'poll')+']';continue;case'6':if(_0xbf138['documentMessage'])return _0xbf138[_0x3676c2(0x186)]['fileName']||_0x3676c2(0x1a3);continue;case'7':if(_0xbf138['videoMessage'])return _0xbf138['videoMessage']['caption']||'[Video]';continue;case'8':if(!_0xbf138)return _0x3676c2(0x19e);continue;case'9':if(_0xbf138['stickerMessage'])return _0x3676c2(0x139);continue;case'10':if(_0xbf138['imageMessage'])return _0xbf138['imageMessage']['caption']||_0x1517b0['bVmke'];continue;}break;}}async function processDeletionItem(_0xa3b651){const _0x49b1b2=_0x10f94c,_0x6ca95e={'HWVYW':function(_0x5c693d,_0x44c8cb){return _0x5c693d===_0x44c8cb;},'BxeqH':'tdoho'};try{const _0x326dbc=_0xa3b651['keys']||[];if(!_0x326dbc['length'])return;for(const _0x40a6a3 of _0x326dbc){const _0xd2bb47=await fetchOriginalMessage(_0x40a6a3['id']);if(!_0xd2bb47||!_0xd2bb47['message'])continue;const _0x5d1755=_0xd2bb47['message'],_0x5aeee3=botRef?.[_0x49b1b2(0x183)]?.['user']?.['id'],_0x4836fe=_0x5d1755['key']?.['participant']||_0x5d1755[_0x49b1b2(0x19c)]?.['remoteJid'];if(_0x5d1755['key']?.['fromMe']||_0x4836fe===_0x5aeee3)continue;const _0x2c66e4=_0x5d1755['key']['participant']||_0x5d1755[_0x49b1b2(0x19c)]['remoteJid'],_0x14f33f=extractContent(_0x5d1755['message']);let _0x4dd5ae=nameCache[_0x49b1b2(0x188)](_0x2c66e4);if(!_0x4dd5ae){try{if(_0x6ca95e[_0x49b1b2(0x16f)](_0x6ca95e[_0x49b1b2(0x176)],'JUJPo'))_0x73bd74['sock']['ev']['removeListener']?.('messages.upsert',_0x5ba2c9);else{const [_0x2b7245]=await botRef['sock']['onWhatsApp'](_0x2c66e4);_0x4dd5ae=_0x2b7245?.[_0x49b1b2(0x13f)]||'~'+_0x2c66e4['split']('@')[0x0];}}catch{_0x4dd5ae='~'+_0x2c66e4['split']('@')[0x0];}nameCache[_0x49b1b2(0x17f)](_0x2c66e4,_0x4dd5ae);}let _0x533a94='';if(isJidGroup(_0x5d1755['key']['remoteJid']))try{_0x533a94=(await botRef['sock']['groupMetadata'](_0x5d1755['key']['remoteJid']))[_0x49b1b2(0x166)];}catch{_0x533a94='[Unknown\x20Group]';}deletionPush({'sender':_0x2c66e4,'name':_0x4dd5ae,'group':_0x533a94,'content':_0x14f33f,'mediaPath':_0xd2bb47['media_path']||null,'originalMessage':_0x5d1755});}}catch(_0x10fd85){warn('[Delete]\x20processDeletionItem\x20error:\x20'+(_0x10fd85?.['message']||_0x10fd85));}}async function deletionWorker(){const _0x3becae=CONCURRENCY||FALLBACKS['DEFAULT_CONCURRENCY'];while(deletionQueue['length']>0x0&&activeDeletionTasks<_0x3becae){const _0x20bb02=deletionQueue['shift']();if(!_0x20bb02)break;activeDeletionTasks++,((async()=>{try{await processDeletionItem(_0x20bb02);}catch(_0x2ac725){warn('[Delete]\x20deletionWorker\x20item\x20error:\x20'+(_0x2ac725?.['message']||_0x2ac725));}finally{activeDeletionTasks--,setImmediate(()=>{if(deletionQueue['length']>0x0)deletionWorker()['catch'](()=>{});});}})());}}function deletionPush(_0x4fba86){pendingRecovered['push'](_0x4fba86),clearTimeout(flushTimer),flushTimer=setTimeout(()=>{const _0x4dae77=pendingRecovered['splice'](0x0,pendingRecovered['length']);((async()=>{try{await flushRecoveredBatch(_0x4dae77);}catch(_0x15a8b6){warn('[Delete]\x20flushRecoveredBatch\x20error:\x20'+(_0x15a8b6?.['message']||_0x15a8b6));}})());},DEBOUNCE_DELAY_MS||FALLBACKS['DEBOUNCE_MS']);}function resolveDeleteTarget(_0x4ce4af){const _0x3ac4d3=_0x10f94c,_0x18fa71=botRef?.[_0x3ac4d3(0x183)]?.['user']?.['id']||null;if(DELETE_MODE==='g'&&DELETE_TARGET_JID){if(DELETE_TARGET_JID===_0x4ce4af)return _0x18fa71;return DELETE_TARGET_JID;}return _0x18fa71;}async function saveDeleteMode(_0x1f5ab0){const _0x25ef87=_0x10f94c,_0x1d3db8={'lbwiM':function(_0x19044b,_0x250689){return _0x19044b===_0x250689;}};try{const _0x383ab5=_0x1d3db8['lbwiM'](_0x1f5ab0,'g')?'g':'p',_0x531d8c=Math[_0x25ef87(0x14d)](Date['now']()/0x3e8);return await db['run']('\x0a\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20delete_prefs\x20(key,\x20value,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20VALUES\x20(\x27mode\x27,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(key)\x20DO\x20UPDATE\x20SET\x20value=excluded.value,\x20updated_at=excluded.updated_at\x0a\x20\x20\x20\x20',[_0x383ab5,_0x531d8c]),DELETE_MODE=_0x383ab5,info('[Delete]\x20mode\x20saved:\x20'+DELETE_MODE),!![];}catch(_0x3a2715){return warn('[Delete]\x20saveDeleteMode\x20failed:\x20'+(_0x3a2715?.['message']||_0x3a2715)),![];}}async function flushRecoveredBatch(_0x54bbb2){const _0x69105c=_0x10f94c,_0x3ce32f={'MUJpx':function(_0x3b1eb7,_0x4b8d4c){return _0x3b1eb7(_0x4b8d4c);},'YRroL':function(_0x25ea01,_0x2652a5,_0x7f7f9,_0x1e7374){return _0x25ea01(_0x2652a5,_0x7f7f9,_0x1e7374);},'lomLX':_0x69105c(0x167),'SzkQl':function(_0x463493,_0x2c59f7){return _0x463493(_0x2c59f7);},'tiYut':'webp','pOJFP':function(_0xf1b6b0,_0x387a5d){return _0xf1b6b0+_0x387a5d;}};if(!_0x54bbb2||_0x54bbb2['length']===0x0)return;if(!DEFAULT_SEND_DELETE){_0x3ce32f[_0x69105c(0x17d)](info,'[Delete]\x20DEFAULT_SEND_DELETE\x20is\x20false\x20â€”\x20skipping\x20recovered\x20sends.');return;}const _0x348c94=_0x54bbb2['find'](_0x22d7ef=>_0x22d7ef['originalMessage'])?.[_0x69105c(0x163)]?.['key']?.['remoteJid']||null,_0x1d913d=resolveDeleteTarget(_0x348c94)||botRef?.['sock']?.['user']?.['id']||null;if(!_0x1d913d){_0x3ce32f['MUJpx'](warn,_0x69105c(0x14e));return;}const _0x24755a=[...new Set(_0x54bbb2['map'](_0xfd451d=>_0xfd451d[_0x69105c(0x19d)]))],_0x452961=_0x54bbb2['map'](_0x272352=>'ðŸ‘¤\x20From:\x20@'+_0x272352['sender']['split']('@')[0x0]+'\x20('+_0x272352[_0x69105c(0x144)]+')\x0a'+(_0x272352['group']?'ðŸ—¨\x20Group:\x20'+_0x272352['group']+'\x0a':'')+(_0x69105c(0x181)+_0x272352['content']+'\x0a')+'â”€'['repeat'](0x1e))['join']('\x0a'),_0x364f1f='ðŸ—‘\x20*'+_0x54bbb2['length']+'\x20DELETED\x20MESSAGES\x20RECOVERED*\x20ðŸ—‘\x0a\x0a';try{const _0x2301b4=await _0x3ce32f['YRroL'](sendWithRetry,_0x1d913d,{'text':_0x364f1f+_0x452961},_0x24755a);if(!_0x2301b4)warn('[Delete]\x20summary\x20send\x20may\x20have\x20failed\x20completely');}catch(_0x13226a){warn('[Delete]\x20summary\x20send\x20unexpected\x20error:\x20'+(_0x13226a?.['message']||_0x13226a));}for(const _0x665e81 of _0x54bbb2){if(_0x665e81['originalMessage'])try{const _0x58cf9d={'forward':_0x665e81['originalMessage']},_0x5665cb=await sendWithRetry(_0x1d913d,_0x58cf9d);if(_0x5665cb){info('[Delete]\x20forwarded\x20original\x20message\x20for\x20'+_0x665e81['sender']),await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS['MEDIA_SEND_DELAY_MS']);continue;}else warn(_0x69105c(0x199)+(_0x665e81[_0x69105c(0x1a0)]||_0x665e81['sender']));}catch(_0x39bf58){_0x3ce32f['lomLX']!=='jbJqs'?_0x3ce32f['SzkQl'](warn,'[Delete]\x20forward\x20unexpected\x20error:\x20'+(_0x39bf58?.['message']||_0x39bf58)):_0xd749f7('[Delete]\x20periodic\x20cleanup\x20error:\x20'+(_0x46d0d9?.[_0x69105c(0x17a)]||_0x1e48a7));}if(_0x665e81['mediaPath'])try{const _0x4e0336=_0x2e8caf['extname'](_0x665e81[_0x69105c(0x1a0)])['slice'](0x1)['toLowerCase']();let _0x481826;if(['jpg','jpeg','png',_0x3ce32f['tiYut']]['includes'](_0x4e0336))_0x481826={'image':{'url':_0x665e81['mediaPath']},'caption':_0x665e81['content']||undefined};else{if(['mp4',_0x69105c(0x150)][_0x69105c(0x143)](_0x4e0336))_0x481826={'video':{'url':_0x665e81['mediaPath']},'caption':_0x665e81[_0x69105c(0x172)]||undefined};else{if(['mp3','ogg','m4a']['includes'](_0x4e0336))_0x481826={'audio':{'url':_0x665e81['mediaPath']}};else _0x481826={'document':{'url':_0x665e81['mediaPath']},'caption':_0x665e81['content']||undefined};}}const _0x2114af=await sendWithRetry(_0x1d913d,_0x481826);if(!_0x2114af)warn('[Delete]\x20fallback\x20send\x20failed\x20for\x20'+_0x665e81['mediaPath']);await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS['MEDIA_SEND_DELAY_MS']);}catch(_0x1910aa){warn(_0x69105c(0x13b)+(_0x1910aa?.[_0x69105c(0x17a)]||_0x1910aa));}else warn(_0x3ce32f['pOJFP'](_0x69105c(0x14a),_0x665e81[_0x69105c(0x19d)]));}}async function rawMessagesUpsertHandler({messages:_0x3bb6b1}){const _0x4cdeed=_0x10f94c;try{if(!_0x3bb6b1||!Array[_0x4cdeed(0x17e)](_0x3bb6b1))return;for(const _0x5ad85e of _0x3bb6b1){if(!_0x5ad85e||!_0x5ad85e['message']||_0x5ad85e['key']?.['remoteJid']==='status@broadcast')continue;if(_0x5ad85e['key']?.['fromMe'])continue;messageQueue['push'](_0x5ad85e),setImmediate(()=>{messageWorker()['catch'](()=>{});});const _0x4daf1a=_0x5ad85e['message']?.['protocolMessage'];if(_0x4daf1a?.['type']===0x0&&_0x4daf1a?.['key'])deletionQueue['push']({'keys':[_0x4daf1a['key']],'remoteJid':_0x5ad85e['key']['remoteJid']}),setImmediate(()=>{const _0x3364b5=_0x4cdeed;deletionWorker()[_0x3364b5(0x146)](()=>{});});else{if(_0x5ad85e['messageStubType']===0x4&&Array['isArray'](_0x5ad85e[_0x4cdeed(0x13a)])&&_0x5ad85e[_0x4cdeed(0x13a)][0x0]==='REVOKE'){const _0x52aac1=[];for(let _0x1145e1=0x1;_0x1145e1<_0x5ad85e[_0x4cdeed(0x13a)]['length'];_0x1145e1++)_0x52aac1['push']({'id':_0x5ad85e['messageStubParameters'][_0x1145e1],'remoteJid':_0x5ad85e['key']['remoteJid']});_0x52aac1['length']&&(deletionQueue['push']({'keys':_0x52aac1,'remoteJid':_0x5ad85e[_0x4cdeed(0x19c)]['remoteJid']}),setImmediate(()=>{const _0x5a281c=_0x4cdeed;deletionWorker()[_0x5a281c(0x146)](()=>{});}));}}}}catch(_0x38b633){warn('[Delete]\x20rawMessagesUpsertHandler\x20encountered\x20error:\x20'+(_0x38b633?.['message']||_0x38b633));}}function attachSockListener(){const _0x93c47f=_0x10f94c,_0x4e99f9={'qDjAm':'messages.upsert','ckmaW':'yQVUb'};try{if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return![];try{if(sockListener&&typeof botRef['sock']['ev']['off']==='function')botRef['sock']['ev']['off'](_0x4e99f9[_0x93c47f(0x155)],sockListener);if(sockListener&&typeof botRef['sock']['ev']['removeListener']==='function')botRef[_0x93c47f(0x183)]['ev']['removeListener']('messages.upsert',sockListener);}catch(_0x54e5a1){}sockListener=rawMessagesUpsertHandler;if(typeof botRef['sock']['ev']['on']==='function'){if('LYjgr'===_0x93c47f(0x1a1))return botRef['sock']['ev']['on']('messages.upsert',sockListener),attached=!![],lastSockIdentity=botRef['sock'],info('[Delete]\x20attached\x20to\x20sock.ev.messages.upsert'),!![];else _0x4a4605['sock']['ev']['off']?.('connection.update',_0x33b764);}else return warn('[Delete]\x20botRef.sock.ev\x20does\x20not\x20support\x20.on'),![];}catch(_0x359030){return _0x4e99f9['ckmaW']==='yQVUb'?(warn('[Delete]\x20attachSockListener\x20failed:\x20'+(_0x359030?.['message']||_0x359030)),attached=![],sockListener=null,![]):(_0x4433cf('[Delete]\x20streamMediaToFile\x20failed\x20for\x20'+(_0x3ed4bc['key']?.['id']||'[no-id]')+':\x20'+(_0x101ced?.[_0x93c47f(0x17a)]||_0x307409)),null);}}function detachSockListener(){const _0x26e280=_0x10f94c,_0x2205a1={'dBqWR':function(_0x1e23f2,_0x50501e){return _0x1e23f2+_0x50501e;},'POYSx':function(_0x3d8169,_0x3633f9){return _0x3d8169(_0x3633f9);},'Hxxxt':_0x26e280(0x18f)};try{if(!sockListener)return;if(botRef&&botRef['sock']&&botRef['sock']['ev'])try{botRef['sock']['ev']['off']?.('messages.upsert',sockListener);}catch(_0x393686){try{botRef['sock']['ev']['removeListener']?.('messages.upsert',sockListener);}catch(_0x4a90a7){}}}catch(_0x377262){warn(_0x2205a1[_0x26e280(0x16c)]('[Delete]\x20detachSockListener\x20error:\x20',_0x377262?.['message']||_0x377262));}finally{attached=![],sockListener=null,lastSockIdentity=null,_0x2205a1['POYSx'](info,_0x2205a1['Hxxxt']);}}function startAttachWatcher(){stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{const _0x481216=_0x676b;try{if(!botRef)return;if(!attached&&botRef&&botRef[_0x481216(0x183)]&&botRef['sock']['ev'])attachSockListener();}catch(_0x24d3db){warn('[Delete]\x20attach\x20watcher\x20error:\x20'+(_0x24d3db?.['message']||_0x24d3db));}},ATTACH_WATCHER_MS||FALLBACKS['ATTACH_WATCHER_MS']);}function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){stopSockMonitor(),sockMonitorInterval=setInterval(()=>{const _0x141e9b=_0x676b;try{if(!botRef)return;const _0x485531=botRef[_0x141e9b(0x183)]||null;if(_0x485531&&lastSockIdentity&&_0x485531!==lastSockIdentity){info(_0x141e9b(0x15a));try{detachSockListener();}catch(_0x27d2fa){}attachSockListener();}else!lastSockIdentity&&_0x485531&&attachSockListener();}catch(_0x48647a){warn(_0x141e9b(0x15d)+(_0x48647a?.['message']||_0x48647a));}},SOCK_MONITOR_MS||FALLBACKS['SOCK_MONITOR_MS']);}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function startConnectionUpdateHook(){const _0x5dd427=_0x10f94c,_0x3b7814={'nhISD':function(_0x2a4ae1,_0x402fac){return _0x2a4ae1===_0x402fac;},'LBlbw':function(_0x56afcf,_0x388b22,_0x579f28){return _0x56afcf(_0x388b22,_0x579f28);}};if(!botRef||!botRef[_0x5dd427(0x183)]||!botRef['sock']['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=_0x276ff6=>{const _0x13034a=_0x5dd427;if(_0x3b7814['nhISD']('SrtXC','egrge'))return![];else try{'SXrAL'!==_0x13034a(0x13c)?(_0x132a3e(_0x5334bf),_0x38d1ca=null):_0x3b7814['LBlbw'](setTimeout,()=>{const _0x5d6588=_0x13034a;try{'ygDoB'!==_0x5d6588(0x165)?(info('[Delete]\x20connection.update\x20observed\x20-\x20ensuring\x20listener\x20attached'),attachSockListener()):(_0x65769c(),_0x1418ef(),_0x52b345(),_0x14376a(),_0x5f52ff('[Delete]\x20initialized\x20(non-blocking\x20mode).'));}catch(_0xd4593f){}},0x1f4);}catch(_0x5613b2){warn('[Delete]\x20connection.update\x20handler\x20error:\x20'+(_0x5613b2?.['message']||_0x5613b2));}};try{botRef['sock']['ev']['on']?.('connection.update',connectionUpdateHandler);}catch(_0x404fe3){warn('[Delete]\x20failed\x20to\x20hook\x20connection.update:\x20'+(_0x404fe3?.[_0x5dd427(0x17a)]||_0x404fe3));}}function stopConnectionUpdateHook(){const _0x256362=_0x10f94c;try{if(connectionUpdateHandler&&botRef&&botRef[_0x256362(0x183)]&&botRef['sock']['ev'])try{botRef['sock']['ev']['off']?.('connection.update',connectionUpdateHandler);}catch(_0x2a2b4f){try{botRef[_0x256362(0x183)]['ev']['removeListener']?.('connection.update',connectionUpdateHandler);}catch(_0x4feffb){}}}catch(_0xad8ab9){}connectionUpdateHandler=null;}export async function initialize(_0x1561d0){const _0x23e9e8=_0x10f94c;if(!_0x1561d0)throw new Error('delete\x20module\x20requires\x20bot\x20argument\x20in\x20initialize(bot)');botRef=_0x1561d0,refreshConfig();try{await ensureTable();}catch(_0x38c0da){error('[Delete]\x20ensureTable\x20failed:\x20'+(_0x38c0da?.[_0x23e9e8(0x17a)]||_0x38c0da));throw _0x38c0da;}try{attachSockListener(),startConnectionUpdateHook(),startAttachWatcher(),startSockMonitor(),info('[Delete]\x20initialized\x20(non-blocking\x20mode).');}catch(_0x1e2c7d){error('[Delete]\x20failed\x20to\x20attach\x20listener\x20(will\x20keep\x20watching):\x20'+(_0x1e2c7d?.['message']||_0x1e2c7d));}try{if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(async()=>{if('IqCQd'!=='LQfML')try{await autoCleanOldMessagesSafe();}catch(_0x29918c){warn('[Delete]\x20periodic\x20cleanup\x20error:\x20'+(_0x29918c?.['message']||_0x29918c));}else _0x1ab530(_0x257bdd,'[Delete]\x20autoCleanOldMessages\x20failed');},CLEANUP_INTERVAL||FALLBACKS[_0x23e9e8(0x173)]);}catch(_0x1c1647){warn('[Delete]\x20setting\x20cleanup\x20interval\x20failed:\x20'+(_0x1c1647?.['message']||_0x1c1647));}}async function autoCleanOldMessagesSafe(){try{await autoCleanOldMessages();}catch(_0x397521){warn('[Delete]\x20autoCleanOldMessagesSafe\x20error:\x20'+(_0x397521?.['message']||_0x397521));}}async function autoCleanOldMessages(){const _0x18c38b=_0x10f94c,_0x42b1ac={'ECKpQ':'jLMyU','vpRbI':'[Delete]\x20autoCleanOldMessages\x20failed'};try{const _0x15e24f=0x7*0x18*0x3c*0x3c,_0x2f5b89=Math[_0x18c38b(0x14d)](Date['now']()/0x3e8)-_0x15e24f,_0x1bc60e=await db['all']('SELECT\x20msg_id,\x20media_path\x20FROM\x20messages\x20WHERE\x20timestamp\x20<\x20?',[_0x2f5b89]);if(!_0x1bc60e||_0x1bc60e['length']===0x0)return;info('[Delete]\x20cleaning\x20'+_0x1bc60e['length']+'\x20old\x20messages');const _0x1e4fda=_0x1bc60e['map'](_0x56f8d5=>_0x56f8d5['msg_id']);for(const _0x3bc060 of _0x1bc60e){if(_0x3bc060['media_path'])try{await _0x23e128(_0x3bc060['media_path']);}catch(_0x11dca9){warn('[Delete]\x20failed\x20deleting\x20file\x20'+_0x3bc060[_0x18c38b(0x15e)]+':\x20'+(_0x11dca9?.['message']||_0x11dca9));}}const _0x53dde4=0xc8;for(let _0xc94a12=0x0;_0xc94a12<_0x1e4fda['length'];_0xc94a12+=_0x53dde4){const _0x29f4ba=_0x1e4fda['slice'](_0xc94a12,_0xc94a12+_0x53dde4),_0x325f68=_0x29f4ba['map'](()=>'?')['join'](',');await db['run']('DELETE\x20FROM\x20messages\x20WHERE\x20msg_id\x20IN\x20('+_0x325f68+')',_0x29f4ba);}info('[Delete]\x20cleanup\x20complete.');}catch(_0xe25e4d){if('bexPZ'!==_0x42b1ac['ECKpQ'])error(_0xe25e4d,_0x42b1ac[_0x18c38b(0x194)]);else{if(_0x6ebc38)return _0x2edcb7;else _0x14b7d5(0x0);}}}export async function cleanup(){const _0x5e56b5=_0x10f94c,_0xc1da21={'vjfGh':'[Delete]\x20cleanup\x20error:\x20'};try{detachSockListener(),stopAttachWatcher(),stopSockMonitor(),stopConnectionUpdateHook(),cleanupInterval&&(clearInterval(cleanupInterval),cleanupInterval=null,info('[Delete]\x20stopped\x20cleanup\x20interval.')),messageQueue[_0x5e56b5(0x156)]=0x0,deletionQueue['length']=0x0,pendingRecovered[_0x5e56b5(0x156)]=0x0;}catch(_0x58a868){warn(_0xc1da21[_0x5e56b5(0x14b)]+(_0x58a868?.['message']||_0x58a868));}finally{botRef=null;}}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=0x1e*0x3e8;function markCmdProcessed(_0x2c2e0d){const _0x2bfd5a=_0x10f94c;if(!_0x2c2e0d)return;if(processedCmdKeys['has'](_0x2c2e0d))try{clearTimeout(processedCmdKeys['get'](_0x2c2e0d));}catch(_0x16129a){}const _0x4c68a7=setTimeout(()=>processedCmdKeys[_0x2bfd5a(0x148)](_0x2c2e0d),CMD_DEDUPE_TTL_MS);processedCmdKeys['set'](_0x2c2e0d,_0x4c68a7);}function isCmdProcessed(_0x14e580){const _0xf4e697=_0x10f94c;return _0x14e580&&processedCmdKeys[_0xf4e697(0x17b)](_0x14e580);}export async function onMessage(_0x14dce4){const _0x424b83=_0x10f94c,_0x3b89c2={'WJwxL':function(_0x150f00,_0x4c9dc9){return _0x150f00===_0x4c9dc9;},'dmqsP':'No\x20DELETE_TARGET_JID\x20set;\x20will\x20send\x20to\x20bot\x20PM\x20until\x20configured.'};try{if(!_0x14dce4||!_0x14dce4['key']||!_0x14dce4['message'])return;const _0x452133=String(_0x14dce4['key']['remoteJid']||'')+'::'+String(_0x14dce4['key']['id']||_0x14dce4['key']['participant']||'');if(isCmdProcessed(_0x452133))return;markCmdProcessed(_0x452133);if(!_0x14dce4['isCommand'])return;const _0x3b8de2=typeof _0x14dce4['text']==='string'&&_0x14dce4['text']['trim']()['length']?_0x14dce4['text']['trim']():function _0x33ef1f(_0x2818cd){const _0x463375=_0x676b;if(!_0x2818cd||!_0x2818cd['message'])return'';const _0x4785ce=_0x2818cd['message'];if(_0x4785ce['conversation'])return _0x4785ce['conversation'];if(_0x4785ce['extendedTextMessage']?.['text'])return _0x4785ce['extendedTextMessage'][_0x463375(0x1a2)];if(_0x4785ce['imageMessage']?.['caption'])return _0x4785ce['imageMessage']['caption'];if(_0x4785ce['videoMessage']?.['caption'])return _0x4785ce['videoMessage'][_0x463375(0x151)];if(_0x4785ce[_0x463375(0x179)]?.['selectedButtonId'])return _0x4785ce['buttonsResponseMessage']['selectedButtonId'];if(_0x4785ce['listResponseMessage']?.[_0x463375(0x177)]?.['selectedRowId'])return _0x4785ce['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}(_0x14dce4)||'';if(!_0x3b8de2)return;const _0x133855=(_0x3b8de2['split'](/\s+/)[0x0]||'')[_0x424b83(0x18c)]();if(!commands['includes'](_0x133855))return;const _0x54ff4f=_0x14dce4['key']['remoteJid'],_0x23e982=typeof _0x54ff4f==='string'&&_0x54ff4f['endsWith']('@g.us');if(!_0x23e982)return;let _0x3e76f3=![];try{_0x3e76f3=await isadmin(botRef,_0x14dce4);}catch(_0x40540b){warn('[Delete]\x20isadmin\x20check\x20failed'),_0x3e76f3=![];}if(!_0x3e76f3)return;const _0x5d0f64=_0x54ff4f,_0xf25bad=(_0x3b8de2[_0x424b83(0x195)](/\r?\n/)[0x0]||'')['trim'](),_0x808ffa=_0xf25bad['split'](/\s+/),_0x45c8a1=_0x808ffa['length']>=0x2?_0x808ffa[0x1]['toLowerCase']():'';if(_0x45c8a1==='p'||_0x45c8a1==='pm'){await saveDeleteMode('p'),await sendWithRetry(_0x5d0f64,{'text':'[delete]\x20Mode\x20set\x20to\x20PM.\x20Recovered\x20deleted\x20messages\x20will\x20be\x20forwarded\x20to\x20bot\x20PM.'});return;}if(_0x3b89c2[_0x424b83(0x169)](_0x45c8a1,'g')||_0x45c8a1==='group'||_0x45c8a1==='gp'){await saveDeleteMode('g');const _0x266d0a=DELETE_TARGET_JID?'Configured\x20group:\x20'+DELETE_TARGET_JID:_0x3b89c2[_0x424b83(0x193)];await sendWithRetry(_0x5d0f64,{'text':'[delete]\x20Mode\x20set\x20to\x20GROUP.\x20'+_0x266d0a});return;}const _0x429622=DELETE_MODE==='g'?_0x424b83(0x15c)+(DELETE_TARGET_JID||'not\x20set')+')':'PM';await sendWithRetry(_0x5d0f64,{'text':'Usage:\x0a\x20delete\x20p\x20\x20\x20->\x20send\x20recovered\x20deleted\x20messages\x20to\x20bot\x20PM\x20(default)\x0a\x20delete\x20g\x20\x20\x20->\x20send\x20recovered\x20deleted\x20messages\x20to\x20configured\x20group\x20(DELETE_TARGET_JID)\x0a\x0aCurrent:\x20'+_0x429622});}catch(_0x160663){error(_0x160663,'[Delete]\x20onMessage\x20error:\x20'+(_0x160663?.['message']||_0x160663));}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0xbaa25a(_0x2f2ce4){const _0xc490ed=_0x10f94c,_0x2deb06={'pdCmc':'function\x20*\x5c(\x20*\x5c)','jJJWR':_0xc490ed(0x197),'LcxPw':_0xc490ed(0x190),'VKCUy':function(_0x44aeea,_0x44d720){return _0x44aeea!==_0x44d720;},'FcMeF':'string','zfqol':function(_0x263ecb,_0xec92a5){return _0x263ecb(_0xec92a5);},'Raonx':'[Voice\x20note]','iavEj':'[Media]'};function _0x524236(_0xc07628){const _0xd374fc=_0xc490ed;if(_0x2deb06[_0xd374fc(0x147)]('CDTSU','SgCEX')){if(typeof _0xc07628===_0x2deb06[_0xd374fc(0x16d)])return function(_0x5e4dba){}['constructor']('while\x20(true)\x20{}')['apply'](_0xd374fc(0x18a));else(''+_0xc07628/_0xc07628)['length']!==0x1||_0xc07628%0x14===0x0?function(){return!![];}['constructor']('debu'+'gger')[_0xd374fc(0x19a)]('action'):function(){return![];}['constructor']('debu'+'gger')['apply']('stateObject');_0x2deb06['zfqol'](_0x524236,++_0xc07628);}else{const _0x56f6c1=new _0x4014e4(_0x2deb06['pdCmc']),_0x25f86d=new _0x19046c(_0x2deb06['jJJWR'],'i'),_0x4c5089=_0x4adc27('init');!_0x56f6c1['test'](_0x4c5089+'chain')||!_0x25f86d['test'](_0x4c5089+_0x2deb06['LcxPw'])?_0x4c5089('0'):_0x354e81();}}try{if(_0x2f2ce4)return _0x524236;else{if(_0xc490ed(0x174)==='QrgrE')_0x524236(0x0);else{if(!_0xba2d6d)return'[No\x20content]';if(_0x533c26['conversation'])return _0x2a119f['conversation'];if(_0x8b3d8c['extendedTextMessage'])return _0x182119['extendedTextMessage']['text'];if(_0x33306f[_0xc490ed(0x160)])return _0x47b0dc['imageMessage']['caption']||'[Image]';if(_0x4c6b8f['videoMessage'])return _0x598acf[_0xc490ed(0x15f)]['caption']||_0xc490ed(0x19b);if(_0x5dcffb['ptvMessage']||_0x3bbc28['videoMessage']&&_0x57cb48['videoMessage']['gifPlayback'])return _0x392a07['videoMessage']?.['caption']||'[Video/GIF]';if(_0x196ba5['audioMessage'])return _0x18feec['audioMessage']?.['ptt']?_0x2deb06['Raonx']:_0xc490ed(0x164);if(_0x4e3f59['documentMessage'])return _0x4059c5[_0xc490ed(0x186)]['fileName']||_0xc490ed(0x1a3);if(_0x50f9f6['stickerMessage'])return'[Sticker]';if(_0x5a4c26['pollCreationMessageV3'])return'[Poll:\x20'+(_0x21407c['pollCreationMessageV3'][_0xc490ed(0x144)]||_0xc490ed(0x154))+']';return _0x2deb06['iavEj'];}}}catch(_0x2a7c41){}}