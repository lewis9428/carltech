const _0x4ea056=_0x4ee4;(function(_0x2e50b4,_0x5b990a){const _0x1eef63=_0x4ee4,_0x1a6d1f=_0x2e50b4();while(!![]){try{const _0x3dae6d=-parseInt(_0x1eef63(0x11d))/0x1*(parseInt(_0x1eef63(0x10a))/0x2)+parseInt(_0x1eef63(0x143))/0x3*(parseInt(_0x1eef63(0xe7))/0x4)+-parseInt(_0x1eef63(0xfc))/0x5*(parseInt(_0x1eef63(0x145))/0x6)+-parseInt(_0x1eef63(0x128))/0x7*(-parseInt(_0x1eef63(0x112))/0x8)+parseInt(_0x1eef63(0xf8))/0x9*(parseInt(_0x1eef63(0x127))/0xa)+-parseInt(_0x1eef63(0x12a))/0xb*(parseInt(_0x1eef63(0xfe))/0xc)+-parseInt(_0x1eef63(0x156))/0xd*(-parseInt(_0x1eef63(0x107))/0xe);if(_0x3dae6d===_0x5b990a)break;else _0x1a6d1f['push'](_0x1a6d1f['shift']());}catch(_0xfda368){_0x1a6d1f['push'](_0x1a6d1f['shift']());}}}(_0x1fb5,0x1d862));const _0x263d46=(function(){let _0x517891=!![];return function(_0x282be1,_0x36f470){const _0x1a329c=_0x517891?function(){const _0x116515=_0x4ee4;if(_0x36f470){if('aIBbS'!=='JkCIn'){const _0x152ffc=_0x36f470['apply'](_0x282be1,arguments);return _0x36f470=null,_0x152ffc;}else try{_0x324383['sock']['ev'][_0x116515(0xef)]?.(_0x116515(0x154),_0x52e1dc);}catch(_0x1485f1){}}}:function(){};return _0x517891=![],_0x1a329c;};}());(function(){const _0x436234={'GjBRZ':function(_0x4420fd,_0x2443ba){return _0x4420fd(_0x2443ba);},'Ftikc':'chain'};_0x263d46(this,function(){const _0x35e752=_0x4ee4,_0x2b39c3=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x5ae241=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x35e37f=_0x436234['GjBRZ'](_0x4bbaf3,'init');!_0x2b39c3['test'](_0x35e37f+_0x436234['Ftikc'])||!_0x5ae241['test'](_0x35e37f+_0x35e752(0x158))?_0x35e37f('0'):_0x4bbaf3();})();}());import _0x5e8acb from'path';import _0x1749f6 from'fs';import{mkdirSync}from'fs';import{rm as _0x22a2a5}from'fs/promises';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import _0x5bd75d from'node-cache';function _0x4ee4(_0x278398,_0xbaa187){const _0x2aad6f=_0x1fb5();return _0x4ee4=function(_0x4bbaf3,_0x263d46){_0x4bbaf3=_0x4bbaf3-0xe3;let _0x1b0e15=_0x2aad6f[_0x4bbaf3];if(_0x4ee4['OkpWcP']===undefined){var _0x4444c8=function(_0x15c237){const _0x417f64='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x162468='',_0x3eceb2='';for(let _0x47bd86=0x0,_0x3853b2,_0x3240f7,_0x2bc0d1=0x0;_0x3240f7=_0x15c237['charAt'](_0x2bc0d1++);~_0x3240f7&&(_0x3853b2=_0x47bd86%0x4?_0x3853b2*0x40+_0x3240f7:_0x3240f7,_0x47bd86++%0x4)?_0x162468+=String['fromCharCode'](0xff&_0x3853b2>>(-0x2*_0x47bd86&0x6)):0x0){_0x3240f7=_0x417f64['indexOf'](_0x3240f7);}for(let _0x2749c4=0x0,_0x51b495=_0x162468['length'];_0x2749c4<_0x51b495;_0x2749c4++){_0x3eceb2+='%'+('00'+_0x162468['charCodeAt'](_0x2749c4)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3eceb2);};_0x4ee4['crUmoC']=_0x4444c8,_0x278398=arguments,_0x4ee4['OkpWcP']=!![];}const _0x1fb596=_0x2aad6f[0x0],_0x4ee438=_0x4bbaf3+_0x1fb596,_0x989967=_0x278398[_0x4ee438];return!_0x989967?(_0x1b0e15=_0x4ee4['crUmoC'](_0x1b0e15),_0x278398[_0x4ee438]=_0x1b0e15):_0x1b0e15=_0x989967,_0x1b0e15;},_0x4ee4(_0x278398,_0xbaa187);}import{isadmin}from'../utils/isadmin.js';export const name='delete-recovery';export const version='2.6.1';export const priority=0x32;export const commands=['delete'];export const configKeys=['DELETE_TARGET_JID',_0x4ea056(0x134),'DELETE_DEBOUNCE_MS','DELETE_CONCURRENCY','DELETE_ATTACH_WATCHER_MS','DELETE_SOCK_MONITOR_MS','DEFAULT_SEND_DELETE'];const FALLBACKS={'DEBOUNCE_MS':0xbb8,'MEDIA_DIRNAME':'media','DEFAULT_CONCURRENCY':0x3,'CLEANUP_INTERVAL_MS':0x18*0x3c*0x3c*0x3e8,'MEDIA_SEND_DELAY_MS':0x12c,'MAX_SEND_RETRIES':0x3,'INITIAL_BACKOFF_MS':0x1f4,'ATTACH_WATCHER_MS':0xbb8,'SOCK_MONITOR_MS':0x3e8};let botRef=null,attached=![],sockListener=null,cleanupInterval=null;const messageQueue=[],deletionQueue=[];(function(){const _0x4cb177=function(){let _0x43bb79;try{_0x43bb79=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x40f372){_0x43bb79=window;}return _0x43bb79;},_0x34d96a=_0x4cb177();_0x34d96a['setInterval'](_0x4bbaf3,0x61a80);}());let activeMessageTasks=0x0,activeDeletionTasks=0x0,MEDIA_DIR=null,DEBOUNCE_DELAY_MS=FALLBACKS['DEBOUNCE_MS'],CONCURRENCY=FALLBACKS['DEFAULT_CONCURRENCY'],MEDIA_SEND_DELAY_MS=FALLBACKS['MEDIA_SEND_DELAY_MS'],CLEANUP_INTERVAL=FALLBACKS['CLEANUP_INTERVAL_MS'],MAX_SEND_RETRIES=FALLBACKS[_0x4ea056(0x137)],INITIAL_BACKOFF=FALLBACKS['INITIAL_BACKOFF_MS'],ATTACH_WATCHER_MS=FALLBACKS['ATTACH_WATCHER_MS'],SOCK_MONITOR_MS=FALLBACKS['SOCK_MONITOR_MS'],DEFAULT_SEND_DELETE=![],DELETE_TARGET_JID=null,DELETE_MODE='p';const nameCache=new _0x5bd75d({'stdTTL':0xe10});let flushTimer=null,attachWatcherInterval=null,sockMonitorInterval=null,lastSockIdentity=null,connectionUpdateHandler=null;const pendingRecovered=[];function ensureDirSync(_0x3e2c3b){if(!_0x1749f6['existsSync'](_0x3e2c3b))mkdirSync(_0x3e2c3b,{'recursive':!![]});}function sleep(_0x8a33ab){return new Promise(_0x13fc3a=>setTimeout(_0x13fc3a,_0x8a33ab));}function refreshConfig(){const _0x3aec21=_0x4ea056,_0x31d14b={'UWHLw':_0x3aec21(0x12d)};try{const _0x2752cb=getConfig()||{};DEFAULT_SEND_DELETE=typeof _0x2752cb['DEFAULT_SEND_DELETE']==='boolean'?_0x2752cb['DEFAULT_SEND_DELETE']:DEFAULT_SEND_DELETE,DELETE_TARGET_JID=typeof _0x2752cb['DELETE_TARGET_JID']==='string'&&_0x2752cb['DELETE_TARGET_JID']['includes']('@')?_0x2752cb[_0x3aec21(0x13a)]:null,DEBOUNCE_DELAY_MS=Number(_0x2752cb['DELETE_DEBOUNCE_MS']??FALLBACKS['DEBOUNCE_MS']),CONCURRENCY=Number(_0x2752cb['DELETE_CONCURRENCY']??_0x2752cb['MODULE_CONCURRENCY_LIMIT']??FALLBACKS[_0x3aec21(0x10e)]),MEDIA_SEND_DELAY_MS=Number(_0x2752cb['DELETE_MEDIA_SEND_DELAY_MS']??FALLBACKS['MEDIA_SEND_DELAY_MS']),CLEANUP_INTERVAL=Number(_0x2752cb['DELETE_CLEANUP_INTERVAL_MS']??FALLBACKS[_0x3aec21(0xe3)]),MAX_SEND_RETRIES=Number(_0x2752cb['DELETE_MAX_SEND_RETRIES']??FALLBACKS['MAX_SEND_RETRIES']),INITIAL_BACKOFF=Number(_0x2752cb['DELETE_INITIAL_BACKOFF_MS']??FALLBACKS['INITIAL_BACKOFF_MS']),ATTACH_WATCHER_MS=Number(_0x2752cb[_0x3aec21(0x106)]??FALLBACKS['ATTACH_WATCHER_MS']),SOCK_MONITOR_MS=Number(_0x2752cb['DELETE_SOCK_MONITOR_MS']??FALLBACKS['SOCK_MONITOR_MS']);const _0x3fadc0=_0x2752cb[_0x3aec21(0xf1)]&&typeof _0x2752cb[_0x3aec21(0xf1)]==='string'?_0x2752cb['PROJECT_ROOT']:process['cwd'](),_0x360e00=_0x5e8acb[_0x3aec21(0x13b)](_0x3fadc0,'data','delete');ensureDirSync(_0x360e00),MEDIA_DIR=_0x5e8acb['join'](_0x360e00,_0x2752cb['DELETE_MEDIA_DIRNAME']??_0x2752cb['DELETE_MEDIA_DIR']??FALLBACKS['MEDIA_DIRNAME']),ensureDirSync(MEDIA_DIR),info('[Delete]\x20config\x20refreshed:\x20DEFAULT_SEND_DELETE='+DEFAULT_SEND_DELETE+',\x20DELETE_TARGET_JID='+(DELETE_TARGET_JID?_0x31d14b['UWHLw']:'unset')+',\x20DEBOUNCE='+DEBOUNCE_DELAY_MS+'ms,\x20CONCURRENCY='+CONCURRENCY);}catch(_0x1f7b57){warn('[Delete]\x20refreshConfig\x20error:\x20'+(_0x1f7b57?.['message']||_0x1f7b57));}}try{hotReloadConfig&&hotReloadConfig(_0x52ff97=>{const _0x490875=_0x4ea056;try{refreshConfig(),info(_0x490875(0x12f)+(_0x52ff97||[])[_0x490875(0x140)](',\x20'));}catch(_0x29dd01){warn('[Delete]\x20hotReloadConfig\x20handler\x20error:\x20'+(_0x29dd01?.[_0x490875(0x14b)]||_0x29dd01));}});}catch(_0x3c703b){warn(_0x4ea056(0xf9)+(_0x3c703b?.['message']||_0x3c703b));}refreshConfig();async function ensureTable(){const _0x427e3f=_0x4ea056,_0x8a85b4={'YQPoI':'[Delete]\x20DB\x20table(s)\x20ensured.\x20mode='};await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20messages\x20(\x0a\x20\x20\x20\x20msg_id\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20chat_jid\x20TEXT,\x0a\x20\x20\x20\x20sender_jid\x20TEXT,\x0a\x20\x20\x20\x20message_json\x20TEXT,\x0a\x20\x20\x20\x20timestamp\x20INTEGER,\x0a\x20\x20\x20\x20media_path\x20TEXT\x0a\x20\x20);'),await db[_0x427e3f(0x14a)]('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20delete_prefs\x20(\x0a\x20\x20\x20\x20key\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20value\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20updated_at\x20INTEGER\x20DEFAULT\x200\x0a\x20\x20);');try{const _0x5d0161=await db['get']('SELECT\x20value\x20FROM\x20delete_prefs\x20WHERE\x20key=\x27mode\x27');if(!_0x5d0161){const _0x4ecd92=Math['floor'](Date[_0x427e3f(0xed)]()/0x3e8);await db['run']('INSERT\x20INTO\x20delete_prefs\x20(key,\x20value,\x20updated_at)\x20VALUES\x20(\x27mode\x27,\x27p\x27,\x20?)',[_0x4ecd92]),DELETE_MODE='p';}else DELETE_MODE=_0x5d0161['value']==='g'?'g':'p';}catch(_0x538603){warn('[Delete]\x20ensureTable\x20prefs\x20init\x20failed:\x20'+(_0x538603?.['message']||_0x538603));}info(_0x8a85b4['YQPoI']+DELETE_MODE);}async function streamMediaToFile(_0x102bb2,_0x3526cd){const _0x14b0f8=_0x4ea056,_0x1e6999={'ueSep':'finish','Qwycc':'audio'};try{const _0x95680c=_0x102bb2['message'][_0x3526cd+'Message'],_0x31e535=await downloadContentFromMessage(_0x95680c,_0x3526cd);let _0x3d4b0a='bin';if(_0x3526cd==='image')_0x3d4b0a='jpg';else{if(_0x3526cd==='video')_0x3d4b0a=_0x14b0f8(0x10b);else{if(_0x3526cd===_0x1e6999['Qwycc'])_0x3d4b0a='mp3';else{if(_0x3526cd==='document')_0x3d4b0a=_0x95680c?.['fileName']?_0x95680c[_0x14b0f8(0x14f)]['split']('.')['pop']():_0x14b0f8(0x122);else{if(_0x3526cd==='sticker')_0x3d4b0a='webp';}}}}const _0x4aa639=_0x102bb2['key']['id']+'.'+_0x3d4b0a,_0x2a525f=_0x5e8acb['join'](MEDIA_DIR,_0x4aa639);return await new Promise((_0xeaa29b,_0x7e7b6e)=>{const _0xf7e144=_0x14b0f8,_0x2223f3=_0x1749f6[_0xf7e144(0x131)](_0x2a525f);((async()=>{const _0x4882b8=_0xf7e144;try{if('hlvFd'==='hlvFd'){for await(const _0x254936 of _0x31e535){if(!_0x2223f3['write'](_0x254936))await new Promise(_0x2701ee=>_0x2223f3['once'](_0x4882b8(0xe6),_0x2701ee));}_0x2223f3['end'](),_0x2223f3['once'](_0x1e6999[_0x4882b8(0x13f)],()=>_0xeaa29b());}else _0xbdc0a7('[Delete]\x20processMessageItem\x20error:\x20'+(_0x59f4e9?.['message']||_0xdfe400));}catch(_0x4c1574){try{_0x2223f3['destroy']();}catch(_0x5bb9ef){}_0x7e7b6e(_0x4c1574);}})());}),_0x2a525f;}catch(_0x2ef782){return warn('[Delete]\x20streamMediaToFile\x20failed\x20for\x20'+(_0x102bb2['key']?.['id']||'[no-id]')+':\x20'+(_0x2ef782?.['message']||_0x2ef782)),null;}}async function maybeSaveMedia(_0x2ea6ef){const _0x5f2b0d=_0x4ea056,_0x55742d={'JBtcP':function(_0x3dcd02,_0x51c546){return _0x3dcd02(_0x51c546);}};try{const _0x1ed242=['image',_0x5f2b0d(0x11e),'audio','document',_0x5f2b0d(0x15a)];for(const _0x460e61 of _0x1ed242){if(_0x2ea6ef['message']?.[_0x460e61+'Message'])return await streamMediaToFile(_0x2ea6ef,_0x460e61);}return null;}catch(_0x425201){return _0x55742d['JBtcP'](warn,'[Delete]\x20maybeSaveMedia\x20error:\x20'+(_0x425201?.['message']||_0x425201)),null;}}async function insertMessageToDB(_0x137af9,_0x17e87a){const _0x40b269=_0x4ea056;try{const {id:_0x2d0b38,remoteJid:_0x20c6da,participant:_0xdf1402}=_0x137af9['key'],_0x457346=_0xdf1402||_0x20c6da,_0x271afa=typeof _0x137af9['messageTimestamp']===_0x40b269(0xe9)?_0x137af9['messageTimestamp']:_0x137af9['messageTimestamp']?.['low']||Math[_0x40b269(0x14c)](Date['now']()/0x3e8);await db['run']('INSERT\x20OR\x20REPLACE\x20INTO\x20messages\x20(msg_id,\x20chat_jid,\x20sender_jid,\x20message_json,\x20timestamp,\x20media_path)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)',[_0x2d0b38,_0x20c6da,_0x457346,JSON['stringify'](_0x137af9),_0x271afa,_0x17e87a]);}catch(_0x276134){warn('[Delete]\x20insertMessageToDB\x20failed:\x20'+(_0x276134?.[_0x40b269(0x14b)]||_0x276134));}}async function processMessageItem(_0x51b00e){const _0x23141f=_0x4ea056;try{if(!_0x51b00e||!_0x51b00e['message']||_0x51b00e['key']?.[_0x23141f(0x100)])return;const _0x57a6c3=await maybeSaveMedia(_0x51b00e);await insertMessageToDB(_0x51b00e,_0x57a6c3);}catch(_0x16f734){warn('[Delete]\x20processMessageItem\x20error:\x20'+(_0x16f734?.['message']||_0x16f734));}}async function messageWorker(){const _0x2d90c5=_0x4ea056,_0x1811f0={'CqNse':function(_0xb4f593,_0x507a43){return _0xb4f593(_0x507a43);},'XWPws':'hqolt'},_0x344133=CONCURRENCY||FALLBACKS[_0x2d90c5(0x10e)];while(messageQueue['length']>0x0&&activeMessageTasks<_0x344133){if('SRfeW'==='HQCCd')_0x442ddb(_0x52d137,'[Delete]\x20autoCleanOldMessages\x20failed');else{const _0x1c0844=messageQueue['shift']();if(!_0x1c0844)break;activeMessageTasks++,((async()=>{const _0x4b6659=_0x2d90c5,_0xeac1bc={'cndRs':function(_0x292c3f,_0x51c8d2){return _0x292c3f+_0x51c8d2;}};try{await processMessageItem(_0x1c0844);}catch(_0xde9d1d){_0x1811f0['CqNse'](warn,'[Delete]\x20messageWorker\x20item\x20error:\x20'+(_0xde9d1d?.['message']||_0xde9d1d));}finally{if(_0x1811f0['XWPws']===_0x4b6659(0x12b))return _0x3d57b3(_0xeac1bc['cndRs']('[Delete]\x20attachSockListener\x20failed:\x20',_0x351f43?.['message']||_0x3e6b01)),_0x5590c0=![],_0x5b1beb=null,![];else activeMessageTasks--,setImmediate(()=>{if(messageQueue['length']>0x0)messageWorker()['catch'](()=>{});});}})());}}}async function fetchOriginalMessage(_0x3e452d){const _0xdd5b78=_0x4ea056;try{const _0x198f50=await db[_0xdd5b78(0x144)]('SELECT\x20message_json,\x20media_path\x20FROM\x20messages\x20WHERE\x20msg_id=?',[_0x3e452d]);if(!_0x198f50)return null;return{'message':JSON[_0xdd5b78(0x148)](_0x198f50['message_json']),'media_path':_0x198f50['media_path']};}catch(_0xd9d207){return warn('[Delete]\x20fetchOriginalMessage\x20error:\x20'+(_0xd9d207?.['message']||_0xd9d207)),null;}}async function sendWithRetry(_0x28dacf,_0x159dee,_0xb5d243=[]){const _0x5e3995=_0x4ea056,_0x54f32d={'lghUx':function(_0x39a855,_0x142f11){return _0x39a855!==_0x142f11;}},_0x5cd33b=Number(MAX_SEND_RETRIES||FALLBACKS['MAX_SEND_RETRIES']);let _0x57d5dc=0x0,_0x5c718e=Number(INITIAL_BACKOFF||FALLBACKS['INITIAL_BACKOFF_MS']);while(_0x57d5dc<_0x5cd33b){try{const _0x1509c7=_0x28dacf||botRef?.[_0x5e3995(0x116)]?.['user']?.['id']||null;if(!_0x1509c7)throw new Error('no\x20send\x20target\x20available');return Array['isArray'](_0xb5d243)&&_0xb5d243['length']&&typeof _0x159dee==='object'&&_0x54f32d[_0x5e3995(0x102)](_0x159dee,null)&&(_0x159dee['mentions']=_0xb5d243),await botRef['sendMessage'](_0x1509c7,_0x159dee),!![];}catch(_0x21c5a7){_0x57d5dc++;const _0xb107cf=String(_0x21c5a7?.['message']||'')[_0x5e3995(0x124)]()['includes']('rate')||_0x21c5a7?.['status']===0x1ad;warn(_0x5e3995(0xea)+_0x57d5dc+'\x20failed:\x20'+(_0x21c5a7?.['message']||_0x21c5a7));if(_0x57d5dc>=_0x5cd33b||!_0xb107cf)return![];await sleep(_0x5c718e),_0x5c718e*=0x2;}}return![];}function extractContent(_0xffb2eb){const _0x992b4e=_0x4ea056;if(!_0xffb2eb)return'[No\x20content]';if(_0xffb2eb['conversation'])return _0xffb2eb[_0x992b4e(0x118)];if(_0xffb2eb['extendedTextMessage'])return _0xffb2eb['extendedTextMessage']['text'];if(_0xffb2eb['imageMessage'])return _0xffb2eb['imageMessage']['caption']||'[Image]';if(_0xffb2eb['videoMessage'])return _0xffb2eb['videoMessage']['caption']||'[Video]';if(_0xffb2eb['ptvMessage']||_0xffb2eb['videoMessage']&&_0xffb2eb['videoMessage']['gifPlayback'])return _0xffb2eb[_0x992b4e(0x104)]?.['caption']||'[Video/GIF]';if(_0xffb2eb['audioMessage'])return _0xffb2eb[_0x992b4e(0x149)]?.['ptt']?_0x992b4e(0xeb):'[Audio]';if(_0xffb2eb['documentMessage'])return _0xffb2eb['documentMessage']['fileName']||'[Document]';if(_0xffb2eb['stickerMessage'])return'[Sticker]';if(_0xffb2eb[_0x992b4e(0x121)])return'[Poll:\x20'+(_0xffb2eb['pollCreationMessageV3']['name']||'poll')+']';return'[Media]';}async function processDeletionItem(_0x40960c){const _0x3001ff=_0x4ea056,_0x1a881c={'NhODI':function(_0x522265,_0x2f5dc9){return _0x522265(_0x2f5dc9);}};try{const _0x8f2d6b=_0x40960c['keys']||[];if(!_0x8f2d6b['length'])return;for(const _0x10ab97 of _0x8f2d6b){const _0x12ee8f=await fetchOriginalMessage(_0x10ab97['id']);if(!_0x12ee8f||!_0x12ee8f[_0x3001ff(0x14b)])continue;const _0x3a440c=_0x12ee8f['message'],_0x4f54f5=botRef?.[_0x3001ff(0x116)]?.['user']?.['id'],_0x792f4e=_0x3a440c['key']?.['participant']||_0x3a440c['key']?.['remoteJid'];if(_0x3a440c['key']?.['fromMe']||_0x792f4e===_0x4f54f5)continue;const _0x3265bf=_0x3a440c['key']['participant']||_0x3a440c['key']['remoteJid'],_0x52f93f=_0x1a881c[_0x3001ff(0xfa)](extractContent,_0x3a440c[_0x3001ff(0x14b)]);let _0x1894ad=nameCache['get'](_0x3265bf);if(!_0x1894ad){try{const [_0x3ca332]=await botRef['sock']['onWhatsApp'](_0x3265bf);_0x1894ad=_0x3ca332?.['notify']||'~'+_0x3265bf[_0x3001ff(0x153)]('@')[0x0];}catch{_0x1894ad='~'+_0x3265bf[_0x3001ff(0x153)]('@')[0x0];}nameCache[_0x3001ff(0x12d)](_0x3265bf,_0x1894ad);}let _0x49621e='';if(isJidGroup(_0x3a440c['key'][_0x3001ff(0xfd)]))try{'rSPBi'==='rSPBi'?_0x49621e=(await botRef['sock']['groupMetadata'](_0x3a440c['key'][_0x3001ff(0xfd)]))['subject']:_0x404899(_0x3001ff(0xe8)+(_0x1d346d?.['message']||_0x5d7735));}catch{_0x49621e='[Unknown\x20Group]';}deletionPush({'sender':_0x3265bf,'name':_0x1894ad,'group':_0x49621e,'content':_0x52f93f,'mediaPath':_0x12ee8f['media_path']||null,'originalMessage':_0x3a440c});}}catch(_0x4920d0){warn(_0x3001ff(0xf4)+(_0x4920d0?.['message']||_0x4920d0));}}async function deletionWorker(){const _0x37b854=CONCURRENCY||FALLBACKS['DEFAULT_CONCURRENCY'];while(deletionQueue['length']>0x0&&activeDeletionTasks<_0x37b854){const _0xabafc4=deletionQueue['shift']();if(!_0xabafc4)break;activeDeletionTasks++,((async()=>{const _0x612778=_0x4ee4;if(_0x612778(0x10f)!=='rzzqG')try{await processDeletionItem(_0xabafc4);}catch(_0x3d9ffa){warn('[Delete]\x20deletionWorker\x20item\x20error:\x20'+(_0x3d9ffa?.['message']||_0x3d9ffa));}finally{if(_0x612778(0x142)==='KxGkd')activeDeletionTasks--,setImmediate(()=>{if(deletionQueue['length']>0x0)deletionWorker()['catch'](()=>{});});else return![];}else _0x5ba42e('[Delete]\x20hotReloadConfig\x20registration\x20failed:\x20'+(_0x3bb3f7?.[_0x612778(0x14b)]||_0x50fd70));})());}}function deletionPush(_0xf9c85c){const _0x4f88ed=_0x4ea056;pendingRecovered['push'](_0xf9c85c),clearTimeout(flushTimer),flushTimer=setTimeout(()=>{if('eCOGj'!=='SyDyX'){const _0x54623a=pendingRecovered['splice'](0x0,pendingRecovered['length']);((async()=>{try{await flushRecoveredBatch(_0x54623a);}catch(_0x21cf0e){warn('[Delete]\x20flushRecoveredBatch\x20error:\x20'+(_0x21cf0e?.['message']||_0x21cf0e));}})());}else return new _0x209494(_0x4a99d9=>_0x401348(_0x4a99d9,_0x3f4db4));},DEBOUNCE_DELAY_MS||FALLBACKS[_0x4f88ed(0x138)]);}function resolveDeleteTarget(_0x4f90c2){const _0x474cbe=botRef?.['sock']?.['user']?.['id']||null;if(DELETE_MODE==='g'&&DELETE_TARGET_JID){if(DELETE_TARGET_JID===_0x4f90c2)return _0x474cbe;return DELETE_TARGET_JID;}return _0x474cbe;}async function saveDeleteMode(_0x20d233){const _0x137426=_0x4ea056;try{const _0x2215ee=_0x20d233==='g'?'g':'p',_0x1cc13a=Math['floor'](Date['now']()/0x3e8);return await db['run']('\x0a\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20delete_prefs\x20(key,\x20value,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20VALUES\x20(\x27mode\x27,\x20?,\x20?)\x0a\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(key)\x20DO\x20UPDATE\x20SET\x20value=excluded.value,\x20updated_at=excluded.updated_at\x0a\x20\x20\x20\x20',[_0x2215ee,_0x1cc13a]),DELETE_MODE=_0x2215ee,info('[Delete]\x20mode\x20saved:\x20'+DELETE_MODE),!![];}catch(_0x17e47a){return warn(_0x137426(0x14e)+(_0x17e47a?.['message']||_0x17e47a)),![];}}async function flushRecoveredBatch(_0x23efbe){const _0x22c5c0=_0x4ea056,_0x1dedd8={'ezpou':function(_0x5a2797,_0x4e0bb8){return _0x5a2797(_0x4e0bb8);},'okzGt':_0x22c5c0(0xf7),'rFOsy':'[Delete]\x20DEFAULT_SEND_DELETE\x20is\x20false\x20—\x20skipping\x20recovered\x20sends.','VWkEl':function(_0x571805,_0x2f63ce){return _0x571805+_0x2f63ce;},'rleuW':function(_0xe0d5a2,_0x174621){return _0xe0d5a2!==_0x174621;},'XrEnq':'slXYO','eBuDX':function(_0x423e59,_0x5099e0){return _0x423e59(_0x5099e0);},'lKeTZ':_0x22c5c0(0x136),'lJwaN':function(_0x4d0492,_0x52d83a){return _0x4d0492(_0x52d83a);}};if(!_0x23efbe||_0x23efbe['length']===0x0)return;if(!DEFAULT_SEND_DELETE){if('lIWEJ'!==_0x1dedd8['okzGt']){const _0x111cd4=_0x1dfb2c()||{};_0x5af4be=typeof _0x111cd4['DEFAULT_SEND_DELETE']==='boolean'?_0x111cd4['DEFAULT_SEND_DELETE']:_0x516928,_0x7bc90=typeof _0x111cd4['DELETE_TARGET_JID']==='string'&&_0x111cd4[_0x22c5c0(0x13a)]['includes']('@')?_0x111cd4['DELETE_TARGET_JID']:null,_0x23eac5=_0x27f7f9(_0x111cd4['DELETE_DEBOUNCE_MS']??_0x4cbc29['DEBOUNCE_MS']),_0x48a320=_0x1dedd8['ezpou'](_0x4ef899,_0x111cd4[_0x22c5c0(0x111)]??_0x111cd4['MODULE_CONCURRENCY_LIMIT']??_0x53bcac['DEFAULT_CONCURRENCY']),_0x17ace7=_0x543b4d(_0x111cd4['DELETE_MEDIA_SEND_DELAY_MS']??_0x5dce01['MEDIA_SEND_DELAY_MS']),_0xaa7bb6=_0x4ba328(_0x111cd4['DELETE_CLEANUP_INTERVAL_MS']??_0x2f4458['CLEANUP_INTERVAL_MS']),_0x3c533f=_0x49b73c(_0x111cd4['DELETE_MAX_SEND_RETRIES']??_0x2ed3ed['MAX_SEND_RETRIES']),_0x1a4437=_0x444419(_0x111cd4['DELETE_INITIAL_BACKOFF_MS']??_0x3bc851['INITIAL_BACKOFF_MS']),_0x111700=_0x271fae(_0x111cd4['DELETE_ATTACH_WATCHER_MS']??_0x5fc44b['ATTACH_WATCHER_MS']),_0x319cfc=_0x1f97d6(_0x111cd4['DELETE_SOCK_MONITOR_MS']??_0x56863d['SOCK_MONITOR_MS']);const _0x323a0b=_0x111cd4[_0x22c5c0(0xf1)]&&typeof _0x111cd4[_0x22c5c0(0xf1)]==='string'?_0x111cd4['PROJECT_ROOT']:process['cwd'](),_0x46f44a=_0x18548e['resolve'](_0x323a0b,'data','delete');_0x39cddc(_0x46f44a),_0x4aecb9=_0x344982['join'](_0x46f44a,_0x111cd4[_0x22c5c0(0x134)]??_0x111cd4['DELETE_MEDIA_DIR']??_0x59bc88['MEDIA_DIRNAME']),_0x4f4dea(_0x5b8ceb),_0x15a9bb('[Delete]\x20config\x20refreshed:\x20DEFAULT_SEND_DELETE='+_0xbf8338+',\x20DELETE_TARGET_JID='+(_0x565e16?'set':'unset')+',\x20DEBOUNCE='+_0x49460e+'ms,\x20CONCURRENCY='+_0x5ececd);}else{info(_0x1dedd8['rFOsy']);return;}}const _0x5023d5=_0x23efbe['find'](_0x1186fe=>_0x1186fe['originalMessage'])?.['originalMessage']?.['key']?.['remoteJid']||null,_0x2ea9d8=resolveDeleteTarget(_0x5023d5)||botRef?.['sock']?.['user']?.['id']||null;if(!_0x2ea9d8){if('AmQSS'!=='UgMvs'){warn('[Delete]\x20no\x20send\x20target\x20available\x20for\x20recovery');return;}else _0x29211e[_0x22c5c0(0x116)]['ev']['removeListener']?.('messages.upsert',_0x38c884);}const _0x47c389=[...new Set(_0x23efbe['map'](_0x51a839=>_0x51a839[_0x22c5c0(0x146)]))],_0x453dbc=_0x23efbe['map'](_0x39a025=>'👤\x20From:\x20@'+_0x39a025['sender']['split']('@')[0x0]+'\x20('+_0x39a025['name']+')\x0a'+(_0x39a025[_0x22c5c0(0x12c)]?'🗨\x20Group:\x20'+_0x39a025['group']+'\x0a':'')+('📝\x20Content:\x20'+_0x39a025['content']+'\x0a')+'─'['repeat'](0x1e))['join']('\x0a'),_0x3c4290='🗑\x20*'+_0x23efbe['length']+'\x20DELETED\x20MESSAGES\x20RECOVERED*\x20🗑\x0a\x0a';try{const _0x1069a7=await sendWithRetry(_0x2ea9d8,{'text':_0x3c4290+_0x453dbc},_0x47c389);if(!_0x1069a7)warn('[Delete]\x20summary\x20send\x20may\x20have\x20failed\x20completely');}catch(_0x492b7e){warn(_0x1dedd8['VWkEl'](_0x22c5c0(0x101),_0x492b7e?.['message']||_0x492b7e));}for(const _0x15b49c of _0x23efbe){if(_0x15b49c['originalMessage'])try{if(_0x1dedd8['rleuW']('MRXCV',_0x1dedd8[_0x22c5c0(0xf0)])){const _0x11e462={'forward':_0x15b49c[_0x22c5c0(0xe4)]},_0x493a4d=await sendWithRetry(_0x2ea9d8,_0x11e462);if(_0x493a4d){info('[Delete]\x20forwarded\x20original\x20message\x20for\x20'+_0x15b49c['sender']),await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS['MEDIA_SEND_DELAY_MS']);continue;}else warn('[Delete]\x20forward\x20attempt\x20failed\x20—\x20falling\x20back\x20to\x20file\x20send:\x20'+(_0x15b49c['mediaPath']||_0x15b49c['sender']));}else _0xf2beda&&(_0x37a727(_0x105e86),_0x21a9e0=null);}catch(_0x87d151){_0x1dedd8['eBuDX'](warn,_0x1dedd8['lKeTZ']+(_0x87d151?.['message']||_0x87d151));}if(_0x15b49c['mediaPath'])try{const _0x419cc1=_0x5e8acb[_0x22c5c0(0x125)](_0x15b49c['mediaPath'])['slice'](0x1)['toLowerCase']();let _0xdef280;if(['jpg','jpeg',_0x22c5c0(0xf5),'webp']['includes'](_0x419cc1))_0xdef280={'image':{'url':_0x15b49c['mediaPath']},'caption':_0x15b49c['content']||undefined};else{if(['mp4',_0x22c5c0(0xfb)]['includes'](_0x419cc1))_0xdef280={'video':{'url':_0x15b49c['mediaPath']},'caption':_0x15b49c['content']||undefined};else{if(['mp3','ogg','m4a']['includes'](_0x419cc1))_0xdef280={'audio':{'url':_0x15b49c[_0x22c5c0(0x105)]}};else _0xdef280={'document':{'url':_0x15b49c['mediaPath']},'caption':_0x15b49c['content']||undefined};}}const _0xfc08e7=await sendWithRetry(_0x2ea9d8,_0xdef280);if(!_0xfc08e7)_0x1dedd8['lJwaN'](warn,'[Delete]\x20fallback\x20send\x20failed\x20for\x20'+_0x15b49c['mediaPath']);await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS[_0x22c5c0(0x119)]);}catch(_0x2e3158){_0x1dedd8['eBuDX'](warn,'[Delete]\x20forward\x20media\x20fallback\x20error:\x20'+(_0x2e3158?.['message']||_0x2e3158));}else warn('[Delete]\x20no\x20original\x20proto\x20or\x20saved\x20file\x20available\x20for\x20'+_0x15b49c['sender']);}}async function rawMessagesUpsertHandler({messages:_0x48ce72}){const _0x19d413=_0x4ea056,_0x1b437c={'cTDeY':function(_0x5447bf,_0x1395c0){return _0x5447bf(_0x1395c0);},'rWJwf':_0x19d413(0x126),'Rwchx':'status@broadcast','jZdVQ':function(_0xd4c6f9,_0x26d1c3){return _0xd4c6f9===_0x26d1c3;},'SXzAs':function(_0x4be288,_0x4bd58b){return _0x4be288===_0x4bd58b;},'lhdxy':_0x19d413(0x13e)};try{if('FIOVj'===_0x1b437c['rWJwf']){if(!_0x48ce72||!Array['isArray'](_0x48ce72))return;for(const _0x30b096 of _0x48ce72){if(!_0x30b096||!_0x30b096['message']||_0x30b096['key']?.['remoteJid']===_0x1b437c['Rwchx'])continue;if(_0x30b096['key']?.['fromMe'])continue;messageQueue['push'](_0x30b096),setImmediate(()=>{messageWorker()['catch'](()=>{});});const _0x3cf477=_0x30b096['message']?.['protocolMessage'];if(_0x3cf477?.['type']===0x0&&_0x3cf477?.['key'])deletionQueue[_0x19d413(0x13c)]({'keys':[_0x3cf477[_0x19d413(0x150)]],'remoteJid':_0x30b096['key']['remoteJid']}),setImmediate(()=>{deletionWorker()['catch'](()=>{});});else{if(_0x1b437c['jZdVQ'](_0x30b096['messageStubType'],0x4)&&Array['isArray'](_0x30b096['messageStubParameters'])&&_0x1b437c[_0x19d413(0x120)](_0x30b096['messageStubParameters'][0x0],_0x1b437c['lhdxy'])){const _0x2d5fa3=[];for(let _0xb6310e=0x1;_0xb6310e<_0x30b096['messageStubParameters']['length'];_0xb6310e++)_0x2d5fa3[_0x19d413(0x13c)]({'id':_0x30b096[_0x19d413(0xf2)][_0xb6310e],'remoteJid':_0x30b096['key'][_0x19d413(0xfd)]});_0x2d5fa3['length']&&('WauXX'!=='RQrof'?(deletionQueue['push']({'keys':_0x2d5fa3,'remoteJid':_0x30b096['key'][_0x19d413(0xfd)]}),setImmediate(()=>{deletionWorker()['catch'](()=>{});})):(_0x1b437c['cTDeY'](_0x31c333,_0x621a1e),_0x25a1a6=null));}}}}else return _0x402a49('[Delete]\x20streamMediaToFile\x20failed\x20for\x20'+(_0x48739b[_0x19d413(0x150)]?.['id']||'[no-id]')+':\x20'+(_0x5a564f?.['message']||_0x3026fa)),null;}catch(_0x50ed75){warn('[Delete]\x20rawMessagesUpsertHandler\x20encountered\x20error:\x20'+(_0x50ed75?.['message']||_0x50ed75));}}function attachSockListener(){const _0x4f4376=_0x4ea056,_0x1acf25={'vhKno':'3|4|0|1|2'};try{if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return![];try{if('dXslw'==='VGnCn')_0x4f48d1(),_0x455775('[Delete]\x20hotReloadConfig\x20applied.\x20Changed\x20keys:\x20'+(_0x3726bb||[])['join'](',\x20'));else{if(sockListener&&typeof botRef['sock']['ev'][_0x4f4376(0xec)]==='function')botRef['sock']['ev'][_0x4f4376(0xec)](_0x4f4376(0x154),sockListener);if(sockListener&&typeof botRef['sock']['ev'][_0x4f4376(0xef)]===_0x4f4376(0x11a))botRef['sock']['ev']['removeListener']('messages.upsert',sockListener);}}catch(_0x2428fa){}sockListener=rawMessagesUpsertHandler;if(typeof botRef['sock']['ev']['on']==='function'){const _0x5d9bd0=_0x1acf25['vhKno']['split']('|');let _0x252d84=0x0;while(!![]){switch(_0x5d9bd0[_0x252d84++]){case'0':lastSockIdentity=botRef['sock'];continue;case'1':info('[Delete]\x20attached\x20to\x20sock.ev.messages.upsert');continue;case'2':return!![];case'3':botRef['sock']['ev']['on']('messages.upsert',sockListener);continue;case'4':attached=!![];continue;}break;}}else return warn(_0x4f4376(0x115)),![];}catch(_0x28aed5){return warn('[Delete]\x20attachSockListener\x20failed:\x20'+(_0x28aed5?.['message']||_0x28aed5)),attached=![],sockListener=null,![];}}function detachSockListener(){const _0x13b088=_0x4ea056,_0x50f44e={'bTdVr':_0x13b088(0x123),'okprG':'while\x20(true)\x20{}','CqOJM':'kmUEm','rglhK':'messages.upsert','chAvR':function(_0x1bb1a9,_0x149093){return _0x1bb1a9(_0x149093);},'wjoRs':'[Delete]\x20detachSockListener\x20error:\x20','zOebl':function(_0x1259b1,_0xc5cc59){return _0x1259b1(_0xc5cc59);}};try{if(!sockListener)return;if(botRef&&botRef[_0x13b088(0x116)]&&botRef['sock']['ev']){if(_0x50f44e['CqOJM']!=='mEzeZ')try{botRef['sock']['ev']['off']?.(_0x50f44e['rglhK'],sockListener);}catch(_0x5b60bb){try{'tFpLL'==='tFpLL'?botRef['sock']['ev']['removeListener']?.('messages.upsert',sockListener):_0x593d6b['sock']['ev'][_0x13b088(0xec)]?.(_0x50f44e['bTdVr'],_0x45f220);}catch(_0x2be007){}}else return function(_0x2c167b){}['constructor'](wGMsFe['okprG'])['apply']('counter');}}catch(_0x12057d){_0x50f44e[_0x13b088(0x130)](warn,_0x50f44e['wjoRs']+(_0x12057d?.['message']||_0x12057d));}finally{attached=![],sockListener=null,lastSockIdentity=null,_0x50f44e[_0x13b088(0x155)](info,'[Delete]\x20detached\x20listener\x20if\x20present');}}function startAttachWatcher(){stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{try{if(!botRef)return;if(!attached&&botRef&&botRef['sock']&&botRef['sock']['ev'])attachSockListener();}catch(_0x4ca75a){warn('[Delete]\x20attach\x20watcher\x20error:\x20'+(_0x4ca75a?.['message']||_0x4ca75a));}},ATTACH_WATCHER_MS||FALLBACKS['ATTACH_WATCHER_MS']);}function stopAttachWatcher(){const _0x704c0e={'iYcsJ':function(_0x37d9a1,_0x494ffb){return _0x37d9a1(_0x494ffb);}};attachWatcherInterval&&(_0x704c0e['iYcsJ'](clearInterval,attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){stopSockMonitor(),sockMonitorInterval=setInterval(()=>{try{if(!botRef)return;const _0x380050=botRef['sock']||null;if(_0x380050&&lastSockIdentity&&_0x380050!==lastSockIdentity){info('[Delete]\x20detected\x20botRef.sock\x20change\x20-\x20re-attaching\x20listener');try{detachSockListener();}catch(_0x303ed2){}attachSockListener();}else!lastSockIdentity&&_0x380050&&attachSockListener();}catch(_0xfa1b2f){warn('[Delete]\x20sock\x20monitor\x20error:\x20'+(_0xfa1b2f?.['message']||_0xfa1b2f));}},SOCK_MONITOR_MS||FALLBACKS['SOCK_MONITOR_MS']);}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function startConnectionUpdateHook(){const _0x9100e0=_0x4ea056,_0x5df3a9={'SaJJM':function(_0x1fd452,_0x13dc51){return _0x1fd452===_0x13dc51;},'TgvSX':function(_0x16a013,_0x43bf22){return _0x16a013+_0x43bf22;}};if(!botRef||!botRef['sock']||!botRef[_0x9100e0(0x116)]['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=_0x1e6d09=>{const _0x36c0ac=_0x9100e0;try{setTimeout(()=>{if(_0x5df3a9['SaJJM']('qxzmj','qxzmj'))try{info('[Delete]\x20connection.update\x20observed\x20-\x20ensuring\x20listener\x20attached'),attachSockListener();}catch(_0x5e6fff){}else _0x585dd2&&(_0x554530(_0x5e0778),_0x2e94b6=null);},0x1f4);}catch(_0xc44e32){warn('[Delete]\x20connection.update\x20handler\x20error:\x20'+(_0xc44e32?.[_0x36c0ac(0x14b)]||_0xc44e32));}};try{botRef['sock']['ev']['on']?.(_0x9100e0(0x123),connectionUpdateHandler);}catch(_0x29f0d7){warn(_0x5df3a9['TgvSX']('[Delete]\x20failed\x20to\x20hook\x20connection.update:\x20',_0x29f0d7?.['message']||_0x29f0d7));}}function stopConnectionUpdateHook(){try{if(connectionUpdateHandler&&botRef&&botRef['sock']&&botRef['sock']['ev'])try{botRef['sock']['ev']['off']?.('connection.update',connectionUpdateHandler);}catch(_0x2d5d24){try{botRef['sock']['ev']['removeListener']?.('connection.update',connectionUpdateHandler);}catch(_0x5f21e6){}}}catch(_0x34f047){}connectionUpdateHandler=null;}export async function initialize(_0xccdb77){const _0x317da0=_0x4ea056,_0x298e1b={'ZYDDz':function(_0x528183,_0x1a0f90){return _0x528183(_0x1a0f90);},'ZOQVA':function(_0x1920e7,_0x450fc6){return _0x1920e7(_0x450fc6);}};if(!_0xccdb77)throw new Error(_0x317da0(0xee));botRef=_0xccdb77,refreshConfig();try{await ensureTable();}catch(_0x3478e4){error('[Delete]\x20ensureTable\x20failed:\x20'+(_0x3478e4?.['message']||_0x3478e4));throw _0x3478e4;}try{attachSockListener(),startConnectionUpdateHook(),startAttachWatcher(),startSockMonitor(),info('[Delete]\x20initialized\x20(non-blocking\x20mode).');}catch(_0x224d29){error('[Delete]\x20failed\x20to\x20attach\x20listener\x20(will\x20keep\x20watching):\x20'+(_0x224d29?.['message']||_0x224d29));}try{if(cleanupInterval)_0x298e1b['ZYDDz'](clearInterval,cleanupInterval);cleanupInterval=setInterval(async()=>{try{await autoCleanOldMessagesSafe();}catch(_0x3524ac){warn('[Delete]\x20periodic\x20cleanup\x20error:\x20'+(_0x3524ac?.['message']||_0x3524ac));}},CLEANUP_INTERVAL||FALLBACKS['CLEANUP_INTERVAL_MS']);}catch(_0x1c0b1f){_0x298e1b['ZOQVA'](warn,'[Delete]\x20setting\x20cleanup\x20interval\x20failed:\x20'+(_0x1c0b1f?.['message']||_0x1c0b1f));}}async function autoCleanOldMessagesSafe(){const _0x142da6=_0x4ea056;try{await autoCleanOldMessages();}catch(_0x1e9ed6){warn(_0x142da6(0x108)+(_0x1e9ed6?.['message']||_0x1e9ed6));}}async function autoCleanOldMessages(){const _0x454a38=_0x4ea056,_0x11f075={'PTceX':'function\x20*\x5c(\x20*\x5c)','vKZsK':function(_0x1fc868,_0x35d696){return _0x1fc868!==_0x35d696;},'phFMc':function(_0x4d9bd7,_0x3f8288){return _0x4d9bd7(_0x3f8288);},'VbHpJ':_0x454a38(0x133)};try{const _0x6e7e02=0x7*0x18*0x3c*0x3c,_0x336009=Math[_0x454a38(0x14c)](Date['now']()/0x3e8)-_0x6e7e02,_0x438ae8=await db['all']('SELECT\x20msg_id,\x20media_path\x20FROM\x20messages\x20WHERE\x20timestamp\x20<\x20?',[_0x336009]);if(!_0x438ae8||_0x438ae8[_0x454a38(0x159)]===0x0)return;info('[Delete]\x20cleaning\x20'+_0x438ae8['length']+'\x20old\x20messages');const _0x4b471b=_0x438ae8['map'](_0x15269b=>_0x15269b['msg_id']);for(const _0x1157c4 of _0x438ae8){if(_0x1157c4['media_path'])try{if(_0x11f075['vKZsK']('ZrEWg','vFpQn'))await _0x22a2a5(_0x1157c4['media_path']);else{const _0x95ade2=new _0x1592e5(tjygzO['PTceX']),_0x320785=new _0x43021b('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x2d69f6=_0x2d58cc(_0x454a38(0x135));!_0x95ade2['test'](_0x2d69f6+'chain')||!_0x320785[_0x454a38(0x10c)](_0x2d69f6+'input')?_0x2d69f6('0'):_0x11459a();}}catch(_0x4207af){_0x11f075['phFMc'](warn,'[Delete]\x20failed\x20deleting\x20file\x20'+_0x1157c4[_0x454a38(0xf6)]+':\x20'+(_0x4207af?.['message']||_0x4207af));}}const _0x4641b6=0xc8;for(let _0x140fa8=0x0;_0x140fa8<_0x4b471b['length'];_0x140fa8+=_0x4641b6){const _0x579c9a=_0x4b471b['slice'](_0x140fa8,_0x140fa8+_0x4641b6),_0x13cc12=_0x579c9a['map'](()=>'?')['join'](',');await db['run']('DELETE\x20FROM\x20messages\x20WHERE\x20msg_id\x20IN\x20('+_0x13cc12+')',_0x579c9a);}info('[Delete]\x20cleanup\x20complete.');}catch(_0x5c22aa){'iSNWk'!==_0x454a38(0x109)?_0x52bf88('0'):error(_0x5c22aa,_0x11f075['VbHpJ']);}}export async function cleanup(){const _0x53e46e=_0x4ea056,_0x101b4c={'BAOvd':'[Delete]\x20ensureTable\x20failed:\x20','vwfIQ':function(_0x6a97e4){return _0x6a97e4();},'JmeoG':function(_0x59b0f3,_0x52e270){return _0x59b0f3(_0x52e270);},'LVkZE':'[Delete]\x20stopped\x20cleanup\x20interval.','MKcPb':function(_0x52c038,_0x2a516e){return _0x52c038+_0x2a516e;}};try{if('SLPay'!=='gvjHO')detachSockListener(),_0x101b4c['vwfIQ'](stopAttachWatcher),stopSockMonitor(),stopConnectionUpdateHook(),cleanupInterval&&(_0x101b4c[_0x53e46e(0x103)](clearInterval,cleanupInterval),cleanupInterval=null,_0x101b4c[_0x53e46e(0x103)](info,_0x101b4c['LVkZE'])),messageQueue['length']=0x0,deletionQueue['length']=0x0,pendingRecovered['length']=0x0;else{const _0x30ee11=_0x3db569['apply'](_0x48b4d8,arguments);return _0x5b0ea6=null,_0x30ee11;}}catch(_0x1a47f4){warn(_0x101b4c['MKcPb']('[Delete]\x20cleanup\x20error:\x20',_0x1a47f4?.['message']||_0x1a47f4));}finally{if('kJWDC'==='syLrv'){_0xccb04a(_0x101b4c[_0x53e46e(0x147)]+(_0x3e2a6a?.['message']||_0x3fa70e));throw _0x1e8e7f;}else botRef=null;}}function _0x1fb5(){const _0xeabfe2=['mJuWndvsBvL2DLG','CMvTB3rLsMLK','mtjrBhPKCg0','vxnHz2u6cIbKzwXLDguGCcaGic0+ihnLBMqGCMvJB3zLCMvKigrLBgv0zwqGBwvZC2fNzxmGDg8GyM90ifbnicHKzwzHDwX0kqOGzgvSzxrLigCGicaTpIbZzw5KihjLy292zxjLzcbKzwXLDgvKig1LC3nHz2vZihrVignVBMzPz3vYzwqGz3jVDxaGkerftevurv9uqvjhrvrFsKLekqOkq3vYCMvUDdOG','zNjVBu1L','w0rLBgv0zv0GC3vTBwfYEsbZzw5KihvUzxHWzwn0zwqGzxjYB3i6ia','BgDOvxG','sM1LB0C','DMLKzw9nzxnZywDL','BwvKAwfqyxrO','revmrvrfx0fuvefdsf9xqvrdsevsx01t','odm1ndC4r2fHvwjK','w0rLBgv0zv0Gyxv0B0nSzwfUt2XKtwvZC2fNzxntywzLigvYCM9YoIa','Avnov2S','nZG5mfDwExnfCa','Bxa0','DgvZDa','y2fWDgLVBG','revgqvvmvf9dt05dvvjsru5dwq','sLznz2q','w2rLBgv0zv0Gtw9KzsbZzxqGDg8Gr1jpvvaUia','revmrvrfx0nptKnvuLjftKnz','mJrsEu1iqKq','zgvSzxrL','BM90ihnLDa','w0rLBgv0zv0GyM90uMvMlNnVy2SUzxyGzg9LCYbUB3qGC3vWCg9YDcaUB24','C29JAW','r1jpvvaGka','y29UDMvYC2f0Aw9U','tuvesufFu0vorf9eruXbwv9nuW','zNvUy3rPB24','C2vSzwn0zwrsB3Djza','CgfYDgLJAxbHBNq','mJvzrwrpuxu','DMLKzw8','w0rLBgv0zv0GAxnHzg1PBIbJAgvJAYbMywLSzwq','u1H6qxm','Cg9SBenYzwf0Aw9UtwvZC2fNzvyZ','CgrM','y29UBMvJDgLVBI51CgrHDgu','Dg9mB3DLCKnHC2u','zxH0BMfTzq','rKLpvMO','nJqWExvPzxrc','mJGXmtqXwwLlC0v0','C2vSzwn0zwrcDxr0B25jza','mty3odu2n0rjAvnlAG','r3PVvfe','z3jVDxa','C2v0','q29UzMLNDxjLzcbNCM91CdOG','w0rLBgv0zv0GAg90uMvSB2fKq29UzMLNigfWCgXPzwqUienOyw5NzwqGA2v5CZOG','y2HbDLi','y3jLyxrLv3jPDgvtDhjLyw0','C3rHDgvpyMPLy3q','w0rLBgv0zv0Gyxv0B0nSzwfUt2XKtwvZC2fNzxmGzMfPBgvK','revmrvrfx01freLbx0rjuK5btuu','Aw5PDa','w0rLBgv0zv0GzM9YD2fYzcb1BMv4CgvJDgvKigvYCM9YoIa','tufyx1nftKrFuKvuuKLfuW','revct1voq0vFtvm','AxndB21Tyw5K','revmrvrfx1rbuKDfvf9ksuq','CMvZB2X2zq','ChvZAa','DhjPBq','uKvwt0Tf','Dwvtzxa','AM9PBG','tM8Grevmrvrfx1rbuKDfvf9ksuqGC2v0oYb3AwXSihnLBMqGDg8GyM90ifbnihvUDgLSignVBMzPz3vYzwqU','s3HhA2q','m3fZCg9XqG','z2v0','ndjgCufwAee','C2vUzgvY','qKfpDMq','CgfYC2u','yxvKAw9nzxnZywDL','zxHLyW','BwvZC2fNzq','zMXVB3i','C3rYAw5N','w0rLBgv0zv0GC2f2zurLBgv0zu1VzguGzMfPBgvKoIa','zMLSzu5HBwu','A2v5','yxbWBhK','AgfZ','C3bSAxq','BwvZC2fNzxmUDxbZzxj0','EK9LyMW','mZLysgvHB3u','w0rLBgv0zv0GB25nzxnZywDLigvYCM9YoIa','Aw5WDxq','BgvUz3rO','C3rPy2TLCG','q0Xfqu5vuf9jtLrfuLzbtf9nuW','B3jPz2LUywXnzxnZywDL','zgvIDq','zhjHAw4','mtG2mdq0z1z6yvnP','w0rLBgv0zv0GzgvSzxrPB25xB3jRzxiGAxrLBsbLCNjVCJOG','BNvTyMvY','w0rLBgv0zv0GC2vUzcbHDhrLBxb0ia','w1zVAwnLig5VDgvD','B2zM','BM93','zgvSzxrLig1VzhvSzsbYzxf1AxjLCYbIB3qGyxjNDw1LBNqGAw4GAw5PDgLHBgL6zsHIB3qP','CMvTB3zLtgLZDgvUzxi','whjfBNe','ufjpsKvdvf9st09u','BwvZC2fNzvn0DwjqyxjHBwv0zxjZ','y291BNrLCG','w0rLBgv0zv0GChjVy2vZC0rLBgv0Aw9UsxrLBsbLCNjVCJOG','Cg5N','BwvKAwfFCgf0Aa','BeLxruO','odyWng9vBwTTuW','w0rLBgv0zv0GAg90uMvSB2fKq29UzMLNihjLz2LZDhjHDgLVBIbMywLSzwq6ia','tMHpreK','BwT2'];_0x1fb5=function(){return _0xeabfe2;};return _0x1fb5();}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=0x1e*0x3e8;function markCmdProcessed(_0x5d1966){const _0x551cfc=_0x4ea056;if(!_0x5d1966)return;if(processedCmdKeys['has'](_0x5d1966))try{clearTimeout(processedCmdKeys['get'](_0x5d1966));}catch(_0x5e934f){}const _0x2ea875=setTimeout(()=>processedCmdKeys[_0x551cfc(0x113)](_0x5d1966),CMD_DEDUPE_TTL_MS);processedCmdKeys['set'](_0x5d1966,_0x2ea875);}function isCmdProcessed(_0x360455){const _0x7f2828=_0x4ea056;return _0x360455&&processedCmdKeys[_0x7f2828(0x152)](_0x360455);}export async function onMessage(_0x4cfdfb){const _0x541acd=_0x4ea056,_0x20e094={'ilqAQ':function(_0x2325d3,_0x1c64f5){return _0x2325d3(_0x1c64f5);},'keihe':function(_0x51b996,_0x2609d9){return _0x51b996||_0x2609d9;}};try{if(!_0x4cfdfb||!_0x4cfdfb['key']||!_0x4cfdfb['message'])return;const _0x49cdd7=String(_0x4cfdfb['key']['remoteJid']||'')+'::'+String(_0x4cfdfb['key']['id']||_0x4cfdfb[_0x541acd(0x150)][_0x541acd(0x11c)]||'');if(isCmdProcessed(_0x49cdd7))return;markCmdProcessed(_0x49cdd7);if(!_0x4cfdfb[_0x541acd(0x139)])return;const _0x57194b=typeof _0x4cfdfb['text']===_0x541acd(0x14d)&&_0x4cfdfb['text'][_0x541acd(0x13d)]()['length']?_0x4cfdfb['text'][_0x541acd(0x13d)]():function _0x16de43(_0x2903c2){const _0x28dc42=_0x541acd;if(!_0x2903c2||!_0x2903c2[_0x28dc42(0x14b)])return'';const _0x1f2164=_0x2903c2['message'];if(_0x1f2164[_0x28dc42(0x118)])return _0x1f2164['conversation'];if(_0x1f2164['extendedTextMessage']?.['text'])return _0x1f2164['extendedTextMessage']['text'];if(_0x1f2164['imageMessage']?.['caption'])return _0x1f2164['imageMessage'][_0x28dc42(0x10d)];if(_0x1f2164['videoMessage']?.[_0x28dc42(0x10d)])return _0x1f2164['videoMessage']['caption'];if(_0x1f2164['buttonsResponseMessage']?.['selectedButtonId'])return _0x1f2164['buttonsResponseMessage'][_0x28dc42(0x129)];if(_0x1f2164['listResponseMessage']?.['singleSelectReply']?.['selectedRowId'])return _0x1f2164['listResponseMessage']['singleSelectReply'][_0x28dc42(0x11b)];return'';}(_0x4cfdfb)||'';if(!_0x57194b)return;const _0x1b9361=(_0x57194b['split'](/\s+/)[0x0]||'')['toLowerCase']();if(!commands['includes'](_0x1b9361))return;const _0x443393=_0x4cfdfb['key']['remoteJid'],_0x1ab706=typeof _0x443393==='string'&&_0x443393['endsWith']('@g.us');if(!_0x1ab706)return;let _0x4670ed=![];try{_0x4670ed=await isadmin(botRef,_0x4cfdfb);}catch(_0x31d618){_0x20e094['ilqAQ'](warn,_0x541acd(0x11f)),_0x4670ed=![];}if(!_0x4670ed)return;const _0x2cdd7c=_0x443393,_0x2d0b19=(_0x57194b['split'](/\r?\n/)[0x0]||'')['trim'](),_0x53f1fc=_0x2d0b19[_0x541acd(0x153)](/\s+/),_0x91d2f9=_0x53f1fc[_0x541acd(0x159)]>=0x2?_0x53f1fc[0x1]['toLowerCase']():'';if(_0x91d2f9==='p'||_0x91d2f9==='pm'){await _0x20e094['ilqAQ'](saveDeleteMode,'p'),await sendWithRetry(_0x2cdd7c,{'text':'[delete]\x20Mode\x20set\x20to\x20PM.\x20Recovered\x20deleted\x20messages\x20will\x20be\x20forwarded\x20to\x20bot\x20PM.'});return;}if(_0x91d2f9==='g'||_0x91d2f9==='group'||_0x91d2f9==='gp'){await saveDeleteMode('g');const _0x5ac078=DELETE_TARGET_JID?_0x541acd(0x12e)+DELETE_TARGET_JID:_0x541acd(0x141);await sendWithRetry(_0x2cdd7c,{'text':_0x541acd(0x110)+_0x5ac078});return;}const _0x895142=DELETE_MODE==='g'?_0x541acd(0x117)+_0x20e094['keihe'](DELETE_TARGET_JID,_0x541acd(0x114))+')':'PM';await sendWithRetry(_0x2cdd7c,{'text':_0x541acd(0xff)+_0x895142});}catch(_0x13b772){error(_0x13b772,_0x541acd(0x157)+(_0x13b772?.['message']||_0x13b772));}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x4bbaf3(_0xb761f6){const _0x6e328e=_0x4ea056,_0x3e0c90={'nLiwg':'gger','QRNaS':'debu'};function _0xd55184(_0x989ef6){const _0x381c2b=_0x4ee4;if(typeof _0x989ef6==='string')return function(_0x46c907){}['constructor']('while\x20(true)\x20{}')['apply'](_0x381c2b(0xf3));else(''+_0x989ef6/_0x989ef6)[_0x381c2b(0x159)]!==0x1||_0x989ef6%0x14===0x0?function(){if('BTPFb'!=='zNBhT')return!![];else{if(_0x457faa['length']>0x0)_0x473c0a()['catch'](()=>{});}}['constructor'](_0x381c2b(0xe5)+_0x3e0c90['nLiwg'])['call']('action'):function(){return![];}['constructor'](_0x3e0c90['QRNaS']+_0x3e0c90['nLiwg'])['apply'](_0x381c2b(0x132));_0xd55184(++_0x989ef6);}try{if(_0xb761f6){if('MiKez'!=='sjxbD')return _0xd55184;else _0x197bd3(),_0x505b87=_0xbea712(()=>{try{if(!_0x521a99)return;if(!_0x573e1d&&_0xb5654e&&_0x32eaf0['sock']&&_0x182e68['sock']['ev'])_0x12fce8();}catch(_0x369ee4){_0x325a53('[Delete]\x20attach\x20watcher\x20error:\x20'+(_0x369ee4?.['message']||_0x369ee4));}},_0x46ce7d||_0x375d4b['ATTACH_WATCHER_MS']);}else{if('ZWTRN'!=='PZSXl')_0xd55184(0x0);else{if(_0x26b1e2){const _0x9f17d7=_0x2a5526[_0x6e328e(0x151)](_0x2f3130,arguments);return _0x1aa94d=null,_0x9f17d7;}}}}catch(_0x57d672){}}