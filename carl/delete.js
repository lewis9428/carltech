const _0x46dfba=_0x3741;(function(_0x443c55,_0x5ea5b9){const _0x4e9f56=_0x3741,_0x2e9831=_0x443c55();while(!![]){try{const _0x2f4d0d=-parseInt(_0x4e9f56(0x218))/0x1+-parseInt(_0x4e9f56(0x20a))/0x2+-parseInt(_0x4e9f56(0x1fe))/0x3+-parseInt(_0x4e9f56(0x1f2))/0x4*(parseInt(_0x4e9f56(0x1ff))/0x5)+-parseInt(_0x4e9f56(0x1cc))/0x6+-parseInt(_0x4e9f56(0x1c7))/0x7*(-parseInt(_0x4e9f56(0x212))/0x8)+parseInt(_0x4e9f56(0x1c4))/0x9*(parseInt(_0x4e9f56(0x1d3))/0xa);if(_0x2f4d0d===_0x5ea5b9)break;else _0x2e9831['push'](_0x2e9831['shift']());}catch(_0x9d65e0){_0x2e9831['push'](_0x2e9831['shift']());}}}(_0x3515,0x1c2ca));const _0x1842bd=(function(){let _0x1813e0=!![];return function(_0x408465,_0x34456c){const _0x208f07=_0x1813e0?function(){if(_0x34456c){const _0x1342e9=_0x34456c['apply'](_0x408465,arguments);return _0x34456c=null,_0x1342e9;}}:function(){};return _0x1813e0=![],_0x208f07;};}());(function(){const _0x2d4921={'yqkwy':'chain','eYrgM':'input'};_0x1842bd(this,function(){const _0x2d46db=_0x3741,_0x49b535=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x1ebf47=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x258447=_0x36316a('init');!_0x49b535['test'](_0x258447+_0x2d4921[_0x2d46db(0x213)])||!_0x1ebf47['test'](_0x258447+_0x2d4921['eYrgM'])?_0x258447('0'):_0x36316a();})();}());function _0x3515(){const _0x3bf659=['Aw1Hz2u','Dgv4Da','q1jfqvrfifrbqKXfieLgie5pvcbfweLtvfmGBwvZC2fNzxmGkaOGicaGBxnNx2LKifrfwfqGufjjtufswsblrvKScIaGicbJAgf0x2PPzcburvHulaOGicaGC2vUzgvYx2PPzcburvHulaOGicaGBwvZC2fNzv9QC29UifrfwfqScIaGicb0Aw1LC3rHBxaGsu5uruDfuIWkicaGig1LzgLHx3bHDgGGvevyvaOGicK7','Aw5JBhvKzxm','w0rLBgv0zv0GBw9KzsbZyxzLzdOG','ywXS','mJC0odzuDfzpuLG','w0rLBgv0zv0Gzgv0zwn0zwqGyM90uMvMlNnVy2SGy2HHBMDLic0GCMuTyxr0ywnOAw5NigXPC3rLBMvY','mI42lJe','otuWmdeYD3D5v2vK','CgfYDgLJAxbHBNq','C3rHDgvpyMPLy3q','y2fWDgLVBG','u0vmrunuihzHBhvLiezst00GzgvSzxrLx3bYzwzZifDirvjfigTLEt0NBw9KzsC','otG5mJKYvMjdzgLf','w1vUA25VD24Gr3jVDxbD','y2f0y2G','w0rLBgv0zv0GAg90uMvSB2fKq29UzMLNihjLz2LZDhjHDgLVBIbMywLSzwq6ia','y29UC3rYDwn0B3i','twvZC2fNzq','zMLSzu5HBwu','mZe0mhr0Dxrtvq','BgvUz3rO','w0rLBgv0zv0GBwf5yMvtyxzLtwvKAweGzxjYB3i6ia','D2HPBguGkhrYDwuPihT9','w0rLBgv0zv0Gzw5ZDxjLvgfIBguGzMfPBgvKoIa','tuvesufFu0vorf9eruXbwv9nuW','w0rLBgv0zv0GBM8GC2vUzcb0yxjNzxqGyxzHAwXHyMXLigzVCIbYzwnVDMvYEq','revct1voq0vFtvm','w0rLBgv0zv0Gy29UBMvJDgLVBI51CgrHDguGAgfUzgXLCIbLCNjVCJOG','BwvKAwfFCgf0Aa','wKz3u1q','q1jfqvrfifrbqKXfieLgie5pvcbfweLtvfmGzgvSzxrLx3bYzwzZicGkicaGigTLEsburvHuifbssu1buLKGs0vzlaOGicaGDMfSDwuGvevyvcbot1qGtLvmtcWkicaGihvWzgf0zwrFyxqGsu5uruDfuIberuzbvuXuidakicaPoW','y29UBMvJDgLVBI51CgrHDgu','zxH0zw5KzwruzxH0twvZC2fNzq','A2v5','BwvUDgLVBNm','z2LMugXHEwjHy2S','BwvZC2fNzxmUDxbZzxj0','DMflugi','C3bSAxq','CMvTB3rLsMLK','8j+rPcbgCM9ToIba','BwvZC2fNzq','tMDnsuy','w0rLBgv0zv0GzMfPBgvKigrLBgv0Aw5NigzPBguG','C2LUz2XLu2vSzwn0uMvWBhK','y29UDMvYC2f0Aw9U','BM93','sMnJz08','revgqvvmvf9tru5ex0rftevurq','w0rLBgv0zv0Grevgqvvmvf9tru5ex0rftevursbPCYbMywXZzsdIGjqGC2TPChbPBMCGCMvJB3zLCMvKihnLBMrZlG','ndmWmtK2rLD2ufny','cIaGicaGieLou0vsvcbjtLrpigrLBgv0zv9WCMvMCYaOA2v5lcb2ywX1zsWGDxbKyxrLzf9HDcKkicaGicaGvKfmvuvticGNBw9KzsCSid8Sid8PcIaGicaGie9oienptKzmsunukgTLEsKGre8Gvvbeqvrfifnfvcb2ywX1zt1LEgnSDwrLzc52ywX1zsWGDxbKyxrLzf9HDd1LEgnSDwrLzc51CgrHDgvKx2f0cIaGica','C2vSzwn0zwrcDxr0B25jza','zNvUy3rPB24','CMvTB3zLtgLZDgvUzxi','BwfW','DMLKzw8','q3LhBLm','BxmSienptKnvuLjftKnzpq','revmrvrfiezst00GBwvZC2fNzxmGv0HfuKuGBxnNx2LKieLoicG','zMLUAxnO','ChDzC0K','nJy2mdmWBNLSvuXJ','mtbVzNPQy0K','qvruqunix1DbvenirvjFtvm','tM9RCLK','ufjpsKvdvf9st09u','AM9PBG','t0LAvwi','w0rLBgv0zv0Gy2XLyw51CcbJB21WBgv0zs4','ChjVDg9JB2XnzxnZywDL','w0f1zgLVxq','ierftevuruqGtuvtu0fhrvmGuKvdt1zfuKvekIdWN5ErcGO','zMXVB3i','nda4ody2yu5Tsxvl','zg9JDw1LBNrnzxnZywDL','revgqvvmvf9dt05dvvjsru5dwq','B3jPz2LUywXnzxnZywDL','q0Xfqu5vuf9jtLrfuLzbtf9nuW','B2jQzwn0','w0rLBgv0zv0GChjVy2vZC0rLBgv0Aw9UsxrLBsbLCNjVCJOG','BwvKAwfqyxrO','ogjstgfbDa','ExfRD3K','DxnLCG','w2rLBgv0zv0Gtw9KzsbZzxqGDg8Gr1jpvvaUia','y29UDgvUDa','rLDzz1K','mtCYodq3uuLjre92','C2v0sw50zxj2ywW','DMfSDwu','C29JAW','tufyx1nftKrFuKvuuKLfuW','Bxa0','B2zM','A2v5CW','C3rPy2TLCK1LC3nHz2u','BgLZDfjLC3bVBNnLtwvZC2fNzq','revmrvrfx0nmrufovvbFsu5urvjwquXFtvm','C2XPy2u','DMLKzw9nzxnZywDL','lcberujpvu5drt0','w0rLBgv0zv0Gyxr0ywnOzwqGDg8GC29JAY5LDI5TzxnZywDLCY51ChnLCNq','Cg5N','r1jpvvaGka','w1n0AwnRzxjD'];_0x3515=function(){return _0x3bf659;};return _0x3515();}import _0x5c5d9a from'path';(function(){const _0x2a68df=_0x3741;let _0x4b3db0;try{const _0x14a07a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4b3db0=_0x14a07a();}catch(_0x304d75){_0x4b3db0=window;}_0x4b3db0[_0x2a68df(0x219)](_0x36316a,0x61a80);}());import _0x12dead from'fs';import{mkdirSync}from'fs';import{rm as _0x8eaf00}from'fs/promises';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import _0x346bcc from'node-cache';import{isadmin}from'../utils/isadmin.js';export const name='delete-recovery';export const version=_0x46dfba(0x1c6);export const priority=0x32;export const commands=['delete'];export const configKeys=['DELETE_TARGET_JID','DELETE_MEDIA_DIRNAME','DELETE_DEBOUNCE_MS','DELETE_CONCURRENCY','DELETE_ATTACH_WATCHER_MS','DELETE_SOCK_MONITOR_MS',_0x46dfba(0x1f0)];const FALLBACKS={'DEBOUNCE_MS':0xbb8,'MEDIA_DIRNAME':'media','DEFAULT_CONCURRENCY':0x3,'CLEANUP_INTERVAL_MS':0x18*0x3c*0x3c*0x3e8,'MEDIA_SEND_DELAY_MS':0x12c,'MAX_SEND_RETRIES':0x3,'INITIAL_BACKOFF_MS':0x1f4,'ATTACH_WATCHER_MS':0xbb8,'SOCK_MONITOR_MS':0x3e8};let botRef=null,attached=![],sockListener=null,cleanupInterval=null;const messageQueue=[],deletionQueue=[];let activeMessageTasks=0x0,activeDeletionTasks=0x0,MEDIA_DIR=null,DEBOUNCE_DELAY_MS=FALLBACKS['DEBOUNCE_MS'],CONCURRENCY=FALLBACKS['DEFAULT_CONCURRENCY'],MEDIA_SEND_DELAY_MS=FALLBACKS[_0x46dfba(0x1d8)],CLEANUP_INTERVAL=FALLBACKS['CLEANUP_INTERVAL_MS'],MAX_SEND_RETRIES=FALLBACKS['MAX_SEND_RETRIES'],INITIAL_BACKOFF=FALLBACKS['INITIAL_BACKOFF_MS'],ATTACH_WATCHER_MS=FALLBACKS['ATTACH_WATCHER_MS'],SOCK_MONITOR_MS=FALLBACKS['SOCK_MONITOR_MS'],DEFAULT_SEND_DELETE=![],DELETE_TARGET_JID=null,DELETE_MODE='p';const nameCache=new _0x346bcc({'stdTTL':0xe10});let flushTimer=null,attachWatcherInterval=null,sockMonitorInterval=null,lastSockIdentity=null,connectionUpdateHandler=null;const pendingRecovered=[];function ensureDirSync(_0x1b7226){if(!_0x12dead['existsSync'](_0x1b7226))mkdirSync(_0x1b7226,{'recursive':!![]});}function sleep(_0x3f5223){return new Promise(_0x199eb6=>setTimeout(_0x199eb6,_0x3f5223));}function refreshConfig(){const _0x4a864b=_0x46dfba,_0x519beb={'QTLMu':function(_0x5136a1,_0x41f193){return _0x5136a1(_0x41f193);}};try{const _0x3f23d1=getConfig()||{};DEFAULT_SEND_DELETE=typeof _0x3f23d1['DEFAULT_SEND_DELETE']==='boolean'?_0x3f23d1[_0x4a864b(0x1f0)]:DEFAULT_SEND_DELETE,DELETE_TARGET_JID=typeof _0x3f23d1['DELETE_TARGET_JID']==='string'&&_0x3f23d1['DELETE_TARGET_JID'][_0x4a864b(0x1c1)]('@')?_0x3f23d1['DELETE_TARGET_JID']:null,DEBOUNCE_DELAY_MS=Number(_0x3f23d1['DELETE_DEBOUNCE_MS']??FALLBACKS['DEBOUNCE_MS']),CONCURRENCY=_0x519beb['QTLMu'](Number,_0x3f23d1['DELETE_CONCURRENCY']??_0x3f23d1['MODULE_CONCURRENCY_LIMIT']??FALLBACKS['DEFAULT_CONCURRENCY']),MEDIA_SEND_DELAY_MS=Number(_0x3f23d1['DELETE_MEDIA_SEND_DELAY_MS']??FALLBACKS['MEDIA_SEND_DELAY_MS']),CLEANUP_INTERVAL=Number(_0x3f23d1[_0x4a864b(0x1b6)]??FALLBACKS[_0x4a864b(0x20e)]),MAX_SEND_RETRIES=Number(_0x3f23d1['DELETE_MAX_SEND_RETRIES']??FALLBACKS[_0x4a864b(0x1b0)]),INITIAL_BACKOFF=Number(_0x3f23d1['DELETE_INITIAL_BACKOFF_MS']??FALLBACKS['INITIAL_BACKOFF_MS']),ATTACH_WATCHER_MS=Number(_0x3f23d1['DELETE_ATTACH_WATCHER_MS']??FALLBACKS[_0x4a864b(0x200)]),SOCK_MONITOR_MS=Number(_0x3f23d1['DELETE_SOCK_MONITOR_MS']??FALLBACKS['SOCK_MONITOR_MS']);const _0x17be7c=_0x3f23d1[_0x4a864b(0x202)]&&typeof _0x3f23d1[_0x4a864b(0x202)]==='string'?_0x3f23d1['PROJECT_ROOT']:process['cwd'](),_0xdf58e9=_0x5c5d9a['resolve'](_0x17be7c,'data','delete');ensureDirSync(_0xdf58e9),MEDIA_DIR=_0x5c5d9a['join'](_0xdf58e9,_0x3f23d1['DELETE_MEDIA_DIRNAME']??_0x3f23d1['DELETE_MEDIA_DIR']??FALLBACKS['MEDIA_DIRNAME']),ensureDirSync(MEDIA_DIR),info('[Delete]\x20config\x20refreshed:\x20DEFAULT_SEND_DELETE='+DEFAULT_SEND_DELETE+',\x20DELETE_TARGET_JID='+(DELETE_TARGET_JID?'set':'unset')+_0x4a864b(0x1b9)+DEBOUNCE_DELAY_MS+_0x4a864b(0x1fa)+CONCURRENCY);}catch(_0x55cc9f){warn('[Delete]\x20refreshConfig\x20error:\x20'+(_0x55cc9f?.['message']||_0x55cc9f));}}try{hotReloadConfig&&hotReloadConfig(_0x4c960a=>{const _0x22adf6=_0x46dfba,_0x529f0f={'HJKNy':'[Delete]\x20hotReloadConfig\x20handler\x20error:\x20'};try{refreshConfig(),info('[Delete]\x20hotReloadConfig\x20applied.\x20Changed\x20keys:\x20'+(_0x4c960a||[])[_0x22adf6(0x203)](',\x20'));}catch(_0x306aea){warn(_0x529f0f['HJKNy']+(_0x306aea?.[_0x22adf6(0x1e9)]||_0x306aea));}});}catch(_0x39a2ca){warn(_0x46dfba(0x1cf)+(_0x39a2ca?.[_0x46dfba(0x1e9)]||_0x39a2ca));}refreshConfig();async function ensureTable(){const _0x371c54=_0x46dfba,_0x31ee38={'PtKZS':'[Delete]\x20ensureTable\x20prefs\x20init\x20failed:\x20','bdTEk':function(_0x2a442c,_0xd8e0a7){return _0x2a442c(_0xd8e0a7);}};await db['exec'](_0x371c54(0x1c0)),await db['exec'](_0x371c54(0x1de));try{const _0x1e5217=await db['get'](_0x371c54(0x1cb));if(!_0x1e5217){const _0x51cc99=Math['floor'](Date['now']()/0x3e8);await db['run']('INSERT\x20INTO\x20delete_prefs\x20(key,\x20value,\x20updated_at)\x20VALUES\x20(\x27mode\x27,\x27p\x27,\x20?)',[_0x51cc99]),DELETE_MODE='p';}else'YrKCC'==='YrKCC'?DELETE_MODE=_0x1e5217[_0x371c54(0x21a)]==='g'?'g':'p':_0x5d8fb6('[Delete]\x20no\x20original\x20proto\x20or\x20saved\x20file\x20available\x20for\x20'+_0x49de68['sender']);}catch(_0x2d5836){warn(_0x31ee38['PtKZS']+(_0x2d5836?.['message']||_0x2d5836));}_0x31ee38['bdTEk'](info,'[Delete]\x20DB\x20table(s)\x20ensured.\x20mode='+DELETE_MODE);}async function streamMediaToFile(_0xd8ef40,_0x5baf01){const _0x223317=_0x46dfba,_0x5f4638={'AaDTJ':'XuKvH','mupqi':function(_0x3b1958,_0x151bf5){return _0x3b1958===_0x151bf5;}};try{if(_0x5f4638['AaDTJ']===_0x5f4638['AaDTJ']){const _0x35a4f6=_0xd8ef40[_0x223317(0x1e9)][_0x5baf01+'Message'],_0x3b3e61=await downloadContentFromMessage(_0x35a4f6,_0x5baf01);let _0x441f29='bin';if(_0x5baf01===_0x223317(0x1be))_0x441f29='jpg';else{if(_0x5baf01==='video')_0x441f29=_0x223317(0x1b1);else{if(_0x5baf01==='audio')_0x441f29='mp3';else{if(_0x5baf01==='document')_0x441f29=_0x35a4f6?.[_0x223317(0x1d2)]?_0x35a4f6['fileName']['split']('.')['pop']():'pdf';else{if(_0x5f4638['mupqi'](_0x5baf01,'sticker'))_0x441f29='webp';}}}}const _0x2327d0=_0xd8ef40[_0x223317(0x1e1)]['id']+'.'+_0x441f29,_0x580f64=_0x5c5d9a['join'](MEDIA_DIR,_0x2327d0);return await new Promise((_0x3fa38f,_0x4b8ce5)=>{const _0x1a9693=_0x12dead['createWriteStream'](_0x580f64);((async()=>{const _0x1c9777=_0x3741;if('YHAem'!=='GcVXj')try{for await(const _0x2ea2e2 of _0x3b3e61){if(!_0x1a9693['write'](_0x2ea2e2))await new Promise(_0x82da82=>_0x1a9693['once']('drain',_0x82da82));}_0x1a9693['end'](),_0x1a9693['once'](_0x1c9777(0x1fc),()=>_0x3fa38f());}catch(_0x3976fb){try{_0x1a9693['destroy']();}catch(_0x5cc032){}_0x4b8ce5(_0x3976fb);}else _0x448047&&(_0x3b4ee3(_0x214ead),_0x3c0fe4=null);})());}),_0x580f64;}else return _0x529e14;}catch(_0x2f6f92){return warn('[Delete]\x20streamMediaToFile\x20failed\x20for\x20'+(_0xd8ef40['key']?.['id']||'[no-id]')+':\x20'+(_0x2f6f92?.[_0x223317(0x1e9)]||_0x2f6f92)),null;}}async function maybeSaveMedia(_0x5bae64){const _0x4c3fec=_0x46dfba,_0x5874d7={'hsFHb':_0x4c3fec(0x1f8)};try{const _0x24340f=[_0x4c3fec(0x1be),_0x5874d7['hsFHb'],'audio','document','sticker'];for(const _0x5e5ac0 of _0x24340f){if(_0x5bae64[_0x4c3fec(0x1e9)]?.[_0x5e5ac0+_0x4c3fec(0x1d1)])return await streamMediaToFile(_0x5bae64,_0x5e5ac0);}return null;}catch(_0x518acf){return warn(_0x4c3fec(0x1d5)+(_0x518acf?.[_0x4c3fec(0x1e9)]||_0x518acf)),null;}}async function insertMessageToDB(_0x248ea3,_0x5478b8){const _0x8d1e68=_0x46dfba;try{const {id:_0x927c78,remoteJid:_0x896a25,participant:_0x8bbd2f}=_0x248ea3['key'],_0xa04b43=_0x8bbd2f||_0x896a25,_0x22d151=typeof _0x248ea3['messageTimestamp']==='number'?_0x248ea3['messageTimestamp']:_0x248ea3['messageTimestamp']?.['low']||Math['floor'](Date[_0x8d1e68(0x1ee)]()/0x3e8);await db['run']('INSERT\x20OR\x20REPLACE\x20INTO\x20messages\x20(msg_id,\x20chat_jid,\x20sender_jid,\x20message_json,\x20timestamp,\x20media_path)\x0a\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)',[_0x927c78,_0x896a25,_0xa04b43,JSON['stringify'](_0x248ea3),_0x22d151,_0x5478b8]);}catch(_0x3b015e){warn('[Delete]\x20insertMessageToDB\x20failed:\x20'+(_0x3b015e?.['message']||_0x3b015e));}}async function processMessageItem(_0x5d02be){try{if(!_0x5d02be||!_0x5d02be['message']||_0x5d02be['key']?.['fromMe'])return;const _0x3a1c21=await maybeSaveMedia(_0x5d02be);await insertMessageToDB(_0x5d02be,_0x3a1c21);}catch(_0x557b6b){warn('[Delete]\x20processMessageItem\x20error:\x20'+(_0x557b6b?.['message']||_0x557b6b));}}async function messageWorker(){const _0x26801b={'JLwrh':'[Delete]\x20messageWorker\x20item\x20error:\x20'},_0x5abb48=CONCURRENCY||FALLBACKS['DEFAULT_CONCURRENCY'];while(messageQueue['length']>0x0&&activeMessageTasks<_0x5abb48){const _0x965d2d=messageQueue['shift']();if(!_0x965d2d)break;activeMessageTasks++,((async()=>{try{await processMessageItem(_0x965d2d);}catch(_0xe178a8){warn(_0x26801b['JLwrh']+(_0xe178a8?.['message']||_0xe178a8));}finally{activeMessageTasks--,setImmediate(()=>{const _0x57540f=_0x3741;if(messageQueue[_0x57540f(0x1d4)]>0x0)messageWorker()['catch'](()=>{});});}})());}}async function fetchOriginalMessage(_0x265e24){const _0x37f9f0=_0x46dfba;try{const _0x145357=await db['get']('SELECT\x20message_json,\x20media_path\x20FROM\x20messages\x20WHERE\x20msg_id=?',[_0x265e24]);if(!_0x145357)return null;return{'message':JSON['parse'](_0x145357['message_json']),'media_path':_0x145357['media_path']};}catch(_0x5772db){return warn('[Delete]\x20fetchOriginalMessage\x20error:\x20'+(_0x5772db?.[_0x37f9f0(0x1e9)]||_0x5772db)),null;}}async function sendWithRetry(_0x5f1b0b,_0xc66b9a,_0x5a95b7=[]){const _0x42be10=_0x46dfba,_0x4056d3=Number(MAX_SEND_RETRIES||FALLBACKS[_0x42be10(0x1b0)]);let _0x5c7581=0x0,_0x5be12f=Number(INITIAL_BACKOFF||FALLBACKS['INITIAL_BACKOFF_MS']);while(_0x5c7581<_0x4056d3){try{const _0x2859c3=_0x5f1b0b||botRef?.['sock']?.['user']?.['id']||null;if(!_0x2859c3)throw new Error('no\x20send\x20target\x20available');return Array['isArray'](_0x5a95b7)&&_0x5a95b7['length']&&typeof _0xc66b9a===_0x42be10(0x20f)&&_0xc66b9a!==null&&(_0xc66b9a[_0x42be10(0x1e2)]=_0x5a95b7),await botRef['sendMessage'](_0x2859c3,_0xc66b9a),!![];}catch(_0x2bb1a2){_0x5c7581++;const _0x36eace=String(_0x2bb1a2?.['message']||'')['toLowerCase']()[_0x42be10(0x1c1)]('rate')||_0x2bb1a2?.['status']===0x1ad;warn('[Delete]\x20send\x20attempt\x20'+_0x5c7581+'\x20failed:\x20'+(_0x2bb1a2?.['message']||_0x2bb1a2));if(_0x5c7581>=_0x4056d3||!_0x36eace)return![];await sleep(_0x5be12f),_0x5be12f*=0x2;}}return![];}function extractContent(_0x252e2f){const _0x241907=_0x46dfba,_0x232192={'StnKV':'[Document]'};if(!_0x252e2f)return'[No\x20content]';if(_0x252e2f['conversation'])return _0x252e2f[_0x241907(0x1ed)];if(_0x252e2f[_0x241907(0x1e0)])return _0x252e2f['extendedTextMessage']['text'];if(_0x252e2f['imageMessage'])return _0x252e2f['imageMessage']['caption']||'[Image]';if(_0x252e2f[_0x241907(0x1b8)])return _0x252e2f['videoMessage']['caption']||'[Video]';if(_0x252e2f['ptvMessage']||_0x252e2f[_0x241907(0x1b8)]&&_0x252e2f['videoMessage'][_0x241907(0x1e3)])return _0x252e2f['videoMessage']?.['caption']||'[Video/GIF]';if(_0x252e2f['audioMessage'])return _0x252e2f['audioMessage']?.['ptt']?'[Voice\x20note]':_0x241907(0x207);if(_0x252e2f['documentMessage'])return _0x252e2f[_0x241907(0x20b)]['fileName']||_0x232192['StnKV'];if(_0x252e2f[_0x241907(0x1b4)])return _0x241907(0x1bd);if(_0x252e2f['pollCreationMessageV3'])return'[Poll:\x20'+(_0x252e2f['pollCreationMessageV3']['name']||'poll')+']';return'[Media]';}async function processDeletionItem(_0x84e7b3){const _0x173c05=_0x46dfba,_0x2a8024={'NokrY':function(_0x400533,_0xbd1123){return _0x400533(_0xbd1123);},'VQQcs':function(_0x3c1024,_0x93ba28){return _0x3c1024===_0x93ba28;}};try{const _0x25b7d5=_0x84e7b3[_0x173c05(0x1b3)]||[];if(!_0x25b7d5[_0x173c05(0x1d4)])return;for(const _0x12bee8 of _0x25b7d5){const _0x58bca6=await fetchOriginalMessage(_0x12bee8['id']);if(!_0x58bca6||!_0x58bca6['message'])continue;const _0xc13bc=_0x58bca6['message'],_0x5bd4b9=botRef?.[_0x173c05(0x1af)]?.[_0x173c05(0x214)]?.['id'],_0x5eb916=_0xc13bc['key']?.['participant']||_0xc13bc[_0x173c05(0x1e1)]?.[_0x173c05(0x1e7)];if(_0xc13bc['key']?.['fromMe']||_0x5eb916===_0x5bd4b9)continue;const _0x1c1469=_0xc13bc['key']['participant']||_0xc13bc['key'][_0x173c05(0x1e7)],_0x589055=_0x2a8024[_0x173c05(0x201)](extractContent,_0xc13bc[_0x173c05(0x1e9)]);let _0x53b3cd=nameCache['get'](_0x1c1469);if(!_0x53b3cd){try{if(_0x2a8024['VQQcs'](_0x173c05(0x204),'OIZUb')){const [_0x3a9106]=await botRef['sock']['onWhatsApp'](_0x1c1469);_0x53b3cd=_0x3a9106?.['notify']||'~'+_0x1c1469['split']('@')[0x0];}else _0x557fc8='[Unknown\x20Group]';}catch{_0x53b3cd='~'+_0x1c1469['split']('@')[0x0];}nameCache['set'](_0x1c1469,_0x53b3cd);}let _0x4dc764='';if(isJidGroup(_0xc13bc['key']['remoteJid']))try{_0x4dc764=(await botRef['sock']['groupMetadata'](_0xc13bc[_0x173c05(0x1e1)]['remoteJid']))['subject'];}catch{if('kYmam'==='oYlEq'){const _0x22f1a7=_0xc47408?.['sock']?.['user']?.['id']||null;if(_0x2aefff==='g'&&_0x55044f){if(_0x419063===_0x5a578f)return _0x22f1a7;return _0x5dd448;}return _0x22f1a7;}else _0x4dc764=_0x173c05(0x1cd);}deletionPush({'sender':_0x1c1469,'name':_0x53b3cd,'group':_0x4dc764,'content':_0x589055,'mediaPath':_0x58bca6['media_path']||null,'originalMessage':_0xc13bc});}}catch(_0x521e27){warn(_0x173c05(0x210)+(_0x521e27?.['message']||_0x521e27));}}async function deletionWorker(){const _0x476a1b=_0x46dfba,_0x3f0fdc={'ZlNwK':'[Delete]\x20deletionWorker\x20item\x20error:\x20'},_0x4e8ead=CONCURRENCY||FALLBACKS[_0x476a1b(0x20c)];while(deletionQueue['length']>0x0&&activeDeletionTasks<_0x4e8ead){const _0x4aae73=deletionQueue['shift']();if(!_0x4aae73)break;activeDeletionTasks++,((async()=>{try{await processDeletionItem(_0x4aae73);}catch(_0x2cd486){warn(_0x3f0fdc['ZlNwK']+(_0x2cd486?.['message']||_0x2cd486));}finally{activeDeletionTasks--,setImmediate(()=>{const _0xefc59c=_0x3741;if('PgcJD'==='svwKH')return _0x122d6f[_0xefc59c(0x1af)]['ev']['on']('messages.upsert',_0x1e2394),_0x15f507=!![],_0x3dd05b=_0x311f48['sock'],_0x3c7213('[Delete]\x20attached\x20to\x20sock.ev.messages.upsert'),!![];else{if(deletionQueue[_0xefc59c(0x1d4)]>0x0)deletionWorker()[_0xefc59c(0x1ce)](()=>{});}});}})());}}function deletionPush(_0x4f4f01){const _0x4b5739=_0x46dfba,_0x490e1e={'oxvOu':function(_0x167e41,_0x17cdb3){return _0x167e41(_0x17cdb3);},'psxCd':function(_0x1e4589,_0x267d6e,_0x1df67a){return _0x1e4589(_0x267d6e,_0x1df67a);}};pendingRecovered['push'](_0x4f4f01),clearTimeout(flushTimer),flushTimer=_0x490e1e['psxCd'](setTimeout,()=>{const _0x30ff7d=pendingRecovered['splice'](0x0,pendingRecovered['length']);((async()=>{try{await flushRecoveredBatch(_0x30ff7d);}catch(_0x5d2308){_0x490e1e['oxvOu'](warn,'[Delete]\x20flushRecoveredBatch\x20error:\x20'+(_0x5d2308?.['message']||_0x5d2308));}})());},DEBOUNCE_DELAY_MS||FALLBACKS[_0x4b5739(0x1da)]);}function resolveDeleteTarget(_0x15be79){const _0x5faa37=_0x46dfba,_0x39e180=botRef?.['sock']?.['user']?.['id']||null;if(DELETE_MODE==='g'&&DELETE_TARGET_JID){if('JZGBs'!=='JZGBs')return function(_0x3b839d){}['constructor'](_0x5faa37(0x1d6))['apply']('counter');else{if(DELETE_TARGET_JID===_0x15be79)return _0x39e180;return DELETE_TARGET_JID;}}return _0x39e180;}async function saveDeleteMode(_0x626a23){const _0x577551=_0x46dfba;try{const _0x29d218=_0x626a23==='g'?'g':'p',_0x373093=Math[_0x577551(0x209)](Date['now']()/0x3e8);return await db['run'](_0x577551(0x1f3),[_0x29d218,_0x373093]),DELETE_MODE=_0x29d218,info(_0x577551(0x1c2)+DELETE_MODE),!![];}catch(_0x18c333){return warn('[Delete]\x20saveDeleteMode\x20failed:\x20'+(_0x18c333?.['message']||_0x18c333)),![];}}async function flushRecoveredBatch(_0x55bd37){const _0x385101=_0x46dfba,_0x467763={'oIFsY':function(_0x5889f6){return _0x5889f6();},'jJCEb':function(_0x3f1279,_0x4d0e5c){return _0x3f1279(_0x4d0e5c);},'kgGcf':function(_0x4f6ad5,_0x4383c4){return _0x4f6ad5===_0x4383c4;},'GNIGJ':function(_0x27dfe6,_0x579c55){return _0x27dfe6!==_0x579c55;},'ZymxW':_0x385101(0x1ea),'qHtZs':_0x385101(0x1f1),'AUIIB':'[Delete]\x20forwarded\x20original\x20message\x20for\x20','PSrZD':function(_0x47deb0,_0x2ea257){return _0x47deb0===_0x2ea257;},'LwvdK':_0x385101(0x1f9)};if(!_0x55bd37||_0x467763['kgGcf'](_0x55bd37['length'],0x0))return;if(!DEFAULT_SEND_DELETE){if(_0x467763['GNIGJ']('RyNKQ',_0x467763['ZymxW'])){info(_0x467763['qHtZs']);return;}else _0x2dc5f8('[Delete]\x20cleanup\x20error:\x20'+(_0x45bb8e?.['message']||_0xa1ff4e));}const _0x3a4261=_0x55bd37['find'](_0x74a07e=>_0x74a07e['originalMessage'])?.[_0x385101(0x20d)]?.[_0x385101(0x1e1)]?.['remoteJid']||null,_0x2f8e3a=resolveDeleteTarget(_0x3a4261)||botRef?.['sock']?.['user']?.['id']||null;if(!_0x2f8e3a){warn(_0x385101(0x1d9));return;}const _0x581cae=[...new Set(_0x55bd37['map'](_0x1dda61=>_0x1dda61['sender']))],_0x4d5980=_0x55bd37['map'](_0x31250e=>_0x385101(0x1e8)+_0x31250e['sender']['split']('@')[0x0]+'\x20('+_0x31250e['name']+')\x0a'+(_0x31250e['group']?'ðŸ—¨\x20Group:\x20'+_0x31250e['group']+'\x0a':'')+('ðŸ“\x20Content:\x20'+_0x31250e[_0x385101(0x216)]+'\x0a')+'â”€'['repeat'](0x1e))['join']('\x0a'),_0x3d1953='ðŸ—‘\x20*'+_0x55bd37[_0x385101(0x1d4)]+_0x385101(0x208);try{const _0x404fba=await sendWithRetry(_0x2f8e3a,{'text':_0x3d1953+_0x4d5980},_0x581cae);if(!_0x404fba)warn('[Delete]\x20summary\x20send\x20may\x20have\x20failed\x20completely');}catch(_0x9f1626){warn('[Delete]\x20summary\x20send\x20unexpected\x20error:\x20'+(_0x9f1626?.['message']||_0x9f1626));}for(const _0xc202ef of _0x55bd37){if(_0xc202ef[_0x385101(0x20d)])try{const _0x5190dc={'forward':_0xc202ef[_0x385101(0x20d)]},_0x538dd5=await sendWithRetry(_0x2f8e3a,_0x5190dc);if(_0x538dd5){if('CjSDw'==='XOImc')_0x1ad89d(),_0x475912(),_0x34e58b(),_0x467763['oIFsY'](_0x179281),_0x467763['jJCEb'](_0x3a6c45,'[Delete]\x20initialized\x20(non-blocking\x20mode).');else{info(_0x467763['AUIIB']+_0xc202ef['sender']),await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS['MEDIA_SEND_DELAY_MS']);continue;}}else warn('[Delete]\x20forward\x20attempt\x20failed\x20â€”\x20falling\x20back\x20to\x20file\x20send:\x20'+(_0xc202ef[_0x385101(0x211)]||_0xc202ef['sender']));}catch(_0x2dab16){warn('[Delete]\x20forward\x20unexpected\x20error:\x20'+(_0x2dab16?.[_0x385101(0x1e9)]||_0x2dab16));}if(_0xc202ef[_0x385101(0x211)])try{if(_0x467763['PSrZD']('nEdbu','iIZms'))return _0x23ce7a('[Delete]\x20maybeSaveMedia\x20error:\x20'+(_0x3a7169?.['message']||_0x10c3f3)),null;else{const _0x317cfe=_0x5c5d9a['extname'](_0xc202ef['mediaPath'])[_0x385101(0x1b7)](0x1)['toLowerCase']();let _0x7fb129;if(['jpg','jpeg',_0x385101(0x1bb),'webp']['includes'](_0x317cfe))_0x7fb129={'image':{'url':_0xc202ef['mediaPath']},'caption':_0xc202ef['content']||undefined};else{if(['mp4','mkv']['includes'](_0x317cfe))_0x7fb129={'video':{'url':_0xc202ef[_0x385101(0x211)]},'caption':_0xc202ef[_0x385101(0x216)]||undefined};else{if(['mp3','ogg','m4a']['includes'](_0x317cfe))_0x7fb129={'audio':{'url':_0xc202ef['mediaPath']}};else _0x7fb129={'document':{'url':_0xc202ef['mediaPath']},'caption':_0xc202ef['content']||undefined};}}const _0x4c3ce2=await sendWithRetry(_0x2f8e3a,_0x7fb129);if(!_0x4c3ce2)warn('[Delete]\x20fallback\x20send\x20failed\x20for\x20'+_0xc202ef['mediaPath']);await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS[_0x385101(0x1d8)]);}}catch(_0x5167cd){'iBMdX'!=='iBMdX'?_0x373010['sock']['ev'][_0x385101(0x1b2)]?.('connection.update',_0x296131):warn('[Delete]\x20forward\x20media\x20fallback\x20error:\x20'+(_0x5167cd?.['message']||_0x5167cd));}else'CyGnS'!==_0x467763['LwvdK']?_0x48659(_0x287281,'[Delete]\x20onMessage\x20error:\x20'+(_0x2dd7ac?.['message']||_0xf09862)):warn('[Delete]\x20no\x20original\x20proto\x20or\x20saved\x20file\x20available\x20for\x20'+_0xc202ef['sender']);}}async function rawMessagesUpsertHandler({messages:_0x527d86}){const _0x297a39=_0x46dfba,_0x14ae33={'UqOZb':'function','ZlGvj':function(_0x246869,_0x5083a8){return _0x246869>_0x5083a8;},'CvjfY':'REVOKE'};try{if('flyhB'!=='flyhB'){if(_0x463bf6&&typeof _0x212216['sock']['ev']['off']===_0x14ae33['UqOZb'])_0x1c6e9e['sock']['ev'][_0x297a39(0x1b2)]('messages.upsert',_0x2a1a83);if(_0x128db3&&typeof _0xd6d88['sock']['ev']['removeListener']==='function')_0x3cabcd['sock']['ev'][_0x297a39(0x1f6)]('messages.upsert',_0x4965f5);}else{if(!_0x527d86||!Array['isArray'](_0x527d86))return;for(const _0x1a0460 of _0x527d86){if(!_0x1a0460||!_0x1a0460['message']||_0x1a0460['key']?.['remoteJid']==='status@broadcast')continue;if(_0x1a0460[_0x297a39(0x1e1)]?.['fromMe'])continue;messageQueue['push'](_0x1a0460),setImmediate(()=>{messageWorker()['catch'](()=>{});});const _0x21a312=_0x1a0460[_0x297a39(0x1e9)]?.[_0x297a39(0x206)];if(_0x21a312?.['type']===0x0&&_0x21a312?.['key'])deletionQueue['push']({'keys':[_0x21a312['key']],'remoteJid':_0x1a0460[_0x297a39(0x1e1)][_0x297a39(0x1e7)]}),setImmediate(()=>{deletionWorker()['catch'](()=>{});});else{if(_0x1a0460['messageStubType']===0x4&&Array['isArray'](_0x1a0460['messageStubParameters'])&&_0x1a0460['messageStubParameters'][0x0]===_0x14ae33['CvjfY']){const _0xc7ea1e=[];for(let _0x58b3a0=0x1;_0x58b3a0<_0x1a0460['messageStubParameters']['length'];_0x58b3a0++)_0xc7ea1e['push']({'id':_0x1a0460['messageStubParameters'][_0x58b3a0],'remoteJid':_0x1a0460['key']['remoteJid']});_0xc7ea1e['length']&&(deletionQueue['push']({'keys':_0xc7ea1e,'remoteJid':_0x1a0460['key'][_0x297a39(0x1e7)]}),setImmediate(()=>{const _0x2e2b6e=_0x297a39,_0x4811e2={'EpzFo':function(_0x19e23c,_0x4c0d9e){return _0x14ae33['ZlGvj'](_0x19e23c,_0x4c0d9e);}};if('ZFwST'!==_0x2e2b6e(0x1dd)){if(_0x4811e2['EpzFo'](_0x12abdd['length'],0x0))_0x25c51f()['catch'](()=>{});}else deletionWorker()['catch'](()=>{});}));}}}}}catch(_0x43d915){warn('[Delete]\x20rawMessagesUpsertHandler\x20encountered\x20error:\x20'+(_0x43d915?.['message']||_0x43d915));}}function attachSockListener(){const _0x52bc09=_0x46dfba,_0x171285={'PdZNN':_0x52bc09(0x1f5),'Xinjv':function(_0x1d27a7,_0x2681b2){return _0x1d27a7(_0x2681b2);}};try{if(!botRef||!botRef['sock']||!botRef['sock']['ev'])return![];try{if(sockListener&&typeof botRef['sock']['ev']['off']==='function')botRef['sock']['ev']['off'](_0x52bc09(0x1e4),sockListener);if(sockListener&&typeof botRef['sock']['ev'][_0x52bc09(0x1f6)]===_0x171285['PdZNN'])botRef['sock']['ev'][_0x52bc09(0x1f6)]('messages.upsert',sockListener);}catch(_0x348d30){}sockListener=rawMessagesUpsertHandler;if(typeof botRef['sock']['ev']['on']==='function')return botRef['sock']['ev']['on']('messages.upsert',sockListener),attached=!![],lastSockIdentity=botRef[_0x52bc09(0x1af)],info(_0x52bc09(0x1ba)),!![];else{if('AXNQm'!=='AXNQm'){_0x46b71b('[Delete]\x20detected\x20botRef.sock\x20change\x20-\x20re-attaching\x20listener');try{_0xcdb1e4();}catch(_0x39a376){}_0xadcb0c();}else return _0x171285['Xinjv'](warn,'[Delete]\x20botRef.sock.ev\x20does\x20not\x20support\x20.on'),![];}}catch(_0x3bf9eb){return warn('[Delete]\x20attachSockListener\x20failed:\x20'+(_0x3bf9eb?.['message']||_0x3bf9eb)),attached=![],sockListener=null,![];}}function _0x3741(_0x2d8fc4,_0x282a60){const _0x2b508c=_0x3515();return _0x3741=function(_0x36316a,_0x1842bd){_0x36316a=_0x36316a-0x1af;let _0x372f8c=_0x2b508c[_0x36316a];if(_0x3741['trMfqF']===undefined){var _0xffe300=function(_0x31849b){const _0x3b9842='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x272ad1='',_0x475e85='';for(let _0x3c9e4e=0x0,_0x230450,_0xdb05e3,_0x22e290=0x0;_0xdb05e3=_0x31849b['charAt'](_0x22e290++);~_0xdb05e3&&(_0x230450=_0x3c9e4e%0x4?_0x230450*0x40+_0xdb05e3:_0xdb05e3,_0x3c9e4e++%0x4)?_0x272ad1+=String['fromCharCode'](0xff&_0x230450>>(-0x2*_0x3c9e4e&0x6)):0x0){_0xdb05e3=_0x3b9842['indexOf'](_0xdb05e3);}for(let _0x2d390c=0x0,_0x3a2c48=_0x272ad1['length'];_0x2d390c<_0x3a2c48;_0x2d390c++){_0x475e85+='%'+('00'+_0x272ad1['charCodeAt'](_0x2d390c)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x475e85);};_0x3741['rOdXOy']=_0xffe300,_0x2d8fc4=arguments,_0x3741['trMfqF']=!![];}const _0x3515f3=_0x2b508c[0x0],_0x3741cb=_0x36316a+_0x3515f3,_0x57ffae=_0x2d8fc4[_0x3741cb];return!_0x57ffae?(_0x372f8c=_0x3741['rOdXOy'](_0x372f8c),_0x2d8fc4[_0x3741cb]=_0x372f8c):_0x372f8c=_0x57ffae,_0x372f8c;},_0x3741(_0x2d8fc4,_0x282a60);}function detachSockListener(){const _0x5cbaf1=_0x46dfba,_0xbd7edc={'NNxGn':'KlQhG'};try{if(!sockListener)return;if(botRef&&botRef['sock']&&botRef['sock']['ev'])try{botRef['sock']['ev']['off']?.(_0x5cbaf1(0x1e4),sockListener);}catch(_0x570f2b){try{botRef['sock']['ev'][_0x5cbaf1(0x1f6)]?.('messages.upsert',sockListener);}catch(_0xa79b15){}}}catch(_0x5e41b5){if(_0xbd7edc['NNxGn']==='AAniQ'){if(_0x399da1){const _0x47d2b5=_0x2c31b3['apply'](_0x2306c6,arguments);return _0x4b902f=null,_0x47d2b5;}}else warn('[Delete]\x20detachSockListener\x20error:\x20'+(_0x5e41b5?.['message']||_0x5e41b5));}finally{attached=![],sockListener=null,lastSockIdentity=null,info('[Delete]\x20detached\x20listener\x20if\x20present');}}function startAttachWatcher(){const _0x36c732={'dhAaE':function(_0x1a6f3f,_0x362f03){return _0x1a6f3f&&_0x362f03;}};stopAttachWatcher(),attachWatcherInterval=setInterval(()=>{try{if(!botRef)return;if(_0x36c732['dhAaE'](!attached,botRef)&&botRef['sock']&&botRef['sock']['ev'])attachSockListener();}catch(_0xac0032){warn('[Delete]\x20attach\x20watcher\x20error:\x20'+(_0xac0032?.['message']||_0xac0032));}},ATTACH_WATCHER_MS||FALLBACKS['ATTACH_WATCHER_MS']);}function stopAttachWatcher(){attachWatcherInterval&&(clearInterval(attachWatcherInterval),attachWatcherInterval=null);}function startSockMonitor(){const _0x26ea81={'QrgQP':function(_0x107b90,_0x14020c){return _0x107b90(_0x14020c);},'jhufX':function(_0x595007){return _0x595007();},'uuwtK':function(_0x5c04db,_0x20bea2){return _0x5c04db(_0x20bea2);}};stopSockMonitor(),sockMonitorInterval=setInterval(()=>{const _0x1f075c=_0x3741;try{if(!botRef)return;const _0x1b1136=botRef[_0x1f075c(0x1af)]||null;if(_0x1b1136&&lastSockIdentity&&_0x1b1136!==lastSockIdentity){_0x26ea81['QrgQP'](info,_0x1f075c(0x1c5));try{detachSockListener();}catch(_0x5e67da){}_0x26ea81['jhufX'](attachSockListener);}else!lastSockIdentity&&_0x1b1136&&attachSockListener();}catch(_0x528ab6){_0x26ea81['uuwtK'](warn,'[Delete]\x20sock\x20monitor\x20error:\x20'+(_0x528ab6?.['message']||_0x528ab6));}},SOCK_MONITOR_MS||FALLBACKS['SOCK_MONITOR_MS']);}function stopSockMonitor(){sockMonitorInterval&&(clearInterval(sockMonitorInterval),sockMonitorInterval=null);}function startConnectionUpdateHook(){const _0x24b01a=_0x46dfba;if(!botRef||!botRef['sock']||!botRef[_0x24b01a(0x1af)]['ev'])return;if(connectionUpdateHandler)return;connectionUpdateHandler=_0x901cac=>{const _0x28dfb4=_0x24b01a;try{setTimeout(()=>{try{info('[Delete]\x20connection.update\x20observed\x20-\x20ensuring\x20listener\x20attached'),attachSockListener();}catch(_0x589da6){}},0x1f4);}catch(_0x5dbb40){warn(_0x28dfb4(0x1db)+(_0x5dbb40?.['message']||_0x5dbb40));}};try{botRef['sock']['ev']['on']?.(_0x24b01a(0x1df),connectionUpdateHandler);}catch(_0x485bea){warn('[Delete]\x20failed\x20to\x20hook\x20connection.update:\x20'+(_0x485bea?.['message']||_0x485bea));}}function stopConnectionUpdateHook(){const _0x1885d2=_0x46dfba;try{if('nuQrx'!=='nuQrx')_0x5ed572&&(_0xe722a8(_0x3032b2),_0x1eeb94=null);else{if(connectionUpdateHandler&&botRef&&botRef['sock']&&botRef['sock']['ev'])try{botRef['sock']['ev'][_0x1885d2(0x1b2)]?.('connection.update',connectionUpdateHandler);}catch(_0x5e11c9){try{botRef['sock']['ev']['removeListener']?.('connection.update',connectionUpdateHandler);}catch(_0x2a9585){}}}}catch(_0x301737){}connectionUpdateHandler=null;}export async function initialize(_0x3df2df){const _0x20431e=_0x46dfba,_0x2b3311={'FWYgY':function(_0x373b22,_0x241368){return _0x373b22(_0x241368);}};if(!_0x3df2df)throw new Error('delete\x20module\x20requires\x20bot\x20argument\x20in\x20initialize(bot)');botRef=_0x3df2df,refreshConfig();try{await ensureTable();}catch(_0x5b79a3){_0x2b3311[_0x20431e(0x217)](error,_0x20431e(0x1d7)+(_0x5b79a3?.['message']||_0x5b79a3));throw _0x5b79a3;}try{attachSockListener(),startConnectionUpdateHook(),startAttachWatcher(),startSockMonitor(),info('[Delete]\x20initialized\x20(non-blocking\x20mode).');}catch(_0x3ad699){error('[Delete]\x20failed\x20to\x20attach\x20listener\x20(will\x20keep\x20watching):\x20'+(_0x3ad699?.['message']||_0x3ad699));}try{if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(async()=>{try{await autoCleanOldMessagesSafe();}catch(_0x22afa4){warn('[Delete]\x20periodic\x20cleanup\x20error:\x20'+(_0x22afa4?.['message']||_0x22afa4));}},CLEANUP_INTERVAL||FALLBACKS[_0x20431e(0x20e)]);}catch(_0xa74fa2){warn('[Delete]\x20setting\x20cleanup\x20interval\x20failed:\x20'+(_0xa74fa2?.[_0x20431e(0x1e9)]||_0xa74fa2));}}async function autoCleanOldMessagesSafe(){try{await autoCleanOldMessages();}catch(_0x3a0565){warn('[Delete]\x20autoCleanOldMessagesSafe\x20error:\x20'+(_0x3a0565?.['message']||_0x3a0565));}}async function autoCleanOldMessages(){const _0x441821=_0x46dfba,_0x5e1cdd={'RNHfA':function(_0x2e21f2,_0x39568e){return _0x2e21f2(_0x39568e);}};try{const _0x583c51=0x7*0x18*0x3c*0x3c,_0x538972=Math['floor'](Date['now']()/0x3e8)-_0x583c51,_0x191b2f=await db[_0x441821(0x1c3)]('SELECT\x20msg_id,\x20media_path\x20FROM\x20messages\x20WHERE\x20timestamp\x20<\x20?',[_0x538972]);if(!_0x191b2f||_0x191b2f['length']===0x0)return;info('[Delete]\x20cleaning\x20'+_0x191b2f['length']+'\x20old\x20messages');const _0x3b476c=_0x191b2f[_0x441821(0x1f7)](_0x567163=>_0x567163['msg_id']);for(const _0x1e6187 of _0x191b2f){if(_0x1e6187[_0x441821(0x1dc)])try{await _0x8eaf00(_0x1e6187['media_path']);}catch(_0x4d0850){_0x5e1cdd['RNHfA'](warn,_0x441821(0x1eb)+_0x1e6187['media_path']+':\x20'+(_0x4d0850?.['message']||_0x4d0850));}}const _0x28125f=0xc8;for(let _0x3fcb00=0x0;_0x3fcb00<_0x3b476c['length'];_0x3fcb00+=_0x28125f){const _0x3f33ae=_0x3b476c['slice'](_0x3fcb00,_0x3fcb00+_0x28125f),_0x3ad979=_0x3f33ae['map'](()=>'?')['join'](',');await db['run'](_0x441821(0x1fb)+_0x3ad979+')',_0x3f33ae);}info(_0x441821(0x205));}catch(_0x119d4a){error(_0x119d4a,'[Delete]\x20autoCleanOldMessages\x20failed');}}export async function cleanup(){const _0x5e5282=_0x46dfba;try{detachSockListener(),stopAttachWatcher(),stopSockMonitor(),stopConnectionUpdateHook(),cleanupInterval&&('pwYsI'!==_0x5e5282(0x1fd)?_0x15f933('[Delete]\x20sock\x20monitor\x20error:\x20'+(_0x1b3bc3?.['message']||_0x41f7a2)):(clearInterval(cleanupInterval),cleanupInterval=null,info('[Delete]\x20stopped\x20cleanup\x20interval.'))),messageQueue['length']=0x0,deletionQueue['length']=0x0,pendingRecovered['length']=0x0;}catch(_0x5528d6){warn('[Delete]\x20cleanup\x20error:\x20'+(_0x5528d6?.['message']||_0x5528d6));}finally{botRef=null;}}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=0x1e*0x3e8;function markCmdProcessed(_0x48ed5e){if(!_0x48ed5e)return;if(processedCmdKeys['has'](_0x48ed5e))try{clearTimeout(processedCmdKeys['get'](_0x48ed5e));}catch(_0x3f5c84){}const _0x4007f7=setTimeout(()=>processedCmdKeys['delete'](_0x48ed5e),CMD_DEDUPE_TTL_MS);processedCmdKeys['set'](_0x48ed5e,_0x4007f7);}function isCmdProcessed(_0x5cd491){return _0x5cd491&&processedCmdKeys['has'](_0x5cd491);}export async function onMessage(_0x390dfe){const _0x24864e=_0x46dfba,_0xeb5585={'bhnXJ':function(_0x11b5fa,_0x53f5c4){return _0x11b5fa(_0x53f5c4);}};try{if(!_0x390dfe||!_0x390dfe['key']||!_0x390dfe['message'])return;const _0x50f4ac=String(_0x390dfe['key']['remoteJid']||'')+'::'+String(_0x390dfe['key']['id']||_0x390dfe['key'][_0x24864e(0x1c8)]||'');if(isCmdProcessed(_0x50f4ac))return;_0xeb5585['bhnXJ'](markCmdProcessed,_0x50f4ac);if(!_0x390dfe['isCommand'])return;const _0x139f79=typeof _0x390dfe[_0x24864e(0x1bf)]==='string'&&_0x390dfe['text']['trim']()['length']?_0x390dfe['text']['trim']():function _0x1eddb8(_0x34a35b){const _0x526f7f=_0x24864e;if(!_0x34a35b||!_0x34a35b['message'])return'';const _0x324c4e=_0x34a35b['message'];if(_0x324c4e['conversation'])return _0x324c4e['conversation'];if(_0x324c4e['extendedTextMessage']?.[_0x526f7f(0x1bf)])return _0x324c4e['extendedTextMessage']['text'];if(_0x324c4e['imageMessage']?.[_0x526f7f(0x1ca)])return _0x324c4e['imageMessage']['caption'];if(_0x324c4e['videoMessage']?.[_0x526f7f(0x1ca)])return _0x324c4e['videoMessage']['caption'];if(_0x324c4e['buttonsResponseMessage']?.[_0x526f7f(0x1f4)])return _0x324c4e['buttonsResponseMessage']['selectedButtonId'];if(_0x324c4e[_0x526f7f(0x1b5)]?.[_0x526f7f(0x1ec)]?.['selectedRowId'])return _0x324c4e['listResponseMessage']['singleSelectReply']['selectedRowId'];return'';}(_0x390dfe)||'';if(!_0x139f79)return;const _0x5e64e1=(_0x139f79['split'](/\s+/)[0x0]||'')['toLowerCase']();if(!commands[_0x24864e(0x1c1)](_0x5e64e1))return;const _0x5858a1=_0x390dfe['key']['remoteJid'],_0xa181e5=typeof _0x5858a1==='string'&&_0x5858a1['endsWith']('@g.us');if(!_0xa181e5)return;let _0x6eddfd=![];try{'vaKPb'!==_0x24864e(0x1e5)?_0x36d661['sock']['ev']['off']?.('messages.upsert',_0x101520):_0x6eddfd=await isadmin(botRef,_0x390dfe);}catch(_0x253925){warn('[Delete]\x20isadmin\x20check\x20failed'),_0x6eddfd=![];}if(!_0x6eddfd)return;const _0x20528e=_0x5858a1,_0x49df30=(_0x139f79[_0x24864e(0x1e6)](/\r?\n/)[0x0]||'')['trim'](),_0x1a0cb4=_0x49df30['split'](/\s+/),_0x236e02=_0x1a0cb4[_0x24864e(0x1d4)]>=0x2?_0x1a0cb4[0x1]['toLowerCase']():'';if(_0x236e02==='p'||_0x236e02==='pm'){await saveDeleteMode('p'),await sendWithRetry(_0x20528e,{'text':'[delete]\x20Mode\x20set\x20to\x20PM.\x20Recovered\x20deleted\x20messages\x20will\x20be\x20forwarded\x20to\x20bot\x20PM.'});return;}if(_0x236e02==='g'||_0x236e02==='group'||_0x236e02==='gp'){await saveDeleteMode('g');const _0x424e65=DELETE_TARGET_JID?'Configured\x20group:\x20'+DELETE_TARGET_JID:'No\x20DELETE_TARGET_JID\x20set;\x20will\x20send\x20to\x20bot\x20PM\x20until\x20configured.';await sendWithRetry(_0x20528e,{'text':_0x24864e(0x215)+_0x424e65});return;}const _0x2a109d=DELETE_MODE==='g'?_0x24864e(0x1bc)+(DELETE_TARGET_JID||'not\x20set')+')':'PM';await sendWithRetry(_0x20528e,{'text':'Usage:\x0a\x20delete\x20p\x20\x20\x20->\x20send\x20recovered\x20deleted\x20messages\x20to\x20bot\x20PM\x20(default)\x0a\x20delete\x20g\x20\x20\x20->\x20send\x20recovered\x20deleted\x20messages\x20to\x20configured\x20group\x20(DELETE_TARGET_JID)\x0a\x0aCurrent:\x20'+_0x2a109d});}catch(_0x361533){error(_0x361533,'[Delete]\x20onMessage\x20error:\x20'+(_0x361533?.[_0x24864e(0x1e9)]||_0x361533));}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x36316a(_0x38d53c){const _0x143e42={'sDrCx':'action','JccgO':'debu'};function _0xe7ddb1(_0x112f45){const _0xaca47c=_0x3741;if(typeof _0x112f45==='string')return function(_0x1df314){}['constructor']('while\x20(true)\x20{}')['apply']('counter');else(''+_0x112f45/_0x112f45)['length']!==0x1||_0x112f45%0x14===0x0?function(){return!![];}[_0xaca47c(0x1d0)]('debu'+'gger')['call'](_0x143e42['sDrCx']):function(){return![];}[_0xaca47c(0x1d0)](_0x143e42[_0xaca47c(0x1ef)]+'gger')['apply'](_0xaca47c(0x1c9));_0xe7ddb1(++_0x112f45);}try{if(_0x38d53c)return _0xe7ddb1;else _0xe7ddb1(0x0);}catch(_0x44c2b2){}}