const _0x326fa6=_0x3ec4;(function(_0xbde6ff,_0x5cc33e){const _0x51fc37=_0x3ec4,_0x470e83=_0xbde6ff();while(!![]){try{const _0x137be1=-parseInt(_0x51fc37(0x1fa))/0x1+-parseInt(_0x51fc37(0x1a1))/0x2+parseInt(_0x51fc37(0x1c8))/0x3*(-parseInt(_0x51fc37(0x1a3))/0x4)+parseInt(_0x51fc37(0x1b5))/0x5*(-parseInt(_0x51fc37(0x224))/0x6)+parseInt(_0x51fc37(0x1ab))/0x7*(-parseInt(_0x51fc37(0x207))/0x8)+-parseInt(_0x51fc37(0x1cf))/0x9+parseInt(_0x51fc37(0x21b))/0xa;if(_0x137be1===_0x5cc33e)break;else _0x470e83['push'](_0x470e83['shift']());}catch(_0x187b74){_0x470e83['push'](_0x470e83['shift']());}}}(_0x4380,0x2050a));const _0x5757da=(function(){let _0x24cbff=!![];return function(_0x27d673,_0x55c8ac){const _0x134b79=_0x3ec4;if(_0x134b79(0x212)!=='VWyWd'){const _0x466707=_0x24cbff?function(){if(_0x55c8ac){const _0x41bf5b=_0x55c8ac['apply'](_0x27d673,arguments);return _0x55c8ac=null,_0x41bf5b;}}:function(){};return _0x24cbff=![],_0x466707;}else _0x472149('[lock]\x20isadmin\x20check\x20failed'),_0x3bdec0=![];};}());(function(){const _0x594a9b={'aAXhO':'\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','cetkF':function(_0x2d7a44,_0x417fd6){return _0x2d7a44+_0x417fd6;}};_0x5757da(this,function(){const _0x12c042=_0x3ec4,_0xd969ad=new RegExp(_0x12c042(0x19f)),_0x59e800=new RegExp(_0x594a9b[_0x12c042(0x225)],'i'),_0x4850bb=_0x11e1ae('init');!_0xd969ad['test'](_0x594a9b['cetkF'](_0x4850bb,_0x12c042(0x1b0)))||!_0x59e800[_0x12c042(0x20c)](_0x4850bb+'input')?_0x4850bb('0'):_0x11e1ae();})();}());import{getConfig}from'../utils/config.js';(function(){const _0x1e599d=_0x3ec4,_0x2db125={'EwrpR':function(_0x24eca4,_0x201127){return _0x24eca4(_0x201127);},'ZbltO':'GjkcB'};let _0x16b1f7;try{if(_0x2db125['ZbltO']!==_0x1e599d(0x219)){const _0x1bcd84=_0x2db125['EwrpR'](_0x337c7b,_0x58530c(_0x386c5f(_0x46346e['phrase']||'')));_0x1bcd84['test'](_0x2e49f5)&&(_0x5640a4['add'](_0x147614['id']),_0x21d4da[_0x1e599d(0x1ee)](_0x4d2ca7['phrase']));}else{const _0x517819=Function(_0x1e599d(0x1e0)+_0x1e599d(0x1f5)+');');_0x16b1f7=_0x517819();}}catch(_0x3beae9){if('WEqzj'!==_0x1e599d(0x1af)){const _0xc53872=_0x2822bc(_0x197c72(_0x5e5b83(_0x1ac016['phrase']||'')));_0xc53872['test'](_0x46fbbc)&&(_0x1ad6ea['add'](_0x41709f['id']),_0x304c4a['add'](_0x1219d4['phrase']));}else _0x16b1f7=window;}_0x16b1f7['setInterval'](_0x11e1ae,0x61a80);}());import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{getDefault,getConnection}from'../utils/connection.js';function _0x3ec4(_0x3a46e4,_0x5d3402){const _0x3825e8=_0x4380();return _0x3ec4=function(_0x11e1ae,_0x5757da){_0x11e1ae=_0x11e1ae-0x19f;let _0x55daa9=_0x3825e8[_0x11e1ae];if(_0x3ec4['KBPhFp']===undefined){var _0x277099=function(_0xd067b){const _0x4cdc29='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2e576c='',_0x2ebbce='';for(let _0x5799be=0x0,_0x339c48,_0x21140f,_0x49460e=0x0;_0x21140f=_0xd067b['charAt'](_0x49460e++);~_0x21140f&&(_0x339c48=_0x5799be%0x4?_0x339c48*0x40+_0x21140f:_0x21140f,_0x5799be++%0x4)?_0x2e576c+=String['fromCharCode'](0xff&_0x339c48>>(-0x2*_0x5799be&0x6)):0x0){_0x21140f=_0x4cdc29['indexOf'](_0x21140f);}for(let _0x1cd067=0x0,_0xdc0798=_0x2e576c['length'];_0x1cd067<_0xdc0798;_0x1cd067++){_0x2ebbce+='%'+('00'+_0x2e576c['charCodeAt'](_0x1cd067)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2ebbce);};_0x3ec4['KaThNa']=_0x277099,_0x3a46e4=arguments,_0x3ec4['KBPhFp']=!![];}const _0x438046=_0x3825e8[0x0],_0x3ec464=_0x11e1ae+_0x438046,_0x43fd66=_0x3a46e4[_0x3ec464];return!_0x43fd66?(_0x55daa9=_0x3ec4['KaThNa'](_0x55daa9),_0x3a46e4[_0x3ec464]=_0x55daa9):_0x55daa9=_0x43fd66,_0x55daa9;},_0x3ec4(_0x3a46e4,_0x5d3402);}function _0x4380(){const _0x39d4fb=['w2XVy2TDignYzwf0zwqGBg9JA3mGDgfIBguGkgnHBM9UAwnHBcK','vevyvcberuzbvuXuicDUB3jTywWN','zMXWC2C','zgvSzxrL','DhLWzq','mJGYnevqq2DYqW','BMv4Da','iJOG','BwfW','quXurviGvefcteuGBg9JA3mGqureienptfvntIbPC192ywXPzf9YzwDLEcbjtLrfr0vsierfrKfvtfqGmtS','DgvZDa','ieaG','CgHYyxnL','cIaGicaGicaGq1jfqvrfifrbqKXfigXVy2TZicGkicaGicaGicaGia','w2XVy2TDihrHyMXLrxHPC3rZigvYCM9YoIa','C2XPy2u','y0HVtMO','Aw5JBhvKzxm','y3jLyxrVCG','CMvNzxG','BMfTzq','y2fWDgLVBG','whfXBuG','r2PRy0i','q1jfqvrfifvosvfvrsbjtKrfwcbjrIbot1qGrvHju1rtigLKEf9SB2nRC191BMLXDwuGt04GBg9JA3mOy2HHDf9QAwqSihbOCMfZzsK7','odiZntGWmfrcAMXNDW','CgfYDgLJAxbHBNq','qKfuq0HFu0LArq','t1vpv1y','tNLtDwq','CMHnuLi','BM9Kzxm','zNfVBvC','Dgv4Da','mtj5Cxfttgu','yufyAe8','zNvUy3rPB24GkLWOicPCkq','sgPNwgG','mtG1nJG4su1Xv0nb','z2v0','mtu3mJrgsvzuCu0','tKzlqW','tM90AwnLoIaNz3aNihbHCMfTzxrLCIbPBIbJB21Tyw5KigLZigLNBM9YzwqUieXVy2TZihDPBgWGyMuGC2f2zwqGDg8GEw91CIbKzwzHDwX0ignVBM5Ly3rPB246ia','s3DlAxq','BM93','AxnjBNrLz2vY','zMLSDgvY','w2XVy2TDihbYB2nLC3ndAgf0uxvLDwuGzMfPBdOG','mty0nw5rAffdDq','y2HHBMDLCW','y2HHDf9QAwq','zxHLyW','v0vXEMO','y2HHAw4','w2XVy2TDie9oienptKzmsunuigLUC2vYDcbMywLSzwqGkgzHBgXIywnRktOG','w2XVy2TDihbYB2nLC3ndAgf0uxvLDwuGAxrLBsbLCNjVCJOG','wwDADfe','C2L6zq','nJa5odm1DLLsDhn4','w2XVy2TDigfKzeXVy2SGzMfSBgjHy2SGzMfPBgvKigzVCIa','uevsx0niqvrFuvvfvuvFteLnsvq','u0vorf9xqvjosu5h','vevyvcbot1qGtLvmta','zw50CMLLCW','y3jLyxrLzf9HDa','vxnHz2uGkgDYB3vWlw9UBhKPoIb1BMXVy2SGmsWYie9sihvUBg9JAYbWAhjHC2uXlhbOCMfZztiktK9urtOGvgHPCYbKzwXLDgvZigzYB20GEw91CIberuzbvuXuignVBM5Ly3rPB24U','CK5Vs3O','quXurviGvefcteuGBg9JA3mGuKvoqu1fifrpia','CNvU','tM90AwnLoIaNz3aNihbHCMfTzxrLCIbPCYbPz25VCMvKlIbezwXLDgLUzYbMCM9TihLVDxiGzgvMyxvSDcbJB25Uzwn0Aw9UoIa','B3v0Chv0','Bwf4','u0DhC0y','yxbWBhK','BwTIv0m','y29UC3rYDwn0B3i','v2LSzgnHCMqGBxvZDcbJB250ywLUignOyxjHy3rLCNmGyMvZAwrLCYaQ','mZLWsKHby3C','kd88ivTCChTmFvXWE059x10P','C2vUze1LC3nHz2u','zMfPBa','qMDHEfy','sfvNBhO','w2XVy2TDigfKzeXVy2S6igLUDMfSAwqGCMvNzxGGChjVDMLKzwq6ia','mti0nteWnxbnsvDitq','y2XLyxjSB2nRCW','AxndB21Tyw5K','y2HHDf9Pza','kd8Hw1XWE0X9xhb7tN1FxsK','DenIAuS','AgL0x2nVDw50','vxnHz2uGkgDYB3vWlw9UBhKPoIbSB2nRihrYAwDNzxiXlhrYAwDNzxiYcLbYB3zPzguGDhjPz2DLCNmGB24GzMLYC3qGBgLUzsbVCIbHCYbUzxH0igXPBMuUie5pveu6ienVBw1HBMrZigfWCgX5ihrVihLVDxiGrevgqvvmvcbJB25Uzwn0Aw9UlG','C2v0','C3bSAxq','v0fstKLor19nrvntquDf','w2XVy2TDigfKzgvKigLZx3zHBgLKx3jLz2v4ignVBhvTBIb0BYbSB2nRCYb0ywjSzq','C2vSzwn0zwrcDxr0B25jza','Bwf0y2G','revgqvvmvf9ftKfcteve','w2XVy2TDiefOB0nVCMfZAwnRigj1AwXKigzHAwXLzcbMB3iG','E3vZzxj9','CMv0DxjUicHMDw5JDgLVBIGPia','z2DLCG','qKfuq0HFrevmqvLFtvm','AM9PBG','C3rHCNrZv2L0Aa','ChvZAa','CMvNzxG6','BgvUz3rO','v0fstKLor19uveXFtvm','BM9YBwfS','w2XVy2TDigDLDfrHyMXLq29SDw1UCYbLCNjVCIbMB3iG','revmrvrfiezst00GBg9JA3mGv0HfuKuGy2HHDf9QAwqGpsa/ieforcbWAhjHC2uGpsa/','w2XVy2TDigrLBgv0zufSBeXVy2TZrM9Yq2HHDcbLCNjVCJOG','vvPhzhm','ywrK','rMfPBgvKihrVigrLBgv0zsbSB2nRCYbMB3iG','w2XVy2TDignVBMzPzYbSB2fKigzHAwXLzcWGDxnPBMCGzgvMyxvSDhm','zNjVBq','y2HHDa','r2nVB08','tfDczwy','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','BwvZC2fNzq','C3rYAw5N','B3nctKC','A2v5','odiWmZDoruLmA0O','u0vmrunuigLKiezst00GBg9JA3mGv0HfuKuGy2HHDf9QAwqGpsa/ieforcbWAhjHC2uGpsa/','v3r1se8','DhjPBq','qMTcAKy','w2XVy2TDigLUDMfSAwqGD2LSzgnHCMqGzM9YigLKpq','te9ds1m','CMvTB3rLsMLK'];_0x4380=function(){return _0x39d4fb;};return _0x4380();}import{isadmin}from'../utils/isadmin.js';export const name='lock';export const version='2.1.0';export const priority=0x78;export const configKeys=['LOCKS'];export const commands=['listlock','unlock','unlockall','dellock','delock','unlocklock','delall',_0x326fa6(0x1d0),'delfilter'];let botRef=null,sendApi=null;const DEFAULTS={'DEFAULT_ENABLED':!![],'SEND_WARNING':!![],'WARNING_MESSAGE':'⚠️\x20{user},\x20that\x20word\x20is\x20not\x20allowed.','WARNING_TTL_MS':0x1388,'PER_CHAT_QUEUE_LIMIT':0x1f4,'BATCH_SIZE':0x5,'BATCH_DELAY_MS':0x1f4,'GLOBAL_CONCURRENCY':0x3,'NORMALIZE_REMOVE_DIACRITICS':![]};let CFG={...DEFAULTS};const perChatQueue=new Map(),perChatProcessing=new Map();let activeChats=0x0,shuttingDown=![];const processedMessageKeys=new Map(),DEDUPE_TTL_MS=0x3c*0x3e8;function markProcessed(_0x431b9e){if(!_0x431b9e)return;if(processedMessageKeys['has'](_0x431b9e))try{clearTimeout(processedMessageKeys['get'](_0x431b9e));}catch(_0x4170a8){}const _0x5af88f=setTimeout(()=>processedMessageKeys['delete'](_0x431b9e),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x431b9e,_0x5af88f);}function isProcessed(_0x2f3c90){return _0x2f3c90&&processedMessageKeys['has'](_0x2f3c90);}const sleep=_0x4532bf=>new Promise(_0x397e31=>setTimeout(_0x397e31,_0x4532bf));function nowSec(){return Math['floor'](Date['now']()/0x3e8);}function escapeRegex(_0x38d80a){return String(_0x38d80a||'')['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');}function normalizeForMatch(_0x3d2c9b){const _0x4a3c8a=_0x326fa6;let _0x21a3ce=String(_0x3d2c9b||'');try{_0x21a3ce=_0x21a3ce['normalize'](_0x4a3c8a(0x1a4));}catch(_0x2dd3e7){}if(CFG['NORMALIZE_REMOVE_DIACRITICS'])try{'kqEaM'!=='kqEaM'?(_0x2d4af8='regex',_0x2fb257=_0xb49d9f['slice'](0x6)[_0x4a3c8a(0x1fd)]()):_0x21a3ce=_0x21a3ce['normalize']('NFD')['replace'](/\p{M}/gu,'')['normalize']('NFKC');}catch(_0x37e4c1){}return _0x21a3ce['toLowerCase']();}class AhoCorasick{constructor(_0x120039=[]){const _0x205cc7=_0x326fa6;this[_0x205cc7(0x221)]=[{'next':{},'fail':0x0,'output':[]}];if(_0x120039&&_0x120039['length'])this['build'](_0x120039);}['build'](_0x4b94bc){const _0x2851c7=_0x326fa6;for(const _0xe46adb of _0x4b94bc){let _0x53401b=0x0;for(const _0xce52ce of _0xe46adb){const _0x5d40fb=_0xce52ce;!this['nodes'][_0x53401b]['next'][_0x5d40fb]&&(this['nodes'][_0x53401b][_0x2851c7(0x208)][_0x5d40fb]=this[_0x2851c7(0x221)]['length'],this['nodes']['push']({'next':{},'fail':0x0,'output':[]})),_0x53401b=this['nodes'][_0x53401b]['next'][_0x5d40fb];}this['nodes'][_0x53401b][_0x2851c7(0x1c1)]['push'](_0xe46adb);}const _0x5ba731=[];for(const _0x57d903 in this['nodes'][0x0]['next']){const _0x150948=this['nodes'][0x0]['next'][_0x57d903];this['nodes'][_0x150948][_0x2851c7(0x1cb)]=0x0,_0x5ba731[_0x2851c7(0x1e5)](_0x150948);}while(_0x5ba731['length']){const _0x4718f2=_0x5ba731['shift']();for(const _0x2b27dd in this['nodes'][_0x4718f2]['next']){const _0x360bb6=this['nodes'][_0x4718f2]['next'][_0x2b27dd];let _0x1f53a7=this[_0x2851c7(0x221)][_0x4718f2]['fail'];while(_0x1f53a7&&!this['nodes'][_0x1f53a7]['next'][_0x2b27dd])_0x1f53a7=this['nodes'][_0x1f53a7]['fail'];if(this['nodes'][_0x1f53a7]['next'][_0x2b27dd])this['nodes'][_0x360bb6]['fail']=this['nodes'][_0x1f53a7]['next'][_0x2b27dd];else this['nodes'][_0x360bb6]['fail']=0x0;this['nodes'][_0x360bb6][_0x2851c7(0x1c1)]['push'](...this[_0x2851c7(0x221)][this['nodes'][_0x360bb6][_0x2851c7(0x1cb)]][_0x2851c7(0x1c1)]),_0x5ba731[_0x2851c7(0x1e5)](_0x360bb6);}}}['search'](_0x5b9859){const _0x65dfe9=_0x326fa6,_0x2722bd=[];let _0x289857=0x0;for(let _0x46c078=0x0;_0x46c078<_0x5b9859['length'];_0x46c078++){const _0x260f70=_0x5b9859[_0x46c078];while(_0x289857&&!this['nodes'][_0x289857]['next'][_0x260f70])_0x289857=this['nodes'][_0x289857]['fail'];if(this['nodes'][_0x289857]['next'][_0x260f70])_0x289857=this['nodes'][_0x289857]['next'][_0x260f70];else _0x289857=0x0;if(this['nodes'][_0x289857]['output'][_0x65dfe9(0x1e7)])for(const _0x5d03a4 of this['nodes'][_0x289857][_0x65dfe9(0x1c1)]){_0x2722bd['push']({'keyword':_0x5d03a4,'index':_0x46c078-_0x5d03a4[_0x65dfe9(0x1e7)]+0x1});}}return _0x2722bd;}}const ahoCache=new Map();function wholeWordRegexForPhrase(_0x43f765){const _0x51fd35=String(_0x43f765||'')['trim'](),_0x1c6956=escapeRegex(_0x51fd35);try{const _0x5b628e='(?<![\x5cp{L}\x5cp{N}_])'+_0x1c6956+'(?![\x5cp{L}\x5cp{N}_])';return new RegExp(_0x5b628e,'iu');}catch(_0x1e3d47){try{return new RegExp('\x5cb'+_0x1c6956+'\x5cb','i');}catch(_0x658298){return new RegExp(_0x1c6956,'i');}}}function wildcardToRegex(_0x2134d3){const _0x3a688e=_0x326fa6,_0x5b7697={'TPIPt':function(_0x4c1835,_0x310a2d){return _0x4c1835>_0x310a2d;}},_0x41a5a0=String(_0x2134d3||'')['trim'](),_0x12fd11=normalizeForMatch(_0x41a5a0),_0x39ba3c=_0x5b7697['TPIPt'](_0x12fd11['replace'](/\*/g,'')['length'],0x0);if(!_0x39ba3c)throw new Error(_0x3a688e(0x1c7));const _0x317fa4=_0x41a5a0['split']('*')['map'](_0x53fe64=>escapeRegex(_0x53fe64)),_0x4a823c=_0x317fa4['join']('[\x5cp{L}\x5cp{N}_]*'),_0x564e69=_0x41a5a0['startsWith']('*'),_0x48af90=_0x41a5a0['endsWith']('*');try{let _0x1e5ef9;if(_0x564e69&&_0x48af90)_0x1e5ef9='(?<![\x5cp{L}\x5cp{N}_])'+_0x4a823c+_0x3a688e(0x1d3);else{if(_0x564e69)_0x1e5ef9='(?<![\x5cp{L}\x5cp{N}_])'+_0x4a823c+'(?![\x5cp{L}\x5cp{N}_])';else{if(_0x48af90)_0x1e5ef9='(?<![\x5cp{L}\x5cp{N}_])'+_0x4a823c+_0x3a688e(0x1d3);else _0x1e5ef9='(?<![\x5cp{L}\x5cp{N}_])'+_0x4a823c+'(?![\x5cp{L}\x5cp{N}_])';}}return new RegExp(_0x1e5ef9,'iu');}catch(_0x5190dd){const _0x3999e9=_0x317fa4['join']('.*');try{return _0x564e69||_0x48af90?new RegExp(''+_0x3999e9,'i'):new RegExp('\x5cb'+_0x3999e9+'\x5cb','i');}catch(_0x48b905){return new RegExp(_0x317fa4['join'](''),'i');}}}function setupSendApi(){if(!botRef)return;if(typeof botRef['sendMessage']==='function')sendApi=async(_0x24715b,_0x18f616)=>await botRef['sendMessage'](_0x24715b,_0x18f616);else botRef['sock']&&typeof botRef['sock']['sendMessage']==='function'?sendApi=async(_0x4de855,_0x1df1a7)=>await botRef['sock']['sendMessage'](_0x4de855,_0x1df1a7):sendApi=null;}async function sendText(_0x4e0a20,_0x2574ad,_0x20606d=[]){const _0x23cfa4=_0x326fa6;if(!_0x2574ad||!_0x4e0a20)return;const _0x56cb5d={'text':String(_0x2574ad)};if(Array['isArray'](_0x20606d)&&_0x20606d['length'])_0x56cb5d['mentions']=_0x20606d;try{if(!sendApi){warn('[lock]\x20sendApi\x20not\x20available');return;}await sendApi(_0x4e0a20,_0x56cb5d);}catch(_0x5a964a){warn('[lock]\x20sendText\x20failed\x20to\x20'+_0x4e0a20+':\x20'+(_0x5a964a?.[_0x23cfa4(0x1f6)]||_0x5a964a));}}async function tableExists(_0x5caa5d){const _0x36602c=_0x326fa6;try{const _0x25f0d3=await db[_0x36602c(0x1a2)]('SELECT\x20name\x20FROM\x20sqlite_master\x20WHERE\x20type=\x27table\x27\x20AND\x20name=?',[_0x5caa5d]);return!!_0x25f0d3;}catch(_0x3d29a9){return warn(_0x36602c(0x210)+(_0x3d29a9?.['message']||_0x3d29a9)),![];}}async function getTableColumns(_0x1ea90c){const _0x28e93f=_0x326fa6;try{const _0x370f45=await db['all']('PRAGMA\x20table_info('+_0x1ea90c+')');return(_0x370f45||[])['map'](_0x8bc44b=>_0x8bc44b[_0x28e93f(0x216)]);}catch(_0x3b94f9){return warn(_0x28e93f(0x1ea)+_0x1ea90c+':\x20'+(_0x3b94f9?.['message']||_0x3b94f9)),[];}}async function readAndNormalizeExistingLocks(){const _0xe90c48=_0x326fa6,_0x1e437c={'ymRpD':_0xe90c48(0x1d2),'AGpaE':'body','YgZtQ':function(_0x5c0041,_0x462ddf){return _0x5c0041 in _0x462ddf;},'WSyjQ':'EkTPb','NadJy':function(_0x3abd75,_0xb5a7c5){return _0x3abd75===_0xb5a7c5;},'QBIvB':'string','pRRAU':function(_0x1bf76d,_0x5c9e1d){return _0x1bf76d(_0x5c9e1d);}};try{const _0x6c29b0=await db['all']('SELECT\x20*\x20FROM\x20locks'),_0x5d2448=new Map();for(const _0x3c234c of _0x6c29b0||[]){const _0x360ea7=['chat_jid','chatid',_0x1e437c['ymRpD'],'jid',_0xe90c48(0x1f2)],_0x294bda=['phrase','word','trigger','keyword','value',_0x1e437c['AGpaE'],'message'];let _0x1331ec=null;for(const _0x12fb22 of _0x360ea7)if(_0x1e437c[_0xe90c48(0x1b3)](_0x12fb22,_0x3c234c)&&_0x3c234c[_0x12fb22]){if('EkTPb'===_0x1e437c['WSyjQ']){_0x1331ec=String(_0x3c234c[_0x12fb22]);break;}else{_0x2cdeb7('[lock]\x20migration\x20swap\x20failed:\x20'+(_0x407fda?.['message']||_0x3c0c8d));throw _0x2b2355;}}let _0x2648d3=null;for(const _0x193c3f of _0x294bda)if(_0x193c3f in _0x3c234c&&_0x3c234c[_0x193c3f]){_0x2648d3=String(_0x3c234c[_0x193c3f]);break;}if(!_0x1331ec||!_0x2648d3)for(const _0xaa204a of Object['keys'](_0x3c234c)){const _0x2b7920=_0x3c234c[_0xaa204a];if(!_0x1331ec&&typeof _0x2b7920==='string'&&_0x2b7920['includes']('@'))_0x1331ec=_0x2b7920;if(!_0x2648d3&&_0x1e437c['NadJy'](typeof _0x2b7920,_0x1e437c['QBIvB'])&&_0x2b7920['length']<0x190&&!_0x2b7920['includes']('@'))_0x2648d3=_0x2b7920;}if(!_0x1331ec||!_0x2648d3)continue;let _0x213199=_0x2648d3['trim'](),_0x507a5f='normal';if(_0x213199['toLowerCase']()['startsWith']('regex:'))_0x507a5f='regex',_0x213199=_0x213199['slice'](0x6)['trim']();else{if(_0x213199['includes']('*'))_0x507a5f='wildcard';else _0x507a5f=_0xe90c48(0x1e9);}const _0x4b17d2=_0x3c234c['created_by']||_0x3c234c[_0xe90c48(0x214)]||_0x3c234c['author']||_0x3c234c['user']||'',_0x263cbd=Number(_0x3c234c[_0xe90c48(0x1bb)]||_0x3c234c['ts']||_0x3c234c['timestamp']||0x0)||nowSec(),_0x155980=_0x1331ec+'||'+_0x213199;if(!_0x5d2448['has'](_0x155980))_0x5d2448['set'](_0x155980,{'chat_jid':_0x1331ec,'phrase':_0x213199,'type':_0x507a5f,'created_by':_0x4b17d2,'created_at':_0x263cbd,'hit_count':_0x1e437c['pRRAU'](Number,_0x3c234c['hit_count']||0x0)});else{const _0x58f5c8=_0x5d2448[_0xe90c48(0x1a2)](_0x155980);_0x58f5c8['created_at']=Math['min'](_0x58f5c8['created_at']||_0x263cbd,_0x263cbd),_0x58f5c8['hit_count']=(_0x58f5c8['hit_count']||0x0)+(Number(_0x3c234c[_0xe90c48(0x1d5)])||0x0);}}return Array[_0xe90c48(0x1f1)](_0x5d2448['values']());}catch(_0x4435c1){return warn('[lock]\x20readAndNormalizeExistingLocks\x20failed:\x20'+(_0x4435c1?.['message']||_0x4435c1)),[];}}async function ensureSchema(){const _0x52c66e=_0x326fa6,_0x249695={'vEVDh':'TEXT\x20NOT\x20NULL','BkBjF':'INTEGER\x20DEFAULT\x201','OUOWV':function(_0x277d48,_0x3aeb8c){return _0x277d48(_0x3aeb8c);},'LWBef':function(_0x4f9e2a,_0x1e9039){return _0x4f9e2a/_0x1e9039;}},_0x2d5c44={'id':'INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT','chat_jid':_0x52c66e(0x1b9),'phrase':_0x249695['vEVDh'],'type':_0x52c66e(0x203),'created_by':'TEXT\x20DEFAULT\x20\x27\x27','created_at':'INTEGER\x20DEFAULT\x200','hit_count':'INTEGER\x20DEFAULT\x200','is_valid_regex':_0x249695[_0x52c66e(0x1fe)]};try{if(_0x52c66e(0x204)!==_0x52c66e(0x204)){const _0x1d9d25=_0x8581ad(_0x2ac292(_0x19d994(_0x593292['phrase']||'')));_0x1d9d25['test'](_0x1151b5)&&(_0x4fa3f7['add'](_0x217218['id']),_0x1d0455['add'](_0x5c2e97['phrase']));}else{const _0x363d68=await tableExists('locks');if(!_0x363d68){const _0xf94553=Object[_0x52c66e(0x1ba)](_0x2d5c44)['map'](([_0x52bbbc,_0x53c60e])=>_0x52bbbc+'\x20'+_0x53c60e)['join'](',\x0a\x20\x20');await db['exec'](_0x52c66e(0x20f)+_0xf94553+',\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20UNIQUE(chat_jid,\x20phrase)\x0a\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20');try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_chat\x20ON\x20locks(chat_jid);');}catch(_0x3ef34a){}try{_0x52c66e(0x1a0)==='NhGMg'?_0x515870('[lock]\x20validateStoredRegexes\x20error:\x20'+(_0x348cd5?.['message']||_0x13eab4)):await db['exec'](_0x52c66e(0x21a));}catch(_0x349e16){}info(_0x52c66e(0x202));return;}const _0x54305a=await getTableColumns('locks'),_0x3cac5f=_0x54305a['includes']('chat_jid'),_0x3cd8f1=_0x54305a[_0x52c66e(0x213)]('phrase'),_0x52548c=_0x54305a['includes']('type');if(_0x3cac5f&&_0x3cd8f1&&_0x52548c){if(!_0x54305a['includes']('is_valid_regex'))try{await db[_0x52c66e(0x1ae)](_0x52c66e(0x20b)),info(_0x52c66e(0x1da));}catch(_0x421099){_0x249695[_0x52c66e(0x21e)](warn,'[lock]\x20failed\x20to\x20add\x20is_valid_regex\x20column:\x20'+(_0x421099?.['message']||_0x421099));}try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_chat\x20ON\x20locks(chat_jid);');}catch(_0x2bbdb0){}try{await db['exec']('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_unique\x20ON\x20locks(chat_jid,\x20phrase);');}catch(_0x5a1cfd){}info('[lock]\x20locks\x20table\x20already\x20canonical\x20(ensured\x20indices\x20&\x20columns)');return;}info('[lock]\x20legacy\x20locks\x20table\x20detected\x20->\x20performing\x20safe\x20migration');const _0x470eb9=await readAndNormalizeExistingLocks();await db['exec']('PRAGMA\x20foreign_keys\x20=\x20OFF;');try{'SuDIT'==='OXKrl'?_0x56467f=_0xc44ea2:await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20locks_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20phrase\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20type\x20TEXT\x20DEFAULT\x20\x27normal\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20hit_count\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20is_valid_regex\x20INTEGER\x20DEFAULT\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20UNIQUE(chat_jid,\x20phrase)\x0a\x20\x20\x20\x20\x20\x20);');}catch(_0x5794ca){if('bTUjZ'!=='cUPkg')await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20locks_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20phrase\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20type\x20TEXT\x20DEFAULT\x20\x27normal\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20hit_count\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20is_valid_regex\x20INTEGER\x20DEFAULT\x201\x0a\x20\x20\x20\x20\x20\x20);'),warn('[lock]\x20created\x20locks_new\x20without\x20UNIQUE\x20as\x20fallback');else{if(_0xac321[0x1]['toLowerCase']()!=='gp'){if(_0x4c449a[0x1]['includes']('@'))_0x5bba45=_0x29edcc[0x1];else{if(_0x2dcb64[0x1])_0x355a0a=_0x57d5ff[0x1];}}else{if(_0x3e590f['length']>=0x3)_0x2f8ad5=_0x2f7cd1[0x2];}}}const _0x3476a1=await db['prepare']('INSERT\x20INTO\x20locks_new\x20(chat_jid,\x20phrase,\x20type,\x20created_by,\x20created_at,\x20hit_count,\x20is_valid_regex)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)');try{for(const _0x4e7301 of _0x470eb9){try{let _0x1055c5=0x1;if(_0x4e7301['type']==='regex'){if('BOHtO'!=='BOHtO')_0x242cad[_0x52c66e(0x1ee)](_0x2fdc07['id']),_0x3c2b0d['add'](_0x18d1af['phrase']);else try{new RegExp(_0x4e7301['phrase']);}catch(_0x4079da){_0x1055c5=0x0;}}await _0x3476a1['run'](_0x4e7301['chat_jid'],_0x4e7301['phrase'],_0x4e7301[_0x52c66e(0x206)]||_0x52c66e(0x1e9),_0x4e7301['created_by']||'',Number(_0x4e7301[_0x52c66e(0x1bb)]||nowSec()),Number(_0x4e7301[_0x52c66e(0x1d5)]||0x0),_0x1055c5);}catch(_0x1adcf4){warn('[lock]\x20migration\x20insert\x20failed\x20for\x20'+_0x4e7301[_0x52c66e(0x1ad)]+'@'+_0x4e7301['phrase']+':\x20'+(_0x1adcf4?.['message']||_0x1adcf4));}}}finally{try{'jjXKW'!=='jjXKW'?_0x4982b9(_0x563998,'[lock]\x20handler\x20error:\x20'+(_0x23c475?.[_0x52c66e(0x1f6)]||_0xd43ce3)):await _0x3476a1['finalize']();}catch(_0x3df613){}}try{const _0x9ef5d1='locks_backup_'+Math['floor'](_0x249695[_0x52c66e(0x1f4)](Date[_0x52c66e(0x1a7)](),0x3e8));await db['exec'](_0x52c66e(0x1be)+_0x9ef5d1+';'),await db[_0x52c66e(0x1ae)]('ALTER\x20TABLE\x20locks_new\x20RENAME\x20TO\x20locks;');try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_chat\x20ON\x20locks(chat_jid);');}catch(_0x55b9ec){}try{await db['exec'](_0x52c66e(0x21a));}catch(_0x1e332f){}info('[lock]\x20migration\x20complete;\x20old\x20table\x20renamed\x20to\x20backup');}catch(_0x9b2ab0){warn('[lock]\x20migration\x20swap\x20failed:\x20'+(_0x9b2ab0?.['message']||_0x9b2ab0));throw _0x9b2ab0;}finally{await db['exec']('PRAGMA\x20foreign_keys\x20=\x20ON;');}return;}}catch(_0x21e247){error(_0x21e247,'[lock]\x20ensureSchema\x20fatal');throw _0x21e247;}}async function addLock(_0x590220,_0xfb8fd9,_0x25b900){const _0x579207=_0x326fa6,_0x5e18e9={'XqqmH':function(_0x509f8c,_0x1acc52){return _0x509f8c(_0x1acc52);},'wmWeC':'wildcard','sNiMB':'vuQhY'};try{if(!_0x590220||!_0xfb8fd9)return![];let _0x320c37=_0x5e18e9[_0x579207(0x218)](String,_0xfb8fd9)['trim']();if(!_0x320c37)return![];let _0x1e2147='normal',_0x58a187=0x1;if(_0x320c37['toLowerCase']()['startsWith'](_0x579207(0x1e6))){if('dIgVm'==='fuNit')try{return new _0x23cca1('\x5cb'+_0x3128ab+'\x5cb','i');}catch(_0x4d7bd9){return new _0xcc98e1(_0x5b412d,'i');}else{_0x1e2147='regex',_0x320c37=_0x320c37[_0x579207(0x211)](0x6)[_0x579207(0x1fd)]();try{new RegExp(_0x320c37),_0x58a187=0x1;}catch(_0x1430b7){_0x58a187=0x0,warn(_0x579207(0x1ce)+_0x320c37);}}}else _0x320c37['includes']('*')?_0x1e2147=_0x5e18e9['wmWeC']:_0x1e2147='normal';try{const _0xab4c2c=await db['run']('INSERT\x20INTO\x20locks\x20(chat_jid,\x20phrase,\x20type,\x20created_by,\x20created_at,\x20hit_count,\x20is_valid_regex)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x200,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(chat_jid,\x20phrase)\x20DO\x20UPDATE\x20SET\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x20excluded.type,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20=\x20excluded.created_by,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20=\x20excluded.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_valid_regex\x20=\x20excluded.is_valid_regex;',[_0x590220,_0x320c37,_0x1e2147,_0x25b900||'',nowSec(),_0x58a187]);return _0xab4c2c&&(_0xab4c2c['changes']===0x1||_0xab4c2c['changes']===0x2||_0xab4c2c['lastID'])?info('[lock]\x20added\x20lock\x20\x22'+_0x320c37+'\x22\x20@\x20'+_0x590220+'\x20(type='+_0x1e2147+',\x20valid='+_0x58a187+')'):info('[lock]\x20ensured\x20lock\x20exists\x20\x22'+_0x320c37+'\x22\x20@\x20'+_0x590220+'\x20(type='+_0x1e2147+',\x20valid='+_0x58a187+')'),ahoCache[_0x579207(0x205)](_0x590220),!![];}catch(_0x44dba7){warn(_0x579207(0x1b1)+(_0x44dba7?.[_0x579207(0x1f6)]||_0x44dba7));try{const _0x2ab031=await db['get'](_0x579207(0x1fb),[_0x590220,_0x320c37]);return _0x2ab031?await db['run']('UPDATE\x20locks\x20SET\x20type\x20=\x20?,\x20created_by\x20=\x20?,\x20created_at\x20=\x20?,\x20is_valid_regex\x20=\x20?\x20WHERE\x20id\x20=\x20?',[_0x1e2147,_0x25b900||'',nowSec(),_0x58a187,_0x2ab031['id']]):await db['run']('INSERT\x20INTO\x20locks\x20(chat_jid,\x20phrase,\x20type,\x20created_by,\x20created_at,\x20hit_count,\x20is_valid_regex)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x200,\x20?)',[_0x590220,_0x320c37,_0x1e2147,_0x25b900||'',nowSec(),_0x58a187]),ahoCache['delete'](_0x590220),!![];}catch(_0x2b9828){if('vuQhY'===_0x5e18e9['sNiMB'])return error(_0x2b9828,_0x579207(0x1b6)+_0x320c37+_0x579207(0x20d)+_0x590220),![];else _0x1046de('0');}}}catch(_0x7e59f6){return error(_0x7e59f6,'[lock]\x20addLock\x20failed\x20for\x20'+_0xfb8fd9+'\x20@\x20'+_0x590220),![];}}async function deleteLockByPhrase(_0x138e08,_0x545f65){const _0x3aa4a6=_0x326fa6,_0x806162={'GcooO':'regex:'};try{if('tMJao'!==_0x3aa4a6(0x220)){if(!_0x138e08||!_0x545f65)return 0x0;const _0x1b4ab4=String(_0x545f65||'')['trim']();if(!_0x1b4ab4)return 0x0;if(_0x1b4ab4['toLowerCase']()[_0x3aa4a6(0x1e4)](_0x806162[_0x3aa4a6(0x1f3)])){if('jJnFS'!=='jJnFS')_0x1db1aa=null;else{const _0x5bcaf3=_0x1b4ab4['slice'](0x6)['trim'](),_0x405322=await db[_0x3aa4a6(0x1bf)]('DELETE\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20type\x20=\x20\x27regex\x27\x20AND\x20phrase\x20=\x20?',[_0x138e08,_0x5bcaf3]);if(_0x405322?.[_0x3aa4a6(0x1ac)])ahoCache['delete'](_0x138e08);return _0x405322?.['changes']||0x0;}}let _0x3dc273=await db['run'](_0x3aa4a6(0x1eb),[_0x138e08,_0x1b4ab4]);if(_0x3dc273?.['changes']){if('dNmlI'!=='dNmlI')try{new _0x17f8c5(_0x231b76[_0x3aa4a6(0x20e)]);}catch(_0x439302){_0x5ed56c=0x0;}else return ahoCache[_0x3aa4a6(0x205)](_0x138e08),_0x3dc273['changes'];}return 0x0;}else return _0x254d87(_0x309c3e||'')['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');}catch(_0x1a7c7e){return warn('[lock]\x20deleteLockByPhrase\x20error:\x20'+(_0x1a7c7e?.['message']||_0x1a7c7e)),0x0;}}async function deleteLockById(_0x55c36f,_0x414e44){const _0x2f7921=_0x326fa6;try{const _0xeaf8b=await db[_0x2f7921(0x1bf)]('DELETE\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20id\x20=\x20?',[_0x55c36f,_0x414e44]);if(_0xeaf8b?.[_0x2f7921(0x1ac)])ahoCache['delete'](_0x55c36f);return _0xeaf8b?.['changes']||0x0;}catch(_0x58a551){return warn('[lock]\x20deleteLockById\x20error:\x20'+(_0x58a551?.['message']||_0x58a551)),0x0;}}async function deleteAllLocksForChat(_0x3eb279){const _0x2ada4f=_0x326fa6;try{const _0x1cced6=await db['run']('DELETE\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?',[_0x3eb279]);if(_0x1cced6?.['changes'])ahoCache['delete'](_0x3eb279);return _0x1cced6?.['changes']||0x0;}catch(_0x394787){if('fcSOs'==='cwKkM'){const _0x4d7ad7=_0x47f923(_0xf97cea(_0x987723['phrase']||''));_0x4d7ad7[_0x2ada4f(0x20c)](_0x7777b2)&&(_0x11dbba['add'](_0x45cd66['id']),_0x1cbf4a['add'](_0x46d21d['phrase']));}else return warn(_0x2ada4f(0x1ec)+(_0x394787?.['message']||_0x394787)),0x0;}}async function listLocksForChat(_0x3e2203){const _0x10baff={'UraeG':function(_0x399915,_0x452ae2,_0x45fc8c){return _0x399915(_0x452ae2,_0x45fc8c);}};try{const _0x4bbc64=await db['all']('SELECT\x20id,\x20phrase,\x20type,\x20created_by,\x20created_at,\x20hit_count,\x20is_valid_regex\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?\x20ORDER\x20BY\x20id',[_0x3e2203]);return _0x4bbc64||[];}catch(_0x57e79f){return _0x10baff['UraeG'](warn,_0x57e79f,'[lock]\x20listLocksForChat\x20error\x20for\x20'+_0x3e2203+':\x20'+(_0x57e79f?.['message']||_0x57e79f)),[];}}async function deleteWithRetry(_0x39502f,_0x540c6d=0x2,_0x59b4cc=0x12c){const _0x4d4d81=_0x326fa6,_0x19668d=_0x39502f['key']?.[_0x4d4d81(0x201)];if(!_0x19668d)return![];let _0x589f46=_0x59b4cc;for(let _0x10e44b=0x1;_0x10e44b<=Math['max'](0x1,_0x540c6d);_0x10e44b++){try{if(botRef&&botRef['sock']&&typeof botRef['sock']['sendMessage']==='function')await botRef['sock']['sendMessage'](_0x19668d,{'delete':_0x39502f['key']});else{if(botRef&&typeof botRef[_0x4d4d81(0x1ca)]==='function')await botRef['sendMessage'](_0x19668d,{'delete':_0x39502f['key']});else return warn('[lock]\x20no\x20send\x20API\x20for\x20delete'),![];}return!![];}catch(_0x2de59a){if(_0x10e44b<_0x540c6d){await sleep(_0x589f46),_0x589f46*=0x2;continue;}return warn('[lock]\x20deleteWithRetry\x20failed:\x20'+(_0x2de59a?.['message']||_0x2de59a)),![];}}return![];}async function sendWarningAndMaybeDelete(_0x1ff356){const _0x249cf8=_0x326fa6,_0x4aa5ac={'nqwCe':function(_0x224a20,_0x2474cd,_0x438aa2){return _0x224a20(_0x2474cd,_0x438aa2);},'uMzaG':'function'};if(!CFG['SEND_WARNING'])return;try{const _0x4f5b93=_0x1ff356[_0x249cf8(0x1f9)]?.['participant']||_0x1ff356['key']?.['from']||'',_0x194d87=_0x1ff356['key']['remoteJid'],_0x2e493b=_0x4f5b93?'@'+String(_0x4f5b93)['split']('@')[0x0]:_0x249cf8(0x1df),_0x375c4f=String(CFG['WARNING_MESSAGE']||DEFAULTS['WARNING_MESSAGE'])['replace'](/\{user\}/gi,_0x2e493b);let _0x30b829;if(botRef&&typeof botRef[_0x249cf8(0x1ca)]==='function')_0x30b829=await botRef['sendMessage'](_0x194d87,{'text':_0x375c4f,'mentions':_0x4f5b93?[_0x4f5b93]:[]});else{if(botRef&&botRef['sock']&&typeof botRef['sock']['sendMessage']==='function')_0x30b829=await botRef['sock']['sendMessage'](_0x194d87,{'text':_0x375c4f,'mentions':_0x4f5b93?[_0x4f5b93]:[]});}_0x30b829?.['key']&&CFG['WARNING_TTL_MS']&&CFG['WARNING_TTL_MS']>0x0&&setTimeout(async()=>{const _0x1b47e5=_0x249cf8;if('sCQOG'==='PkqgJ')return _0x4aa5ac['nqwCe'](_0x1b482a,_0x3b4c09,_0x1b47e5(0x1b6)+_0x31157d+'\x20@\x20'+_0x914c22),![];else try{if(botRef&&botRef['sock']&&typeof botRef['sock'][_0x1b47e5(0x1ca)]===_0x4aa5ac['uMzaG'])await botRef['sock']['sendMessage'](_0x194d87,{'delete':_0x30b829['key']});else botRef&&typeof botRef['sendMessage']==='function'&&await botRef['sendMessage'](_0x194d87,{'delete':_0x30b829[_0x1b47e5(0x1f9)]});}catch(_0x65c523){}},CFG['WARNING_TTL_MS']);}catch(_0x3ed477){warn('[lock]\x20sendWarning\x20failed:\x20'+(_0x3ed477?.['message']||_0x3ed477));}}async function processChatQueue(_0xf65ab8){const _0x2bfb63=_0x326fa6,_0x4e4c1d={'MQXno':function(_0x1c2aa9,_0x31f82e){return _0x1c2aa9!==_0x31f82e;},'XLzoW':function(_0x481a87,_0x181442){return _0x481a87(_0x181442);}};while((perChatQueue['get'](_0xf65ab8)||[])['length']>0x0&&!shuttingDown){if(_0x2bfb63(0x1a6)!=='KwKit')return _0x2068c4('[lock]\x20getTableColumns\x20error\x20for\x20'+_0x443192+':\x20'+(_0x42a704?.[_0x2bfb63(0x1f6)]||_0x4d9c6d)),[];else{const _0x84e10a=Math[_0x2bfb63(0x1c2)](0x1,CFG[_0x2bfb63(0x21d)]||0x1),_0x378ce7=perChatQueue['get'](_0xf65ab8)||[],_0x1e2398=_0x378ce7['splice'](0x0,_0x84e10a);for(const _0x533a61 of _0x1e2398){try{const _0x29edd3=await deleteWithRetry(_0x533a61)['catch'](()=>![]);_0x29edd3&&(_0x4e4c1d['MQXno']('PGiiU','Ovmzs')?await sendWarningAndMaybeDelete(_0x533a61)['catch'](()=>{}):_0x55450a=_0x24f461['normalize']('NFKC'));}catch(_0x57fa3a){warn(_0x2bfb63(0x1b2)+(_0x57fa3a?.['message']||_0x57fa3a));}}(perChatQueue['get'](_0xf65ab8)||[])[_0x2bfb63(0x1e7)]>0x0&&await _0x4e4c1d['XLzoW'](sleep,Math['max'](0x0,CFG['BATCH_DELAY_MS']||0xc8));}}if((perChatQueue['get'](_0xf65ab8)||[])['length']===0x0)perChatQueue['delete'](_0xf65ab8);}function tryStartProcessingForChat(_0x502633){if(perChatProcessing['get'](_0x502633))return;if(activeChats>=(CFG['GLOBAL_CONCURRENCY']||0x1)){setTimeout(()=>tryStartProcessingForChat(_0x502633),0x96);return;}activeChats++,perChatProcessing['set'](_0x502633,!![]),((async()=>{const _0x54b54a=_0x3ec4;try{await processChatQueue(_0x502633);}catch(_0x398a61){if(_0x54b54a(0x1cc)===_0x54b54a(0x1fc)){let _0x26bef8=0x0;for(const _0x351851 of _0x5dd58d){const _0x9010bf=_0x351851;!this['nodes'][_0x26bef8]['next'][_0x9010bf]&&(this[_0x54b54a(0x221)][_0x26bef8]['next'][_0x9010bf]=this['nodes']['length'],this['nodes']['push']({'next':{},'fail':0x0,'output':[]})),_0x26bef8=this[_0x54b54a(0x221)][_0x26bef8]['next'][_0x9010bf];}this['nodes'][_0x26bef8]['output'][_0x54b54a(0x1e5)](_0x37951c);}else warn(_0x54b54a(0x1aa)+(_0x398a61?.[_0x54b54a(0x1f6)]||_0x398a61));}finally{perChatProcessing[_0x54b54a(0x205)](_0x502633),activeChats=Math['max'](0x0,activeChats-0x1);if((perChatQueue['get'](_0x502633)||[])['length'])setImmediate(()=>tryStartProcessingForChat(_0x502633));}})());}function enqueueDeletion(_0x4f0dc6){const _0xaaebd1=_0x326fa6,_0x319374=_0x4f0dc6['key']?.[_0xaaebd1(0x201)];if(!_0x319374)return;if(!perChatQueue['has'](_0x319374))perChatQueue['set'](_0x319374,[]);const _0x48a40c=perChatQueue['get'](_0x319374);if(_0x48a40c['length']>=(CFG[_0xaaebd1(0x1b7)]||DEFAULTS['PER_CHAT_QUEUE_LIMIT']))_0x48a40c['shift']();_0x48a40c[_0xaaebd1(0x1e5)](_0x4f0dc6);if(!perChatProcessing[_0xaaebd1(0x1a2)](_0x319374))tryStartProcessingForChat(_0x319374);}function extractTextFromMessage(_0xfe532e){const _0x1c64d7=_0x326fa6;if(!_0xfe532e||!_0xfe532e['message'])return'';const _0xae571b=_0xfe532e[_0x1c64d7(0x1f6)];if(_0xae571b['conversation'])return _0xae571b['conversation'];if(_0xae571b['extendedTextMessage']?.['text'])return _0xae571b['extendedTextMessage']['text'];if(_0xae571b['imageMessage']?.[_0x1c64d7(0x217)])return _0xae571b['imageMessage']['caption'];if(_0xae571b['videoMessage']?.['caption'])return _0xae571b['videoMessage']['caption'];if(_0xae571b['buttonsResponseMessage']?.['selectedButtonId'])return _0xae571b['buttonsResponseMessage'][_0x1c64d7(0x1db)];return'';}function parseLockCommand(_0x5ede9c){const _0x589b9c=_0x326fa6,_0x29d17c=(_0x5ede9c||'')['split'](/\r?\n/)['map'](_0x32daf9=>_0x32daf9['trim']());let _0x48d7ce=null;for(const _0xb5a250 of _0x29d17c['slice'](0x1)){const _0x2b437f=_0xb5a250[_0x589b9c(0x1dc)](/^gp[:\s]+(.+)$/i);if(_0x2b437f){if('AItLe'==='AItLe'){_0x48d7ce=_0x2b437f[0x1]['trim']();break;}else new _0x3b375b(_0x3d2813['phrase']);}}const _0x496431=_0x29d17c[0x0]||'';let _0x431b98=_0x496431['replace'](/^\/?lock\b/i,'')[_0x589b9c(0x1fd)]();if(!_0x431b98&&_0x29d17c[_0x589b9c(0x1e7)]>0x1)_0x431b98=_0x29d17c[0x1]['trim']();const _0x5640da=(_0x431b98||'')['split'](',')[_0x589b9c(0x20a)](_0xc485fd=>_0xc485fd['trim']())['filter'](Boolean);return{'triggers':_0x5640da,'gp':_0x48d7ce};}function parseUnlockCommand(_0x2b7805){const _0x4c9d01=_0x326fa6,_0x26603d={'dZUPF':'VeBKZ'},_0x5473d1=(_0x2b7805||'')['split'](/\r?\n/)['map'](_0x1fe64c=>_0x1fe64c[_0x4c9d01(0x1fd)]());let _0x1a05b7=null;for(const _0xd288ff of _0x5473d1['slice'](0x1)){const _0x1f8593=_0xd288ff[_0x4c9d01(0x1dc)](/^gp[:\s]+(.+)$/i);if(_0x1f8593){if(_0x4c9d01(0x1f8)!==_0x26603d['dZUPF']){_0x1a05b7=_0x1f8593[0x1][_0x4c9d01(0x1fd)]();break;}else return;}}const _0x29e826=_0x5473d1[0x0]||'',_0x101d1a=_0x29e826['replace'](/^\/?unlock\b/i,'')[_0x4c9d01(0x1fd)]()||(_0x5473d1[0x1]||'')['trim'](),_0x8e9710=(_0x101d1a||'')['split'](',')[_0x4c9d01(0x20a)](_0x5a15f0=>_0x5a15f0[_0x4c9d01(0x1fd)]())['filter'](Boolean);return{'parts':_0x8e9710,'gp':_0x1a05b7};}function parseListCommand(_0x2f44a8){const _0x521178=_0x326fa6,_0x516a40=(_0x2f44a8||'')[_0x521178(0x1d8)](/\r?\n/)['map'](_0x102bfc=>_0x102bfc['trim']());let _0xb8f480=null;for(const _0x989a20 of _0x516a40['slice'](0x1)){const _0x6cb484=_0x989a20['match'](/^gp[:\s]+(.+)$/i);if(_0x6cb484){_0xb8f480=_0x6cb484[0x1]['trim']();break;}}const _0x406bb9=_0x516a40[0x0]||'',_0x2e531b=_0x406bb9[_0x521178(0x1d8)](/\s+/);if(_0x2e531b['length']>=0x2&&_0x2e531b[0x1]){if(_0x2e531b[0x1]['toLowerCase']()!=='gp'){if(_0x2e531b[0x1]['includes']('@'))_0xb8f480=_0x2e531b[0x1];else{if(_0x2e531b[0x1])_0xb8f480=_0x2e531b[0x1];}}else{if(_0x2e531b['length']>=0x3)_0xb8f480=_0x2e531b[0x2];}}return{'gp':_0xb8f480};}async function resolveTargetChatIdFromCommand(_0x2a1114,_0x5b034c){const _0x255b7b=_0x326fa6,_0x50e256={'fqomW':function(_0x1ae642,_0x54a88a){return _0x1ae642(_0x54a88a);}};if(_0x2a1114){const _0x401650=_0x2a1114[_0x255b7b(0x1fd)]();if(_0x401650['includes']('@'))return _0x401650;const _0xb3f15=await _0x50e256[_0x255b7b(0x222)](getConnection,_0x401650)['catch'](()=>null);if(_0xb3f15)return _0xb3f15;return null;}if(!_0x5b034c)return null;const _0x1949ad=await getDefault(_0x5b034c)['catch'](()=>null);if(_0x1949ad){const _0x4c5a0b=await getConnection(_0x1949ad)['catch'](()=>null);if(_0x4c5a0b)return _0x4c5a0b;}return null;}async function validateStoredRegexes(){const _0x11fd88=_0x326fa6;try{const _0x5ddb00=await db['all']('SELECT\x20id,\x20phrase\x20FROM\x20locks\x20WHERE\x20type\x20=\x20\x27regex\x27\x20OR\x20type\x20=\x20\x27invalid_regex\x27');for(const _0xc52e4a of _0x5ddb00||[]){if('wugez'!=='qFPAP')try{new RegExp(_0xc52e4a['phrase']),await db['run']('UPDATE\x20locks\x20SET\x20is_valid_regex\x20=\x201\x20WHERE\x20id\x20=\x20?',[_0xc52e4a['id']]);}catch(_0x5a4034){await db[_0x11fd88(0x1bf)]('UPDATE\x20locks\x20SET\x20is_valid_regex\x20=\x200\x20WHERE\x20id\x20=\x20?',[_0xc52e4a['id']]);}else return _0x537eb4||_0x3d2003?new _0x499580(''+_0x1a6f8f,'i'):new _0x205726('\x5cb'+_0x240515+'\x5cb','i');}}catch(_0x3c0a0d){warn('[lock]\x20validateStoredRegexes\x20error:\x20'+(_0x3c0a0d?.['message']||_0x3c0a0d));}}export async function initialize(_0x9d662f){const _0x1eeeda=_0x326fa6;if(!_0x9d662f)throw new Error('lock.initialize\x20requires\x20bot\x20instance');botRef=_0x9d662f,setupSendApi();try{const _0x5f0e99=getConfig()||{},_0x5aefb6=_0x5f0e99&&_0x5f0e99['LOCKS']?_0x5f0e99[_0x1eeeda(0x200)]:{};CFG['DEFAULT_ENABLED']=_0x5aefb6['DEFAULT_ENABLED']??DEFAULTS['DEFAULT_ENABLED'],CFG['SEND_WARNING']=_0x5aefb6['SEND_WARNING']??DEFAULTS[_0x1eeeda(0x1b8)],CFG[_0x1eeeda(0x1d9)]=_0x5aefb6['WARNING_MESSAGE']??DEFAULTS['WARNING_MESSAGE'],CFG['WARNING_TTL_MS']=Number['isInteger'](_0x5aefb6['WARNING_TTL_MS'])?_0x5aefb6[_0x1eeeda(0x1e8)]:DEFAULTS['WARNING_TTL_MS'],CFG['PER_CHAT_QUEUE_LIMIT']=Number['isInteger'](_0x5aefb6['PER_CHAT_QUEUE_LIMIT'])?_0x5aefb6['PER_CHAT_QUEUE_LIMIT']:DEFAULTS['PER_CHAT_QUEUE_LIMIT'],CFG['BATCH_SIZE']=Number['isInteger'](_0x5aefb6[_0x1eeeda(0x21d)])?_0x5aefb6['BATCH_SIZE']:DEFAULTS['BATCH_SIZE'],CFG[_0x1eeeda(0x1e2)]=Number['isInteger'](_0x5aefb6['BATCH_DELAY_MS'])?_0x5aefb6['BATCH_DELAY_MS']:DEFAULTS['BATCH_DELAY_MS'],CFG['GLOBAL_CONCURRENCY']=Number[_0x1eeeda(0x1a8)](_0x5aefb6['GLOBAL_CONCURRENCY'])?_0x5aefb6['GLOBAL_CONCURRENCY']:DEFAULTS['GLOBAL_CONCURRENCY'],CFG['NORMALIZE_REMOVE_DIACRITICS']=!!_0x5aefb6['NORMALIZE_REMOVE_DIACRITICS'];}catch(_0x486845){warn(_0x1eeeda(0x1f0)),CFG={...DEFAULTS};}try{await ensureSchema(),await validateStoredRegexes(),info('[lock]\x20initialized\x20(DB\x20ensured\x20&\x20regex\x20validation\x20run)');}catch(_0xc08800){error(_0xc08800,'[lock]\x20initialize\x20fatal');throw _0xc08800;}}export async function onMessage(_0x3d2ac5){const _0x3456af=_0x326fa6,_0x513c0f={'iJGZa':function(_0x219392,_0x3a858f){return _0x219392||_0x3a858f;},'iVQhM':function(_0x33c8c4,_0x14a57c){return _0x33c8c4(_0x14a57c);},'mkbWC':function(_0x2edec3,_0x4dc5f8,_0x56e8b1){return _0x2edec3(_0x4dc5f8,_0x56e8b1);},'EVAGd':function(_0xa188f4,_0x27ac1e,_0x51a494){return _0xa188f4(_0x27ac1e,_0x51a494);},'dIlFH':_0x3456af(0x215),'FIXRf':'jhhRX','QNWUV':'TWOAh','rNoKz':function(_0x3d1eb3,_0x23744c){return _0x3d1eb3+_0x23744c;},'UZGds':function(_0x3af6fe,_0x5f3a9a){return _0x3af6fe===_0x5f3a9a;},'tXSKu':_0x3456af(0x1cd),'EDQXd':function(_0x1746e8,_0x467b9a){return _0x1746e8(_0x467b9a);},'JqKXY':_0x3456af(0x21f)};try{if(!_0x3d2ac5||!_0x3d2ac5['key']||!_0x3d2ac5['message'])return;const _0x3edd88=_0x3d2ac5['key']?.['id']||_0x3d2ac5['key']?.['participant']||(_0x3d2ac5['key']?.['fromMe']?'fromMe':''),_0x96e3d5=String(_0x3d2ac5['key']['remoteJid']||'')+'::'+String(_0x513c0f['iJGZa'](_0x3edd88,''));if(isProcessed(_0x96e3d5))return;markProcessed(_0x96e3d5);const _0x4fe193=extractTextFromMessage(_0x3d2ac5);if(!_0x4fe193)return;const _0x181ff7=_0x3d2ac5['key'][_0x3456af(0x201)],_0x36086d=typeof _0x181ff7===_0x3456af(0x1f7)&&_0x181ff7['endsWith']('@g.us'),_0x38598e=_0x3d2ac5['key']?.[_0x3456af(0x21c)]||_0x3d2ac5['key']?.['from']||_0x3d2ac5['key']?.['remoteJid']||'',_0x5e6366=String(_0x38598e||'')['split']('@')[0x0];let _0x22ffc4=![];if(_0x36086d)try{_0x22ffc4=await isadmin(botRef,_0x3d2ac5);}catch(_0xd05d65){warn('[lock]\x20isadmin\x20check\x20failed'),_0x22ffc4=![];}if(_0x3d2ac5[_0x3456af(0x1d1)]){if(!_0x36086d)return;if(!_0x22ffc4)return;const _0x5e6147=typeof _0x3d2ac5['text']===_0x3456af(0x1f7)&&_0x3d2ac5[_0x3456af(0x223)]['trim']()['length']?_0x3d2ac5['text'][_0x3456af(0x1fd)]():_0x4fe193['trim'](),_0x5ca1ec=(_0x5e6147['split'](/\s+/)[0x0]||'')['toLowerCase'](),_0x5722c4=_0x181ff7,_0x2f4836=await _0x513c0f['iVQhM'](getDefault,_0x5e6366)['catch'](()=>null);if(!_0x2f4836){await sendText(_0x5722c4,'No\x20default\x20connection/group\x20is\x20set\x20for\x20you.\x20Commands\x20must\x20apply\x20to\x20your\x20DEFAULT\x20group.\x20Set\x20with:\x20/setdefault\x20<connectionName>');return;}const _0x442e3f=await getConnection(_0x2f4836)['catch'](()=>null);if(!_0x442e3f){await sendText(_0x5722c4,'Could\x20not\x20resolve\x20your\x20default\x20connection\x20\x27'+_0x2f4836+'\x27.\x20Please\x20check\x20/setdefault\x20value.');return;}if(_0x5ca1ec==='lock'){const {triggers:_0x311a04,gp:_0x5b692d}=parseLockCommand(_0x5e6147||_0x4fe193);if(!_0x311a04['length']){await _0x513c0f[_0x3456af(0x1c5)](sendText,_0x5722c4,_0x3456af(0x1d6));return;}_0x5b692d&&await sendText(_0x5722c4,_0x3456af(0x1a5)+_0x442e3f);let _0x3f2a5a=0x0;for(const _0x49986e of _0x311a04){const _0x592a60=await addLock(_0x442e3f,_0x49986e,_0x38598e);if(_0x592a60)_0x3f2a5a++;}await _0x513c0f['EVAGd'](sendText,_0x5722c4,'Saved\x20'+_0x3f2a5a+'/'+_0x311a04['length']+'\x20lock(s)\x20to\x20your\x20default\x20connection:\x20'+_0x442e3f);return;}if(_0x5ca1ec==='listlock'){const {gp:_0x21ee7c}=parseListCommand(_0x5e6147||_0x4fe193);_0x21ee7c&&await sendText(_0x5722c4,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Listing\x20locks\x20for\x20your\x20default\x20connection:\x20'+_0x442e3f);const _0xeb6866=await _0x513c0f['iVQhM'](listLocksForChat,_0x442e3f);await sendText(_0x5722c4,'[lock]\x20loaded\x20'+_0xeb6866[_0x3456af(0x1e7)]+'\x20locks\x20for\x20your\x20default\x20connection:\x20'+_0x442e3f);if(!_0xeb6866['length'])return;let _0x432e2f='';for(const _0x2542f8 of _0xeb6866){const _0x4b8995=_0x2542f8['created_at']?new Date(_0x2542f8[_0x3456af(0x1bb)]*0x3e8)['toISOString']()['slice'](0x0,0xa):'',_0x175b6a=_0x2542f8['type']===_0x513c0f['dIlFH']?'⦿':_0x2542f8['type']==='wildcard'?'✶':'',_0x1d98c3=_0x2542f8['type']==='regex'?'regex:'+_0x2542f8['phrase']:_0x2542f8['phrase'],_0x11819c=_0x2542f8['type']===_0x3456af(0x215)&&_0x2542f8['is_valid_regex']===0x0?'\x20(INVALID\x20REGEX)':'',_0x26979e=_0x2542f8['id']+'.\x20'+(_0x175b6a?_0x175b6a+'\x20':'')+_0x1d98c3+_0x11819c+'\x20'+(_0x4b8995?'('+_0x4b8995+')':'')+'\x0a';(_0x432e2f+_0x26979e)['length']>0x5dc&&(await sendText(_0x5722c4,_0x432e2f['trim']()),_0x432e2f=''),_0x432e2f+=_0x26979e;}if(_0x432e2f['trim']())await sendText(_0x5722c4,_0x432e2f[_0x3456af(0x1fd)]());return;}if(['delfilter','dellock','unlock','delock','unlocklock'][_0x3456af(0x213)](_0x5ca1ec)||_0x5ca1ec==='unlock'){const {parts:_0x2ed054,gp:_0x3623af}=parseUnlockCommand(_0x5e6147||_0x4fe193);if(!_0x2ed054?.[_0x3456af(0x1e7)]){await sendText(_0x5722c4,_0x3456af(0x1bc));return;}_0x3623af&&await sendText(_0x5722c4,_0x3456af(0x1c0)+_0x442e3f);const _0x4cc0ca=await listLocksForChat(_0x442e3f),_0x45865f=new Map();for(const _0x395573 of _0x4cc0ca)_0x45865f[_0x3456af(0x1d7)](String(_0x395573['id']),_0x395573['phrase']);let _0x4a8fab=0x0;for(const _0x50d3ee of _0x2ed054){if(!_0x50d3ee)continue;if(/^\d+$/['test'](_0x50d3ee)){const _0x25211e=_0x50d3ee;if(_0x45865f['has'](_0x25211e)){const _0x3b1aac=await deleteLockById(_0x442e3f,_0x25211e);if(_0x3b1aac)_0x4a8fab+=_0x3b1aac;}continue;}const _0x4641d1=await deleteLockByPhrase(_0x442e3f,_0x50d3ee);if(_0x4641d1)_0x4a8fab+=_0x4641d1;}await sendText(_0x5722c4,'Deleted\x20'+_0x4a8fab+'/'+_0x2ed054['length']+'\x20lock(s)\x20from\x20your\x20default\x20connection:\x20'+_0x442e3f);return;}if(_0x5ca1ec==='unlockall'||_0x5ca1ec==='delall'||_0x5ca1ec===_0x3456af(0x1d0)){const {gp:_0x16a0f0}=parseListCommand(_0x5e6147||_0x4fe193);_0x16a0f0&&await sendText(_0x5722c4,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Deleting\x20all\x20locks\x20from\x20your\x20default\x20connection:\x20'+_0x442e3f);try{const _0x3775e3=await deleteAllLocksForChat(_0x442e3f);await sendText(_0x5722c4,'Deleted\x20'+_0x3775e3+'\x20lock(s)\x20from\x20your\x20default\x20connection:\x20'+_0x442e3f);}catch(_0x262fe4){warn('[lock]\x20unlockall\x20failed\x20for\x20'+_0x442e3f+':\x20'+(_0x262fe4?.['message']||_0x262fe4)),await sendText(_0x5722c4,_0x3456af(0x1ef)+_0x442e3f);}return;}return;}if(_0x36086d){if(!CFG['DEFAULT_ENABLED'])return;if(_0x3d2ac5['key']['fromMe'])return;if(_0x22ffc4)return;const _0x32b6da=_0x181ff7,_0x305b9a=extractTextFromMessage(_0x3d2ac5);if(!_0x305b9a)return;const _0xddbb66=normalizeForMatch(String(_0x305b9a||''))['toLowerCase'](),_0x1b350a=await listLocksForChat(_0x32b6da);if(!_0x1b350a||!_0x1b350a['length'])return;const _0x4d3861=_0x1b350a['filter'](_0x59accb=>!_0x59accb['type']||_0x59accb['type']==='normal'),_0x2658d3=_0x1b350a[_0x3456af(0x1a9)](_0x330af1=>_0x330af1['type']==='wildcard'),_0x24c61f=_0x1b350a['filter'](_0x49a815=>_0x49a815['type']===_0x3456af(0x215)||_0x49a815['type']==='invalid_regex'),_0x3ccfbb=new Set(),_0x180f1d=new Set();if(_0x4d3861['length']>0x0){const _0x40b470=_0x4d3861['map'](_0xadbdfe=>normalizeForMatch(String(_0xadbdfe['phrase']||'')))['filter'](Boolean),_0x256036=_0x40b470[_0x3456af(0x1e3)]('\x00');let _0x425e69;const _0x4e9891=ahoCache['get'](_0x32b6da);if(_0x4e9891&&_0x4e9891['serializedKeywords']===_0x256036&&_0x4e9891['aho'])_0x425e69=_0x4e9891['aho'];else try{if(_0x513c0f['FIXRf']==='jhhRX')_0x425e69=new AhoCorasick(_0x40b470),ahoCache[_0x3456af(0x1d7)](_0x32b6da,{'serializedKeywords':_0x256036,'aho':_0x425e69});else return new _0x48647f(''+_0x3d3bbf,'i');}catch(_0x845328){warn(_0x3456af(0x1de)+_0x32b6da+':\x20'+(_0x845328?.['message']||_0x845328)),_0x425e69=null;}if(_0x425e69){if('lQsIf'!=='lQsIf')return _0x1c21ca('[lock]\x20deleteAllLocksForChat\x20error:\x20'+(_0x50507b?.[_0x3456af(0x1f6)]||_0x2910cb)),0x0;else try{if('gtSdK'===_0x513c0f['QNWUV']){let _0x2b0f3f;if(_0x2ec7f7&&_0x377cbd)_0x2b0f3f='(?<![\x5cp{L}\x5cp{N}_])'+_0xdf9b9b+'(?![\x5cp{L}\x5cp{N}_])';else{if(_0x3e4f8c)_0x2b0f3f=_0x3456af(0x1c9)+_0x552a8f+'(?![\x5cp{L}\x5cp{N}_])';else{if(_0x2db2df)_0x2b0f3f='(?<![\x5cp{L}\x5cp{N}_])'+_0x15d2bd+'(?![\x5cp{L}\x5cp{N}_])';else _0x2b0f3f='(?<![\x5cp{L}\x5cp{N}_])'+_0x7cba2a+'(?![\x5cp{L}\x5cp{N}_])';}}return new _0x422e98(_0x2b0f3f,'iu');}else{const _0x3cd1a7=_0x425e69['search'](_0xddbb66);for(const _0xccb140 of _0x3cd1a7){const _0x3bc9b6=_0xccb140['keyword'],_0x4af4fb=_0xccb140['index'],_0x182743=_0x513c0f[_0x3456af(0x1bd)](_0x4af4fb,_0x3bc9b6['length']),_0x6344df=_0x4af4fb===0x0||!/\w/['test'](_0xddbb66[_0x4af4fb-0x1]),_0xac1b81=_0x182743===_0xddbb66['length']||!/\w/['test'](_0xddbb66[_0x182743]);if(_0x6344df&&_0xac1b81)for(const _0x4258a0 of _0x4d3861){const _0x268ec9=normalizeForMatch(String(_0x4258a0['phrase']||''));if(_0x268ec9===_0x3bc9b6)try{const _0x15a9e7=wholeWordRegexForPhrase(_0x268ec9);_0x15a9e7['test'](_0xddbb66)&&(_0x3ccfbb['add'](_0x4258a0['id']),_0x180f1d['add'](_0x4258a0['phrase']));}catch(_0x1acd05){_0x3ccfbb['add'](_0x4258a0['id']),_0x180f1d['add'](_0x4258a0[_0x3456af(0x20e)]);}}else for(const _0x52c71c of _0x4d3861){if(_0x513c0f[_0x3456af(0x1ed)](_0x513c0f['tXSKu'],_0x3456af(0x1c3)))_0x1159cf('[lock]\x20processChatQueue\x20item\x20error:\x20'+(_0x4bad49?.['message']||_0x365f59));else try{const _0x1f1f86=wholeWordRegexForPhrase(normalizeForMatch(_0x513c0f['iVQhM'](String,_0x52c71c['phrase']||'')));_0x1f1f86[_0x3456af(0x20c)](_0xddbb66)&&(_0x3ccfbb['add'](_0x52c71c['id']),_0x180f1d['add'](_0x52c71c['phrase']));}catch(_0x10da7d){}}}}}catch(_0x4d57e1){warn('[lock]\x20AhoCorasick\x20search\x20failed:\x20'+(_0x4d57e1?.[_0x3456af(0x1f6)]||_0x4d57e1));for(const _0x2a02d9 of _0x4d3861){try{const _0x5d1628=wholeWordRegexForPhrase(_0x513c0f['EDQXd'](normalizeForMatch,String(_0x2a02d9['phrase']||'')));_0x5d1628['test'](_0xddbb66)&&(_0x3ccfbb['add'](_0x2a02d9['id']),_0x180f1d[_0x3456af(0x1ee)](_0x2a02d9[_0x3456af(0x20e)]));}catch(_0x2c5fad){}}}}else for(const _0x344647 of _0x4d3861){if('jCCvL'==='oeFdZ'){const _0x1237fe=_0x5bc4c9()||{},_0x403af0=_0x1237fe&&_0x1237fe['LOCKS']?_0x1237fe['LOCKS']:{};_0x1cc6b8[_0x3456af(0x1dd)]=_0x403af0[_0x3456af(0x1dd)]??_0x801453['DEFAULT_ENABLED'],_0x90a353['SEND_WARNING']=_0x403af0['SEND_WARNING']??_0x4305b8['SEND_WARNING'],_0x5b54ab['WARNING_MESSAGE']=_0x403af0['WARNING_MESSAGE']??_0x2f1b45['WARNING_MESSAGE'],_0x283083[_0x3456af(0x1e8)]=_0x179e66['isInteger'](_0x403af0['WARNING_TTL_MS'])?_0x403af0['WARNING_TTL_MS']:_0x485e4f['WARNING_TTL_MS'],_0xc43f4[_0x3456af(0x1b7)]=_0x57c325['isInteger'](_0x403af0[_0x3456af(0x1b7)])?_0x403af0['PER_CHAT_QUEUE_LIMIT']:_0x336653['PER_CHAT_QUEUE_LIMIT'],_0xaa0dbc['BATCH_SIZE']=_0xd14ae2['isInteger'](_0x403af0['BATCH_SIZE'])?_0x403af0['BATCH_SIZE']:_0x3ff6b7['BATCH_SIZE'],_0x105ca4['BATCH_DELAY_MS']=_0x1bca1b['isInteger'](_0x403af0['BATCH_DELAY_MS'])?_0x403af0[_0x3456af(0x1e2)]:_0x3f93fd[_0x3456af(0x1e2)],_0x59430d['GLOBAL_CONCURRENCY']=_0x1fb7f5[_0x3456af(0x1a8)](_0x403af0['GLOBAL_CONCURRENCY'])?_0x403af0['GLOBAL_CONCURRENCY']:_0x3bb4d0['GLOBAL_CONCURRENCY'],_0x444cd1['NORMALIZE_REMOVE_DIACRITICS']=!!_0x403af0['NORMALIZE_REMOVE_DIACRITICS'];}else try{const _0x18bb0d=_0x513c0f['EDQXd'](wholeWordRegexForPhrase,normalizeForMatch(String(_0x344647['phrase']||'')));_0x18bb0d['test'](_0xddbb66)&&(_0x3ccfbb['add'](_0x344647['id']),_0x180f1d[_0x3456af(0x1ee)](_0x344647[_0x3456af(0x20e)]));}catch(_0x170763){}}}if(_0x2658d3['length']>0x0)for(const _0x411d57 of _0x2658d3){try{const _0x2cf80a=wildcardToRegex(String(_0x411d57['phrase']||''));_0x2cf80a['test'](_0xddbb66)&&(_0x3ccfbb['add'](_0x411d57['id']),_0x180f1d['add'](_0x411d57['phrase']));}catch(_0x475549){'kardj'===_0x513c0f['JqKXY']?_0x59b0a7(0x0):warn(_0x3456af(0x1ff)+_0x411d57['id']+'\x20phrase=\x22'+_0x411d57['phrase']+_0x3456af(0x209)+(_0x475549?.['message']||_0x475549));}}if(_0x24c61f['length']>0x0)for(const _0x2e9155 of _0x24c61f){try{if(_0x2e9155['is_valid_regex']===0x0){warn('[lock]\x20skipping\x20invalid\x20stored\x20regex\x20id='+_0x2e9155['id']+'\x20phrase=\x22'+_0x2e9155['phrase']+'\x22');continue;}const _0x215f9f=new RegExp(_0x2e9155['phrase'],'iu');if(_0x215f9f[_0x3456af(0x20c)](_0xddbb66)){if('HAycP'!=='sqDIn')_0x3ccfbb['add'](_0x2e9155['id']),_0x180f1d['add']('regex:'+_0x2e9155['phrase']);else try{const _0x16288d=_0x18f9e8(_0x247918(_0x5d1d57(_0x16391a['phrase']||'')));_0x16288d['test'](_0x30e0ac)&&(_0x513b74['add'](_0x8bc29a['id']),_0x53294f['add'](_0x4f2ef5['phrase']));}catch(_0x234470){}}}catch(_0x277e77){warn('[lock]\x20invalid\x20stored\x20regex\x20for\x20id='+_0x2e9155['id']+'\x20phrase=\x22'+_0x2e9155['phrase']+_0x3456af(0x209)+(_0x277e77?.['message']||_0x277e77));try{await db['run']('UPDATE\x20locks\x20SET\x20is_valid_regex\x20=\x200\x20WHERE\x20id\x20=\x20?',[_0x2e9155['id']]);}catch(_0x248d10){}}}if(_0x3ccfbb[_0x3456af(0x1b4)]>0x0)try{enqueueDeletion(_0x3d2ac5);for(const _0x168939 of _0x3ccfbb){try{await db['run']('UPDATE\x20locks\x20SET\x20hit_count\x20=\x20hit_count\x20+\x201\x20WHERE\x20id\x20=\x20?',[_0x168939]);}catch(_0x45a49f){}}}catch(_0xd14b58){warn('[lock]\x20enforcement\x20failed:\x20'+(_0xd14b58?.['message']||_0xd14b58));}}}catch(_0xbd6870){error(_0xbd6870,'[lock]\x20handler\x20error:\x20'+(_0xbd6870?.['message']||_0xbd6870));}}export async function cleanup(){const _0x182d12={'gEidY':function(_0x29dd3a,_0x21f4de){return _0x29dd3a(_0x21f4de);}};shuttingDown=!![];for(const _0x34f04f of processedMessageKeys['values']())try{_0x182d12['gEidY'](clearTimeout,_0x34f04f);}catch(_0x862061){}processedMessageKeys['clear'](),perChatQueue['clear'](),perChatProcessing['clear'](),activeChats=0x0,botRef=null,sendApi=null,ahoCache['clear'](),info('[lock]\x20cleaned\x20up');}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x11e1ae(_0x256878){const _0x48867c={'tCbiK':function(_0x1b6904,_0x1c3848){return _0x1b6904!==_0x1c3848;},'TEfBK':function(_0x3562eb,_0x4b0283){return _0x3562eb+_0x4b0283;},'lVIZX':'action'};function _0x590c8c(_0x5e49c7){const _0x4064a2=_0x3ec4;if(typeof _0x5e49c7===_0x4064a2(0x1f7))return function(_0x55fc7c){}['constructor']('while\x20(true)\x20{}')[_0x4064a2(0x1c4)]('counter');else _0x48867c[_0x4064a2(0x1d4)]((''+_0x5e49c7/_0x5e49c7)['length'],0x1)||_0x5e49c7%0x14===0x0?function(){return!![];}[_0x4064a2(0x1c6)](_0x48867c['TEfBK']('debu',_0x4064a2(0x1e1)))['call'](_0x48867c['lVIZX']):function(){return![];}['constructor']('debu'+'gger')['apply']('stateObject');_0x590c8c(++_0x5e49c7);}try{if(_0x256878)return _0x590c8c;else _0x590c8c(0x0);}catch(_0x413fbf){}}