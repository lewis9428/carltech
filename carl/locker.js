const _0x20a5c2=_0x142f;(function(_0x2f8b20,_0x257508){const _0x3563b4=_0x142f,_0xd1f7bc=_0x2f8b20();while(!![]){try{const _0x2387a3=parseInt(_0x3563b4(0xe9))/0x1+-parseInt(_0x3563b4(0xd8))/0x2*(parseInt(_0x3563b4(0xe3))/0x3)+parseInt(_0x3563b4(0x15c))/0x4*(-parseInt(_0x3563b4(0xfc))/0x5)+-parseInt(_0x3563b4(0x151))/0x6*(parseInt(_0x3563b4(0x141))/0x7)+-parseInt(_0x3563b4(0xdf))/0x8+parseInt(_0x3563b4(0x153))/0x9*(-parseInt(_0x3563b4(0x15b))/0xa)+parseInt(_0x3563b4(0x144))/0xb;if(_0x2387a3===_0x257508)break;else _0xd1f7bc['push'](_0xd1f7bc['shift']());}catch(_0x1c34f6){_0xd1f7bc['push'](_0xd1f7bc['shift']());}}}(_0x5423,0x26f18));const _0x43178c=(function(){let _0xa90b=!![];return function(_0x5d9721,_0x41383c){const _0x3932c3=_0xa90b?function(){if(_0x41383c){const _0xcc693=_0x41383c['apply'](_0x5d9721,arguments);return _0x41383c=null,_0xcc693;}}:function(){};return _0xa90b=![],_0x3932c3;};}());(function(){_0x43178c(this,function(){const _0x2b9aea=_0x142f;if('Kwxeq'==='FNObH'){this['nodes']=[{'next':{},'fail':0x0,'output':[]}];if(_0x24b8f6&&_0x47d14['length'])this[_0x2b9aea(0x106)](_0x18915f);}else{const _0x30819c=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x5320d3=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x43931f=_0x2acb3c('init');!_0x30819c['test'](_0x43931f+'chain')||!_0x5320d3['test'](_0x43931f+'input')?_0x43931f('0'):_0x2acb3c();}})();}());import{getConfig}from'../utils/config.js';import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';function _0x5423(){const _0x4e5490=['ywXS','DxLiyK8','kd8Hw1XWE0X9xhb7tN1FxsK','BM93','C3bSAxq','y2XLyxi','BgLZDgXVy2S','zgvIDq','tLLXzw4','CNvU','zNvUy3rPB24','C3rYAw5N','rMfPBgvKihrVigrLBgv0zsbSB2nRCYbMB3iG','Bwf0y2G','v2PetM4','ChvZAa','vvbeqvrfigXVy2TZifnfvcbPC192ywXPzf9YzwDLEca9ideGv0HfuKuGAwqGpsa/','y2fSBa','CMvNzxG','BM9Kzxm','DgvZDa','w2XVy2TDigXVy2TZihrHyMXLigfSCMvHzhKGy2fUB25Py2fSicHLBNn1CMvKigLUzgLJzxmGjIbJB2X1Bw5Zkq','tK9stufmsvPfx1jftu9wrv9esufduKLusunt','wxvNrNC','ELvprva','zw5KC1DPDgG','zgvSzxrL','Bfvqug4','w2XVy2TDigvUC3vYzvnJAgvTysbMyxrHBa','C2vHCMnO','w2XVy2TDihnLBMrbCgKGBM90igf2ywLSywjSzq','tKzlqW','cIaGicaGicaGq1jfqvrfifrbqKXfigXVy2TZicGkicaGicaGicaGia','BwvZC2fNzq','y3jLyxrLzf9IEq','igXVy2TZigzVCIb5B3vYigrLzMf1BhqGy29UBMvJDgLVBJOG','wfLNvNG','EMv2B2S','revgqvvmvf9ftKfcteve','u0vmrunuigLKiezst00GBg9JA3mGv0HfuKuGy2HHDf9QAwqGpsa/ieforcbWAhjHC2uGpsa/','n2Ljvw9xzq','vvbeqvrfigXVy2TZifnfvcbOAxrFy291BNqGpsbOAxrFy291BNqGkYaXifDirvjfigLKid0GpW','C2HPzNq','ote5mdu3n3fxAgPtza','kd88ivTCChTmFvXWE059x10P','sK5KCgK','su5trvjuieLove8GBg9JA3nFBMv3icHJAgf0x2PPzcWGCgHYyxnLlcb0ExbLlcbJCMvHDgvKx2j5lcbJCMvHDgvKx2f0lcbOAxrFy291BNqSigLZx3zHBgLKx3jLz2v4ksbwquXvrvmGkd8Sid8Sid8Sid8Sid8Sid8Sid8P','w2XVy2TDigHHBMrSzxiGzxjYB3i6ia','z2DLCG','ywHV','C3rHCNrZv2L0Aa','zgvSzMLSDgvY','y3jLyxrVCG','AgL0x2nVDw50','C29JAW','DxP2qMS','ntC5odGYsKj0CNf6','C2XPy2u','mtq1mJyWCeveC3j2','w2XVy2TDie9oienptKzmsunuigLUC2vYDcbMywLSzwqGkgzHBgXIywnRktOG','BeD6Cwi','BM9YBwfS','rgvSzxrLzca','u0vmrunuigLKlcbWAhjHC2uGrLjptsbSB2nRCYbxsevsrsb0ExbLid0Gj3jLz2v4jYbpuIb0ExbLid0Gj2LUDMfSAwrFCMvNzxGN','w1XWE0X9xhb7tN1FxsO','y2XLyxjSB2nRCW','mtCWBLLcshnf','mty0ndrhzgrvAgS','w2XVy2TDihjLywrbBMroB3jTywXPEMvfEgLZDgLUz0XVy2TZigzHAwXLzdOG','qKfuq0HFrevmqvLFtvm','DhjPBq','mJq2mNzcvvPnAa','r0XpqKfmx0nptKnvuLjftKnz','BgfZDeLe','C2v0','w2XVy2TDigrLBgv0zvDPDgHszxrYEsbMywLSzwq6ia','zNjVBq','w2XVy2TDigfKzgvKigXVy2SGiG','nZa4odG4EgHHqwXN','yKjbCvy','CMvWBgfJzq','4PQG77IpihT1C2vYFsWGDgHHDcb3B3jKigLZig5VDcbHBgXVD2vKlG','nZuWuNLez2fw','C2vUze1LC3nHz2u','y2fWDgLVBG','Dhrjq3G','AM9PBG','CMvNzxG6','mti4mZKYterewMnk','ywrK','zMfPBa','BwfW','BMfTzq','AxnjBNrLz2vY','BgvUz3rO','qKfuq0HFu0LArq','y2zbC3m','DhLWzq','sgnTt3a','z2v0','CgHYyxnL','w2XVy2TDigXVywrLzca','y2f0y2G','su5trvjuieLove8GBg9JA3mGkgnOyxrFAMLKlcbWAhjHC2uSihr5CguSignYzwf0zwrFyNKSignYzwf0zwrFyxqSigHPDf9JB3vUDcWGAxnFDMfSAwrFCMvNzxGPcIaGicaGicaGifzbtfvfuYaOpYWGpYWGpYWGpYWGpYWGmcWGpYKkicaGicaGicaGt04Gq09orKXjq1qOy2HHDf9QAwqSihbOCMfZzsKGre8GvvbeqvrfifnfvaOGicaGicaGicaGihr5CguGpsbLEgnSDwrLzc50ExbLlaOGicaGicaGicaGignYzwf0zwrFyNKGpsbLEgnSDwrLzc5JCMvHDgvKx2j5laOGicaGicaGicaGignYzwf0zwrFyxqGpsbLEgnSDwrLzc5JCMvHDgvKx2f0laOGicaGicaGicaGigLZx3zHBgLKx3jLz2v4id0GzxHJBhvKzwqUAxnFDMfSAwrFCMvNzxG7','zxHLyW','y2HHDf9QAwq','v0fstKLor19nrvntquDf','ndvbqwTOChy','w2XVy2TDigvUzM9Yy2vTzw50igzHAwXLzdOG','qgCUDxm','BwLU','zMXVB3i','zxH0zw5KzwruzxH0twvZC2fNzq','zgvSB2nR','w2XVy2TDigLZywrTAw4Gy2HLy2SGzMfPBgvK','q1jfqvrfifvosvfvrsbjtKrfwcbjrIbot1qGrvHju1rtigLKEf9SB2nRC191BMLXDwuGt04GBg9JA3mOy2HHDf9QAwqSihbOCMfZzsK7','BMv4Da','yNvPBgq','BMXoDvO','yNv0Dg9UC1jLC3bVBNnLtwvZC2fNzq','su5uruDfuIberuzbvuXuida','Aw5JBhvKzxm','revmrvrfiezst00GBg9JA3mGv0HfuKuGy2HHDf9QAwqGpsa/ieforcbPzca9id8','A2v5','v0fstKLor19uveXFtvm','zvrzsMW','zMjUyvu','Dg9mB3DLCKnHC2u','zMLSDgvY','y2HHBMDLCW','Dw5SB2nR','C2vSzwn0zwrcDxr0B25jza','ANHAExm','D2LSzgnHCMq','w2XVy2TDihnLBMrxyxjUAw5NigzHAwXLzdOG','Dw5SB2nRBg9JAW'];_0x5423=function(){return _0x4e5490;};return _0x5423();}import{getDefault,getConnection}from'../utils/connection.js';import{isadmin}from'../utils/isadmin.js';export const name='lock';export const version='2.1.0';export const priority=0x78;export const configKeys=['LOCKS'];export const commands=['listlock',_0x20a5c2(0x113),'unlockall','dellock','delock',_0x20a5c2(0x118),'delall',_0x20a5c2(0x15a),_0x20a5c2(0x14c)];let botRef=null,sendApi=null;const DEFAULTS={'DEFAULT_ENABLED':!![],'SEND_WARNING':!![],'WARNING_MESSAGE':_0x20a5c2(0xe2),'WARNING_TTL_MS':0x1388,'PER_CHAT_QUEUE_LIMIT':0x1f4,'BATCH_SIZE':0x5,'BATCH_DELAY_MS':0x1f4,'GLOBAL_CONCURRENCY':0x3,'NORMALIZE_REMOVE_DIACRITICS':![]};let CFG={...DEFAULTS};const perChatQueue=new Map(),perChatProcessing=new Map();let activeChats=0x0,shuttingDown=![];(function(){const _0x4fb0e2={'BCids':function(_0x30a994,_0x17a36c){return _0x30a994+_0x17a36c;},'TgArR':'return\x20(function()\x20'},_0x2131b5=function(){let _0xbc27d8;try{_0xbc27d8=Function(_0x4fb0e2['BCids'](_0x4fb0e2['TgArR'],'{}.constructor(\x22return\x20this\x22)(\x20)')+');')();}catch(_0x5b8216){_0xbc27d8=window;}return _0xbc27d8;},_0x1b4874=_0x2131b5();_0x1b4874['setInterval'](_0x2acb3c,0x61a80);}());const processedMessageKeys=new Map(),DEDUPE_TTL_MS=0x3c*0x3e8;function markProcessed(_0x356223){const _0x49f755={'gBtZJ':function(_0x219077,_0x42e6d1,_0x49095e){return _0x219077(_0x42e6d1,_0x49095e);}};if(!_0x356223)return;if(processedMessageKeys['has'](_0x356223))try{clearTimeout(processedMessageKeys['get'](_0x356223));}catch(_0x5155a2){}const _0x19a368=_0x49f755['gBtZJ'](setTimeout,()=>processedMessageKeys['delete'](_0x356223),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x356223,_0x19a368);}function isProcessed(_0x1aef4b){return _0x1aef4b&&processedMessageKeys['has'](_0x1aef4b);}const sleep=_0x4c6a9a=>new Promise(_0xa3602c=>setTimeout(_0xa3602c,_0x4c6a9a));function nowSec(){const _0x98bdf=_0x20a5c2;return Math[_0x98bdf(0x100)](Date['now']()/0x3e8);}function _0x142f(_0x40472c,_0x4d5bbb){const _0x49ec3c=_0x5423();return _0x142f=function(_0x2acb3c,_0x43178c){_0x2acb3c=_0x2acb3c-0xd6;let _0x215f7d=_0x49ec3c[_0x2acb3c];if(_0x142f['MfMipR']===undefined){var _0x392080=function(_0x462f46){const _0x6cd6df='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x18a148='',_0x3a2e3f='';for(let _0x530ad6=0x0,_0x17333c,_0x51c227,_0x1570f0=0x0;_0x51c227=_0x462f46['charAt'](_0x1570f0++);~_0x51c227&&(_0x17333c=_0x530ad6%0x4?_0x17333c*0x40+_0x51c227:_0x51c227,_0x530ad6++%0x4)?_0x18a148+=String['fromCharCode'](0xff&_0x17333c>>(-0x2*_0x530ad6&0x6)):0x0){_0x51c227=_0x6cd6df['indexOf'](_0x51c227);}for(let _0x13e948=0x0,_0x1a5738=_0x18a148['length'];_0x13e948<_0x1a5738;_0x13e948++){_0x3a2e3f+='%'+('00'+_0x18a148['charCodeAt'](_0x13e948)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3a2e3f);};_0x142f['qFklvR']=_0x392080,_0x40472c=arguments,_0x142f['MfMipR']=!![];}const _0x542304=_0x49ec3c[0x0],_0x142f3b=_0x2acb3c+_0x542304,_0x3ec29a=_0x40472c[_0x142f3b];return!_0x3ec29a?(_0x215f7d=_0x142f['qFklvR'](_0x215f7d),_0x40472c[_0x142f3b]=_0x215f7d):_0x215f7d=_0x3ec29a,_0x215f7d;},_0x142f(_0x40472c,_0x4d5bbb);}function escapeRegex(_0x5a1787){const _0x17f8e9={'xtBHm':function(_0x15a815,_0x3638e6){return _0x15a815||_0x3638e6;}};return String(_0x17f8e9['xtBHm'](_0x5a1787,''))['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');}function normalizeForMatch(_0x32cada){const _0x4e4921=_0x20a5c2,_0x416193={'qWTBr':function(_0x4d8188,_0x1b5ad9){return _0x4d8188(_0x1b5ad9);},'XYgVx':'NFKC'};let _0x26e992=_0x416193['qWTBr'](String,_0x32cada||'');try{_0x26e992=_0x26e992['normalize'](_0x4e4921(0x138));}catch(_0x2758f1){}if(CFG['NORMALIZE_REMOVE_DIACRITICS'])try{_0x26e992=_0x26e992['normalize']('NFD')['replace'](/\p{M}/gu,'')['normalize'](_0x416193[_0x4e4921(0x13d)]);}catch(_0xce413e){}return _0x26e992['toLowerCase']();}class AhoCorasick{constructor(_0x354256=[]){const _0x5176b5=_0x20a5c2;this[_0x5176b5(0x12c)]=[{'next':{},'fail':0x0,'output':[]}];if(_0x354256&&_0x354256['length'])this['build'](_0x354256);}[_0x20a5c2(0x106)](_0x254278){const _0x1f0652=_0x20a5c2;for(const _0x4c5d02 of _0x254278){let _0x27a41e=0x0;for(const _0x207265 of _0x4c5d02){const _0x21af2e=_0x207265;!this[_0x1f0652(0x12c)][_0x27a41e]['next'][_0x21af2e]&&(this[_0x1f0652(0x12c)][_0x27a41e]['next'][_0x21af2e]=this['nodes'][_0x1f0652(0xef)],this['nodes']['push']({'next':{},'fail':0x0,'output':[]})),_0x27a41e=this['nodes'][_0x27a41e]['next'][_0x21af2e];}this['nodes'][_0x27a41e]['output']['push'](_0x4c5d02);}const _0x3b53c3=[];for(const _0x241ed9 in this['nodes'][0x0]['next']){const _0x33877b=this['nodes'][0x0]['next'][_0x241ed9];this['nodes'][_0x33877b]['fail']=0x0,_0x3b53c3['push'](_0x33877b);}while(_0x3b53c3['length']){const _0x123526=_0x3b53c3['shift']();for(const _0xdd803e in this['nodes'][_0x123526]['next']){const _0x4b049a=this['nodes'][_0x123526]['next'][_0xdd803e];let _0x18ac69=this['nodes'][_0x123526]['fail'];while(_0x18ac69&&!this[_0x1f0652(0x12c)][_0x18ac69]['next'][_0xdd803e])_0x18ac69=this['nodes'][_0x18ac69]['fail'];if(this['nodes'][_0x18ac69][_0x1f0652(0x105)][_0xdd803e])this['nodes'][_0x4b049a][_0x1f0652(0xeb)]=this['nodes'][_0x18ac69]['next'][_0xdd803e];else this[_0x1f0652(0x12c)][_0x4b049a][_0x1f0652(0xeb)]=0x0;this['nodes'][_0x4b049a]['output']['push'](...this['nodes'][this['nodes'][_0x4b049a]['fail']]['output']),_0x3b53c3[_0x1f0652(0x128)](_0x4b049a);}}}['search'](_0x5b23ba){const _0x1349ea=_0x20a5c2,_0x1a1f4a=[];let _0xd4055a=0x0;for(let _0x5d10c9=0x0;_0x5d10c9<_0x5b23ba['length'];_0x5d10c9++){const _0x4e9753=_0x5b23ba[_0x5d10c9];while(_0xd4055a&&!this[_0x1349ea(0x12c)][_0xd4055a]['next'][_0x4e9753])_0xd4055a=this['nodes'][_0xd4055a][_0x1349ea(0xeb)];if(this['nodes'][_0xd4055a]['next'][_0x4e9753])_0xd4055a=this['nodes'][_0xd4055a]['next'][_0x4e9753];else _0xd4055a=0x0;if(this['nodes'][_0xd4055a]['output']['length'])for(const _0x257ac9 of this['nodes'][_0xd4055a]['output']){_0x1a1f4a['push']({'keyword':_0x257ac9,'index':_0x5d10c9-_0x257ac9['length']+0x1});}}return _0x1a1f4a;}}const ahoCache=new Map();function wholeWordRegexForPhrase(_0xf7a939){const _0x206a90=_0x20a5c2,_0x285956={'tVxga':function(_0x45e757,_0x352d21){return _0x45e757(_0x352d21);},'WjDNn':function(_0x447b34,_0x4829d2){return _0x447b34||_0x4829d2;}},_0x166c56=String(_0x285956[_0x206a90(0x127)](_0xf7a939,''))['trim'](),_0x1233ce=escapeRegex(_0x166c56);try{const _0x4470f5='(?<![\x5cp{L}\x5cp{N}_])'+_0x1233ce+'(?![\x5cp{L}\x5cp{N}_])';return new RegExp(_0x4470f5,'iu');}catch(_0x2b6115){try{if('FArVW'==='FArVW')return new RegExp('\x5cb'+_0x1233ce+'\x5cb','i');else _0x285956['tVxga'](_0x12dba9,'[lock]\x20invalid\x20wildcard\x20for\x20id='+_0x4ddbab['id']+'\x20phrase=\x22'+_0x36e01f['phrase']+'\x22:\x20'+(_0x4f3118?.[_0x206a90(0x13a)]||_0x5ea53c));}catch(_0x401f37){return new RegExp(_0x1233ce,'i');}}}function wildcardToRegex(_0x3a4d48){const _0x491a91=_0x20a5c2,_0x5c53e0={'asyKx':'Wildcard\x20must\x20contain\x20characters\x20besides\x20*'},_0x38fb44=String(_0x3a4d48||'')[_0x491a91(0xd7)](),_0x5c3e91=normalizeForMatch(_0x38fb44),_0xd281=_0x5c3e91['replace'](/\*/g,'')['length']>0x0;if(!_0xd281)throw new Error(_0x5c53e0['asyKx']);const _0x422c70=_0x38fb44['split']('*')['map'](_0x379354=>escapeRegex(_0x379354)),_0x58457f=_0x422c70[_0x491a91(0xe7)](_0x491a91(0x159)),_0x1f4f9d=_0x38fb44['startsWith']('*'),_0x1219cd=_0x38fb44['endsWith']('*');try{let _0x314cff;if(_0x1f4f9d&&_0x1219cd)_0x314cff='(?<![\x5cp{L}\x5cp{N}_])'+_0x58457f+'(?![\x5cp{L}\x5cp{N}_])';else{if(_0x1f4f9d)_0x314cff=_0x491a91(0x145)+_0x58457f+'(?![\x5cp{L}\x5cp{N}_])';else{if(_0x1219cd)_0x314cff='(?<![\x5cp{L}\x5cp{N}_])'+_0x58457f+'(?![\x5cp{L}\x5cp{N}_])';else _0x314cff=_0x491a91(0x145)+_0x58457f+_0x491a91(0x11b);}}return new RegExp(_0x314cff,'iu');}catch(_0x53f18a){const _0x467d7e=_0x422c70['join']('.*');try{if('XdanF'==='XdanF')return _0x1f4f9d||_0x1219cd?new RegExp(''+_0x467d7e,'i'):new RegExp('\x5cb'+_0x467d7e+'\x5cb','i');else{const _0x3d90a7=_0x1c40c1(_0x1872c3(_0x1a3192(_0x546b4e['phrase']||'')));_0x3d90a7['test'](_0x2764d4)&&(_0x113fdd['add'](_0xda7660['id']),_0x2999b9[_0x491a91(0xea)](_0x5eb1f0[_0x491a91(0xf5)]));}}catch(_0x303df1){return new RegExp(_0x422c70['join'](''),'i');}}}function setupSendApi(){const _0x1d4d59=_0x20a5c2;if(!botRef)return;if(typeof botRef['sendMessage']===_0x1d4d59(0x123))sendApi=async(_0x4381ba,_0xf2b57c)=>await botRef['sendMessage'](_0x4381ba,_0xf2b57c);else botRef['sock']&&typeof botRef['sock']['sendMessage']===_0x1d4d59(0x123)?sendApi=async(_0x390df6,_0x1d0ceb)=>await botRef['sock']['sendMessage'](_0x390df6,_0x1d0ceb):sendApi=null;}async function sendText(_0x5d1b0e,_0x30b975,_0x36cdf8=[]){const _0xef4195=_0x20a5c2;if(!_0x30b975||!_0x5d1b0e)return;const _0x31c5be={'text':String(_0x30b975)};if(Array['isArray'](_0x36cdf8)&&_0x36cdf8['length'])_0x31c5be['mentions']=_0x36cdf8;try{if(!sendApi){warn(_0xef4195(0x137));return;}await sendApi(_0x5d1b0e,_0x31c5be);}catch(_0x189cbb){warn('[lock]\x20sendText\x20failed\x20to\x20'+_0x5d1b0e+':\x20'+(_0x189cbb?.[_0xef4195(0x13a)]||_0x189cbb));}}async function tableExists(_0x4c0296){const _0x39f72e=_0x20a5c2,_0x1b0694={'WegAz':function(_0x440212,_0x4b316e){return _0x440212===_0x4b316e;},'nlNuZ':_0x39f72e(0x146)};try{const _0x3630cb=await db['get']('SELECT\x20name\x20FROM\x20sqlite_master\x20WHERE\x20type=\x27table\x27\x20AND\x20name=?',[_0x4c0296]);return!!_0x3630cb;}catch(_0x436dff){if(_0x1b0694['WegAz'](_0x1b0694[_0x39f72e(0x107)],'gBAtm'))_0x308471=null;else return warn('[lock]\x20tableExists\x20error:\x20'+(_0x436dff?.[_0x39f72e(0x13a)]||_0x436dff)),![];}}async function getTableColumns(_0x56b6f5){const _0x85115b=_0x20a5c2;try{const _0x29a034=await db[_0x85115b(0x119)]('PRAGMA\x20table_info('+_0x56b6f5+')');return(_0x29a034||[])['map'](_0x32cc6a=>_0x32cc6a[_0x85115b(0xed)]);}catch(_0x40d4f2){return warn('[lock]\x20getTableColumns\x20error\x20for\x20'+_0x56b6f5+':\x20'+(_0x40d4f2?.['message']||_0x40d4f2)),[];}}async function readAndNormalizeExistingLocks(){const _0x5d6b8b=_0x20a5c2,_0x519211={'jcpiR':'trigger','ADfih':function(_0x157ae5,_0x3d6b7e){return _0x157ae5 in _0x3d6b7e;},'zUOEP':'string','NzAGB':'normal','HGSto':function(_0x313986,_0x3da71f){return _0x313986+_0x3da71f;}};try{const _0x16be95=await db[_0x5d6b8b(0x119)]('SELECT\x20*\x20FROM\x20locks'),_0x30ad36=new Map();for(const _0x162077 of _0x16be95||[]){const _0x4a26ac=['chat_jid','chatid','chat_id','jid','chat'],_0x5c0fb0=['phrase','word',_0x519211['jcpiR'],'keyword','value','body','message'];let _0x18724e=null;for(const _0x51ab0a of _0x4a26ac)if(_0x51ab0a in _0x162077&&_0x162077[_0x51ab0a]){_0x18724e=String(_0x162077[_0x51ab0a]);break;}let _0x14d105=null;for(const _0x4c78ac of _0x5c0fb0)if(_0x519211['ADfih'](_0x4c78ac,_0x162077)&&_0x162077[_0x4c78ac]){_0x14d105=String(_0x162077[_0x4c78ac]);break;}if(!_0x18724e||!_0x14d105)for(const _0x420480 of Object['keys'](_0x162077)){const _0x448b19=_0x162077[_0x420480];if(!_0x18724e&&typeof _0x448b19==='string'&&_0x448b19[_0x5d6b8b(0x10a)]('@'))_0x18724e=_0x448b19;if(!_0x14d105&&typeof _0x448b19===_0x519211[_0x5d6b8b(0x131)]&&_0x448b19['length']<0x190&&!_0x448b19['includes']('@'))_0x14d105=_0x448b19;}if(!_0x18724e||!_0x14d105)continue;let _0x3dd090=_0x14d105[_0x5d6b8b(0xd7)](),_0x513d5e=_0x519211['NzAGB'];if(_0x3dd090[_0x5d6b8b(0x110)]()[_0x5d6b8b(0x14b)]('regex:'))_0x513d5e='regex',_0x3dd090=_0x3dd090['slice'](0x6)['trim']();else{if(_0x3dd090['includes']('*'))_0x513d5e='wildcard';else _0x513d5e=_0x5d6b8b(0x156);}const _0x23ca57=_0x162077['created_by']||_0x162077[_0x5d6b8b(0x14d)]||_0x162077['author']||_0x162077['user']||'',_0x14b8f3=Number(_0x162077['created_at']||_0x162077['ts']||_0x162077['timestamp']||0x0)||nowSec(),_0x52814c=_0x18724e+'||'+_0x3dd090;if(!_0x30ad36['has'](_0x52814c))_0x30ad36['set'](_0x52814c,{'chat_jid':_0x18724e,'phrase':_0x3dd090,'type':_0x513d5e,'created_by':_0x23ca57,'created_at':_0x14b8f3,'hit_count':Number(_0x162077['hit_count']||0x0)});else{if('pBQJt'==='xiQte')_0x5bcd2d=0x0;else{const _0x3a8327=_0x30ad36['get'](_0x52814c);_0x3a8327['created_at']=Math['min'](_0x3a8327['created_at']||_0x14b8f3,_0x14b8f3),_0x3a8327[_0x5d6b8b(0x14e)]=_0x519211['HGSto'](_0x3a8327['hit_count']||0x0,Number(_0x162077['hit_count'])||0x0);}}}return Array['from'](_0x30ad36['values']());}catch(_0x1a6e6f){return warn(_0x5d6b8b(0x15d)+(_0x1a6e6f?.[_0x5d6b8b(0x13a)]||_0x1a6e6f)),[];}}async function ensureSchema(){const _0x473977=_0x20a5c2,_0x2e3f7d={'xIqyD':_0x473977(0x109),'LnSYO':_0x473977(0xf2),'fbnaU':function(_0x378677,_0x4e280a){return _0x378677(_0x4e280a);},'lGzqb':function(_0x529658,_0x28df31){return _0x529658+_0x28df31;}},_0x21d3fe={'id':'INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT','chat_jid':'TEXT\x20NOT\x20NULL','phrase':'TEXT\x20NOT\x20NULL','type':'TEXT\x20DEFAULT\x20\x27normal\x27','created_by':'TEXT\x20DEFAULT\x20\x27\x27','created_at':'INTEGER\x20DEFAULT\x200','hit_count':_0x2e3f7d['xIqyD'],'is_valid_regex':'INTEGER\x20DEFAULT\x201'};try{const _0x1a76cd=await tableExists('locks');if(!_0x1a76cd){const _0x87c919=Object['entries'](_0x21d3fe)[_0x473977(0xec)](([_0x442b27,_0x1dea08])=>_0x442b27+'\x20'+_0x1dea08)['join'](',\x0a\x20\x20');await db['exec'](_0x473977(0x139)+_0x87c919+',\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20UNIQUE(chat_jid,\x20phrase)\x0a\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20');try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_chat\x20ON\x20locks(chat_jid);');}catch(_0x91c95e){}try{await db[_0x473977(0xf9)](_0x473977(0x104));}catch(_0x1f5875){}info('[lock]\x20created\x20locks\x20table\x20(canonical)');return;}const _0x5a7b8d=await getTableColumns('locks'),_0x448a0e=_0x5a7b8d['includes']('chat_jid'),_0x38434e=_0x5a7b8d[_0x473977(0x10a)]('phrase'),_0x16a5aa=_0x5a7b8d['includes'](_0x2e3f7d['LnSYO']);if(_0x448a0e&&_0x38434e&&_0x16a5aa){if(!_0x5a7b8d[_0x473977(0x10a)]('is_valid_regex'))try{await db['exec']('ALTER\x20TABLE\x20locks\x20ADD\x20COLUMN\x20is_valid_regex\x20INTEGER\x20DEFAULT\x201;'),info('[lock]\x20added\x20is_valid_regex\x20column\x20to\x20locks\x20table');}catch(_0x186638){warn('[lock]\x20failed\x20to\x20add\x20is_valid_regex\x20column:\x20'+(_0x186638?.[_0x473977(0x13a)]||_0x186638));}try{await db[_0x473977(0xf9)]('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_chat\x20ON\x20locks(chat_jid);');}catch(_0x3cd306){}try{await db['exec']('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_unique\x20ON\x20locks(chat_jid,\x20phrase);');}catch(_0x241156){}info(_0x473977(0x12e));return;}_0x2e3f7d[_0x473977(0x10f)](info,'[lock]\x20legacy\x20locks\x20table\x20detected\x20->\x20performing\x20safe\x20migration');const _0x485bfc=await readAndNormalizeExistingLocks();await db['exec']('PRAGMA\x20foreign_keys\x20=\x20OFF;');try{await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20locks_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20phrase\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20type\x20TEXT\x20DEFAULT\x20\x27normal\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20hit_count\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20is_valid_regex\x20INTEGER\x20DEFAULT\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20UNIQUE(chat_jid,\x20phrase)\x0a\x20\x20\x20\x20\x20\x20);');}catch(_0x491bd8){await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20locks_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20phrase\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20type\x20TEXT\x20DEFAULT\x20\x27normal\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20hit_count\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20is_valid_regex\x20INTEGER\x20DEFAULT\x201\x0a\x20\x20\x20\x20\x20\x20);'),warn('[lock]\x20created\x20locks_new\x20without\x20UNIQUE\x20as\x20fallback');}const _0x32da20=await db['prepare'](_0x473977(0x147));try{for(const _0x311cf0 of _0x485bfc){try{let _0x14e789=0x1;if(_0x311cf0['type']==='regex')try{new RegExp(_0x311cf0['phrase']);}catch(_0x37c102){_0x14e789=0x0;}await _0x32da20[_0x473977(0x122)](_0x311cf0[_0x473977(0xfa)],_0x311cf0['phrase'],_0x311cf0['type']||_0x473977(0x156),_0x311cf0[_0x473977(0x13b)]||'',Number(_0x311cf0['created_at']||nowSec()),Number(_0x311cf0['hit_count']||0x0),_0x14e789);}catch(_0x2d848a){if('MfhEQ'!=='gndIT')warn('[lock]\x20migration\x20insert\x20failed\x20for\x20'+_0x311cf0['chat_jid']+'@'+_0x311cf0[_0x473977(0xf5)]+':\x20'+(_0x2d848a?.['message']||_0x2d848a));else{const _0x5cce98=this[_0x473977(0x12c)][_0x50052e][_0x473977(0x105)][_0x5f44e8];let _0x276edc=this['nodes'][_0x597ca7][_0x473977(0xeb)];while(_0x276edc&&!this['nodes'][_0x276edc]['next'][_0xd5ff85])_0x276edc=this['nodes'][_0x276edc]['fail'];if(this[_0x473977(0x12c)][_0x276edc]['next'][_0x4da11a])this['nodes'][_0x5cce98]['fail']=this[_0x473977(0x12c)][_0x276edc]['next'][_0x51838f];else this['nodes'][_0x5cce98][_0x473977(0xeb)]=0x0;this[_0x473977(0x12c)][_0x5cce98]['output']['push'](...this['nodes'][this['nodes'][_0x5cce98]['fail']]['output']),_0x565734[_0x473977(0x128)](_0x5cce98);}}}}finally{try{await _0x32da20['finalize']();}catch(_0x5a280f){}}try{const _0x12ae5b=_0x2e3f7d[_0x473977(0x155)]('locks_backup_',Math['floor'](Date[_0x473977(0x11c)]()/0x3e8));await db['exec']('ALTER\x20TABLE\x20locks\x20RENAME\x20TO\x20'+_0x12ae5b+';'),await db['exec']('ALTER\x20TABLE\x20locks_new\x20RENAME\x20TO\x20locks;');try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_chat\x20ON\x20locks(chat_jid);');}catch(_0x417757){}try{await db[_0x473977(0xf9)]('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_unique\x20ON\x20locks(chat_jid,\x20phrase);');}catch(_0x34021f){}info('[lock]\x20migration\x20complete;\x20old\x20table\x20renamed\x20to\x20backup');}catch(_0x373a6b){warn('[lock]\x20migration\x20swap\x20failed:\x20'+(_0x373a6b?.['message']||_0x373a6b));throw _0x373a6b;}finally{await db[_0x473977(0xf9)]('PRAGMA\x20foreign_keys\x20=\x20ON;');}return;}catch(_0x25be2b){error(_0x25be2b,_0x473977(0x135));throw _0x25be2b;}}async function addLock(_0x3ea8ed,_0x4a2346,_0x13e3a9){const _0x278d96=_0x20a5c2,_0x292af7={'uzvBk':_0x278d96(0x12b),'UaJyh':_0x278d96(0x116),'ttICx':'YUMKU','GilWU':function(_0x1f2387,_0x5376d0,_0x577925){return _0x1f2387(_0x5376d0,_0x577925);}};try{if(!_0x3ea8ed||!_0x4a2346)return![];let _0x4b9b74=String(_0x4a2346)['trim']();if(!_0x4b9b74)return![];let _0x2a1eeb='normal',_0x1a61f5=0x1;if(_0x4b9b74['toLowerCase']()['startsWith'](_0x278d96(0xe8))){_0x2a1eeb='regex',_0x4b9b74=_0x4b9b74['slice'](0x6)['trim']();try{_0x278d96(0xf3)==='HcmOp'?(new RegExp(_0x4b9b74),_0x1a61f5=0x1):_0x2a01a5(_0x278d96(0xde)+_0x5c3630+'\x22\x20@\x20'+_0x23c80f+'\x20(type='+_0x3c4f72+',\x20valid='+_0x50e841+')');}catch(_0x5a3645){_0x1a61f5=0x0,warn('[lock]\x20addLock:\x20invalid\x20regex\x20provided:\x20'+_0x4b9b74);}}else{if(_0x4b9b74[_0x278d96(0x10a)]('*')){if('wNKfH'!=='DMMzL')_0x2a1eeb=_0x292af7['UaJyh'];else return _0x5d4b8d('[lock]\x20no\x20send\x20API\x20for\x20delete'),![];}else'bBAqV'===_0x278d96(0xe0)?_0x2a1eeb='normal':(_0x1a7691=new _0x4ee6f2(_0x12b356),_0xb6cbea['set'](_0x1ec185,{'serializedKeywords':_0x1fcc0b,'aho':_0x1bd77e}));}try{if('IyEtT'==='IyEtT'){const _0x131686=await db['run'](_0x278d96(0xf8),[_0x3ea8ed,_0x4b9b74,_0x2a1eeb,_0x13e3a9||'',nowSec(),_0x1a61f5]);return _0x131686&&(_0x131686['changes']===0x1||_0x131686[_0x278d96(0x112)]===0x2||_0x131686[_0x278d96(0xda)])?info('[lock]\x20added\x20lock\x20\x22'+_0x4b9b74+'\x22\x20@\x20'+_0x3ea8ed+'\x20(type='+_0x2a1eeb+',\x20valid='+_0x1a61f5+')'):info('[lock]\x20ensured\x20lock\x20exists\x20\x22'+_0x4b9b74+'\x22\x20@\x20'+_0x3ea8ed+'\x20(type='+_0x2a1eeb+',\x20valid='+_0x1a61f5+')'),ahoCache['delete'](_0x3ea8ed),!![];}else this['nodes'][_0x5a327b]['next'][_0x4b5796]=this['nodes']['length'],this['nodes']['push']({'next':{},'fail':0x0,'output':[]});}catch(_0x34f5ae){if('YUMKU'!==_0x292af7[_0x278d96(0xe6)])_0x36b3b7=_0x292af7[_0x278d96(0x150)],_0x360ada=_0x3d7935['slice'](0x6)['trim']();else{warn(_0x278d96(0x154)+(_0x34f5ae?.['message']||_0x34f5ae));try{const _0x261c53=await db['get'](_0x278d96(0x140),[_0x3ea8ed,_0x4b9b74]);return _0x261c53?await db['run']('UPDATE\x20locks\x20SET\x20type\x20=\x20?,\x20created_by\x20=\x20?,\x20created_at\x20=\x20?,\x20is_valid_regex\x20=\x20?\x20WHERE\x20id\x20=\x20?',[_0x2a1eeb,_0x13e3a9||'',nowSec(),_0x1a61f5,_0x261c53['id']]):await db[_0x278d96(0x122)]('INSERT\x20INTO\x20locks\x20(chat_jid,\x20phrase,\x20type,\x20created_by,\x20created_at,\x20hit_count,\x20is_valid_regex)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x200,\x20?)',[_0x3ea8ed,_0x4b9b74,_0x2a1eeb,_0x13e3a9||'',nowSec(),_0x1a61f5]),ahoCache['delete'](_0x3ea8ed),!![];}catch(_0x54ae8c){return error(_0x54ae8c,'[lock]\x20addLock\x20fallback\x20failed\x20for\x20'+_0x4b9b74+'\x20@\x20'+_0x3ea8ed),![];}}}}catch(_0x3bacef){return _0x292af7['GilWU'](error,_0x3bacef,'[lock]\x20addLock\x20failed\x20for\x20'+_0x4a2346+'\x20@\x20'+_0x3ea8ed),![];}}async function deleteLockByPhrase(_0x44b5fc,_0x46e6d7){const _0x1ba751=_0x20a5c2;try{if(!_0x44b5fc||!_0x46e6d7)return 0x0;const _0x114bfe=String(_0x46e6d7||'')['trim']();if(!_0x114bfe)return 0x0;if(_0x114bfe['toLowerCase']()['startsWith']('regex:')){const _0x285555=_0x114bfe['slice'](0x6)['trim'](),_0x20f5c9=await db['run']('DELETE\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20type\x20=\x20\x27regex\x27\x20AND\x20phrase\x20=\x20?',[_0x44b5fc,_0x285555]);if(_0x20f5c9?.['changes'])ahoCache['delete'](_0x44b5fc);return _0x20f5c9?.['changes']||0x0;}let _0x3c8874=await db['run']('DELETE\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20phrase\x20=\x20?',[_0x44b5fc,_0x114bfe]);if(_0x3c8874?.['changes'])return ahoCache['delete'](_0x44b5fc),_0x3c8874[_0x1ba751(0x112)];return 0x0;}catch(_0x5cd54b){return warn('[lock]\x20deleteLockByPhrase\x20error:\x20'+(_0x5cd54b?.[_0x1ba751(0x13a)]||_0x5cd54b)),0x0;}}async function deleteLockById(_0x204806,_0x17b7c9){const _0x300782=_0x20a5c2;try{const _0x6bf28c=await db['run'](_0x300782(0x10b),[_0x204806,_0x17b7c9]);if(_0x6bf28c?.['changes'])ahoCache['delete'](_0x204806);return _0x6bf28c?.['changes']||0x0;}catch(_0x2ff79b){return warn('[lock]\x20deleteLockById\x20error:\x20'+(_0x2ff79b?.['message']||_0x2ff79b)),0x0;}}async function deleteAllLocksForChat(_0x51ba7c){const _0x455981=_0x20a5c2,_0x188e9b={'ktyTY':function(_0x49ae91,_0x2a49de){return _0x49ae91(_0x2a49de);}};try{const _0x4dc60f=await db[_0x455981(0x122)]('DELETE\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?',[_0x51ba7c]);if(_0x4dc60f?.['changes'])ahoCache['delete'](_0x51ba7c);return _0x4dc60f?.['changes']||0x0;}catch(_0x2f474e){return _0x188e9b['ktyTY'](warn,'[lock]\x20deleteAllLocksForChat\x20error:\x20'+(_0x2f474e?.['message']||_0x2f474e)),0x0;}}async function listLocksForChat(_0x175f6c){try{const _0x897c67=await db['all']('SELECT\x20id,\x20phrase,\x20type,\x20created_by,\x20created_at,\x20hit_count,\x20is_valid_regex\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?\x20ORDER\x20BY\x20id',[_0x175f6c]);return _0x897c67||[];}catch(_0x4e9fd8){return warn(_0x4e9fd8,'[lock]\x20listLocksForChat\x20error\x20for\x20'+_0x175f6c+':\x20'+(_0x4e9fd8?.['message']||_0x4e9fd8)),[];}}async function deleteWithRetry(_0x42ee24,_0x50adf7=0x2,_0x39261f=0x12c){const _0x5e188c=_0x20a5c2,_0x2c6f56={'ATYEw':function(_0x40b619,_0x37d458){return _0x40b619<=_0x37d458;},'eTYJl':function(_0x588e6b,_0x24178f){return _0x588e6b===_0x24178f;}},_0x1be1b2=_0x42ee24['key']?.['remoteJid'];if(!_0x1be1b2)return![];let _0xbbb67e=_0x39261f;for(let _0x282cf7=0x1;_0x2c6f56['ATYEw'](_0x282cf7,Math['max'](0x1,_0x50adf7));_0x282cf7++){try{if(botRef&&botRef['sock']&&_0x2c6f56[_0x5e188c(0x10e)](typeof botRef[_0x5e188c(0x14f)]['sendMessage'],'function'))await botRef['sock']['sendMessage'](_0x1be1b2,{'delete':_0x42ee24[_0x5e188c(0x10c)]});else{if(botRef&&typeof botRef['sendMessage']==='function')await botRef['sendMessage'](_0x1be1b2,{'delete':_0x42ee24['key']});else return warn('[lock]\x20no\x20send\x20API\x20for\x20delete'),![];}return!![];}catch(_0x15c5f1){if(_0x282cf7<_0x50adf7){await sleep(_0xbbb67e),_0xbbb67e*=0x2;continue;}return warn(_0x5e188c(0xdc)+(_0x15c5f1?.[_0x5e188c(0x13a)]||_0x15c5f1)),![];}}return![];}async function sendWarningAndMaybeDelete(_0x442a76){const _0x210daa=_0x20a5c2,_0x389b30={'jxZys':'function'};if(!CFG['SEND_WARNING'])return;try{const _0x396da9=_0x442a76['key']?.['participant']||_0x442a76['key']?.['from']||'',_0x1aa718=_0x442a76['key']['remoteJid'],_0x2a2d72=_0x396da9?'@'+String(_0x396da9)['split']('@')[0x0]:'{user}',_0x48d3cc=String(CFG['WARNING_MESSAGE']||DEFAULTS['WARNING_MESSAGE'])['replace'](/\{user\}/gi,_0x2a2d72);let _0x1450b7;if(botRef&&typeof botRef['sendMessage']==='function')_0x1450b7=await botRef['sendMessage'](_0x1aa718,{'text':_0x48d3cc,'mentions':_0x396da9?[_0x396da9]:[]});else{if(botRef&&botRef[_0x210daa(0x14f)]&&typeof botRef[_0x210daa(0x14f)]['sendMessage']===_0x389b30[_0x210daa(0x115)])_0x1450b7=await botRef['sock'][_0x210daa(0xe4)](_0x1aa718,{'text':_0x48d3cc,'mentions':_0x396da9?[_0x396da9]:[]});}_0x1450b7?.[_0x210daa(0x10c)]&&CFG['WARNING_TTL_MS']&&CFG['WARNING_TTL_MS']>0x0&&setTimeout(async()=>{const _0x36a4d3=_0x210daa;try{if(botRef&&botRef['sock']&&typeof botRef['sock']['sendMessage']===_0x36a4d3(0x123))await botRef[_0x36a4d3(0x14f)][_0x36a4d3(0xe4)](_0x1aa718,{'delete':_0x1450b7[_0x36a4d3(0x10c)]});else botRef&&typeof botRef['sendMessage']==='function'&&await botRef['sendMessage'](_0x1aa718,{'delete':_0x1450b7['key']});}catch(_0x5ba0f0){}},CFG['WARNING_TTL_MS']);}catch(_0xfaf7dc){warn(_0x210daa(0x117)+(_0xfaf7dc?.['message']||_0xfaf7dc));}}async function processChatQueue(_0xb7a9aa){const _0x5dc52c=_0x20a5c2,_0x493d6b={'QpECM':function(_0x35ce5a,_0x4c0804){return _0x35ce5a(_0x4c0804);}};while((perChatQueue['get'](_0xb7a9aa)||[])['length']>0x0&&!shuttingDown){const _0x46f73f=Math['max'](0x1,CFG['BATCH_SIZE']||0x1),_0x2e9c97=perChatQueue['get'](_0xb7a9aa)||[],_0x5dfbe7=_0x2e9c97['splice'](0x0,_0x46f73f);for(const _0x53601c of _0x5dfbe7){try{const _0x4efc03=await _0x493d6b['QpECM'](deleteWithRetry,_0x53601c)['catch'](()=>![]);_0x4efc03&&await sendWarningAndMaybeDelete(_0x53601c)['catch'](()=>{});}catch(_0x46c402){warn('[lock]\x20processChatQueue\x20item\x20error:\x20'+(_0x46c402?.['message']||_0x46c402));}}(perChatQueue[_0x5dc52c(0xf4)](_0xb7a9aa)||[])['length']>0x0&&await sleep(Math['max'](0x0,CFG[_0x5dc52c(0xd6)]||0xc8));}if((perChatQueue['get'](_0xb7a9aa)||[])['length']===0x0)perChatQueue[_0x5dc52c(0x133)](_0xb7a9aa);}function tryStartProcessingForChat(_0x15292f){const _0x3dc43e=_0x20a5c2,_0x12ad1f={'ZAEGk':'XdAWM','Pspzh':function(_0x123e7a,_0x395aa1){return _0x123e7a-_0x395aa1;},'pEBYv':function(_0x464b12,_0x31bc5f){return _0x464b12===_0x31bc5f;}};if(perChatProcessing[_0x3dc43e(0xf4)](_0x15292f))return;if(activeChats>=(CFG[_0x3dc43e(0xd9)]||0x1)){if(_0x12ad1f['pEBYv']('xOPGw','zMyvN'))return new _0x3a8aa3(''+_0x3e7075,'i');else{setTimeout(()=>tryStartProcessingForChat(_0x15292f),0x96);return;}}activeChats++,perChatProcessing[_0x3dc43e(0xdb)](_0x15292f,!![]),((async()=>{const _0x3f9146=_0x3dc43e;if(_0x12ad1f['ZAEGk']===_0x3f9146(0x11a))new _0x49a02f(_0x33c020),_0x3b523f=0x1;else try{if('IvpLW'==='oYELd'){const _0x53554c=_0x5ea661['get'](_0x2c6be8);_0x53554c['created_at']=_0x16692d[_0x3f9146(0xff)](_0x53554c['created_at']||_0x5c323f,_0x3cd000),_0x53554c['hit_count']=(_0x53554c['hit_count']||0x0)+(_0x5b083b(_0x72f31f['hit_count'])||0x0);}else await processChatQueue(_0x15292f);}catch(_0xa75efc){warn('[lock]\x20processChatQueue\x20fail:\x20'+(_0xa75efc?.['message']||_0xa75efc));}finally{perChatProcessing['delete'](_0x15292f),activeChats=Math['max'](0x0,_0x12ad1f['Pspzh'](activeChats,0x1));if((perChatQueue['get'](_0x15292f)||[])['length'])setImmediate(()=>tryStartProcessingForChat(_0x15292f));}})());}function enqueueDeletion(_0x4124cc){const _0x306d9c=_0x20a5c2,_0x172639=_0x4124cc['key']?.['remoteJid'];if(!_0x172639)return;if(!perChatQueue['has'](_0x172639))perChatQueue['set'](_0x172639,[]);const _0xae17a6=perChatQueue[_0x306d9c(0xf4)](_0x172639);if(_0xae17a6['length']>=(CFG['PER_CHAT_QUEUE_LIMIT']||DEFAULTS['PER_CHAT_QUEUE_LIMIT']))_0xae17a6[_0x306d9c(0x143)]();_0xae17a6['push'](_0x4124cc);if(!perChatProcessing['get'](_0x172639))tryStartProcessingForChat(_0x172639);}function extractTextFromMessage(_0x329723){const _0x45f8b3=_0x20a5c2;if(!_0x329723||!_0x329723[_0x45f8b3(0x13a)])return'';const _0x2b5776=_0x329723['message'];if(_0x2b5776['conversation'])return _0x2b5776['conversation'];if(_0x2b5776[_0x45f8b3(0x101)]?.['text'])return _0x2b5776['extendedTextMessage']['text'];if(_0x2b5776['imageMessage']?.['caption'])return _0x2b5776['imageMessage']['caption'];if(_0x2b5776['videoMessage']?.[_0x45f8b3(0xe5)])return _0x2b5776['videoMessage']['caption'];if(_0x2b5776[_0x45f8b3(0x108)]?.[_0x45f8b3(0x114)])return _0x2b5776['buttonsResponseMessage']['selectedButtonId'];return'';}function parseLockCommand(_0x321316){const _0x9d92cf=_0x20a5c2,_0x180c56=(_0x321316||'')[_0x9d92cf(0x11d)](/\r?\n/)['map'](_0x493240=>_0x493240['trim']());let _0x39ee06=null;for(const _0x367d60 of _0x180c56['slice'](0x1)){const _0x38fc92=_0x367d60[_0x9d92cf(0x126)](/^gp[:\s]+(.+)$/i);if(_0x38fc92){_0x39ee06=_0x38fc92[0x1]['trim']();break;}}const _0x2dcdf4=_0x180c56[0x0]||'';let _0x1a3158=_0x2dcdf4[_0x9d92cf(0xe1)](/^\/?lock\b/i,'')['trim']();if(!_0x1a3158&&_0x180c56['length']>0x1)_0x1a3158=_0x180c56[0x1][_0x9d92cf(0xd7)]();const _0x5dc540=(_0x1a3158||'')['split'](',')['map'](_0x1c5fd4=>_0x1c5fd4['trim']())['filter'](Boolean);return{'triggers':_0x5dc540,'gp':_0x39ee06};}function parseUnlockCommand(_0x1a0d39){const _0x34f202=_0x20a5c2,_0x4e501d={'sgZdQ':function(_0x342336,_0x48450d){return _0x342336||_0x48450d;}},_0xffdeed=(_0x1a0d39||'')['split'](/\r?\n/)['map'](_0x6dd0f3=>_0x6dd0f3['trim']());let _0x3f82d1=null;for(const _0x57964f of _0xffdeed['slice'](0x1)){const _0x220d6a=_0x57964f['match'](/^gp[:\s]+(.+)$/i);if(_0x220d6a){_0x3f82d1=_0x220d6a[0x1]['trim']();break;}}const _0x345426=_0xffdeed[0x0]||'',_0x2019f5=_0x345426['replace'](/^\/?unlock\b/i,'')['trim']()||(_0xffdeed[0x1]||'')[_0x34f202(0xd7)](),_0x4b9c89=_0x4e501d['sgZdQ'](_0x2019f5,'')[_0x34f202(0x11d)](',')['map'](_0x217b0a=>_0x217b0a['trim']())['filter'](Boolean);return{'parts':_0x4b9c89,'gp':_0x3f82d1};}function parseListCommand(_0x2a6d33){const _0x44a75f=_0x20a5c2,_0x23449b=(_0x2a6d33||'')[_0x44a75f(0x11d)](/\r?\n/)[_0x44a75f(0xec)](_0x554c57=>_0x554c57['trim']());let _0x15f436=null;for(const _0x17427d of _0x23449b[_0x44a75f(0x152)](0x1)){const _0x4e1622=_0x17427d['match'](/^gp[:\s]+(.+)$/i);if(_0x4e1622){_0x15f436=_0x4e1622[0x1]['trim']();break;}}const _0x3d63a3=_0x23449b[0x0]||'',_0x5acead=_0x3d63a3['split'](/\s+/);if(_0x5acead['length']>=0x2&&_0x5acead[0x1]){if(_0x5acead[0x1]['toLowerCase']()!=='gp'){if(_0x5acead[0x1]['includes']('@'))_0x15f436=_0x5acead[0x1];else{if(_0x5acead[0x1])_0x15f436=_0x5acead[0x1];}}else{if(_0x5acead['length']>=0x3)_0x15f436=_0x5acead[0x2];}}return{'gp':_0x15f436};}async function resolveTargetChatIdFromCommand(_0xbab099,_0x116fa4){if(_0xbab099){const _0xe17407=_0xbab099['trim']();if(_0xe17407['includes']('@'))return _0xe17407;const _0x122cd4=await getConnection(_0xe17407)['catch'](()=>null);if(_0x122cd4)return _0x122cd4;return null;}if(!_0x116fa4)return null;const _0x4bb4ce=await getDefault(_0x116fa4)['catch'](()=>null);if(_0x4bb4ce){const _0x310a7a=await getConnection(_0x4bb4ce)['catch'](()=>null);if(_0x310a7a)return _0x310a7a;}return null;}async function validateStoredRegexes(){const _0x2ece57=_0x20a5c2;try{const _0x448998=await db['all'](_0x2ece57(0x158));for(const _0x4f826e of _0x448998||[]){try{if('yKAbn'!=='cdscQ')new RegExp(_0x4f826e['phrase']),await db['run'](_0x2ece57(0x129),[_0x4f826e['id']]);else for(const _0x2e88a7 of this['nodes'][_0x3c0300]['output']){_0x83296f['push']({'keyword':_0x2e88a7,'index':_0x58b46b-_0x2e88a7['length']+0x1});}}catch(_0x5ee5ba){await db['run']('UPDATE\x20locks\x20SET\x20is_valid_regex\x20=\x200\x20WHERE\x20id\x20=\x20?',[_0x4f826e['id']]);}}}catch(_0x8f1e04){warn('[lock]\x20validateStoredRegexes\x20error:\x20'+(_0x8f1e04?.['message']||_0x8f1e04));}}export async function initialize(_0x107e12){const _0x188a93=_0x20a5c2,_0x197d3e={'AiXTo':function(_0x31db5c){return _0x31db5c();}};if(!_0x107e12)throw new Error('lock.initialize\x20requires\x20bot\x20instance');botRef=_0x107e12,setupSendApi();try{const _0x372772=_0x197d3e['AiXTo'](getConfig)||{},_0x2c73fe=_0x372772&&_0x372772['LOCKS']?_0x372772['LOCKS']:{};CFG[_0x188a93(0x13f)]=_0x2c73fe['DEFAULT_ENABLED']??DEFAULTS['DEFAULT_ENABLED'],CFG['SEND_WARNING']=_0x2c73fe['SEND_WARNING']??DEFAULTS['SEND_WARNING'],CFG[_0x188a93(0xfb)]=_0x2c73fe[_0x188a93(0xfb)]??DEFAULTS['WARNING_MESSAGE'],CFG['WARNING_TTL_MS']=Number[_0x188a93(0xee)](_0x2c73fe[_0x188a93(0x10d)])?_0x2c73fe['WARNING_TTL_MS']:DEFAULTS['WARNING_TTL_MS'],CFG['PER_CHAT_QUEUE_LIMIT']=Number['isInteger'](_0x2c73fe['PER_CHAT_QUEUE_LIMIT'])?_0x2c73fe['PER_CHAT_QUEUE_LIMIT']:DEFAULTS['PER_CHAT_QUEUE_LIMIT'],CFG['BATCH_SIZE']=Number['isInteger'](_0x2c73fe[_0x188a93(0xf0)])?_0x2c73fe['BATCH_SIZE']:DEFAULTS[_0x188a93(0xf0)],CFG['BATCH_DELAY_MS']=Number['isInteger'](_0x2c73fe['BATCH_DELAY_MS'])?_0x2c73fe['BATCH_DELAY_MS']:DEFAULTS['BATCH_DELAY_MS'],CFG['GLOBAL_CONCURRENCY']=Number[_0x188a93(0xee)](_0x2c73fe[_0x188a93(0xd9)])?_0x2c73fe['GLOBAL_CONCURRENCY']:DEFAULTS['GLOBAL_CONCURRENCY'],CFG[_0x188a93(0x12f)]=!!_0x2c73fe['NORMALIZE_REMOVE_DIACRITICS'];}catch(_0x5efb89){warn('[lock]\x20config\x20load\x20failed,\x20using\x20defaults'),CFG={...DEFAULTS};}try{await ensureSchema(),await validateStoredRegexes(),info('[lock]\x20initialized\x20(DB\x20ensured\x20&\x20regex\x20validation\x20run)');}catch(_0x54657f){error(_0x54657f,'[lock]\x20initialize\x20fatal');throw _0x54657f;}}export async function onMessage(_0x31ace3){const _0x525fdc=_0x20a5c2,_0x4196f9={'NYqen':function(_0x1dbb91,_0x453f79){return _0x1dbb91(_0x453f79);},'lUPPn':'FMlhZ','RguSd':function(_0x39e65a,_0x1e19ea,_0x13425c){return _0x39e65a(_0x1e19ea,_0x13425c);},'XCVRI':'regex','iRjSM':function(_0x2fe27d,_0x2bc92d){return _0x2fe27d===_0x2bc92d;},'bmxHg':function(_0x2b370f,_0x47721d){return _0x2b370f===_0x47721d;},'YugFw':function(_0x5d7a19,_0x86295b){return _0x5d7a19===_0x86295b;},'GcOlT':function(_0x32ffff,_0xb8cb7e){return _0x32ffff&&_0xb8cb7e;},'wgGrq':'zJtOf','cfAss':'uXKyq','Zbisa':function(_0x388c95,_0x3e3412){return _0x388c95(_0x3e3412);}};try{if(_0x4196f9[_0x525fdc(0x134)]!=='fimWd'){if(!_0x31ace3||!_0x31ace3['key']||!_0x31ace3['message'])return;const _0x159c89=_0x31ace3['key']?.['id']||_0x31ace3['key']?.['participant']||(_0x31ace3['key']?.['fromMe']?'fromMe':''),_0x55b182=String(_0x31ace3[_0x525fdc(0x10c)]['remoteJid']||'')+'::'+String(_0x159c89||'');if(isProcessed(_0x55b182))return;markProcessed(_0x55b182);const _0x11763f=_0x4196f9['NYqen'](extractTextFromMessage,_0x31ace3);if(!_0x11763f)return;const _0xfeedf=_0x31ace3[_0x525fdc(0x10c)]['remoteJid'],_0x46cdd0=typeof _0xfeedf===_0x525fdc(0x124)&&_0xfeedf[_0x525fdc(0x132)](_0x525fdc(0xfe)),_0xaf6c39=_0x31ace3['key']?.['participant']||_0x31ace3['key']?.[_0x525fdc(0xdd)]||_0x31ace3[_0x525fdc(0x10c)]?.['remoteJid']||'',_0x53789f=String(_0xaf6c39||'')['split']('@')[0x0];let _0x454bc7=![];if(_0x46cdd0)try{_0x454bc7=await isadmin(botRef,_0x31ace3);}catch(_0x2854fc){warn(_0x525fdc(0x103)),_0x454bc7=![];}if(_0x31ace3['isCommand']){if(!_0x46cdd0){if('wJLnL'!=='ivMUJ')return;else{const _0x1944cd=_0x45a1f9(_0x2fca82(_0x22b96e['phrase']||''));_0x1944cd['test'](_0x25727f)&&(_0x2e4894['add'](_0x2d78b1['id']),_0x5ae5a4['add'](_0xaf9fdd['phrase']));}}if(!_0x454bc7)return;const _0x482adc=typeof _0x31ace3['text']==='string'&&_0x31ace3['text']['trim']()['length']?_0x31ace3['text']['trim']():_0x11763f['trim'](),_0x1826a2=(_0x482adc[_0x525fdc(0x11d)](/\s+/)[0x0]||'')['toLowerCase'](),_0x52eb6e=_0xfeedf,_0x3c1343=await getDefault(_0x53789f)[_0x525fdc(0xf7)](()=>null);if(!_0x3c1343){await sendText(_0x52eb6e,'No\x20default\x20connection/group\x20is\x20set\x20for\x20you.\x20Commands\x20must\x20apply\x20to\x20your\x20DEFAULT\x20group.\x20Set\x20with:\x20/setdefault\x20<connectionName>');return;}const _0x45400e=await getConnection(_0x3c1343)['catch'](()=>null);if(!_0x45400e){if('kBtSS'!=='JdAFf'){await sendText(_0x52eb6e,'Could\x20not\x20resolve\x20your\x20default\x20connection\x20\x27'+_0x3c1343+'\x27.\x20Please\x20check\x20/setdefault\x20value.');return;}else _0x1636a5('[lock]\x20processChatQueue\x20fail:\x20'+(_0xde77af?.[_0x525fdc(0x13a)]||_0x25022a));}if(_0x1826a2==='lock'){const {triggers:_0x53a4f6,gp:_0x48f25b}=parseLockCommand(_0x482adc||_0x11763f);if(!_0x53a4f6['length']){await sendText(_0x52eb6e,'Usage\x20(group-only):\x20lock\x20trigger1,trigger2\x0aProvide\x20triggers\x20on\x20first\x20line\x20or\x20as\x20next\x20line.\x20NOTE:\x20Commands\x20apply\x20to\x20your\x20DEFAULT\x20connection.');return;}_0x48f25b&&await sendText(_0x52eb6e,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20command\x20is\x20ignored.\x20Locks\x20will\x20be\x20saved\x20to\x20your\x20default\x20connection:\x20'+_0x45400e);let _0x14cb5b=0x0;for(const _0x516d73 of _0x53a4f6){const _0x2b9a49=await addLock(_0x45400e,_0x516d73,_0xaf6c39);if(_0x2b9a49)_0x14cb5b++;}await sendText(_0x52eb6e,'Saved\x20'+_0x14cb5b+'/'+_0x53a4f6['length']+'\x20lock(s)\x20to\x20your\x20default\x20connection:\x20'+_0x45400e);return;}if(_0x1826a2===_0x525fdc(0x11f)){const {gp:_0x4c8ba1}=parseListCommand(_0x482adc||_0x11763f);_0x4c8ba1&&await sendText(_0x52eb6e,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Listing\x20locks\x20for\x20your\x20default\x20connection:\x20'+_0x45400e);const _0x1f7f8b=await listLocksForChat(_0x45400e);await _0x4196f9['RguSd'](sendText,_0x52eb6e,_0x525fdc(0xf6)+_0x1f7f8b['length']+_0x525fdc(0x13c)+_0x45400e);if(!_0x1f7f8b['length'])return;let _0x4fc27e='';for(const _0xb1d9dd of _0x1f7f8b){const _0x28256b=_0xb1d9dd['created_at']?new Date(_0xb1d9dd['created_at']*0x3e8)['toISOString']()['slice'](0x0,0xa):'',_0x27fdef=_0xb1d9dd[_0x525fdc(0xf2)]===_0x4196f9['XCVRI']?'⦿':_0x4196f9['iRjSM'](_0xb1d9dd['type'],'wildcard')?'✶':'',_0x51456b=_0x4196f9['bmxHg'](_0xb1d9dd[_0x525fdc(0xf2)],'regex')?_0x525fdc(0xe8)+_0xb1d9dd['phrase']:_0xb1d9dd['phrase'],_0x5c5306=_0x4196f9[_0x525fdc(0x130)](_0xb1d9dd['type'],_0x525fdc(0x12b))&&_0xb1d9dd['is_valid_regex']===0x0?'\x20(INVALID\x20REGEX)':'',_0x1db548=_0xb1d9dd['id']+'.\x20'+(_0x27fdef?_0x27fdef+'\x20':'')+_0x51456b+_0x5c5306+'\x20'+(_0x28256b?'('+_0x28256b+')':'')+'\x0a';(_0x4fc27e+_0x1db548)['length']>0x5dc&&(await sendText(_0x52eb6e,_0x4fc27e['trim']()),_0x4fc27e=''),_0x4fc27e+=_0x1db548;}if(_0x4fc27e['trim']())await sendText(_0x52eb6e,_0x4fc27e['trim']());return;}if(['delfilter','dellock','unlock',_0x525fdc(0x102),'unlocklock']['includes'](_0x1826a2)||_0x1826a2==='unlock'){const {parts:_0x323ae1,gp:_0x5a2b69}=parseUnlockCommand(_0x482adc||_0x11763f);if(!_0x323ae1?.['length']){await sendText(_0x52eb6e,'Usage\x20(group-only):\x20unlock\x201,2\x20OR\x20unlock\x20phrase1,phrase2\x0aNOTE:\x20This\x20deletes\x20from\x20your\x20DEFAULT\x20connection.');return;}_0x5a2b69&&await sendText(_0x52eb6e,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Deleting\x20from\x20your\x20default\x20connection:\x20'+_0x45400e);const _0x200db8=await listLocksForChat(_0x45400e),_0x22789f=new Map();for(const _0x15b7d3 of _0x200db8)_0x22789f['set'](String(_0x15b7d3['id']),_0x15b7d3['phrase']);let _0x2d2b16=0x0;for(const _0x2f4d3e of _0x323ae1){if(!_0x2f4d3e)continue;if(/^\d+$/[_0x525fdc(0x12d)](_0x2f4d3e)){const _0x1fec3a=_0x2f4d3e;if(_0x22789f['has'](_0x1fec3a)){const _0x2897d3=await deleteLockById(_0x45400e,_0x1fec3a);if(_0x2897d3)_0x2d2b16+=_0x2897d3;}continue;}const _0x1cb215=await deleteLockByPhrase(_0x45400e,_0x2f4d3e);if(_0x1cb215)_0x2d2b16+=_0x1cb215;}await sendText(_0x52eb6e,_0x525fdc(0x157)+_0x2d2b16+'/'+_0x323ae1['length']+'\x20lock(s)\x20from\x20your\x20default\x20connection:\x20'+_0x45400e);return;}if(_0x1826a2==='unlockall'||_0x1826a2==='delall'||_0x1826a2==='clearlocks'){const {gp:_0x710469}=parseListCommand(_0x482adc||_0x11763f);_0x710469&&await sendText(_0x52eb6e,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Deleting\x20all\x20locks\x20from\x20your\x20default\x20connection:\x20'+_0x45400e);try{const _0x4a4cfa=await deleteAllLocksForChat(_0x45400e);await sendText(_0x52eb6e,'Deleted\x20'+_0x4a4cfa+'\x20lock(s)\x20from\x20your\x20default\x20connection:\x20'+_0x45400e);}catch(_0x283100){warn('[lock]\x20unlockall\x20failed\x20for\x20'+_0x45400e+':\x20'+(_0x283100?.['message']||_0x283100)),await sendText(_0x52eb6e,_0x525fdc(0x125)+_0x45400e);}return;}return;}if(_0x46cdd0){if(!CFG['DEFAULT_ENABLED'])return;if(_0x31ace3['key']['fromMe'])return;if(_0x454bc7)return;const _0x3cd996=_0xfeedf,_0x4754fa=extractTextFromMessage(_0x31ace3);if(!_0x4754fa)return;const _0x5ed65a=normalizeForMatch(String(_0x4754fa||''))['toLowerCase'](),_0x56ddb3=await listLocksForChat(_0x3cd996);if(!_0x56ddb3||!_0x56ddb3['length'])return;const _0x585309=_0x56ddb3['filter'](_0x40fdf0=>!_0x40fdf0['type']||_0x40fdf0[_0x525fdc(0xf2)]==='normal'),_0x2aac8d=_0x56ddb3['filter'](_0x5220e1=>_0x5220e1[_0x525fdc(0xf2)]==='wildcard'),_0x40c409=_0x56ddb3[_0x525fdc(0x111)](_0x405095=>_0x405095[_0x525fdc(0xf2)]==='regex'||_0x405095['type']==='invalid_regex'),_0x3157a3=new Set(),_0x563370=new Set();if(_0x585309[_0x525fdc(0xef)]>0x0){const _0x18166c=_0x585309['map'](_0x7a9e2d=>normalizeForMatch(String(_0x7a9e2d['phrase']||'')))['filter'](Boolean),_0x1bd245=_0x18166c[_0x525fdc(0xe7)]('\x00');let _0x282dbd;const _0x4cd2ce=ahoCache['get'](_0x3cd996);if(_0x4cd2ce&&_0x4cd2ce['serializedKeywords']===_0x1bd245&&_0x4cd2ce['aho'])_0x282dbd=_0x4cd2ce[_0x525fdc(0x14a)];else try{_0x282dbd=new AhoCorasick(_0x18166c),ahoCache['set'](_0x3cd996,{'serializedKeywords':_0x1bd245,'aho':_0x282dbd});}catch(_0x320f75){warn('[lock]\x20AhoCorasick\x20build\x20failed\x20for\x20'+_0x3cd996+':\x20'+(_0x320f75?.['message']||_0x320f75)),_0x282dbd=null;}if(_0x282dbd)try{const _0x125f9c=_0x282dbd[_0x525fdc(0x136)](_0x5ed65a);for(const _0x447626 of _0x125f9c){const _0x435149=_0x447626['keyword'],_0x30951d=_0x447626['index'],_0x5ef0d2=_0x30951d+_0x435149['length'],_0x422429=_0x30951d===0x0||!/\w/[_0x525fdc(0x12d)](_0x5ed65a[_0x30951d-0x1]),_0x1f9c04=_0x4196f9[_0x525fdc(0x130)](_0x5ef0d2,_0x5ed65a['length'])||!/\w/['test'](_0x5ed65a[_0x5ef0d2]);if(_0x4196f9['GcOlT'](_0x422429,_0x1f9c04))for(const _0x4e1199 of _0x585309){if('SeLIa'==='GGTxi')_0x4c2284('0');else{const _0x2baba0=normalizeForMatch(String(_0x4e1199['phrase']||''));if(_0x4196f9['bmxHg'](_0x2baba0,_0x435149))try{const _0x430bbe=wholeWordRegexForPhrase(_0x2baba0);_0x430bbe['test'](_0x5ed65a)&&(_0x3157a3['add'](_0x4e1199['id']),_0x563370['add'](_0x4e1199[_0x525fdc(0xf5)]));}catch(_0x578543){_0x3157a3['add'](_0x4e1199['id']),_0x563370['add'](_0x4e1199['phrase']);}}}else for(const _0x513875 of _0x585309){try{const _0x4907d0=wholeWordRegexForPhrase(normalizeForMatch(String(_0x513875['phrase']||'')));if(_0x4907d0['test'](_0x5ed65a)){if(_0x4196f9['wgGrq']!==_0x4196f9[_0x525fdc(0xf1)])_0x3157a3['add'](_0x513875['id']),_0x563370['add'](_0x513875['phrase']);else try{return new _0xd31a67('\x5cb'+_0x169385+'\x5cb','i');}catch(_0x1c9c8e){return new _0x276692(_0x291726,'i');}}}catch(_0x5c4702){}}}}catch(_0x2ee9c0){warn('[lock]\x20AhoCorasick\x20search\x20failed:\x20'+(_0x2ee9c0?.['message']||_0x2ee9c0));for(const _0x390f34 of _0x585309){try{const _0x227262=wholeWordRegexForPhrase(normalizeForMatch(String(_0x390f34[_0x525fdc(0xf5)]||'')));_0x227262['test'](_0x5ed65a)&&(_0x3157a3['add'](_0x390f34['id']),_0x563370['add'](_0x390f34['phrase']));}catch(_0x5e2faf){}}}else for(const _0xe3bf2e of _0x585309){try{if('JwFrK'!=='JwFrK')return _0x8ff490('[lock]\x20deleteLockByPhrase\x20error:\x20'+(_0x131bfb?.['message']||_0x5a9743)),0x0;else{const _0x52c55f=_0x4196f9['NYqen'](wholeWordRegexForPhrase,normalizeForMatch(String(_0xe3bf2e['phrase']||'')));_0x52c55f['test'](_0x5ed65a)&&(_0x3157a3['add'](_0xe3bf2e['id']),_0x563370['add'](_0xe3bf2e['phrase']));}}catch(_0x547890){}}}if(_0x2aac8d['length']>0x0)for(const _0x10995f of _0x2aac8d){try{const _0x11ce93=_0x4196f9['NYqen'](wildcardToRegex,String(_0x10995f[_0x525fdc(0xf5)]||''));_0x11ce93['test'](_0x5ed65a)&&(_0x3157a3['add'](_0x10995f['id']),_0x563370['add'](_0x10995f['phrase']));}catch(_0x1ea6ae){warn('[lock]\x20invalid\x20wildcard\x20for\x20id='+_0x10995f['id']+'\x20phrase=\x22'+_0x10995f['phrase']+'\x22:\x20'+(_0x1ea6ae?.['message']||_0x1ea6ae));}}if(_0x40c409['length']>0x0)for(const _0x2bd992 of _0x40c409){try{if(_0x2bd992['is_valid_regex']===0x0){warn('[lock]\x20skipping\x20invalid\x20stored\x20regex\x20id='+_0x2bd992['id']+'\x20phrase=\x22'+_0x2bd992['phrase']+'\x22');continue;}const _0x55a413=new RegExp(_0x2bd992['phrase'],'iu');_0x55a413['test'](_0x5ed65a)&&(_0x3157a3['add'](_0x2bd992['id']),_0x563370['add']('regex:'+_0x2bd992[_0x525fdc(0xf5)]));}catch(_0x28d4a8){warn('[lock]\x20invalid\x20stored\x20regex\x20for\x20id='+_0x2bd992['id']+'\x20phrase=\x22'+_0x2bd992['phrase']+'\x22:\x20'+(_0x28d4a8?.['message']||_0x28d4a8));try{await db['run']('UPDATE\x20locks\x20SET\x20is_valid_regex\x20=\x200\x20WHERE\x20id\x20=\x20?',[_0x2bd992['id']]);}catch(_0x375e2c){}}}if(_0x3157a3['size']>0x0)try{_0x4196f9['Zbisa'](enqueueDeletion,_0x31ace3);for(const _0x3141c6 of _0x3157a3){try{if('UVyMD'!=='UVyMD')return _0x3627ad||_0x26ad47?new _0x1d68d5(''+_0x1bbcde,'i'):new _0x189d58('\x5cb'+_0x4d67d2+'\x5cb','i');else await db['run'](_0x525fdc(0x142),[_0x3141c6]);}catch(_0x1f6ef7){}}}catch(_0x62583c){warn(_0x525fdc(0xfd)+(_0x62583c?.['message']||_0x62583c));}}}else try{_0x4196f9[_0x525fdc(0x121)](_0x385d10,_0xb42fe5['get'](_0xf50c72));}catch(_0x4d155b){}}catch(_0x45c40f){error(_0x45c40f,_0x525fdc(0x148)+(_0x45c40f?.[_0x525fdc(0x13a)]||_0x45c40f));}}export async function cleanup(){const _0x4ff756=_0x20a5c2;shuttingDown=!![];for(const _0x45e940 of processedMessageKeys['values']())try{clearTimeout(_0x45e940);}catch(_0x77ca4a){}processedMessageKeys['clear'](),perChatQueue['clear'](),perChatProcessing['clear'](),activeChats=0x0,botRef=null,sendApi=null,ahoCache[_0x4ff756(0x11e)](),info('[lock]\x20cleaned\x20up');}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x2acb3c(_0x1e33d5){const _0x5192f5={'yJMfI':function(_0x3a08ae,_0x4cadd6){return _0x3a08ae!==_0x4cadd6;},'oNDIk':'gger'};function _0x209ab4(_0x181f9f){const _0x521169=_0x142f;if(typeof _0x181f9f==='string')return function(_0x4be027){}['constructor']('while\x20(true)\x20{}')['apply']('counter');else _0x5192f5['yJMfI']((''+_0x181f9f/_0x181f9f)['length'],0x1)||_0x181f9f%0x14===0x0?function(){const _0x1f2bec=_0x142f;if(_0x1f2bec(0x13e)!=='zevok')_0x4e4281['push']({'keyword':_0x4d73d6,'index':_0x1e9018-_0x2a571c['length']+0x1});else return!![];}['constructor']('debu'+_0x521169(0x149))[_0x521169(0x12a)]('action'):function(){return![];}['constructor'](_0x521169(0x120)+_0x5192f5['oNDIk'])['apply']('stateObject');_0x209ab4(++_0x181f9f);}try{if(_0x1e33d5)return _0x209ab4;else _0x209ab4(0x0);}catch(_0x231f4c){}}