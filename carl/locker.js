const _0x3dfcf3=_0x3f3b;(function(_0x474679,_0x12ad65){const _0x152fb7=_0x3f3b,_0x4f4698=_0x474679();while(!![]){try{const _0x5079c9=-parseInt(_0x152fb7(0xea))/0x1*(-parseInt(_0x152fb7(0xcd))/0x2)+parseInt(_0x152fb7(0xe6))/0x3+parseInt(_0x152fb7(0xb1))/0x4*(-parseInt(_0x152fb7(0xce))/0x5)+parseInt(_0x152fb7(0x72))/0x6*(parseInt(_0x152fb7(0x70))/0x7)+-parseInt(_0x152fb7(0x91))/0x8+-parseInt(_0x152fb7(0x9c))/0x9*(parseInt(_0x152fb7(0xed))/0xa)+parseInt(_0x152fb7(0xa8))/0xb*(parseInt(_0x152fb7(0xdf))/0xc);if(_0x5079c9===_0x12ad65)break;else _0x4f4698['push'](_0x4f4698['shift']());}catch(_0x7f5e0a){_0x4f4698['push'](_0x4f4698['shift']());}}}(_0x7fa5,0x355e1));const _0x1c086c=(function(){let _0x4e0f18=!![];return function(_0xc584bc,_0x59bd0e){const _0x4a5955=_0x4e0f18?function(){if(_0x59bd0e){const _0x224263=_0x59bd0e['apply'](_0xc584bc,arguments);return _0x59bd0e=null,_0x224263;}}:function(){};return _0x4e0f18=![],_0x4a5955;};}());(function(){const _0x2d8290={'tSvXg':function(_0x401f89,_0x44ee4d){return _0x401f89+_0x44ee4d;}};_0x1c086c(this,function(){const _0xe95335=_0x3f3b,_0x26936f=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0xaf936e=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x2472c5=_0x5476af(_0xe95335(0xd7));!_0x26936f[_0xe95335(0x7b)](_0x2d8290['tSvXg'](_0x2472c5,'chain'))||!_0xaf936e['test'](_0x2472c5+'input')?_0x2472c5('0'):_0x5476af();})();}());import{getConfig}from'../utils/config.js';import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{getDefault,getConnection}from'../utils/connection.js';import{isadmin}from'../utils/isadmin.js';export const name='lock';export const version='2.1.0';export const priority=0x78;export const configKeys=['LOCKS'];export const commands=['listlock',_0x3dfcf3(0x88),'unlockall',_0x3dfcf3(0xca),'delock','unlocklock','delall','clearlocks','delfilter'];let botRef=null,sendApi=null;const DEFAULTS={'DEFAULT_ENABLED':!![],'SEND_WARNING':!![],'WARNING_MESSAGE':'⚠️\x20{user},\x20that\x20word\x20is\x20not\x20allowed.','WARNING_TTL_MS':0x1388,'PER_CHAT_QUEUE_LIMIT':0x1f4,'BATCH_SIZE':0x5,'BATCH_DELAY_MS':0x1f4,'GLOBAL_CONCURRENCY':0x3,'NORMALIZE_REMOVE_DIACRITICS':![]};function _0x7fa5(){const _0x13f158=['revgqvvmvf9ftKfcteve','Dgv4Da','B1zcu2W','y2HHDa','AxnFDMfSAwrFCMvNzxG','qKfuq0HFu0LArq','zxH0zw5KzwruzxH0twvZC2fNzq','BwvZC2fNzq','mtq1ota2mMvyr1rLzG','w2XVy2TDigXLz2fJEsbSB2nRCYb0ywjSzsbKzxrLy3rLzcaTpIbWzxjMB3jTAw5NihnHzMuGBwLNCMf0Aw9U','CgHYyxnL','zgvSzxrL','BgfZDeLe','tKzlqW','BM9Kzxm','w2XVy2TDie9oienptKzmsunuigLUC2vYDcbMywLSzwqGkgzHBgXIywnRktOG','BM9YBwfSAxPL','ndG4sK1MsevL','CfPZwLy','w2XVy2TDig1Pz3jHDgLVBIbZD2fWigzHAwXLzdOG','uKHbug8','AgfZ','kd8Hw1XWE0X9xhb7tN1FxsK','DhjPz2DLCG','ChvZAa','Bg9JAW','vxnHz2uGkgDYB3vWlw9UBhKPoIb1BMXVy2SGmsWYie9sihvUBg9JAYbWAhjHC2uXlhbOCMfZztiktK9urtOGvgHPCYbKzwXLDgvZigzYB20GEw91CIberuzbvuXuignVBM5Ly3rPB24U','C2vSzwn0zwrcDxr0B25jza','AxnjBNrLz2vY','igXVy2SOCYKGDg8GEw91CIbKzwzHDwX0ignVBM5Ly3rPB246ia','rgzWyKS','qKfuq0HFrevmqvLFtvm','DMLKzw9nzxnZywDL','u0vmrunuigLKlcbWAhjHC2uSihr5CguSignYzwf0zwrFyNKSignYzwf0zwrFyxqSigHPDf9JB3vUDcWGAxnFDMfSAwrFCMvNzxGGrLjptsbSB2nRCYbxsevsrsbJAgf0x2PPzca9id8Gt1jerviGqLKGAwq','y2HHBMDLCW','w2XVy2TDigrLBgv0zvDPDgHszxrYEsbMywLSzwq6ia','BM93','v0fstKLor19nrvntquDf','w2XVy2TDigLZywrTAw4Gy2HLy2SGzMfPBgvK','AM9PBG','u0vmrunuigLKlcbWAhjHC2uGrLjptsbSB2nRCYbxsevsrsb0ExbLid0Gj3jLz2v4jYbpuIb0ExbLid0Gj2LUDMfSAwrFCMvNzxGN','CMvTB3rLsMLK','zgvSBg9JAW','BM9YBwfS','C2vUze1LC3nHz2u','mNflwM5rra','nJuZmhPXDxftrW','A2v5','w2XVy2TDihbYB2nLC3ndAgf0uxvLDwuGzMfPBdOG','w2XVy2TDiefOB0nVCMfZAwnRigj1AwXKigzHAwXLzcbMB3iG','vwTgyMy','ufjbr01bihrHyMXLx2LUzM8O','D2LSzgnHCMq','icH0ExbLpq','EhreC00','Aw5PDa','zNvUy3rPB24','vxnnvhO','z2v0','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','B3v0Chv0','ywXS','CMv0DxjUicHMDw5JDgLVBIGPia','mtjQwu1osva','BgvUz3rO','CMvNzxG6','tK9stufmsvPfx1jftu9wrv9esufduKLusunt','C3rHDgvpyMPLy3q','ufjbr01bigzVCMvPz25FA2v5CYa9ie9ooW','w2XVy2TDigzHAwXLzcb0BYbHzgqGAxnFDMfSAwrFCMvNzxGGy29SDw1UoIa','nZeXmduXsfzyvMH0','wLbssee','yxv0Ag9Y','B0D2ywm','mZy4mtGYrfzSswjK','w2XVy2TDigrLBgv0zufSBeXVy2TZrM9Yq2HHDcbLCNjVCJOG','w2XVy2TDigLUDMfSAwqGD2LSzgnHCMqGzM9YigLKpq','nJeWsMnwtKnc','ihbOCMfZzt0I','zNjVBq','C29JAW','w2XVy2TDihjLywrbBMroB3jTywXPEMvfEgLZDgLUz0XVy2TZigzHAwXLzdOG','uevsx0niqvrFuvvfvuvFteLnsvq','DhLWzq','EvLxs3a','CMvWBgfJzq','v2LSzgnHCMqGBxvZDcbJB250ywLUignOyxjHy3rLCNmGyMvZAwrLCYaQ','n0jhvej5Ca','C3rHCNrZv2L0Aa','mZa3mZjHyLrkzNu','Bwf4','DhjPBq','te9ds1m','y2HHDf9Pza','q1vkvwC','wM92wxe','w2XVy2TDigvUC3vYzvnJAgvTysbMyxrHBa','zxHLyW','DgvZDa','cIaGicaGicaGq1jfqvrfifrbqKXfigXVy2TZicGkicaGicaGicaGia','w2XVy2TDig1Pz3jHDgLVBIbJB21WBgv0ztSGB2XKihrHyMXLihjLBMfTzwqGDg8GyMfJA3vW','yM9KEq','BMv4Da','ww9kDxi','tM90AwnLoIaNz3aNihbHCMfTzxrLCIbPCYbPz25VCMvKlIbezwXLDgLUzYbMCM9TihLVDxiGzgvMyxvSDcbJB25Uzwn0Aw9UoIa','r0XpqKfmx0nptKnvuLjftKnz','vvbeqvrfigXVy2TZifnfvcbOAxrFy291BNqGpsbOAxrFy291BNqGkYaXifDirvjfigLKid0GpW','w2XVy2TDigrLBgv0zuXVy2TcEuLKigvYCM9YoIa','zgvSB2nR','yNvPBgq','wxzwr0m','Dw5SB2nR','ywrK','igXVy2SOCYKGzNjVBsb5B3vYigrLzMf1BhqGy29UBMvJDgLVBJOG','C3bSAxq','Aw5JBhvKzxm','CNvU','y3jLyxrLzf9HDa','DgLTzxn0yw1W','rxrSAfy','mZi5nteYBvvbqwzT','EMDxvKe','BwvUDgLVBNm','zMfPBa','Aw5KzxG','BwfW','t1LvDMq','y29UC3rYDwn0B3i','q2v1CLy','sLLHwxG','C2XPy2u','ndC3odfQwuv3A0m','w2XVy2TDigvUC3vYzwqGBg9JAYbLEgLZDhmGiG','C2v0','qgCUDxm'];_0x7fa5=function(){return _0x13f158;};return _0x7fa5();}let CFG={...DEFAULTS};const perChatQueue=new Map(),perChatProcessing=new Map();let activeChats=0x0,shuttingDown=![];const processedMessageKeys=new Map(),DEDUPE_TTL_MS=0x3c*0x3e8;function markProcessed(_0xd071ac){const _0x413d3f={'rMcbo':function(_0x303ae5,_0x5bc9b9){return _0x303ae5(_0x5bc9b9);},'phzIc':function(_0x571d18,_0x311e5a,_0x9d7716){return _0x571d18(_0x311e5a,_0x9d7716);}};if(!_0xd071ac)return;if(processedMessageKeys['has'](_0xd071ac))try{_0x413d3f['rMcbo'](clearTimeout,processedMessageKeys['get'](_0xd071ac));}catch(_0x4e5ed8){}const _0x2a817e=_0x413d3f['phzIc'](setTimeout,()=>processedMessageKeys['delete'](_0xd071ac),DEDUPE_TTL_MS);processedMessageKeys['set'](_0xd071ac,_0x2a817e);}function isProcessed(_0x314fa1){return _0x314fa1&&processedMessageKeys['has'](_0x314fa1);}const sleep=_0x57d419=>new Promise(_0x4dc65e=>setTimeout(_0x4dc65e,_0x57d419));function nowSec(){const _0x2ca055=_0x3dfcf3;return Math['floor'](Date[_0x2ca055(0xc4)]()/0x3e8);}function escapeRegex(_0x313abe){return String(_0x313abe||'')['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');}function normalizeForMatch(_0x293f4d){const _0x2e0093=_0x3dfcf3;let _0x2d6906=String(_0x293f4d||'');try{_0x2d6906=_0x2d6906[_0x2e0093(0xb0)]('NFKC');}catch(_0x170b2b){}if(CFG['NORMALIZE_REMOVE_DIACRITICS'])try{_0x2d6906=_0x2d6906['normalize']('NFD')['replace'](/\p{M}/gu,'')['normalize'](_0x2e0093(0xad));}catch(_0x304604){}return _0x2d6906['toLowerCase']();}class AhoCorasick{constructor(_0x13580b=[]){const _0x26dc54=_0x3dfcf3;this['nodes']=[{'next':{},'fail':0x0,'output':[]}];if(_0x13580b&&_0x13580b['length'])this[_0x26dc54(0x86)](_0x13580b);}[_0x3dfcf3(0x86)](_0x25ad2b){const _0x2d5472=_0x3dfcf3,_0x4c14f7={'JXNYV':'NFD','wDGVy':function(_0x559654,_0x1a5c19){return _0x559654!==_0x1a5c19;},'pZsZV':'dckRY'};for(const _0x1f1610 of _0x25ad2b){let _0x11441e=0x0;for(const _0x214a05 of _0x1f1610){const _0x24d775=_0x214a05;!this['nodes'][_0x11441e]['next'][_0x24d775]&&(this[_0x2d5472(0xae)][_0x11441e]['next'][_0x24d775]=this['nodes']['length'],this['nodes']['push']({'next':{},'fail':0x0,'output':[]})),_0x11441e=this['nodes'][_0x11441e]['next'][_0x24d775];}this['nodes'][_0x11441e]['output']['push'](_0x1f1610);}const _0x157487=[];for(const _0x44ec25 in this['nodes'][0x0]['next']){const _0x2a6db2=this['nodes'][0x0]['next'][_0x44ec25];this['nodes'][_0x2a6db2]['fail']=0x0,_0x157487['push'](_0x2a6db2);}while(_0x157487['length']){const _0xb13e4b=_0x157487['shift']();for(const _0x4dd182 in this['nodes'][_0xb13e4b]['next']){if(_0x4c14f7['wDGVy']('nAkCx',_0x4c14f7[_0x2d5472(0xb2)])){const _0x460e26=this['nodes'][_0xb13e4b]['next'][_0x4dd182];let _0x490e1e=this[_0x2d5472(0xae)][_0xb13e4b]['fail'];while(_0x490e1e&&!this['nodes'][_0x490e1e][_0x2d5472(0x7f)][_0x4dd182])_0x490e1e=this['nodes'][_0x490e1e]['fail'];if(this[_0x2d5472(0xae)][_0x490e1e]['next'][_0x4dd182])this[_0x2d5472(0xae)][_0x460e26][_0x2d5472(0x94)]=this[_0x2d5472(0xae)][_0x490e1e]['next'][_0x4dd182];else this[_0x2d5472(0xae)][_0x460e26][_0x2d5472(0x94)]=0x0;this['nodes'][_0x460e26][_0x2d5472(0xdc)][_0x2d5472(0xb8)](...this[_0x2d5472(0xae)][this['nodes'][_0x460e26]['fail']]['output']),_0x157487['push'](_0x460e26);}else try{_0x48e8c2=_0x37febf['normalize'](_0x4c14f7['JXNYV'])['replace'](/\p{M}/gu,'')[_0x2d5472(0xb0)]('NFKC');}catch(_0x376a7a){}}}}['search'](_0x37c315){const _0x127366=_0x3dfcf3,_0x397048=[];let _0x559ac6=0x0;for(let _0x2c825e=0x0;_0x2c825e<_0x37c315[_0x127366(0xe0)];_0x2c825e++){const _0x543101=_0x37c315[_0x2c825e];while(_0x559ac6&&!this[_0x127366(0xae)][_0x559ac6]['next'][_0x543101])_0x559ac6=this['nodes'][_0x559ac6][_0x127366(0x94)];if(this['nodes'][_0x559ac6]['next'][_0x543101])_0x559ac6=this[_0x127366(0xae)][_0x559ac6]['next'][_0x543101];else _0x559ac6=0x0;if(this['nodes'][_0x559ac6]['output']['length'])for(const _0x3061b9 of this[_0x127366(0xae)][_0x559ac6][_0x127366(0xdc)]){_0x397048['push']({'keyword':_0x3061b9,'index':_0x2c825e-_0x3061b9['length']+0x1});}}return _0x397048;}}const ahoCache=new Map();function wholeWordRegexForPhrase(_0x47781a){const _0x34f78b={'wPcsg':function(_0x33722e,_0x38bd2d){return _0x33722e||_0x38bd2d;}},_0x2ee106=String(_0x34f78b['wPcsg'](_0x47781a,''))['trim'](),_0xbc42c3=escapeRegex(_0x2ee106);try{const _0x517d64='(?<![\x5cp{L}\x5cp{N}_])'+_0xbc42c3+'(?![\x5cp{L}\x5cp{N}_])';return new RegExp(_0x517d64,'iu');}catch(_0x1e17cf){try{return new RegExp('\x5cb'+_0xbc42c3+'\x5cb','i');}catch(_0x962a6c){return new RegExp(_0xbc42c3,'i');}}}function wildcardToRegex(_0x2dc3cd){const _0x4d3288=_0x3dfcf3,_0x34419e={'bltNR':function(_0x3c5791,_0xafc8e3){return _0x3c5791(_0xafc8e3);},'uKSVw':_0x4d3288(0x6f),'yYWKp':function(_0xfc9f6b,_0x13c865){return _0xfc9f6b===_0x13c865;}},_0x44f815=_0x34419e['bltNR'](String,_0x2dc3cd||'')['trim'](),_0xed840c=normalizeForMatch(_0x44f815),_0x3be623=_0xed840c['replace'](/\*/g,'')[_0x4d3288(0xe0)]>0x0;if(!_0x3be623)throw new Error(_0x34419e['uKSVw']);const _0x5306f7=_0x44f815['split']('*')['map'](_0x4ed17f=>escapeRegex(_0x4ed17f)),_0x595788=_0x5306f7['join']('[\x5cp{L}\x5cp{N}_]*'),_0x3e7a6c=_0x44f815[_0x4d3288(0x71)]('*'),_0x11c9fc=_0x44f815['endsWith']('*');try{let _0x1650d3;if(_0x3e7a6c&&_0x11c9fc)_0x1650d3='(?<![\x5cp{L}\x5cp{N}_])'+_0x595788+_0x4d3288(0xb6);else{if(_0x3e7a6c)_0x1650d3='(?<![\x5cp{L}\x5cp{N}_])'+_0x595788+'(?![\x5cp{L}\x5cp{N}_])';else{if(_0x11c9fc)_0x1650d3='(?<![\x5cp{L}\x5cp{N}_])'+_0x595788+'(?![\x5cp{L}\x5cp{N}_])';else _0x1650d3='(?<![\x5cp{L}\x5cp{N}_])'+_0x595788+'(?![\x5cp{L}\x5cp{N}_])';}}return new RegExp(_0x1650d3,'iu');}catch(_0x299df3){const _0x164b06=_0x5306f7['join']('.*');try{if(_0x3e7a6c||_0x11c9fc)return new RegExp(''+_0x164b06,'i');else{if(_0x34419e[_0x4d3288(0x6d)]('ZovYq',_0x4d3288(0x78)))return new RegExp('\x5cb'+_0x164b06+'\x5cb','i');else _0x584249('0');}}catch(_0xa988a3){return new RegExp(_0x5306f7['join'](''),'i');}}}function setupSendApi(){const _0x1c1229=_0x3dfcf3;if(!botRef)return;if(typeof botRef['sendMessage']==='function')'cZxNY'!=='OCdgx'?sendApi=async(_0x248548,_0x1acf75)=>await botRef[_0x1c1229(0xcc)](_0x248548,_0x1acf75):_0x44b3a5('[lock]\x20sendText\x20failed\x20to\x20'+_0x20507d+':\x20'+(_0x60e083?.['message']||_0x448e5d));else botRef['sock']&&typeof botRef['sock']['sendMessage']==='function'?sendApi=async(_0x1a87ce,_0x73c1bf)=>await botRef['sock']['sendMessage'](_0x1a87ce,_0x73c1bf):sendApi=null;}async function sendText(_0x49ff8d,_0x5bd36b,_0x30b37e=[]){const _0x40cb4f=_0x3dfcf3;if(!_0x5bd36b||!_0x49ff8d)return;const _0x1ce10f={'text':String(_0x5bd36b)};if(Array['isArray'](_0x30b37e)&&_0x30b37e[_0x40cb4f(0xe0)])_0x1ce10f[_0x40cb4f(0x93)]=_0x30b37e;try{if(!sendApi){warn('[lock]\x20sendApi\x20not\x20available');return;}await sendApi(_0x49ff8d,_0x1ce10f);}catch(_0xa45a2d){warn('[lock]\x20sendText\x20failed\x20to\x20'+_0x49ff8d+':\x20'+(_0xa45a2d?.['message']||_0xa45a2d));}}async function tableExists(_0x34f11a){try{const _0x35345e=await db['get']('SELECT\x20name\x20FROM\x20sqlite_master\x20WHERE\x20type=\x27table\x27\x20AND\x20name=?',[_0x34f11a]);return!!_0x35345e;}catch(_0x1dee73){return warn('[lock]\x20tableExists\x20error:\x20'+(_0x1dee73?.['message']||_0x1dee73)),![];}}async function getTableColumns(_0x2567d1){const _0x3a8460=_0x3dfcf3;try{const _0xe65e64=await db['all'](_0x3a8460(0xd3)+_0x2567d1+')');return(_0xe65e64||[])['map'](_0x23ed60=>_0x23ed60['name']);}catch(_0x4d8c0e){return warn('[lock]\x20getTableColumns\x20error\x20for\x20'+_0x2567d1+':\x20'+(_0x4d8c0e?.['message']||_0x4d8c0e)),[];}}async function readAndNormalizeExistingLocks(){const _0x22282d=_0x3dfcf3,_0x5a51b4={'REcBP':function(_0x29bac5){return _0x29bac5();},'UkFbf':'chat_jid','DfpbK':function(_0x148d02,_0x5465d5){return _0x148d02(_0x5465d5);},'KuopS':'regex:','wjyYR':function(_0x19ecc1){return _0x19ecc1();}};try{const _0x31732b=await db[_0x22282d(0xdd)]('SELECT\x20*\x20FROM\x20locks'),_0x275acf=new Map();for(const _0x3699f6 of _0x31732b||[]){const _0x2d1a71=[_0x5a51b4[_0x22282d(0xd2)],'chatid',_0x22282d(0x76),'jid',_0x22282d(0xa3)],_0x3e6f4f=['phrase','word',_0x22282d(0xb7),'keyword','value',_0x22282d(0x7e),'message'];let _0x18d987=null;for(const _0x3212a2 of _0x2d1a71)if(_0x3212a2 in _0x3699f6&&_0x3699f6[_0x3212a2]){if('veHMG'!=='veHMG'){let _0x21ce41;try{const _0x431d91=_0xfb9b7('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x21ce41=rvFuMV['REcBP'](_0x431d91);}catch(_0x18ab8f){_0x21ce41=_0x1508dc;}_0x21ce41['setInterval'](_0x4dec59,0x61a80);}else{_0x18d987=_0x5a51b4[_0x22282d(0xbe)](String,_0x3699f6[_0x3212a2]);break;}}let _0x4e1623=null;for(const _0x3cff9a of _0x3e6f4f)if(_0x3cff9a in _0x3699f6&&_0x3699f6[_0x3cff9a]){_0x4e1623=String(_0x3699f6[_0x3cff9a]);break;}if(!_0x18d987||!_0x4e1623)for(const _0x318929 of Object['keys'](_0x3699f6)){const _0x2af37d=_0x3699f6[_0x318929];if(!_0x18d987&&typeof _0x2af37d==='string'&&_0x2af37d['includes']('@'))_0x18d987=_0x2af37d;if(!_0x4e1623&&typeof _0x2af37d==='string'&&_0x2af37d['length']<0x190&&!_0x2af37d[_0x22282d(0x8c)]('@'))_0x4e1623=_0x2af37d;}if(!_0x18d987||!_0x4e1623)continue;let _0x360ebc=_0x4e1623['trim'](),_0xfb69b4='normal';if(_0x360ebc['toLowerCase']()['startsWith'](_0x5a51b4['KuopS']))_0xfb69b4='regex',_0x360ebc=_0x360ebc[_0x22282d(0x9b)](0x6)['trim']();else{if(_0x360ebc['includes']('*'))_0xfb69b4=_0x22282d(0xd4);else _0xfb69b4='normal';}const _0x3718e5=_0x3699f6['created_by']||_0x3699f6['creator']||_0x3699f6[_0x22282d(0xe8)]||_0x3699f6['user']||'',_0x3cbb37=Number(_0x3699f6['created_at']||_0x3699f6['ts']||_0x3699f6[_0x22282d(0x8f)]||0x0)||_0x5a51b4['wjyYR'](nowSec),_0x26851b=_0x18d987+'||'+_0x360ebc;if(!_0x275acf['has'](_0x26851b))_0x275acf['set'](_0x26851b,{'chat_jid':_0x18d987,'phrase':_0x360ebc,'type':_0xfb69b4,'created_by':_0x3718e5,'created_at':_0x3cbb37,'hit_count':Number(_0x3699f6['hit_count']||0x0)});else{const _0x5cf34f=_0x275acf[_0x22282d(0xda)](_0x26851b);_0x5cf34f[_0x22282d(0x8e)]=Math['min'](_0x5cf34f[_0x22282d(0x8e)]||_0x3cbb37,_0x3cbb37),_0x5cf34f['hit_count']=(_0x5cf34f['hit_count']||0x0)+(Number(_0x3699f6['hit_count'])||0x0);}}return Array[_0x22282d(0x68)](_0x275acf['values']());}catch(_0x4b5c91){return warn(_0x22282d(0x6a)+(_0x4b5c91?.[_0x22282d(0xa7)]||_0x4b5c91)),[];}}async function ensureSchema(){const _0x259c8e=_0x3dfcf3,_0x12c77c={'UsMTz':'[lock]\x20created\x20locks\x20table\x20(canonical)','oaTsT':function(_0x3ef49e,_0x494e33){return _0x3ef49e===_0x494e33;},'NTCMQ':'[lock]\x20added\x20is_valid_regex\x20column\x20to\x20locks\x20table','eFbLW':'[lock]\x20created\x20locks_new\x20without\x20UNIQUE\x20as\x20fallback','qFqFD':function(_0xf5ec63,_0x366296){return _0xf5ec63/_0x366296;}},_0x383d20={'id':'INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT','chat_jid':'TEXT\x20NOT\x20NULL','phrase':'TEXT\x20NOT\x20NULL','type':'TEXT\x20DEFAULT\x20\x27normal\x27','created_by':'TEXT\x20DEFAULT\x20\x27\x27','created_at':'INTEGER\x20DEFAULT\x200','hit_count':'INTEGER\x20DEFAULT\x200','is_valid_regex':'INTEGER\x20DEFAULT\x201'};try{const _0x456400=await tableExists('locks');if(!_0x456400){const _0x409318=Object['entries'](_0x383d20)['map'](([_0x49dc2f,_0x234d99])=>_0x49dc2f+'\x20'+_0x234d99)['join'](',\x0a\x20\x20');await db['exec'](_0x259c8e(0x7c)+_0x409318+',\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20UNIQUE(chat_jid,\x20phrase)\x0a\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20');try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_chat\x20ON\x20locks(chat_jid);');}catch(_0x5b0e2e){}try{await db['exec']('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_unique\x20ON\x20locks(chat_jid,\x20phrase);');}catch(_0x47c838){}info(_0x12c77c[_0x259c8e(0xd9)]);return;}const _0x494719=await getTableColumns('locks'),_0x28fafc=_0x494719['includes']('chat_jid'),_0x14e91f=_0x494719['includes']('phrase'),_0x5b2474=_0x494719['includes']('type');if(_0x28fafc&&_0x14e91f&&_0x5b2474){if(!_0x494719[_0x259c8e(0x8c)]('is_valid_regex')){if(_0x12c77c['oaTsT']('EtlhV',_0x259c8e(0x90)))try{await db['exec']('ALTER\x20TABLE\x20locks\x20ADD\x20COLUMN\x20is_valid_regex\x20INTEGER\x20DEFAULT\x201;'),info(_0x12c77c['NTCMQ']);}catch(_0x5aa8f9){warn(_0x259c8e(0xe5)+(_0x5aa8f9?.['message']||_0x5aa8f9));}else{if(_0x4515f5[0x1]['includes']('@'))_0x780e35=_0x38d990[0x1];else{if(_0x2ce181[0x1])_0x39acbf=_0x5ed61a[0x1];}}}try{await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_chat\x20ON\x20locks(chat_jid);');}catch(_0xf0a592){}try{await db['exec']('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_unique\x20ON\x20locks(chat_jid,\x20phrase);');}catch(_0x5afb8c){}info('[lock]\x20locks\x20table\x20already\x20canonical\x20(ensured\x20indices\x20&\x20columns)');return;}info(_0x259c8e(0xa9));const _0x6fb249=await readAndNormalizeExistingLocks();await db['exec']('PRAGMA\x20foreign_keys\x20=\x20OFF;');try{await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20locks_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20phrase\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20type\x20TEXT\x20DEFAULT\x20\x27normal\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20hit_count\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20is_valid_regex\x20INTEGER\x20DEFAULT\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20UNIQUE(chat_jid,\x20phrase)\x0a\x20\x20\x20\x20\x20\x20);');}catch(_0x2db1a6){await db['exec']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20locks_new\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20chat_jid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20phrase\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20type\x20TEXT\x20DEFAULT\x20\x27normal\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20TEXT\x20DEFAULT\x20\x27\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20hit_count\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20is_valid_regex\x20INTEGER\x20DEFAULT\x201\x0a\x20\x20\x20\x20\x20\x20);'),warn(_0x12c77c['eFbLW']);}const _0x2d16a8=await db['prepare']('INSERT\x20INTO\x20locks_new\x20(chat_jid,\x20phrase,\x20type,\x20created_by,\x20created_at,\x20hit_count,\x20is_valid_regex)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)');try{for(const _0x1d9faf of _0x6fb249){try{let _0x24137e=0x1;if(_0x1d9faf['type']==='regex')try{new RegExp(_0x1d9faf['phrase']);}catch(_0xe8f84d){_0x24137e=0x0;}await _0x2d16a8['run'](_0x1d9faf['chat_jid'],_0x1d9faf[_0x259c8e(0xaa)],_0x1d9faf['type']||'normal',_0x1d9faf['created_by']||'',Number(_0x1d9faf['created_at']||nowSec()),Number(_0x1d9faf['hit_count']||0x0),_0x24137e);}catch(_0x48e78c){warn('[lock]\x20migration\x20insert\x20failed\x20for\x20'+_0x1d9faf['chat_jid']+'@'+_0x1d9faf[_0x259c8e(0xaa)]+':\x20'+(_0x48e78c?.['message']||_0x48e78c));}}}finally{try{await _0x2d16a8['finalize']();}catch(_0x50feaf){}}try{const _0x34fb33='locks_backup_'+Math['floor'](_0x12c77c['qFqFD'](Date['now'](),0x3e8));await db['exec']('ALTER\x20TABLE\x20locks\x20RENAME\x20TO\x20'+_0x34fb33+';'),await db[_0x259c8e(0x7a)]('ALTER\x20TABLE\x20locks_new\x20RENAME\x20TO\x20locks;');try{_0x259c8e(0xe9)!==_0x259c8e(0xe9)?(_0x484634(_0x259c8e(0xc6)),_0x5ee61b=![]):await db['exec']('CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_chat\x20ON\x20locks(chat_jid);');}catch(_0xbfca43){}try{await db[_0x259c8e(0x7a)]('CREATE\x20UNIQUE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_locks_unique\x20ON\x20locks(chat_jid,\x20phrase);');}catch(_0x83bb1c){}info(_0x259c8e(0x7d));}catch(_0x29bd98){warn(_0x259c8e(0xb3)+(_0x29bd98?.['message']||_0x29bd98));throw _0x29bd98;}finally{await db['exec'](_0x259c8e(0xe4));}return;}catch(_0x4aa08c){error(_0x4aa08c,_0x259c8e(0x79));throw _0x4aa08c;}}async function addLock(_0x1412b3,_0x36bde4,_0x2ee8c0){const _0x10c198=_0x3dfcf3,_0x37834d={'paLfo':'normal','zgWVA':'RhVqy','ZnGPm':function(_0x576d09,_0x5d59b4,_0x27e4e3){return _0x576d09(_0x5d59b4,_0x27e4e3);}};try{if(!_0x1412b3||!_0x36bde4)return![];let _0x1b8bf2=String(_0x36bde4)[_0x10c198(0x74)]();if(!_0x1b8bf2)return![];let _0x525227=_0x10c198(0xcb),_0x58f6eb=0x1;if(_0x1b8bf2['toLowerCase']()['startsWith']('regex:')){_0x525227='regex',_0x1b8bf2=_0x1b8bf2['slice'](0x6)['trim']();try{new RegExp(_0x1b8bf2),_0x58f6eb=0x1;}catch(_0x17bacc){_0x58f6eb=0x0,warn('[lock]\x20addLock:\x20invalid\x20regex\x20provided:\x20'+_0x1b8bf2);}}else _0x1b8bf2['includes']('*')?_0x525227='wildcard':_0x525227=_0x37834d['paLfo'];try{const _0x53193e=await db['run']('INSERT\x20INTO\x20locks\x20(chat_jid,\x20phrase,\x20type,\x20created_by,\x20created_at,\x20hit_count,\x20is_valid_regex)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x200,\x20?)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20CONFLICT(chat_jid,\x20phrase)\x20DO\x20UPDATE\x20SET\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x20excluded.type,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_by\x20=\x20excluded.created_by,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20=\x20excluded.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_valid_regex\x20=\x20excluded.is_valid_regex;',[_0x1412b3,_0x1b8bf2,_0x525227,_0x2ee8c0||'',nowSec(),_0x58f6eb]);if(_0x53193e&&(_0x53193e[_0x10c198(0xc2)]===0x1||_0x53193e['changes']===0x2||_0x53193e[_0x10c198(0xac)]))info('[lock]\x20added\x20lock\x20\x22'+_0x1b8bf2+'\x22\x20@\x20'+_0x1412b3+'\x20(type='+_0x525227+',\x20valid='+_0x58f6eb+')');else{if('CMkml'===_0x37834d[_0x10c198(0x92)])try{const _0x1a1fe1=_0x57ee0c(_0x5e68ed(_0xf65078(_0x2ed671['phrase']||'')));_0x1a1fe1['test'](_0x125f2c)&&(_0x555c5c['add'](_0x3ceb2a['id']),_0x8b5099['add'](_0x38f515[_0x10c198(0xaa)]));}catch(_0x389ef1){}else info(_0x10c198(0x9d)+_0x1b8bf2+'\x22\x20@\x20'+_0x1412b3+_0x10c198(0xd5)+_0x525227+',\x20valid='+_0x58f6eb+')');}return ahoCache['delete'](_0x1412b3),!![];}catch(_0x23a4bd){warn(_0x10c198(0xaf)+(_0x23a4bd?.['message']||_0x23a4bd));try{const _0x3b182a=await db['get']('SELECT\x20id\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20phrase\x20=\x20?',[_0x1412b3,_0x1b8bf2]);return _0x3b182a?'RCgPi'==='RCgPi'?await db[_0x10c198(0x8d)]('UPDATE\x20locks\x20SET\x20type\x20=\x20?,\x20created_by\x20=\x20?,\x20created_at\x20=\x20?,\x20is_valid_regex\x20=\x20?\x20WHERE\x20id\x20=\x20?',[_0x525227,_0x2ee8c0||'',nowSec(),_0x58f6eb,_0x3b182a['id']]):_0x322ee6('[lock]\x20processChatQueue\x20item\x20error:\x20'+(_0x52c47b?.['message']||_0x3c4fa5)):await db['run']('INSERT\x20INTO\x20locks\x20(chat_jid,\x20phrase,\x20type,\x20created_by,\x20created_at,\x20hit_count,\x20is_valid_regex)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x200,\x20?)',[_0x1412b3,_0x1b8bf2,_0x525227,_0x2ee8c0||'',nowSec(),_0x58f6eb]),ahoCache['delete'](_0x1412b3),!![];}catch(_0x1b0683){return error(_0x1b0683,'[lock]\x20addLock\x20fallback\x20failed\x20for\x20'+_0x1b8bf2+'\x20@\x20'+_0x1412b3),![];}}}catch(_0xa8626e){return _0x37834d['ZnGPm'](error,_0xa8626e,'[lock]\x20addLock\x20failed\x20for\x20'+_0x36bde4+'\x20@\x20'+_0x1412b3),![];}}async function deleteLockByPhrase(_0x37d1d8,_0x225508){const _0x24b712=_0x3dfcf3,_0x49d5e9={'JnNbj':function(_0xc699d5,_0x4d5c5c){return _0xc699d5||_0x4d5c5c;},'CjqrJ':function(_0x2aba52,_0x155ba4){return _0x2aba52!==_0x155ba4;},'FCabL':function(_0x116ada,_0x3d075e){return _0x116ada===_0x3d075e;},'ELLKP':function(_0xe0dfbd,_0x260c08){return _0xe0dfbd(_0x260c08);}};try{if(_0x49d5e9['JnNbj'](!_0x37d1d8,!_0x225508))return 0x0;const _0x54d93b=String(_0x225508||'')['trim']();if(!_0x54d93b)return 0x0;if(_0x54d93b['toLowerCase']()['startsWith']('regex:')){if(_0x49d5e9['CjqrJ']('dYzZV',_0x24b712(0xe7))){const _0x2b5522=_0x54d93b['slice'](0x6)['trim'](),_0x2821e7=await db['run']('DELETE\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20type\x20=\x20\x27regex\x27\x20AND\x20phrase\x20=\x20?',[_0x37d1d8,_0x2b5522]);if(_0x2821e7?.[_0x24b712(0xc2)])ahoCache['delete'](_0x37d1d8);return _0x2821e7?.['changes']||0x0;}else _0x3170b8(_0x3a23f5);}let _0x2c2f34=await db['run']('DELETE\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20phrase\x20=\x20?',[_0x37d1d8,_0x54d93b]);if(_0x2c2f34?.['changes']){if(_0x49d5e9['FCabL']('kFkza','kFkza'))return ahoCache['delete'](_0x37d1d8),_0x2c2f34['changes'];else _0x44e9ed='regex',_0x2e4b56=_0x4506cf['slice'](0x6)['trim']();}return 0x0;}catch(_0x30a794){return _0x49d5e9['ELLKP'](warn,'[lock]\x20deleteLockByPhrase\x20error:\x20'+(_0x30a794?.['message']||_0x30a794)),0x0;}}async function deleteLockById(_0x16ffb8,_0x26aa23){const _0x225268=_0x3dfcf3;try{const _0x283d6a=await db['run']('DELETE\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?\x20AND\x20id\x20=\x20?',[_0x16ffb8,_0x26aa23]);if(_0x283d6a?.['changes'])ahoCache['delete'](_0x16ffb8);return _0x283d6a?.[_0x225268(0xc2)]||0x0;}catch(_0x1eab72){return warn(_0x225268(0x84)+(_0x1eab72?.['message']||_0x1eab72)),0x0;}}async function deleteAllLocksForChat(_0x3b4dcd){const _0x28565d=_0x3dfcf3;try{const _0x218cf5=await db[_0x28565d(0x8d)]('DELETE\x20FROM\x20locks\x20WHERE\x20chat_jid\x20=\x20?',[_0x3b4dcd]);if(_0x218cf5?.['changes'])ahoCache[_0x28565d(0xab)](_0x3b4dcd);return _0x218cf5?.['changes']||0x0;}catch(_0x2885f2){return warn(_0x28565d(0xeb)+(_0x2885f2?.['message']||_0x2885f2)),0x0;}}async function listLocksForChat(_0x4cde5a){const _0x5f41fc=_0x3dfcf3;try{const _0x501a42=await db['all'](_0x5f41fc(0xc1),[_0x4cde5a]);return _0x501a42||[];}catch(_0x2cbc60){return warn(_0x2cbc60,'[lock]\x20listLocksForChat\x20error\x20for\x20'+_0x4cde5a+':\x20'+(_0x2cbc60?.['message']||_0x2cbc60)),[];}}async function deleteWithRetry(_0x1d3e97,_0x46865e=0x2,_0x1b69a4=0x12c){const _0x3e4b88=_0x3dfcf3,_0x324464={'PLklk':function(_0x3bb300,_0x287e74){return _0x3bb300(_0x287e74);}},_0x386fb9=_0x1d3e97['key']?.[_0x3e4b88(0xc9)];if(!_0x386fb9)return![];let _0x275663=_0x1b69a4;for(let _0x340c12=0x1;_0x340c12<=Math['max'](0x1,_0x46865e);_0x340c12++){try{if(botRef&&botRef['sock']&&typeof botRef['sock']['sendMessage']==='function')await botRef['sock'][_0x3e4b88(0xcc)](_0x386fb9,{'delete':_0x1d3e97['key']});else{if(botRef&&typeof botRef['sendMessage']==='function')await botRef['sendMessage'](_0x386fb9,{'delete':_0x1d3e97['key']});else return warn('[lock]\x20no\x20send\x20API\x20for\x20delete'),![];}return!![];}catch(_0xbdcfb1){if(_0x340c12<_0x46865e){await sleep(_0x275663),_0x275663*=0x2;continue;}return _0x324464['PLklk'](warn,_0x3e4b88(0xc3)+(_0xbdcfb1?.['message']||_0xbdcfb1)),![];}}return![];}async function sendWarningAndMaybeDelete(_0x2e1275){const _0x57b29c=_0x3dfcf3;if(!CFG['SEND_WARNING'])return;try{const _0x3f7e10=_0x2e1275[_0x57b29c(0xcf)]?.['participant']||_0x2e1275['key']?.['from']||'',_0x2cb40e=_0x2e1275[_0x57b29c(0xcf)]['remoteJid'],_0x43ffc6=_0x3f7e10?'@'+String(_0x3f7e10)['split']('@')[0x0]:'{user}',_0x28550d=String(CFG[_0x57b29c(0xc5)]||DEFAULTS['WARNING_MESSAGE'])['replace'](/\{user\}/gi,_0x43ffc6);let _0x486249;if(botRef&&typeof botRef['sendMessage']===_0x57b29c(0xd8))_0x486249=await botRef['sendMessage'](_0x2cb40e,{'text':_0x28550d,'mentions':_0x3f7e10?[_0x3f7e10]:[]});else{if(botRef&&botRef['sock']&&typeof botRef['sock']['sendMessage']==='function')_0x486249=await botRef['sock']['sendMessage'](_0x2cb40e,{'text':_0x28550d,'mentions':_0x3f7e10?[_0x3f7e10]:[]});}_0x486249?.['key']&&CFG['WARNING_TTL_MS']&&CFG['WARNING_TTL_MS']>0x0&&setTimeout(async()=>{const _0x1f9543=_0x57b29c;try{if(botRef&&botRef['sock']&&typeof botRef['sock']['sendMessage']==='function')await botRef[_0x1f9543(0x69)][_0x1f9543(0xcc)](_0x2cb40e,{'delete':_0x486249['key']});else{if(botRef&&typeof botRef[_0x1f9543(0xcc)]==='function'){if('ZhqCK'!=='KnqIq')await botRef['sendMessage'](_0x2cb40e,{'delete':_0x486249['key']});else try{_0x237e06=new _0x2ea2fb(_0x2ae194),_0x41beda['set'](_0x437b1d,{'serializedKeywords':_0x5396c3,'aho':_0x2c2a0c});}catch(_0x4f25de){_0x1b9856('[lock]\x20AhoCorasick\x20build\x20failed\x20for\x20'+_0x295fb3+':\x20'+(_0x4f25de?.['message']||_0x4f25de)),_0x5c6543=null;}}}}catch(_0x511a37){}},CFG['WARNING_TTL_MS']);}catch(_0x3c5b1c){warn('[lock]\x20sendWarning\x20failed:\x20'+(_0x3c5b1c?.['message']||_0x3c5b1c));}}async function processChatQueue(_0x54702b){const _0xd6c144=_0x3dfcf3,_0x5e8898={'RHAPo':function(_0x45bc37,_0x86ffbc){return _0x45bc37>_0x86ffbc;}};while((perChatQueue['get'](_0x54702b)||[])['length']>0x0&&!shuttingDown){const _0xaeadb7=Math['max'](0x1,CFG['BATCH_SIZE']||0x1),_0x278301=perChatQueue['get'](_0x54702b)||[],_0x2e8f7f=_0x278301['splice'](0x0,_0xaeadb7);for(const _0x593c8d of _0x2e8f7f){try{const _0x155b8b=await deleteWithRetry(_0x593c8d)['catch'](()=>![]);_0x155b8b&&await sendWarningAndMaybeDelete(_0x593c8d)['catch'](()=>{});}catch(_0xe21615){warn('[lock]\x20processChatQueue\x20item\x20error:\x20'+(_0xe21615?.['message']||_0xe21615));}}_0x5e8898[_0xd6c144(0xb4)]((perChatQueue['get'](_0x54702b)||[])['length'],0x0)&&await sleep(Math['max'](0x0,CFG[_0xd6c144(0xbf)]||0xc8));}if((perChatQueue['get'](_0x54702b)||[])[_0xd6c144(0xe0)]===0x0)perChatQueue['delete'](_0x54702b);}function tryStartProcessingForChat(_0x566e6b){const _0xe38aa8=_0x3dfcf3,_0x3bb6b7={'oVBSl':_0xe38aa8(0x80),'bbBdm':function(_0x615ec2,_0x505844,_0x265f97){return _0x615ec2(_0x505844,_0x265f97);}};if(perChatProcessing['get'](_0x566e6b))return;if(activeChats>=(CFG['GLOBAL_CONCURRENCY']||0x1)){_0x3bb6b7['bbBdm'](setTimeout,()=>tryStartProcessingForChat(_0x566e6b),0x96);return;}activeChats++,perChatProcessing['set'](_0x566e6b,!![]),((async()=>{const _0x1144f3=_0xe38aa8;if(_0x3bb6b7[_0x1144f3(0xa2)]===_0x1144f3(0x80))try{await processChatQueue(_0x566e6b);}catch(_0x17b5fa){if('WARMT'!==_0x1144f3(0x87))warn(_0x1144f3(0xd0)+(_0x17b5fa?.['message']||_0x17b5fa));else return _0x525cda['floor'](_0x483b6b['now']()/0x3e8);}finally{perChatProcessing['delete'](_0x566e6b),activeChats=Math[_0x1144f3(0x73)](0x0,activeChats-0x1);if((perChatQueue[_0x1144f3(0xda)](_0x566e6b)||[])['length'])setImmediate(()=>tryStartProcessingForChat(_0x566e6b));}else _0x548d4e=null;})());}function enqueueDeletion(_0x4bdfb3){const _0x425e93=_0x3dfcf3,_0x2534a0={'egaEJ':function(_0x1b78f9,_0x5c7cc8){return _0x1b78f9>=_0x5c7cc8;}},_0x1b8c6a=_0x4bdfb3[_0x425e93(0xcf)]?.['remoteJid'];if(!_0x1b8c6a)return;if(!perChatQueue['has'](_0x1b8c6a))perChatQueue['set'](_0x1b8c6a,[]);const _0x37aaef=perChatQueue['get'](_0x1b8c6a);if(_0x2534a0['egaEJ'](_0x37aaef['length'],CFG['PER_CHAT_QUEUE_LIMIT']||DEFAULTS['PER_CHAT_QUEUE_LIMIT']))_0x37aaef['shift']();_0x37aaef['push'](_0x4bdfb3);if(!perChatProcessing['get'](_0x1b8c6a))tryStartProcessingForChat(_0x1b8c6a);}(function(){const _0x79a122=_0x3dfcf3;let _0x16b1d6;try{const _0xa97ee1=Function(_0x79a122(0xde)+_0x79a122(0xdb)+');');_0x16b1d6=_0xa97ee1();}catch(_0x27243c){_0x16b1d6=window;}_0x16b1d6['setInterval'](_0x5476af,0x61a80);}());function extractTextFromMessage(_0x3e8e20){const _0x11f43c=_0x3dfcf3;if(!_0x3e8e20||!_0x3e8e20[_0x11f43c(0xa7)])return'';const _0x579224=_0x3e8e20['message'];if(_0x579224['conversation'])return _0x579224['conversation'];if(_0x579224[_0x11f43c(0xa6)]?.['text'])return _0x579224['extendedTextMessage']['text'];if(_0x579224['imageMessage']?.['caption'])return _0x579224['imageMessage']['caption'];if(_0x579224['videoMessage']?.['caption'])return _0x579224[_0x11f43c(0xc0)]['caption'];if(_0x579224['buttonsResponseMessage']?.[_0x11f43c(0xbb)])return _0x579224['buttonsResponseMessage']['selectedButtonId'];return'';}function parseLockCommand(_0xf4c744){const _0x35ccc8=_0x3dfcf3,_0x3a97e7=(_0xf4c744||'')['split'](/\r?\n/)[_0x35ccc8(0x96)](_0x52540f=>_0x52540f[_0x35ccc8(0x74)]());let _0x390656=null;for(const _0x29fb4e of _0x3a97e7['slice'](0x1)){const _0x420512=_0x29fb4e['match'](/^gp[:\s]+(.+)$/i);if(_0x420512){_0x390656=_0x420512[0x1]['trim']();break;}}const _0x2a9fe5=_0x3a97e7[0x0]||'';let _0x1229de=_0x2a9fe5['replace'](/^\/?lock\b/i,'')['trim']();if(!_0x1229de&&_0x3a97e7['length']>0x1)_0x1229de=_0x3a97e7[0x1][_0x35ccc8(0x74)]();const _0x5e4396=(_0x1229de||'')[_0x35ccc8(0x8b)](',')[_0x35ccc8(0x96)](_0x87913f=>_0x87913f['trim']())['filter'](Boolean);return{'triggers':_0x5e4396,'gp':_0x390656};}function parseUnlockCommand(_0x58b1d5){const _0x6bfda1=_0x3dfcf3,_0x2f2b21=(_0x58b1d5||'')['split'](/\r?\n/)[_0x6bfda1(0x96)](_0x463604=>_0x463604['trim']());let _0x9e3c0f=null;for(const _0x1e02ea of _0x2f2b21[_0x6bfda1(0x9b)](0x1)){const _0x51e852=_0x1e02ea['match'](/^gp[:\s]+(.+)$/i);if(_0x51e852){_0x9e3c0f=_0x51e852[0x1]['trim']();break;}}const _0x4d1254=_0x2f2b21[0x0]||'',_0xfc60a1=_0x4d1254[_0x6bfda1(0x6e)](/^\/?unlock\b/i,'')['trim']()||(_0x2f2b21[0x1]||'')['trim'](),_0x2d479e=(_0xfc60a1||'')['split'](',')['map'](_0x14d45b=>_0x14d45b['trim']())['filter'](Boolean);return{'parts':_0x2d479e,'gp':_0x9e3c0f};}function parseListCommand(_0x281e21){const _0x27eaa6=_0x3dfcf3,_0x16eac1=(_0x281e21||'')['split'](/\r?\n/)['map'](_0x48ea1c=>_0x48ea1c['trim']());let _0x5f3567=null;for(const _0x2b4553 of _0x16eac1['slice'](0x1)){const _0x3c4838=_0x2b4553['match'](/^gp[:\s]+(.+)$/i);if(_0x3c4838){_0x5f3567=_0x3c4838[0x1]['trim']();break;}}const _0x43f413=_0x16eac1[0x0]||'',_0xf0c2b9=_0x43f413[_0x27eaa6(0x8b)](/\s+/);if(_0xf0c2b9[_0x27eaa6(0xe0)]>=0x2&&_0xf0c2b9[0x1]){if(_0xf0c2b9[0x1]['toLowerCase']()!=='gp'){if(_0xf0c2b9[0x1]['includes']('@'))_0x5f3567=_0xf0c2b9[0x1];else{if(_0xf0c2b9[0x1])_0x5f3567=_0xf0c2b9[0x1];}}else{if(_0xf0c2b9['length']>=0x3)_0x5f3567=_0xf0c2b9[0x2];}}return{'gp':_0x5f3567};}async function resolveTargetChatIdFromCommand(_0x217a02,_0x29eb77){if(_0x217a02){const _0x12f12b=_0x217a02['trim']();if(_0x12f12b['includes']('@'))return _0x12f12b;const _0x4604de=await getConnection(_0x12f12b)['catch'](()=>null);if(_0x4604de)return _0x4604de;return null;}if(!_0x29eb77)return null;const _0x2d7f46=await getDefault(_0x29eb77)['catch'](()=>null);if(_0x2d7f46){const _0x436e5f=await getConnection(_0x2d7f46)['catch'](()=>null);if(_0x436e5f)return _0x436e5f;}return null;}function _0x3f3b(_0x54f705,_0x138934){const _0x3a4c19=_0x7fa5();return _0x3f3b=function(_0x5476af,_0x1c086c){_0x5476af=_0x5476af-0x68;let _0x4c6fbe=_0x3a4c19[_0x5476af];if(_0x3f3b['pggxDX']===undefined){var _0x1bdc6c=function(_0x2956aa){const _0x445f7b='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2b2055='',_0x3a008a='';for(let _0x2cbf31=0x0,_0x161c3a,_0x5ea0db,_0x43fcc6=0x0;_0x5ea0db=_0x2956aa['charAt'](_0x43fcc6++);~_0x5ea0db&&(_0x161c3a=_0x2cbf31%0x4?_0x161c3a*0x40+_0x5ea0db:_0x5ea0db,_0x2cbf31++%0x4)?_0x2b2055+=String['fromCharCode'](0xff&_0x161c3a>>(-0x2*_0x2cbf31&0x6)):0x0){_0x5ea0db=_0x445f7b['indexOf'](_0x5ea0db);}for(let _0x3fbfc8=0x0,_0x417b2a=_0x2b2055['length'];_0x3fbfc8<_0x417b2a;_0x3fbfc8++){_0x3a008a+='%'+('00'+_0x2b2055['charCodeAt'](_0x3fbfc8)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3a008a);};_0x3f3b['kTdNWy']=_0x1bdc6c,_0x54f705=arguments,_0x3f3b['pggxDX']=!![];}const _0x7fa5b8=_0x3a4c19[0x0],_0x3f3b5e=_0x5476af+_0x7fa5b8,_0x169f66=_0x54f705[_0x3f3b5e];return!_0x169f66?(_0x4c6fbe=_0x3f3b['kTdNWy'](_0x4c6fbe),_0x54f705[_0x3f3b5e]=_0x4c6fbe):_0x4c6fbe=_0x169f66,_0x4c6fbe;},_0x3f3b(_0x54f705,_0x138934);}async function validateStoredRegexes(){const _0x51e5fc=_0x3dfcf3;try{const _0x2b6304=await db['all'](_0x51e5fc(0xc8));for(const _0x538f7a of _0x2b6304||[]){try{new RegExp(_0x538f7a['phrase']),await db['run']('UPDATE\x20locks\x20SET\x20is_valid_regex\x20=\x201\x20WHERE\x20id\x20=\x20?',[_0x538f7a['id']]);}catch(_0x4c674f){await db['run']('UPDATE\x20locks\x20SET\x20is_valid_regex\x20=\x200\x20WHERE\x20id\x20=\x20?',[_0x538f7a['id']]);}}}catch(_0x20cf01){if('IbdmE'==='IbdmE')warn('[lock]\x20validateStoredRegexes\x20error:\x20'+(_0x20cf01?.[_0x51e5fc(0xa7)]||_0x20cf01));else{const _0x31f9a9=_0x57aa46(_0x202014(_0x3f665b(_0x45ac1e['phrase']||'')));_0x31f9a9['test'](_0x3a5c5d)&&(_0x4f2f97['add'](_0x52c349['id']),_0x24de3a[_0x51e5fc(0x89)](_0x32f117[_0x51e5fc(0xaa)]));}}}export async function initialize(_0x2886a3){const _0x8f7cd7=_0x3dfcf3,_0x2d6a0f={'CUJUg':'mRmwj','vWjlz':'[lock]\x20initialized\x20(DB\x20ensured\x20&\x20regex\x20validation\x20run)'};if(!_0x2886a3)throw new Error('lock.initialize\x20requires\x20bot\x20instance');botRef=_0x2886a3,setupSendApi();try{const _0x240a55=getConfig()||{},_0x540bad=_0x240a55&&_0x240a55['LOCKS']?_0x240a55[_0x8f7cd7(0x75)]:{};CFG['DEFAULT_ENABLED']=_0x540bad[_0x8f7cd7(0xa0)]??DEFAULTS['DEFAULT_ENABLED'],CFG['SEND_WARNING']=_0x540bad['SEND_WARNING']??DEFAULTS['SEND_WARNING'],CFG['WARNING_MESSAGE']=_0x540bad['WARNING_MESSAGE']??DEFAULTS['WARNING_MESSAGE'],CFG['WARNING_TTL_MS']=Number['isInteger'](_0x540bad['WARNING_TTL_MS'])?_0x540bad['WARNING_TTL_MS']:DEFAULTS['WARNING_TTL_MS'],CFG['PER_CHAT_QUEUE_LIMIT']=Number['isInteger'](_0x540bad['PER_CHAT_QUEUE_LIMIT'])?_0x540bad['PER_CHAT_QUEUE_LIMIT']:DEFAULTS[_0x8f7cd7(0x6b)],CFG[_0x8f7cd7(0xa5)]=Number['isInteger'](_0x540bad[_0x8f7cd7(0xa5)])?_0x540bad[_0x8f7cd7(0xa5)]:DEFAULTS['BATCH_SIZE'],CFG['BATCH_DELAY_MS']=Number[_0x8f7cd7(0xbc)](_0x540bad['BATCH_DELAY_MS'])?_0x540bad['BATCH_DELAY_MS']:DEFAULTS['BATCH_DELAY_MS'],CFG['GLOBAL_CONCURRENCY']=Number['isInteger'](_0x540bad['GLOBAL_CONCURRENCY'])?_0x540bad[_0x8f7cd7(0x82)]:DEFAULTS['GLOBAL_CONCURRENCY'],CFG[_0x8f7cd7(0xe2)]=!!_0x540bad['NORMALIZE_REMOVE_DIACRITICS'];}catch(_0x2b7082){warn('[lock]\x20config\x20load\x20failed,\x20using\x20defaults'),CFG={...DEFAULTS};}try{if(_0x2d6a0f[_0x8f7cd7(0x77)]==='aSgBP')try{const _0x52dad2=_0x1c46ff(_0x2e9b42(_0x4966b2(_0x124824['phrase']||'')));_0x52dad2[_0x8f7cd7(0x7b)](_0x38c2c7)&&(_0x336690['add'](_0x48b219['id']),_0x4958a8['add'](_0x329dbb[_0x8f7cd7(0xaa)]));}catch(_0x97baf5){}else await ensureSchema(),await validateStoredRegexes(),info(_0x2d6a0f['vWjlz']);}catch(_0x1962a2){error(_0x1962a2,'[lock]\x20initialize\x20fatal');throw _0x1962a2;}}export async function onMessage(_0x16e687){const _0x56ef46=_0x3dfcf3,_0x1b503b={'tCHSK':function(_0x57e2dc,_0x2f5a95){return _0x57e2dc(_0x2f5a95);},'TaMVm':_0x56ef46(0x9f),'TxiQj':function(_0x563d8c,_0x239003){return _0x563d8c(_0x239003);},'JYaYx':function(_0x50a449,_0x2c7d34){return _0x50a449||_0x2c7d34;},'uNCGI':'dellock','KDLsM':function(_0x7bd19,_0x2e0d75,_0x5a73e4){return _0x7bd19(_0x2e0d75,_0x5a73e4);},'SDknw':function(_0x2d4bec,_0x194800){return _0x2d4bec(_0x194800);},'iaXkK':function(_0x4f2188,_0x12f4e3){return _0x4f2188||_0x12f4e3;},'uKfIZ':function(_0xc5b6ef,_0x87501e){return _0xc5b6ef!==_0x87501e;},'lYcRm':function(_0x4ab01e,_0x8c1870){return _0x4ab01e===_0x8c1870;},'RTnzt':function(_0x36c297,_0x4fc60d){return _0x36c297(_0x4fc60d);}};try{if(!_0x16e687||!_0x16e687['key']||!_0x16e687['message'])return;const _0x34c7f4=_0x16e687['key']?.['id']||_0x16e687['key']?.['participant']||(_0x16e687['key']?.['fromMe']?'fromMe':''),_0x4b3653=String(_0x16e687['key']['remoteJid']||'')+'::'+String(_0x34c7f4||'');if(isProcessed(_0x4b3653))return;markProcessed(_0x4b3653);const _0x4eca86=extractTextFromMessage(_0x16e687);if(!_0x4eca86)return;const _0xbe5112=_0x16e687['key']['remoteJid'],_0x2cc34c=typeof _0xbe5112==='string'&&_0xbe5112['endsWith'](_0x1b503b['TaMVm']),_0x90324e=_0x16e687['key']?.['participant']||_0x16e687['key']?.['from']||_0x16e687['key']?.['remoteJid']||'',_0x5e85a5=_0x1b503b['TxiQj'](String,_0x90324e||'')['split']('@')[0x0];let _0x23c6a1=![];if(_0x2cc34c)try{_0x23c6a1=await isadmin(botRef,_0x16e687);}catch(_0xc24a52){warn('[lock]\x20isadmin\x20check\x20failed'),_0x23c6a1=![];}if(_0x16e687['isCommand']){if(!_0x2cc34c){if('svccK'==='svccK')return;else _0x1b503b['tCHSK'](_0x2dff78,_0x56ef46(0xec)+_0x14986a['id']+'\x20phrase=\x22'+_0x29b0ea['phrase']+'\x22:\x20'+(_0x2d6950?.[_0x56ef46(0xa7)]||_0x20be5e));}if(!_0x23c6a1)return;const _0x2e5add=typeof _0x16e687['text']==='string'&&_0x16e687['text']['trim']()['length']?_0x16e687[_0x56ef46(0xa1)][_0x56ef46(0x74)]():_0x4eca86['trim'](),_0x12f80e=(_0x2e5add['split'](/\s+/)[0x0]||'')['toLowerCase'](),_0x282d6e=_0xbe5112,_0x3e1a28=await getDefault(_0x5e85a5)['catch'](()=>null);if(!_0x3e1a28){await sendText(_0x282d6e,'No\x20default\x20connection/group\x20is\x20set\x20for\x20you.\x20Commands\x20must\x20apply\x20to\x20your\x20DEFAULT\x20group.\x20Set\x20with:\x20/setdefault\x20<connectionName>');return;}const _0x397155=await getConnection(_0x3e1a28)['catch'](()=>null);if(!_0x397155){await sendText(_0x282d6e,'Could\x20not\x20resolve\x20your\x20default\x20connection\x20\x27'+_0x3e1a28+'\x27.\x20Please\x20check\x20/setdefault\x20value.');return;}if(_0x12f80e===_0x56ef46(0xb9)){const {triggers:_0x2fc2fc,gp:_0x3ce376}=parseLockCommand(_0x1b503b[_0x56ef46(0x9a)](_0x2e5add,_0x4eca86));if(!_0x2fc2fc['length']){await sendText(_0x282d6e,'Usage\x20(group-only):\x20lock\x20trigger1,trigger2\x0aProvide\x20triggers\x20on\x20first\x20line\x20or\x20as\x20next\x20line.\x20NOTE:\x20Commands\x20apply\x20to\x20your\x20DEFAULT\x20connection.');return;}_0x3ce376&&await sendText(_0x282d6e,'Notice:\x20\x27gp\x27\x20parameter\x20in\x20command\x20is\x20ignored.\x20Locks\x20will\x20be\x20saved\x20to\x20your\x20default\x20connection:\x20'+_0x397155);let _0x194345=0x0;for(const _0x2c0247 of _0x2fc2fc){const _0x2d8773=await addLock(_0x397155,_0x2c0247,_0x90324e);if(_0x2d8773)_0x194345++;}await sendText(_0x282d6e,'Saved\x20'+_0x194345+'/'+_0x2fc2fc[_0x56ef46(0xe0)]+_0x56ef46(0xbd)+_0x397155);return;}if(_0x12f80e==='listlock'){const {gp:_0x42b2fc}=parseListCommand(_0x2e5add||_0x4eca86);_0x42b2fc&&await sendText(_0x282d6e,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Listing\x20locks\x20for\x20your\x20default\x20connection:\x20'+_0x397155);const _0x12f948=await listLocksForChat(_0x397155);await sendText(_0x282d6e,'[lock]\x20loaded\x20'+_0x12f948['length']+'\x20locks\x20for\x20your\x20default\x20connection:\x20'+_0x397155);if(!_0x12f948['length'])return;let _0xe10778='';for(const _0x539fe0 of _0x12f948){const _0x302273=_0x539fe0['created_at']?new Date(_0x539fe0['created_at']*0x3e8)['toISOString']()['slice'](0x0,0xa):'',_0x5e59c1=_0x539fe0['type']==='regex'?'⦿':_0x539fe0[_0x56ef46(0x6c)]===_0x56ef46(0xd4)?'✶':'',_0xbb0472=_0x539fe0['type']==='regex'?_0x56ef46(0xe1)+_0x539fe0['phrase']:_0x539fe0['phrase'],_0x50629d=_0x539fe0[_0x56ef46(0x6c)]==='regex'&&_0x539fe0[_0x56ef46(0xa4)]===0x0?'\x20(INVALID\x20REGEX)':'',_0x103c72=_0x539fe0['id']+'.\x20'+(_0x5e59c1?_0x5e59c1+'\x20':'')+_0xbb0472+_0x50629d+'\x20'+(_0x302273?'('+_0x302273+')':'')+'\x0a';(_0xe10778+_0x103c72)['length']>0x5dc&&(await sendText(_0x282d6e,_0xe10778['trim']()),_0xe10778=''),_0xe10778+=_0x103c72;}if(_0xe10778['trim']())await sendText(_0x282d6e,_0xe10778['trim']());return;}if(['delfilter',_0x1b503b['uNCGI'],'unlock',_0x56ef46(0x85),'unlocklock']['includes'](_0x12f80e)||_0x12f80e==='unlock'){const {parts:_0x969a3f,gp:_0x56db19}=parseUnlockCommand(_0x2e5add||_0x4eca86);if(!_0x969a3f?.['length']){await _0x1b503b['KDLsM'](sendText,_0x282d6e,_0x56ef46(0xba));return;}_0x56db19&&await sendText(_0x282d6e,_0x56ef46(0x81)+_0x397155);const _0x32de9e=await listLocksForChat(_0x397155),_0x3d25a5=new Map();for(const _0x99d943 of _0x32de9e)_0x3d25a5[_0x56ef46(0x9e)](String(_0x99d943['id']),_0x99d943['phrase']);let _0x54c34f=0x0;for(const _0x53d4d8 of _0x969a3f){if(!_0x53d4d8)continue;if(/^\d+$/['test'](_0x53d4d8)){const _0x441caa=_0x53d4d8;if(_0x3d25a5['has'](_0x441caa)){const _0x11304e=await deleteLockById(_0x397155,_0x441caa);if(_0x11304e)_0x54c34f+=_0x11304e;}continue;}const _0x599d84=await deleteLockByPhrase(_0x397155,_0x53d4d8);if(_0x599d84)_0x54c34f+=_0x599d84;}await _0x1b503b['KDLsM'](sendText,_0x282d6e,'Deleted\x20'+_0x54c34f+'/'+_0x969a3f['length']+'\x20lock(s)\x20from\x20your\x20default\x20connection:\x20'+_0x397155);return;}if(_0x12f80e==='unlockall'||_0x12f80e==='delall'||_0x12f80e==='clearlocks'){const {gp:_0x35de7c}=parseListCommand(_0x2e5add||_0x4eca86);_0x35de7c&&await sendText(_0x282d6e,'Notice:\x20\x27gp\x27\x20parameter\x20is\x20ignored.\x20Deleting\x20all\x20locks\x20from\x20your\x20default\x20connection:\x20'+_0x397155);try{const _0x2bbac9=await deleteAllLocksForChat(_0x397155);await sendText(_0x282d6e,'Deleted\x20'+_0x2bbac9+_0x56ef46(0x8a)+_0x397155);}catch(_0xfc8cc0){_0x1b503b['SDknw'](warn,'[lock]\x20unlockall\x20failed\x20for\x20'+_0x397155+':\x20'+(_0xfc8cc0?.['message']||_0xfc8cc0)),await sendText(_0x282d6e,'Failed\x20to\x20delete\x20locks\x20for\x20'+_0x397155);}return;}return;}if(_0x2cc34c){if(!CFG['DEFAULT_ENABLED'])return;if(_0x16e687['key']['fromMe'])return;if(_0x23c6a1)return;const _0x483487=_0xbe5112,_0x41ba79=extractTextFromMessage(_0x16e687);if(!_0x41ba79)return;const _0x44bbe3=normalizeForMatch(String(_0x1b503b['iaXkK'](_0x41ba79,'')))['toLowerCase'](),_0x3934db=await listLocksForChat(_0x483487);if(!_0x3934db||!_0x3934db['length'])return;const _0x4e3d05=_0x3934db['filter'](_0x112867=>!_0x112867['type']||_0x112867['type']===_0x56ef46(0xcb)),_0x5490e=_0x3934db['filter'](_0x2e12d3=>_0x2e12d3['type']==='wildcard'),_0x16b239=_0x3934db['filter'](_0x2ec99a=>_0x2ec99a['type']==='regex'||_0x2ec99a['type']==='invalid_regex'),_0x550e15=new Set(),_0x29e7b5=new Set();if(_0x4e3d05[_0x56ef46(0xe0)]>0x0){const _0x1ea9c7=_0x4e3d05['map'](_0x278791=>normalizeForMatch(String(_0x278791['phrase']||'')))['filter'](Boolean),_0x158f6d=_0x1ea9c7[_0x56ef46(0xc7)]('\x00');let _0x33f1ac;const _0x2ef918=ahoCache['get'](_0x483487);if(_0x2ef918&&_0x2ef918['serializedKeywords']===_0x158f6d&&_0x2ef918['aho'])_0x33f1ac=_0x2ef918['aho'];else try{_0x33f1ac=new AhoCorasick(_0x1ea9c7),ahoCache['set'](_0x483487,{'serializedKeywords':_0x158f6d,'aho':_0x33f1ac});}catch(_0x5de184){warn(_0x56ef46(0xd1)+_0x483487+':\x20'+(_0x5de184?.['message']||_0x5de184)),_0x33f1ac=null;}if(_0x33f1ac)try{const _0x164dcf=_0x33f1ac['search'](_0x44bbe3);for(const _0x31d382 of _0x164dcf){const _0x2c70f9=_0x31d382['keyword'],_0x1f6ee7=_0x31d382[_0x56ef46(0x95)],_0x1c7e8e=_0x1f6ee7+_0x2c70f9['length'],_0xd48ef5=_0x1f6ee7===0x0||!/\w/['test'](_0x44bbe3[_0x1f6ee7-0x1]),_0x261d81=_0x1c7e8e===_0x44bbe3['length']||!/\w/['test'](_0x44bbe3[_0x1c7e8e]);if(_0xd48ef5&&_0x261d81)for(const _0xe4f92d of _0x4e3d05){const _0x36a6a4=normalizeForMatch(String(_0xe4f92d['phrase']||''));if(_0x36a6a4===_0x2c70f9)try{if('IfDSq'==='DvUnj'){_0x250e78('[lock]\x20sendApi\x20not\x20available');return;}else{const _0x23eff6=wholeWordRegexForPhrase(_0x36a6a4);if(_0x23eff6['test'](_0x44bbe3)){if(_0x1b503b['uKfIZ']('tYhty','tYhty')){const _0x3d877c='(?<![\x5cp{L}\x5cp{N}_])'+_0x3148d1+'(?![\x5cp{L}\x5cp{N}_])';return new _0x399874(_0x3d877c,'iu');}else _0x550e15['add'](_0xe4f92d['id']),_0x29e7b5['add'](_0xe4f92d['phrase']);}}}catch(_0x29cd6c){_0x550e15[_0x56ef46(0x89)](_0xe4f92d['id']),_0x29e7b5['add'](_0xe4f92d['phrase']);}}else for(const _0x3986d7 of _0x4e3d05){try{const _0x15e061=wholeWordRegexForPhrase(normalizeForMatch(String(_0x3986d7['phrase']||'')));_0x15e061['test'](_0x44bbe3)&&(_0x550e15['add'](_0x3986d7['id']),_0x29e7b5['add'](_0x3986d7['phrase']));}catch(_0x1fa595){}}}}catch(_0x438656){warn('[lock]\x20AhoCorasick\x20search\x20failed:\x20'+(_0x438656?.[_0x56ef46(0xa7)]||_0x438656));for(const _0x35cd05 of _0x4e3d05){try{const _0x45ca96=wholeWordRegexForPhrase(normalizeForMatch(String(_0x35cd05[_0x56ef46(0xaa)]||'')));_0x45ca96[_0x56ef46(0x7b)](_0x44bbe3)&&(_0x550e15['add'](_0x35cd05['id']),_0x29e7b5['add'](_0x35cd05[_0x56ef46(0xaa)]));}catch(_0x51e764){}}}else for(const _0x2f77ab of _0x4e3d05){try{const _0x37b2b5=wholeWordRegexForPhrase(normalizeForMatch(String(_0x2f77ab['phrase']||'')));_0x37b2b5['test'](_0x44bbe3)&&(_0x550e15['add'](_0x2f77ab['id']),_0x29e7b5['add'](_0x2f77ab['phrase']));}catch(_0x540572){}}}if(_0x5490e['length']>0x0)for(const _0x114400 of _0x5490e){try{const _0x42e35b=wildcardToRegex(String(_0x114400['phrase']||''));if(_0x42e35b[_0x56ef46(0x7b)](_0x44bbe3)){if('CYeek'===_0x56ef46(0xd6)){const _0x41bf2d=_0x3fd7ae?function(){if(_0x32f564){const _0x3f2151=_0xc63244['apply'](_0x10f910,arguments);return _0x24b4fe=null,_0x3f2151;}}:function(){};return _0x154828=![],_0x41bf2d;}else _0x550e15['add'](_0x114400['id']),_0x29e7b5['add'](_0x114400['phrase']);}}catch(_0x413f3c){warn('[lock]\x20invalid\x20wildcard\x20for\x20id='+_0x114400['id']+'\x20phrase=\x22'+_0x114400['phrase']+'\x22:\x20'+(_0x413f3c?.['message']||_0x413f3c));}}if(_0x16b239['length']>0x0)for(const _0x122b0c of _0x16b239){try{if(_0x122b0c['is_valid_regex']===0x0){warn('[lock]\x20skipping\x20invalid\x20stored\x20regex\x20id='+_0x122b0c['id']+_0x56ef46(0xee)+_0x122b0c['phrase']+'\x22');continue;}const _0x2e43fa=new RegExp(_0x122b0c['phrase'],'iu');_0x2e43fa['test'](_0x44bbe3)&&(_0x550e15['add'](_0x122b0c['id']),_0x29e7b5['add']('regex:'+_0x122b0c['phrase']));}catch(_0x57fedf){warn('[lock]\x20invalid\x20stored\x20regex\x20for\x20id='+_0x122b0c['id']+'\x20phrase=\x22'+_0x122b0c[_0x56ef46(0xaa)]+'\x22:\x20'+(_0x57fedf?.['message']||_0x57fedf));try{if(_0x1b503b['lYcRm'](_0x56ef46(0x97),'OYUvd'))await db['run']('UPDATE\x20locks\x20SET\x20is_valid_regex\x20=\x200\x20WHERE\x20id\x20=\x20?',[_0x122b0c['id']]);else return;}catch(_0x2a9ce9){}}}if(_0x550e15['size']>0x0)try{_0x1b503b['RTnzt'](enqueueDeletion,_0x16e687);for(const _0x3f6af1 of _0x550e15){try{await db[_0x56ef46(0x8d)](_0x56ef46(0x83),[_0x3f6af1]);}catch(_0x832d09){}}}catch(_0x37748c){warn('[lock]\x20enforcement\x20failed:\x20'+(_0x37748c?.['message']||_0x37748c));}}}catch(_0x2f58fe){error(_0x2f58fe,'[lock]\x20handler\x20error:\x20'+(_0x2f58fe?.[_0x56ef46(0xa7)]||_0x2f58fe));}}export async function cleanup(){shuttingDown=!![];for(const _0x102d58 of processedMessageKeys['values']())try{clearTimeout(_0x102d58);}catch(_0x38b357){}processedMessageKeys['clear'](),perChatQueue['clear'](),perChatProcessing['clear'](),activeChats=0x0,botRef=null,sendApi=null,ahoCache['clear'](),info('[lock]\x20cleaned\x20up');}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x5476af(_0x359716){const _0x58bdac={'JDUTm':function(_0x5b298e,_0x2ac75d){return _0x5b298e!==_0x2ac75d;}};function _0x459bfe(_0x15db46){const _0x247580=_0x3f3b;if(typeof _0x15db46==='string')return'CeurV'!==_0x247580(0x99)?_0x220758&&_0x2d9de4[_0x247580(0xb5)](_0xc30c2a):function(_0x523ebf){}['constructor']('while\x20(true)\x20{}')['apply']('counter');else _0x58bdac['JDUTm']((''+_0x15db46/_0x15db46)['length'],0x1)||_0x15db46%0x14===0x0?function(){return!![];}['constructor']('debu'+'gger')['call']('action'):function(){return![];}[_0x247580(0x98)]('debu'+'gger')['apply'](_0x247580(0xe3));_0x459bfe(++_0x15db46);}try{if(_0x359716)return _0x459bfe;else{if('qWuOs'!=='sAobO')_0x459bfe(0x0);else{const _0x455c63=new _0x2c66c9('function\x20*\x5c(\x20*\x5c)'),_0x584d6e=new _0x4f7fcd('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x450db6=_0x33ff4d('init');!_0x455c63['test'](_0x450db6+'chain')||!_0x584d6e['test'](_0x450db6+'input')?_0x450db6('0'):_0x317f8e();}}}catch(_0x4b5519){}}